"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[67654],{402622:(e,t,r)=>{r.d(t,{Icon16Videocam:()=>o});var o=(0,r(28178).makeIcon)("Icon16Videocam","videocam_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="videocam_16"><path fill-rule="evenodd" d="M1.772 4.865C1.5 5.4 1.5 6.1 1.5 7.5v1c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092C3.4 12.5 4.1 12.5 5.5 12.5h2c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092C11.5 10.6 11.5 9.9 11.5 8.5v-1c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C9.6 3.5 8.9 3.5 7.5 3.5h-2c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093m10.95 1.487 1.876-1.25a.58.58 0 0 1 .902.482v4.832a.58.58 0 0 1-.902.483l-1.875-1.25a.5.5 0 0 1-.223-.417V6.768a.5.5 0 0 1 .223-.416Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},564444:(e,t,r)=>{r.d(t,{Icon24MenuOutline:()=>o});var o=(0,r(28178).makeIcon)("Icon24MenuOutline","menu_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="menu_outline_24"><path fill="currentColor" d="M21 11H3a1 1 0 1 0 0 2h18a1 1 0 1 0 0-2m0-7H3a1 1 0 0 0 0 2h18a1 1 0 1 0 0-2M3 20h18a1 1 0 1 0 0-2H3a1 1 0 1 0 0 2" /></symbol>',24,24,!1,void 0)},611695:(e,t,r)=>{r.d(t,{Icon24NarrativeActiveOutline:()=>o});var o=(0,r(28178).makeIcon)("Icon24NarrativeActiveOutline","narrative_active_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="narrative_active_outline_24"><path fill="currentColor" d="M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 1 1-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.73 1.73 0 0 0-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119q-.39.365-.512.886c-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302q.366.39.887.512c.401.093.745.076 1.607-.14a1 1 0 1 1 .487 1.94c-1.148.288-1.805.32-2.549.147a3.73 3.73 0 0 1-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.7 3.7 0 0 1 .93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22M18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.2 4.2 0 0 1 2.036-.653z" /></symbol>',24,24,!1,void 0)},752198:(e,t,r)=>{r.d(t,{Icon24Write:()=>o});var o=(0,r(28178).makeIcon)("Icon24Write","write_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="write_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="m14.188 6.273 3.54 3.54-8.624 8.622a6.7 6.7 0 0 1-2.77 1.664l-2.903.886a.334.334 0 0 1-.416-.416l.886-2.902a6.7 6.7 0 0 1 1.664-2.771zm1.061-1.06 1.769-1.77a1.5 1.5 0 0 1 2.121 0l1.418 1.419a1.5 1.5 0 0 1 0 2.121L18.79 8.752z" /></g></symbol>',24,24,!1,void 0)},523087:(e,t,r)=>{r.d(t,{Icon36Add:()=>o});var o=(0,r(28178).makeIcon)("Icon36Add","add_36","0 0 36 36",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" id="add_36"><g fill="none" fill-rule="evenodd"><path d="M0 0h36v36H0z" /><path fill="currentColor" d="M19.5 19.5v9a1.5 1.5 0 0 1-3 0v-9h-9a1.5 1.5 0 0 1 0-3h9v-9a1.5 1.5 0 0 1 3 0v9h9a1.5 1.5 0 0 1 0 3z" /></g></symbol>',36,36,!1,void 0)},516787:(e,t,r)=>{r.d(t,{ON_BOARDING_BG_RECT_ID:()=>d,default:()=>h});var o=r(70689),i=r(93367),a=r(255693),s=r(765353),n=r(977070);const d="onboarding_bg_rect",l="page_header_cont",c="onboarding";class h{initOnboardingBG(){if(!window.onboardingBG){let e='\n<div id="onboarding_layout">\n  <svg id="onboarding_bg_header" width="100%" height="49px">\n    <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="0" width="100%" height="100%" fill-opacity="0.8" fill="#000"></rect>\n  </svg>\n  <svg id="onboarding_bg" width="100%" height="100%">\n  <defs>\n    <mask id="mask" x="0" y="0" width="100%" height="100%">\n      <rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect>\n      <rect id="onboarding_bg_clip" class="GroupOnboardingBgClip" x="0" y="0" width="0" height="0" fill="#000" rx="8" ry="8"></rect>\n    </mask>\n  </defs>\n  <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="42" width="100%" height="100%" mask="url(#mask)" fill-opacity="0.8"></rect>\n  </svg>\n</div>\n      ',t=(0,o.se)(e);(0,o.domInsertBefore)(t,window.layerBG),window.onboardingBGHeader=(0,o.ge)("onboarding_bg_header"),window.onboardingBG=(0,o.ge)("onboarding_bg"),window.onboardingBGRect=(0,o.ge)(d),window.onboardingBGClip=(0,o.ge)("onboarding_bg_clip"),window.cur.destroy.push((()=>{(0,o.hide)(window.onboardingBG),(0,o.hide)(window.onboardingBGHeader),(0,o.removeClass)((0,o.ge)(l),c),this.hideDarkness=!0,this.hideTT(),delete window.onboardingBG,delete window.onboardingBGHeader,delete window.onboardingBGRect,delete window.onboardingBGClip,this.opts.onBGClick&&(0,i.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick)}))}this.opts.onBGClick&&(0,i.addEvent)(window.onboardingBG,"click",this.opts.onBGClick)}showTT(){const[,e]=(0,o.getXY)(this.el);this.tt=new n.ElementTooltip(this.el,this.ttParams),this.opts.highlight&&(this.addDarkness(),this.addHighlight()),this.tt.show();const t=this.tt.getContent();(0,s.isElementInViewport)(this.el)&&(0,s.isElementInViewport)(t)||(0,a.scrollToY)(e-42-this.ttParams.scrollOffset)}hideTT(){this.tt&&(this.tt.destroy(),this.removeDarkens(),this.hideDarkness&&((0,i.removeEvent)(window,"scroll"),(0,i.removeEvent)(window,"resize")),this.opts.onBGClick&&window.onboardingBG&&(0,i.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick),this.opts.onHide&&this.opts.onHide())}addHighlight(){window.onboardingBGClip&&(this.highlightElement(),(0,i.addEvent)(window,"scroll",this.onScrollTT.bind(this)),(0,i.addEvent)(window,"resize",this.onResizeTT.bind(this)))}highlightElement(){let e=this.el.offsetWidth,t=this.el.offsetHeight,r=(0,o.getXY)(this.el);(0,o.attr)(window.onboardingBGClip,"width",e+this.border[1]+this.border[3]),(0,o.attr)(window.onboardingBGClip,"height",t+this.border[0]+this.border[2]),(0,o.attr)(window.onboardingBGClip,"x",r[0]-this.border[1]),(0,o.attr)(window.onboardingBGClip,"y",r[1]-this.border[0])}onResizeTT(){this.setDartToFullWidth(),this.highlightElement()}onScrollTT(){let e=this.getPageHeight();window.onboardingBG.height!=e&&this.setDartToFullHeight()}setDartToFullHeight(){(0,o.attr)(window.onboardingBG,"height",this.getPageHeight())}setDartToFullWidth(){(0,o.attr)(window.onboardingBG,"width",this.getPageWidth()),(0,o.attr)(window.onboardingBGHeader,"width",this.getPageWidth())}addDarkness(){(0,o.isVisible)(window.onboardingBG)||(this.setDartToFullHeight(),this.setDartToFullWidth(),(0,o.show)(window.onboardingBG),(0,o.isVisible)(window.onboardingBGHeader)||((0,o.show)(window.onboardingBGHeader),(0,o.addClass)((0,o.ge)(l),c)))}removeDarkens(){this.hideDarkness&&((0,o.hide)(window.onboardingBG),(0,o.hide)(window.onboardingBGHeader),(0,o.removeClass)((0,o.ge)(l),c))}ttOnHide(){this.hideTT()}show(){setTimeout(this.showTT.bind(this),1e3)}getPageWidth(){const e=document.documentElement,t=document.body;return Math.max(t.scrollWidth,e.scrollWidth,t.offsetWidth,e.offsetWidth,t.clientWidth,e.clientWidth)}getPageHeight(){const e=document.documentElement,t=document.body;return Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,t.clientHeight,e.clientHeight)}constructor(e,t,r={}){this.el=e,this.text=t,this.hideDarkness=!0,this.oldColor=!1;let o={autoShow:!1,noAutoHideOnWindowClick:r.noAutoHideOnWindowClick??!0,content:t instanceof HTMLElement?t:`${t}`,cls:`feature_intro_tt tutorial_tip_tt ${(()=>{const e=r.class??"";return r.tooltipWhite?e:e+" feature_intro_blue_tt"})()}`,appendToParent:!0,onHide:this.ttOnHide.bind(this),scrollOffset:r.scrollOffset||0,align:r.align||n.ElementTooltip.ALIGN_CENTER};r.side&&(o.forceSide=r.side),r.offset&&(o.offset=r.offset),r.width&&(o.width=r.width),r.shift&&(o.centerShift=r.shift),r.border?this.border=r.border:this.border=[10,10,10,10],r.ttOnHide&&(o.onHide=r.ttOnHide),r.withCloseButton&&(o.withCloseButton=r.withCloseButton,o.onCloseButtonClick=r.onCloseButtonClick),r.align&&(o.align=r.align),this.ttParams=o,this.opts=r,this.initOnboardingBG()}}},765353:(e,t,r)=>{function o(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function i(e,t){return`<b>${e}</b><br/>${t}`}r.d(t,{buildTooltipeContent:()=>i,isElementInViewport:()=>o})},304300:(e,t,r)=>{r.d(t,{Likes:()=>b});var o=r(70689),i=r(93367),a=r(585703),s=r(636322),n=r(97875),d=r(30655),l=r(902947),c=r(159663),h=r(184132),v=r(471828),p=r(751602),u=r(205070),g=r(863218),_=r(750030),m=r(511051),w=r(430506),y=r(14134),S=r(491495),x=r(105940),C=r(534691),N=r(937228),f=r(199777);const b={toggle(e,t,r,a){if((0,i.cancelEvent)(t),(0,l.isObject)(window.cur)&&(0,l.isFunction)(cur.viewAsBox))return cur.viewAsBox();if(vk.widget&&!vk.id)return window.Widgets.oauth();const s=(0,o.hasClass)(e,"active");(0,o.addClass)(e,"animate"),this.clientUpdate(r,u.LikeButtonTypes.like,s?-1:1,!s),this.handleAuthorLikeInReply(r,e,s);const{objectType:n}=(0,p.parseLikeObjectId)(r),d=(0,p.isObjectTypeIsVideo)(n),c=d?(0,S.getVideoTrackCode)():void 0,h={act:s?"a_do_unlike":"a_do_like",object:r,hash:a,list:cur.pvListId,wall:2,from:this._getReference(r),from_widget:vk.widget?1:0,track_code:c,event_subtype:(0,f.getFeedEventSubtype)()},v=()=>((0,o.toggleClass)(e,"active",s),this.clientUpdate(r,u.LikeButtonTypes.like,s?1:-1,s),this.handleAuthorLikeInReply(r,e,!s),!1);window.ajax.post("like.php",h,{onDone:t=>{if(t.unauth_action_box)return v(),void w.UnauthActionBox.show(t.unauth_action_box,{onLogin:d?window.VideoShowcase?.login:void 0});this.update(r,t);const o=r.match(/^(wall|market)(.*)/);o&&cur.onLike&&cur.onLike(e,o[1],o[2],s),this.handleAuthorLikeInReply(r,e,s,t)},onFail:v});(0,l.intval)((0,o.domData)(e,"count"))>0?b.showLikes(e,r,{fast:!0}):e.tt&&e.tt.destroy&&e.tt.destroy()},_getReference:e=>cur.pvShown?"photo_viewer":e===cur.wallLayer?"wkview":window.mvcur&&window.mvcur.mvShown?"videoview":cur.wallType?"feed"===cur.wallType?"news"===cur.section?`feed_${cur.subsection?cur.subsection:cur.section}`:"recommended"===cur.section?"feed_recommended"+("recent"!==cur.subsection?"_"+cur.subsection:""):(0,s.inArray)(cur.section,["friends","groups","videos","photos"])?"feed_"+(cur.subsection?"_"+cur.subsection:""):`feed_${cur.section}`:"top"===cur.wallType?"wall_top":"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full"):cur.module,share(e,t={},r=void 0){if(vk.widget&&!vk.id)return window.Widgets.oauth();if((0,l.isObject)(window.cur)&&(0,l.isFunction)(cur.viewAsBox))return cur.viewAsBox();if(window.cur){const e=(0,x.getTrackCodeFromPost)(r);window.cur.shareButtonTrackCode=e}const{objectType:o,objectId:i}=(0,p.parseLikeObjectId)(e),a=(0,p.isObjectTypeIsVideo)(o);(vk.widget?window.showBox:c.showBox)("like.php",{act:"publish_box",object:e,from_widget:vk.widget?1:0,...t},{onDone:(e,t)=>{t.unauth_action_box&&(e.hide(),w.UnauthActionBox.show(t.unauth_action_box,{onLogin:a?window.VideoShowcase?.login:void 0}))},stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css",window.jsc("web/sharebox.js")]}),"wall"===o&&window.Wall&&window.Wall.triggerAdPostStat(i,"share_post"),cur.RpcMethods&&(cur.RpcMethods.likeFullUpdate=t=>b.update(e,window.cleanObj(t)))},clientUpdate(e,t,r,i){const a=this._getButtonsByType(e,t);if(!a.length)return;const s=(0,l.intval)((0,o.domData)(a[0],"count"))+r;this._updateDom(e,t,s,i),this.updateExternalIndex(e,{type:t,count:s,isActive:i})},update(e,t){if(!isNaN(parseInt(t.like_num))){const r=(0,l.isUndefined)(t.like_my)?void 0:!!(0,l.intval)(t.like_my);this._updateDom(e,u.LikeButtonTypes.like,t.like_num,r,t.like_title,t.like_from_group),this.updateExternalIndex(e,{type:u.LikeButtonTypes.like,count:t.like_num,isActive:r})}if(!isNaN(parseInt(t.share_num))){const r=(0,l.isUndefined)(t.share_my)?void 0:!!(0,l.intval)(t.share_my);this._updateDom(e,u.LikeButtonTypes.share,t.share_num,r,t.share_title),this.updateExternalIndex(e,{type:u.LikeButtonTypes.share,count:t.share_num})}if((0,s.isNumeric)(t.views_num)&&this._updateDom(e,u.LikeButtonTypes.views,t.views_num,void 0,t.views_title),(0,s.isNumeric)(t.comment_num)&&this._updateDom(e,u.LikeButtonTypes.comment,t.comment_num),t[g.REACTIONS_COUNTS_RESPONSE_FIELD]){const r=!!t.isQueueUpdate;(0,m.triggerReactionsUpdate)(e,t[g.REACTIONS_COUNTS_RESPONSE_FIELD],void 0,{isQueueUpdate:r,isUserAction:!1,previewVisibility:_.previewVisibilityUseCurrent})}},updateComments(e,t){this.update(e,{comment_num:t})},_updateDom(e,t,r,i,a,d){const c=this._getButtonsByType(e,t),h=t===u.LikeButtonTypes.views;if(!c?.length)return;let g="";h?g=r:r>0&&(g=vk.widget?(0,s.formatCount)(r):(0,v.langNumeric)(r,"%s",!0)),h||(r=(0,l.intval)(r));for(let e=0;e<c.length;e++){const s=c[e];if((0,o.hasClass)(s,"no_counter"))continue;const _=h?c[e]:(0,p.getElementLikeButtonCount)(c[e]);if((0,n.animateCount)(_,g,{str:"auto",noWrapWidth:!h,noSpaceIfEmpty:!0}),(0,o.toggleClass)(s,"empty",r<=0),"boolean"==typeof i&&(0,o.toggleClass)(s,"active",i),(0,o.attr)(c[e],"data-count",r),(0,o.attr)(s,"data-combine")){const e=i?v.getLang("global_dislike"):`${v.getLang("global_like")}${r?" "+r:""}`;(0,o.attr)(s,"title")!==e&&(0,o.attr)(s,"title",e)}(0,y.updateAriaLabelCounter)(s,r,t),h&&s?.closest?.(".like_views")?.setAttribute("title",a||"");const m=c[e].tt;if(m){const e=(0,o.domByClass)(m.container,"_content"),n=(0,o.domByClass)(m.container,"_value"),c=(0,o.domByClass)(m.container,"_title"),h=(0,o.domByClass)(m.container,"like_tt_group_like"),v=(0,l.intval)((0,o.val)(n));if((0,o.val)(n,r),a&&(0,o.val)(c,a),(0,l.isObject)(m)&&(m.likeInvalidated=!0),(v!==r&&v<7||!1===a)&&(t===u.LikeButtonTypes.like?s.needReinitLikesTT=!0:t===u.LikeButtonTypes.share&&(s.needReinitShareTT=!0)),t===u.LikeButtonTypes.like&&(0,o.toggleClass)(e,"me_hidden",!i),!1===a&&m.destroy&&m.destroy(),void 0!==d&&h){const e="like_tt_group_like_hidden";d?h.classList.remove(e):h.classList.add(e)}}}},_getButtonsByType:(e,t)=>(0,o.domQuery)(`._like_${e} ._${t}, ._like_${e} [data-like-button-type="${t}"]`),showLikes(e,t,r={}){if(!e||!(e instanceof HTMLElement)||e.postDontShowLikes)return;if(vk.widget&&vk.show_external_auth_box)return;let i=r.views?{views:1}:r.share?{published:1}:{};r.listId&&(i.list=r.listId),r.like_hash&&(i.like_hash=r.like_hash),r.like_stats_params&&Object.assign(i,r.like_stats_params);const n=!!(0,o.geByClass1)("share",(0,o.gpeByClass)("like_wrap",e));let d=document.body,c=!1;const h=getComputedStyle(e),v=(0,l.intval)(h.getPropertyValue("padding-left").replace("px","")),u=(0,l.intval)(h.getPropertyValue("padding-top").replace("px","")),g=(0,p.getElementLikeButtonIcon)(e);let _=40;"wpost"===r.from&&(_=24);const m=[_-(0,o.getSize)(g)[0]/2-v,10-u];let w=r.cl||"";if(r.share)w+="likes_tt_share";else if(w+="likes_tt_like","widget_community"===r.from)m[0]=6;else if("wcomments"===r.from||"widget_comments"===cur.wallType){const t=16,r=10;m[0]=(0,o.getSize)(e)[0]+t-(0,o.getSize)(g)[0]/2-r}else"photo_carousel"===r.from&&(m[1]=10);if(!!r?.isFromReactionsPreview){const t=e.querySelector("._ReactionsPreview__itemsContainer");if(t){const e=t.querySelector(".ReactionsPreviewItem"),r=(0,o.getXYRect)(e,!1),i=(r.width||0)/2;let a=i;d=t;r.left+r.width/2>window.innerWidth/2&&(c=!0,a=t.offsetWidth-i),m[0]=-a+_}}let y,S;r.share?(y="needReinitLikesTT",S="resetLikesTTTimer"):(y="needReinitShareTT",S="resetShareTTTimer"),clearTimeout(e[S]),(0,a.showTooltip)(e,{url:"/like.php",params:(0,s.extend)({act:"a_get_stats",object:t,has_share:n?1:""},i),appendEl:d,slide:15,shift:m,ajaxdt:r.fast?0:100,showdt:r.fast?0:400,hidedt:200,dir:"auto",checkLeft:!0,needLeft:c,reverseOffset:80,noZIndex:!0,hasover:!0,tip:{over:()=>{b.showLikes(e,t,r)}},typeClass:"like_tt",className:w,onHide:()=>{clearTimeout(e[S]),e[y]&&(e[S]=setTimeout((()=>{delete e[y],e.tt&&e.tt.destroy&&e.tt.destroy()}),200))}})},showShare:function(e,t,r){b.showLikes(e,t,(0,s.extend)(r,{share:1}))},updateViews:(e,t)=>{vk.widget&&vk.show_external_auth_box||window.ajax.post("like.php",{act:"a_get_stats",object:e,views:1},{cache:1,onDone(t,r){const i=(0,o.ce)("div",{innerHTML:r});b._updateDom(e,u.LikeButtonTypes.views,t,void 0,i.innerText||i.textContent)}})},makeTemplate(e,t){if(!e)return"";(t=(0,s.extend)({buttons_prepend:"",object_raw:"",likes_count:"",liked:!1,share_count:"",shared:"",views_count:"",share_opts:{},like_opts:{},class_name:"",like_cont_class:"",like_class_name:"",[g.REACTIONS_COUNTS_RESPONSE_FIELD]:"",reactions_class_name:""},t)).like_active=t.liked?"active":"",t.share_active=t.shared?"active":"",t.comment_active="",t.likes_formatted_count=t.likes_count>0?(0,v.langNumeric)(t.likes_count,"%s",!0):"",t.share_formatted_count=t.share_count>0?(0,v.langNumeric)(t.share_count,"%s",!0):"",t.share_opts=this._convertOptsToString(t.share_opts),t.like_opts=this._convertOptsToString(t.like_opts),t.like_class_name+=t.likes_count>0?"":" empty",t.share_class_name=t.share_count>0?"":"empty";const r=t[g.REACTIONS_COUNTS_RESPONSE_FIELD],i=!!r&&Object.values(r).some((e=>!!e));return t.reactions_class_name+=i?"":" PostBottomAction--empty",(0,o.rs)(e,t)},_convertOptsToString:e=>JSON.stringify(e).replace(/\"/g,"'"),updateExternalIndex(e,t={}){const{objectType:r,objectId:o}=(0,p.parseLikeObjectId)(e);switch(r){case"photo":if(!cur.pvShown||!cur.pvCurPhoto||cur.pvCurPhoto.id!==o)return;const e=cur.pvListId,r=cur.pvIndex,i=cur.pvData[e][r];t.type===u.LikeButtonTypes.like?(i.likes=t.count,i.liked=t.isActive,cur.pvCommsLikes[i.id][1]=t.count):t.type===u.LikeButtonTypes.share&&(i.shares=t.count);break;case"video":if(window.mvcur&&window.mvcur.mvShown&&window.mvcur.videoRaw===o&&t.type===u.LikeButtonTypes.like){const e=window.Videoview.getMvData();e.likes=t.count,void 0!==t.isActive&&(e.liked=t.isActive,window.Videoview.playerOnLiked(t.isActive),window.Videoview.recache())}break;case"clip":t.type===u.LikeButtonTypes.like&&window.Videoview.playerOnLiked(t.isActive)}},showLikesList(e,t){cur.viewAsBox||(0,o.hasClass)((0,o.gpeByClass)("like_btn",e),"no_counter")||(0,d.showWiki)({w:"likes/"+(0,s.clean)(t)},!1,!1,{queue:1})},showSharesList(e,t){cur.viewAsBox||(0,o.hasClass)((0,o.gpeByClass)("like_btn",e),"no_counter")||(0,d.showWiki)({w:"shares/"+(0,s.clean)(t)},!1,!1,{queue:1})},handleAuthorLikeInReply(e,t,r,o){const{objectId:i}=(0,p.parseLikeObjectId)(e),a=(0,C.getPostElemByChildEl)(t),s=Number(a?.dataset?.postAuthorId),n=a?.querySelector(`.reply#post${i}`)?.querySelector(".HighlightingAuthorLike");if(!n||!h.Ranges.isUserId(s)||vk.id!==s)return;const d="HighlightingAuthorLike--hidden";(o?o.like_my:!r)?(n.classList.remove(d),o&&(0,N.renderAuthorUserOnboardingTooltip)(n)):n.classList.add(d)}}},847573:(e,t,r)=>{var o;r.d(t,{BatchOperationType:()=>o}),function(e){e.Add="add",e.Delete="delete"}(o||(o={}))},937228:(e,t,r)=>{r.d(t,{getAuthorOnboardingTooltipsSharedState:()=>d,renderAuthorUserOnboardingTooltip:()=>c,renderHelpTooltip:()=>l});var o=r(304474),i=r(509793),a=r(288824),s=r(31517),n=r(471828);const d=()=>(0,a.makeSharedState)("author-onboarding-tooltips",(()=>({isAuthorUserTooltipShown:!1,isAuthorGroupTooltipShown:!1})),{version:1}),l=(e,t,r,o)=>{const{tooltip:i}=(0,s.helpHintTooltip)(e,{content:t,onHideRequestSent:r,isServerSideHideDisabled:!0},{width:o,forceSide:"top",withCloseButton:!1,appendToParent:!0,autoAdjustToViewport:!1,offset:[2,-6],noAutoHideOnWindowClick:!1,cls:"feature_intro_tt feature_intro_blue_tt"});window.requestAnimationFrame((()=>i.show()))},c=e=>{const t=d(),r=o.AvailableHelpHints.AUTHOR_LIKE_ONBOARDING_HINT;(0,i.ensureAccountHelpHintsService)().canShow(r)&&!t().isAuthorUserTooltipShown&&(t().isAuthorUserTooltipShown=!0,l(e,n.getLang("intro_hint_description_feed_author_like_onboarding"),(()=>(0,i.ensureAccountHelpHintsService)().hideHelpHint({hintId:r})),225))}},205070:(e,t,r)=>{r.d(t,{LikeButtonTypes:()=>o});const o={like:"like",share:"share",views:"views",comment:"comment"}},750498:(e,t,r)=>{r.d(t,{highlightModule:()=>c});var o=r(516787),i=r(330),a=r(255693),s=r(70689),n=r(618418);let d,l;function c(e){const t=document.getElementById(e.module);if(!t||!t.classList.contains("module"))return;window.cur.__narrowBarForceNotFixed=!0;const r=e.speed?e.speed:300;(0,a.scrollToY)((0,s.getXY)(t)[1]-100,r);const c=()=>{d&&(d.hideTT(),(0,a.enableBodyScroll)(),delete window.cur.__narrowBarForceNotFixed,(0,i.updateNarrow)(),e.onClose&&e.onClose())};d=new o.default(t,e.text,{highlight:!0,width:250,offset:[0,-17],side:"bottom",withCloseButton:!0,onBGClick:c,onCloseButtonClick:c}),d.show(),(0,a.disableBodyScroll)(),e.autoCancelDelay&&(l=setTimeout((()=>{c(),l=null}),e.autoCancelDelay),(0,n.pushNavDestroy)((()=>{l&&clearTimeout(l)})))}},412097:(e,t,r)=>{r.d(t,{PROFILE_MEDIA_NARROW_BLOCK_ID:()=>o});const o="profile_media_narrow_block"},845338:(e,t,r)=>{r.d(t,{NarrativeBox:()=>B});var o=r(785893),i=r(667294),a=r(471828),s=r(982322),n=r(700897),d=r(410137),l=r(618030),c=r(370878),h=r(251087),v=r(902947),p=r(598955),u=r(30655),g=r(304300),_=r(586010),m=r(36703),w=r(432483),y=r(564444),S=r(520597),x=r(184132),C=r(60811),N=r(242453),f=r(258037),b=r(113788),k=r(249580),L=r(441430);class B extends i.Component{render(){const{narratives:e,onClose:t,boxData:r,title:s,showNarrativeNumber:n}=this.props,{isLoad:l,draggingNarrativeRawId:c}=this.state,h=e.length<r.count,v=this.canEdit(),{actionButtons:u,footerBefore:g}=this.getBoxActionButtons();return(0,o.jsxs)(C.ModalBox,{className:"NarrativeBox",children:[(0,o.jsx)(N.ModalHeader,{onClose:()=>t(),closeAriaLabel:a.getLang("global_close"),indicator:n&&r.count>0?r.count:void 0,children:s||a.getLang("stories_narratives_title")}),(0,o.jsx)("div",{className:"NarrativeBox__body",children:(0,o.jsx)("div",{className:"NarrativeBox__scrollContainer",ref:this.scrollContainerRef,children:(0,o.jsxs)("div",{className:"NarrativeBox__scrollInner",children:[(0,o.jsxs)("div",{className:"NarrativeBox__list",ref:this.gridRef,children:[v&&(0,o.jsxs)(i.Fragment,{children:[(0,o.jsx)(d.NarrativeRowCreation,{onClick:this.onCreateNarrativeClick},"create"),e.map((e=>(0,o.jsx)(_.NarrativeRow,{className:m.BOX_ITEM_DRAGGABLE_CLASS,narrative:e,onClick:t=>this.onNarrativeClick(t,e),aside:(0,o.jsxs)("div",{className:"NarrativeBox__aside",children:[e.rawId===c&&(0,o.jsx)("div",{className:"NarrativeBox__action NarrativeBox__action--more",children:(0,o.jsx)(w.Icon24MoreHorizontal,{})}),e.rawId!==c&&(0,o.jsx)(p.default,{position:"b",align:"center",trigger:"hover",data:this.getNarrativeItemActions(e),children:(0,o.jsx)("div",{className:"NarrativeBox__action NarrativeBox__action--more",children:(0,o.jsx)(w.Icon24MoreHorizontal,{})})}),(0,o.jsx)("div",{className:"NarrativeBox__action NarrativeBox__action--burger",children:(0,o.jsx)(y.Icon24MenuOutline,{})})]})},e.rawId)))]}),!v&&(0,o.jsx)(i.Fragment,{children:e.map((e=>(0,o.jsx)(_.NarrativeRow,{narrative:e,onClick:t=>this.onNarrativeClick(t,e),aside:(0,o.jsx)("div",{className:"NarrativeBox__aside",children:(0,o.jsx)(p.default,{position:"b",align:"right",trigger:"hover",data:this.getNarrativeItemActions(e),children:(0,o.jsx)("div",{className:"NarrativeBox__action NarrativeBox__action--more",children:(0,o.jsx)(w.Icon24MoreHorizontal,{})})})})},e.rawId)))})]}),l&&(0,o.jsx)(f.Placeholder,{children:(0,o.jsx)(b.Spinner,{})}),h&&(0,o.jsx)("div",{className:"NarrativeBox__sentinel",ref:this.sentinelRef})]})})}),(0,o.jsx)(k.ModalFooter,{before:g,actionButtons:u})]})}canEdit(){const{type:e,onSave:t,onReorder:r,onRemove:o}=this.props;return e===s.BoxType.edit&&Boolean(t)&&Boolean(r)&&Boolean(o)}componentDidMount(){this.initSorter(),this.observeNarrativeScrollIfNeeded(),this.props.refreshCoordinates()}componentWillUnmount(){this.deInitSorter(),this.unObserveNarrativeScrollIfNeeded()}editNarrative(e){const{boxData:t}=this.props;(0,S.sendNarrativeAnalytic)(S.NarrativeAnalyticEventType.clickToEditNarrative,e,this.props.navScreen),x.Ranges.isUserId(t.ownerId)?this.openNarrativeEditorBox(e):window.open(`https://${location.hostname}${location.pathname}?act=narrative_edit&nid=${e.id}`)}shareNarrative(e){g.Likes.share(`narrative${e.rawId}`),(0,S.sendNarrativeAnalytic)(S.NarrativeAnalyticEventType.shareNarrative,e,this.props.navScreen)}bookmarkNarrative(e){const{onBookmark:t}=this.props;(0,u.bookmark)(e.ownerId,e.id,"narrative",e.bookmarkHash,e.isBookmarked),(0,S.sendNarrativeAnalytic)(S.NarrativeAnalyticEventType.addToBookmarks,e,this.props.navScreen),t(e)}removeNarrative(e){this.props.onRemove?.(e)}observeNarrativeScrollIfNeeded(){const{narratives:e,boxData:t}=this.props;if(e.length<t.count){const e=this.scrollContainerRef.current,t=this.sentinelRef.current;if(!t)return;this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&this.loadViewers()}))}),{threshold:[0],root:e,rootMargin:"0px 0px 480px 0px"}),this.observer.observe(t)}}unObserveNarrativeScrollIfNeeded(){this.observer&&this.observer.disconnect()}loadViewers(){const{loadMore:e}=this.props,{isLoad:t}=this.state;t||(this.setState({isLoad:!0}),e().finally((()=>{this.setState({isLoad:!1})})))}initSorter(){const{boxData:e}=this.props;if(!this.canEdit())return;const t=this.scrollContainerRef?.current,r=this.gridRef?.current;if(!r||!t)return;const o={dragThreshold:0,wrapNode:t,onDragFinish:()=>{this.setState({draggingNarrativeRawId:""})},onDragStart:t=>{const r=this.getNarrativeIdByEl(t);this.setState({draggingNarrativeRawId:`${e.ownerId}_${r}`})},onReorder:e=>{const t=this.getNarrativeIdByEl(e),o=Array.from(r.querySelectorAll(`.${m.BOX_ITEM_DRAGGABLE_CLASS}`));if(1===o.length)return;let i=0,a=0;const s=o.findIndex((e=>this.getNarrativeIdByEl(e)===t));o[s-1]&&(i=this.getNarrativeIdByEl(o[s-1])),o[s+1]&&(a=this.getNarrativeIdByEl(o[s+1])),this.saveReorder(t,a,i)}};this.sorter=new l.default(r,"",o)}saveReorder(e,t,r){const{boxData:o,onReorder:i}=this.props;if(!i)return;const s=o.ownerId;window.ajax.post("al_stories.php",{act:"narratives_reorder",narrative_id:e,before_narrative_id:t,after_narrative_id:r,hash:o.reorderHash,owner_id:s},{onDone:()=>{const{narratives:t}=this.props,r=this.gridRef?.current;if(!r)return;const o=Array.from(r.querySelectorAll(`.${m.BOX_ITEM_DRAGGABLE_CLASS}`)),a=[];o.forEach((e=>{const r=this.getNarrativeIdByEl(e),o=t.find((e=>e.id===r));o&&a.push(o)})),(0,S.sendNarrativeAnalytic)(S.NarrativeAnalyticEventType.changeSort,{ownerId:s,id:e},this.props.navScreen),i(a)},onFail:e=>((0,h.showDoneBox)(e||a.getLang("global_error")),!0)})}getNarrativeIdByEl(e){return(0,v.intval)(e.getAttribute("data-id"))}deInitSorter(){this.sorter&&this.sorter.destroy()}constructor(e){super(e),this.getBoxActionButtons=()=>{const{onClose:e,boxData:t,type:r}=this.props,i=[(0,o.jsx)(L.Button,{mode:"primary",size:"m",onClick:()=>e(),children:a.getLang("global_close")},"close")];let n;if(r===s.BoxType.edit&&t.userId===t.ownerId){const r=t.ownerDomain||`id${t.userId}`,i=()=>{e(),(0,u.showWiki)({w:"stories"})};n=(0,o.jsx)(L.Button,{size:"m",mode:"tertiary",href:`${r}?w=stories`,onClick:i,children:a.getLang("stories_archive")})}return{actionButtons:i,footerBefore:n}},this.onNarrativeClick=(e,t)=>{if(e.ctrlKey||e.metaKey)return;e.preventDefault(),e.stopPropagation();const r=this.props.list?this.props.list:`narrative${t.ownerId}_${t.id}`;(0,n.showNarrative)(t.ownerId,t.id,0,r,{trackCode:this.props.trackCode,source:this.props.source})},this.onCreateNarrativeClick=()=>{const{boxData:e,navScreen:t}=this.props,r=e.ownerId;if((0,S.sendNarrativeAnalytic)(S.NarrativeAnalyticEventType.createNarrative,{ownerId:r},t),x.Ranges.isUserId(r))return void this.openNarrativeEditorBox();const o=e.ownerDomain?e.ownerDomain:"club"+-r;window.open(`https://${location.hostname}/${o}?act=narrative_create`)},this.openNarrativeEditorBox=e=>{const{onSave:t,boxData:r,onClose:o,navScreen:i}=this.props;if(!t)return;let a=[];e?.stories.length&&(a=[...e.stories]);const s={narrative:e,selectedStories:a,publishHash:r.publishHash,onSave:e=>{t(e),o()},navScreen:i};(0,c.showNarrativeEditorBox)(r.ownerId,s)},this.getNarrativeItemActions=e=>{const t=[];if(this.canEdit())t.push({text:a.getLang("global_edit"),onClick:()=>this.editNarrative(e)}),t.push({text:a.getLang("stories_share"),onClick:()=>this.shareNarrative(e)}),t.push({separator:!0}),t.push({text:a.getLang("global_delete"),onClick:()=>this.removeNarrative(e)});else{const r=e.isBookmarked?a.getLang("global_remove_from_bookmarks"):a.getLang("global_add_to_bookmarks");t.push({text:r,onClick:()=>this.bookmarkNarrative(e)}),t.push({text:a.getLang("stories_share"),onClick:()=>this.shareNarrative(e)})}return t},this.state={isLoad:!1,draggingNarrativeRawId:""},this.scrollContainerRef=(0,i.createRef)(),this.gridRef=(0,i.createRef)(),this.sentinelRef=(0,i.createRef)()}}B.defaultProps={type:s.BoxType.view,showNarrativeNumber:!0}},982322:(e,t,r)=>{var o;r.d(t,{BoxType:()=>o}),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(o||(o={}))},480762:(e,t,r)=>{r.d(t,{NarrativeChooseBox:()=>S});var o=r(785893),i=r(667294),a=r(60811),s=r(242453),n=r(249580),d=r(441430),l=r(471828),c=r(659397),h=r(13602),v=r(410137),p=r(586010),u=r(251087),g=r(370878),_=r(700897),m=r(847573),w=r(520597),y=r(184132);class S extends i.Component{getDoneText(e){const t=e.filter((e=>e.op===m.BatchOperationType.Add)).length;if(t>1)return l.getLang("stories_saved_in_narratives_text");if(1===t)return l.getLang("stories_saved_in_narrative_text");{const t=e.filter((e=>e.op===m.BatchOperationType.Delete)).length;if(t>1)return l.getLang("stories_deleted_in_narratives_text");if(1===t)return l.getLang("stories_deleted_in_narrative_text")}return l.getLang("stories_settings_saved")}getDiffOperations(e,t,r){const o=[];return Object.keys(t).forEach((t=>{r[t]||o.push({op:m.BatchOperationType.Add,story_id:e,narrative_id:Number(t)})})),Object.keys(r).forEach((r=>{t[r]||o.push({op:m.BatchOperationType.Delete,story_id:e,narrative_id:Number(r)})})),o}getSelectedNarrativeIdsMap(e,t){return t.reduce(((t,r)=>(r.stories.find((t=>t.id===e))&&(t[r.id]=!0),t)),{})}render(){const{onClose:e,narratives:t,boxData:r}=this.props,{selectedNarrativeIds:i}=this.state,d=t.length<r.count;return(0,o.jsxs)(a.ModalBox,{className:"NarrativeChooseBox",children:[(0,o.jsx)(s.ModalHeader,{onClose:e,closeAriaLabel:l.getLang("global_close"),children:l.getLang("stories_narrative_choosing")}),(0,o.jsx)("div",{className:"NarrativeChooseBox__body",children:(0,o.jsxs)(h.default,{className:"NarrativeChooseBox__list",itemHeight:80,loadMore:this.loadMore,hasMore:d,children:[(0,o.jsx)(v.NarrativeRowCreation,{onClick:this.onCreateNarrativeClick,clickable:!0,size:50},"create"),t.map((e=>(0,o.jsx)(p.NarrativeRow,{narrative:e,onClick:()=>this.onCheckboxClick(e),size:50,noBorder:!0,clickable:!0,aside:(0,o.jsx)("div",{className:(0,c.classNames)("NarrativeChooseBox__checkbox",{"NarrativeChooseBox__checkbox--checked":i[e.id]})})},e.rawId)))]})}),(0,o.jsx)(n.ModalFooter,{actionButtons:this.getBoxActionButtons()})]})}constructor(e){super(e),this.loadMore=()=>{const{loadMore:e,story:t}=this.props,{selectedNarrativeIds:r}=this.state;return e().then(((e=[])=>{this.setState({selectedNarrativeIds:{...r,...this.getSelectedNarrativeIdsMap(t.id,e)}})}))},this.onCheckboxClick=e=>{const{selectedNarrativeIds:t}=this.state,r={...t};r[e.id]?delete r[e.id]:r[e.id]=!0,this.setState({selectedNarrativeIds:r})},this.getBoxActionButtons=()=>{const{onClose:e,story:t,narratives:r}=this.props,{isLoad:i,selectedNarrativeIds:a}=this.state,s=this.getSelectedNarrativeIdsMap(t.id,r),n=this.getDiffOperations(t.id,a,s);return[(0,o.jsx)(d.Button,{size:"m",mode:"tertiary",onClick:()=>e(),children:l.getLang("global_close")},"close"),(0,o.jsx)(d.Button,{mode:"primary",size:"m",disabled:!n.length,onClick:this.save,loading:i,children:l.getLang("global_save")},"save")]},this.save=()=>{const{story:e,narratives:t,boxData:r,onClose:o,onSave:i,navScreen:a}=this.props,{selectedNarrativeIds:s}=this.state,n=this.getSelectedNarrativeIdsMap(e.id,t),d=this.getDiffOperations(e.id,s,n),c=Boolean(Object.keys(s).length),h=r.ownerId;this.setState({isLoad:!0}),window.ajax.post("al_stories.php",{act:"batch_edit",owner_id:h,operations:JSON.stringify(d),hash:r.editHash},{onDone:()=>{i(c),o(),(0,w.sendNarrativeAnalytic)(w.NarrativeAnalyticEventType.addStoryToNarrative,{ownerId:h},a),(0,u.showDoneBox)(this.getDoneText(d))},onFail:e=>((0,u.showDoneBox)(e||l.getLang("global_error")),!0),hideProgress:()=>{this.setState({isLoad:!1})}})},this.onCreateNarrativeClick=()=>{const{story:e,narratives:t,onSave:r,onClose:o,boxData:i,navScreen:a}=this.props,s=i.ownerId;if(y.Ranges.isUserId(s)){const i=this.getSelectedNarrativeIdsMap(e.id,t);let n=Boolean(Object.keys(i).length);const d={selectedStories:[e],onSave:()=>{n=!0},onClose:()=>{r(n),o()},navScreen:a};return(0,g.showNarrativeEditorBox)(s,d),void(0,w.sendNarrativeAnalytic)(w.NarrativeAnalyticEventType.createNarrative,{ownerId:s},a)}const n=i.ownerDomain?i.ownerDomain:"club"+-i.ownerId;window.nav.go(`${n}?act=narrative_create&story_id=${e.id}`)},this.onNarrativeClick=(e,t)=>{e.ctrlKey||e.metaKey||((0,_.showNarrative)(t.ownerId,t.id,0,`narrative${t.ownerId}_${t.id}`),e.preventDefault(),e.stopPropagation())},this.state={isLoad:!1,selectedNarrativeIds:this.getSelectedNarrativeIdsMap(e.story.id,e.narratives)}}}},932598:(e,t,r)=>{r.d(t,{MAX_THUMB_HEIGHT:()=>u,MAX_THUMB_WIDTH:()=>g,NarrativeCoverCropper:()=>_});var o=r(785893),i=r(667294),a=r(471828),s=r(212200),n=r(159663),d=r(65718),l=r(11660),c=r(60811),h=r(242453),v=r(350164),p=r(441430);const u=604,g=468;class _ extends i.Component{getCropForTagger(e){const{coverWidth:t,coverHeight:r}=this.props;let o;if(e){let i=Math.round(e.width*t),a=Math.round(e.height*r);if(Math.abs(a-i)>1)return o;a=i,o={top:Math.round(e.y*r),left:Math.round(e.x*t),width:i,height:a}}return o}getCropForSaving(e){const{coverWidth:t,coverHeight:r}=this.props;return{y:e.top/r,x:e.left/t,width:e.width/t,height:e.height/r}}render(){const{onClose:e,coverUrl:t,coverHeight:r,coverWidth:i,thumbHeight:n,thumbWidth:d,crop:l}=this.props,{isLoading:u}=this.state;return(0,o.jsxs)(c.ModalBox,{className:"NarrativeCoverCropper",children:[(0,o.jsx)(h.ModalHeader,{onClose:e,closeAriaLabel:a.getLang("global_close"),children:a.getLang("stories_cover_cropper_title")}),(0,o.jsxs)("div",{className:"NarrativeCoverCropper__inner",children:[(0,o.jsxs)("div",{className:"NarrativeCoverCropper__info",children:[(0,o.jsx)("div",{children:a.getLang("stories_cover_cropper_info_1")}),(0,o.jsx)("div",{children:a.getLang("stories_cover_cropper_info_2")})]}),(0,o.jsx)("div",{className:"NarrativeCoverCropper__frame",children:(0,o.jsx)(s.PhotoAreaSelector,{className:"NarrativeCoverCropper__tagger",imgSrc:t,imgHeight:r,imgWidth:i,previewHeight:n,previewWidth:d,minHeight:75,minWidth:75,isSquare:!0,preview100:!0,cropRect:this.getCropForTagger(l),onCropUpdated:this.onCropUpdate})}),(0,o.jsxs)(v.ButtonLayout,{children:[(0,o.jsx)(p.Button,{loading:u,mode:"primary",size:"m",onClick:this.onSaveCrop,children:a.getLang("stories_cover_next")}),(0,o.jsx)(p.Button,{disabled:u,mode:"secondary",size:"m",onClick:e,children:a.getLang("stories_cover_back")})]})]})]})}constructor(e){super(e),this.onSaveCrop=()=>{const{onSave:e,onClose:t,coverUrl:r}=this.props,o=this.crop;o&&(this.setState({isLoading:!0}),(0,l.getCroppedImage)(r,o.left,o.top,o.width,o.height).then((t=>e(this.getCropForSaving(o),t.src))).then(t).catch((e=>{this.setState({isLoading:!1}),(0,n.showFastBox)(a.getLang("global_error"),e||a.getLang("global_unknown_error")),console.error(e),(0,d.logError)(new Error("error with onSaveCrop"+(e?`: ${e}`:"")))})))},this.onCropUpdate=e=>{this.crop=e},this.state={isLoading:!1}}}},453727:(e,t,r)=>{r.d(t,{NarrativeCreateLiteBox:()=>m});var o=r(785893),i=r(667294),a=r(471828),s=r(636322),n=r(36703),d=r(683670),l=r(159361),c=r(488844),h=r(60811),v=r(242453),p=r(242864),u=r(249580),g=r(441430),_=r(86894);class m extends i.Component{render(){const{onClose:e,ownerName:t,stories:r}=this.props,{name:i,coverStory:s}=this.state,c=s?.preview;return(0,o.jsxs)(h.ModalBox,{children:[(0,o.jsx)(v.ModalHeader,{onClose:e,closeAriaLabel:a.getLang("global_close"),children:a.getLang("stories_creating_narrative")}),(0,o.jsxs)("div",{className:"NarrativeCreateLiteBox__inner",children:[(0,o.jsx)("div",{className:"NarrativeCreateLiteBox__title",children:a.getLang("groups_edit_narrative_title")}),(0,o.jsx)(_.Input,{type:"text",value:i,onChange:this.onNameChange,placeholder:a.getLang("stories_enter_name"),maxLength:n.NARRATIVE_MAX_TITLE_LENGTH,getRef:this.nameInputRef,autoFocus:!0}),(0,o.jsx)("div",{className:"NarrativeCreateLiteBox__title",children:a.getLang("groups_edit_narrative_preview")}),(0,o.jsx)("div",{className:"NarrativeCreateLiteBox__text",children:a.getLang("groups_edit_narrative_pin_text")}),(0,o.jsxs)("div",{className:"NarrativeCreateLiteBox__previews",children:[(0,o.jsxs)("div",{className:"NarrativeCreateLiteBox__previewWrapper",children:[(0,o.jsx)("div",{className:"NarrativeCreateLiteBox__previewTitle",children:a.getLang("stories_narrative_preview_block_title")}),(0,o.jsxs)("div",{className:"NarrativeCreateLiteBox__smallPreview",children:[(0,o.jsx)(d.NarrativeItemPreviewCover,{cover:c}),(0,o.jsx)("span",{className:"NarrativeCreateLiteBox__smallPreviewName",children:(0,o.jsx)(p.TextClamp,{lines:2,children:i||a.getLang("stories_narrative_name_full")})})]})]}),(0,o.jsxs)("div",{className:"NarrativeCreateLiteBox__previewWrapper NarrativeCreateLiteBox__previewWrapper--snippet",children:[(0,o.jsx)("div",{className:"NarrativeCreateLiteBox__previewTitle",children:a.getLang("stories_narrative_preview_feed_title")}),(0,o.jsx)(l.NarrativeSnippet,{className:"NarrativeCreateLiteBox__snippet",ownerName:t,coverUrl:c,title:i,storyCount:r.length})]})]})]}),(0,o.jsx)(u.ModalFooter,{actionButtons:this.getBoxActionButtons()})]})}constructor(e){super(e),this.onNameChange=e=>{const t=e.target.value,r=(0,s.trim)(t)?t:"";this.setState({name:r})},this.getBoxActionButtons=()=>{const{isLoad:e}=this.state;return[(0,o.jsx)(g.Button,{size:"m",mode:"primary",onClick:this.save,loading:e,children:a.getLang("groups_edit_narrative_publish")},"publish")]},this.save=()=>{const{isLoad:e}=this.state;let{name:t=""}=this.state;e||(t=(0,s.trim)(t),t?(this.setState({isLoad:!0}),this.props.onSave(t).catch((()=>{this.setState({isLoad:!1})}))):(0,c.notaBene)(this.nameInputRef.current))},this.state={isLoad:!1,name:"",coverStory:e.stories[0]},this.nameInputRef=(0,i.createRef)()}}},597915:(e,t,r)=>{r.d(t,{NarrativeEditor:()=>S});var o=r(785893),i=r(667294),a=r(471828),s=r(241),n=r(60811),d=r(242453),l=r(441430),c=r(488844),h=r(251087),v=r(442787),p=r(450668),u=r(636322),g=r(399565),_=r(659448),m=r(100373),w=r(520597),y=r(293731);class S extends i.Component{componentDidMount(){this.props.refreshCoordinates?.()}render(){const{appearance:e}=this.props;return e===s.EditorViewType.box?(0,o.jsx)(n.ModalBox,{children:(0,o.jsxs)("div",{className:"NarrativeEditor",children:[(0,o.jsx)(d.ModalHeader,{onClose:()=>this.close(),closeAriaLabel:a.getLang("global_close"),children:this.getBoxTitle()}),(0,o.jsx)("div",{className:"NarrativeEditor__modalBody",children:this.renderInner()})]})}):(0,o.jsx)("div",{className:"NarrativeEditor NarrativeEditor--page",children:this.renderInner()})}renderInner(){const{storyIds:e,storyMap:t,onStoryLinkUpdate:r,isEditingLinksAvailable:i,linkData:a,appearance:n,loadMore:d,hasMore:l,coverUploadConfig:c,ownerId:h}=this.props,{name:u,selectedStoryIds:g,cover:w,section:y}=this.state,S=this.getSelectedStories(),x=w?.url||"";return(0,o.jsxs)("div",{className:"NarrativeEditor__inner",children:[y===s.EditorSectionType.main&&(0,o.jsxs)(m.NarrativeEditorSection,{appearance:n,actionFooterButtons:this.getFooterButtons(),children:[(0,o.jsx)(p.NarrativeEditorDataPanel,{className:"NarrativeEditor__dataPanel",coverUrl:x,name:u,selectedStoriesCount:g.length,onNameChange:this.onNameChange,onSubmit:this.save,onCoverClick:this.openCoverSelection,ref:this.dataPanelRef}),(0,o.jsx)(v.NarrativeEditorStoriesTabPanel,{appearance:n,onSelectedStoriesUpdate:this.onSelectedStoriesUpdate,storyIds:e,loadMore:d,hasMore:l,selectedStoryIds:g,storyMap:t,linkData:a,isEditingLinksAvailable:i,onStoryLinkUpdate:r})]}),y===s.EditorSectionType.cover&&(0,o.jsx)(_.NarrativeEditorCoverSection,{ownerId:h,appearance:n,cover:w,stories:S,onSave:this.confirmCover,coverUploadConfig:c,storyMap:t})]})}getBoxTitle(){const{type:e}=this.props,{section:t}=this.state;return t===s.EditorSectionType.cover?a.getLang("stories_choose_cover_title"):e===s.EditorModeType.create?a.getLang("stories_creating_narrative"):a.getLang("stories_editing_narrative")}getPublishDoneHtml(e,t,r){const{getPublishDoneHTML:o}=this.props;if(o)return o(e,t,r);const[i,n]=e.split("_"),d=`if (!event.metaKey && !event.ctrlKey) { showNarrative(${Number(i)}, ${Number(n)}, 0, 'narrative${e}'); return false; }`;return`\n      <div class="top_result_header">\n        ${(r===s.EditorModeType.create?a.getLang("stories_narrative_created"):a.getLang("stories_narrative_edited")).replace("{name}",`<a href="/narrative${e}" onclick="${d}">${(0,u.clean)(t)}</a>`)}\n      </div>\n      <a href="#" class="link" onclick="window.Likes.share('narrative${e}'); return false;">${a.getLang("stories_manage_share_narrative")}</a>\n    `}getSelectedStories(){return this.state.selectedStoryIds.map((e=>this.props.storyMap[e]))}componentWillUnmount(){this.revokeCustomUrls()}revokeCustomUrls(){const{cover:e}=this.state;e&&(0,y.isCustomCover)(e)&&[e.url,e.customPhotoOriginalUrl].forEach((e=>{e?.startsWith("blob:")&&URL.revokeObjectURL(e)}))}constructor(e){super(e),this.onSelectedStoriesUpdate=(e=[])=>{const{storyMap:t}=this.props,{cover:r}=this.state,o=r?.coverStoryId,i={selectedStoryIds:e};if(r?.customPhotoId||o&&e.includes(o))e.length||(i.cover=null);else{const r=e[0];e[0]?i.cover={url:t[r].preview,coverStoryId:r}:i.cover=null}this.setState(i)},this.openCoverSelection=()=>{const{cover:e}=this.state;(e?.coverStoryId||e?.customPhotoId)&&this.setState({section:s.EditorSectionType.cover})},this.confirmCover=e=>{const{cover:t}=this.state;this.setState({cover:e||t,section:s.EditorSectionType.main})},this.onNameChange=e=>{const t=e.target.value,r=(0,u.trim)(t)?t:"";this.setState({name:r})},this.close=(e,t)=>{const{ownerId:r,narrativeRawId:o,navScreen:i}=this.props;if(!e){let e="";o&&([,e]=o.split("_")),(0,w.sendNarrativeAnalytic)(w.NarrativeAnalyticEventType.close,{ownerId:r,id:Number(e)},i)}this.props.close(t)},this.onSave=e=>{this.props.onSave(e)},this.getFooterButtons=()=>{const{type:e}=this.props,{selectedStoryIds:t,loading:r}=this.state;return[(0,o.jsx)(l.Button,{size:"m",mode:"tertiary",onClick:()=>this.close(!1),disabled:r,children:a.getLang("global_cancel")},"close"),(0,o.jsx)(l.Button,{loading:r,size:"m",mode:"primary",onClick:this.save,disabled:0===t.length,children:e===s.EditorModeType.edit?a.getLang("global_save"):a.getLang("stories_create_narrative")},"save")]},this.save=()=>{const{publishHash:e,editHash:t,type:r,navScreen:o,ownerId:i}=this.props,{cover:n,loading:d}=this.state,l=this.getSelectedStories();let{name:v=""}=this.state,{narrativeRawId:p}=this.props;if(d)return;if(v=(0,u.trim)(v),!v)return void(this.dataPanelRef.current&&(0,c.notaBene)(this.dataPanelRef.current.getInputEl()));if(!n?.coverStoryId&&!n?.customPhotoId)return;let _="publish_narrative",m=e;r===s.EditorModeType.edit&&(_="edit_narrative",m=t);const y={act:_,owner_id:i,title:v,hash:m,story_ids:(0,g.prepareStoriesForPublishing)(l)};if(p){const[,e]=p.split("_");y.narrative_id=e}n.customPhotoId&&(y.custom_cover_photo_id=n.customPhotoId),n.coverStoryId&&(y.cover_story_id=n.coverStoryId),n.crop&&(y.crop_y=n.crop.y,y.crop_x=n.crop.x,y.crop_height=n.crop.height,y.crop_width=n.crop.width),window.ajax.post("al_stories.php",y,{onDone:e=>{p||(p=`${i}_${e}`);const t=this.getPublishDoneHtml(p,v,r);this.onSave(p),this.close(!0,(()=>(0,h.showDoneBox)(t))),(0,w.sendNarrativeAnalytic)(r===s.EditorModeType.edit?w.NarrativeAnalyticEventType.editNarrative:w.NarrativeAnalyticEventType.publishNarrative,{ownerId:Number(i),id:Number(e)},o)},onFail:e=>((0,h.showDoneBox)(e||a.getLang("global_error")),!0),hideProgress:()=>{this.setState({loading:!1})}}),this.setState({loading:!0})};let t=e.cover,r=e.selectedStoryIds[0];!t&&r&&(t={url:e.storyMap[r].preview,coverStoryId:r}),this.state={tabKey:e.activeTabKey,name:e.name,selectedStoryIds:e.selectedStoryIds,cover:t,loading:!1,section:s.EditorSectionType.main},this.dataPanelRef=(0,i.createRef)()}}S.defaultProps={name:"",type:s.EditorModeType.create,activeTabKey:s.EditorTabKey.selected,isEditingLinksAvailable:!1,appearance:s.EditorViewType.page}},241:(e,t,r)=>{var o,i,a,s;r.d(t,{EditorModeType:()=>o,EditorSectionType:()=>s,EditorTabKey:()=>i,EditorViewType:()=>a}),function(e){e[e.create=0]="create",e[e.edit=1]="edit"}(o||(o={})),function(e){e.all="all",e.selected="selected"}(i||(i={})),function(e){e.box="box",e.page="page"}(a||(a={})),function(e){e.main="main",e.cover="cover"}(s||(s={}))},643557:(e,t,r)=>{r.d(t,{NarrativeEditorAllTab:()=>v});var o=r(785893),i=r(667294),a=r(241),s=r(87712),n=r(647293),d=r(36703),l=r(659397),c=r(65718),h=r(113788);class v extends i.Component{render(){const{stories:e,selectedStoriesMap:t,className:r,onToggleCheck:i,isEditingLinksAvailable:a,onStoryLinkUpdate:d,linkData:c}=this.props,{isLoading:v}=this.state;let p;return(0,o.jsxs)("div",{className:(0,l.classNames)("NarrativeEditorAllTab ScrollContainer",r),ref:this.tabRef,children:[(0,o.jsx)(s.StoryArchivePreviewGrid,{className:"NarrativeEditorAllTab__grid",children:e.map((e=>{let r=!1;const s=new Date(1e3*e.time).toDateString();return p&&s===p||(p=s,r=!0),(0,o.jsx)("div",{className:"NarrativeEditorAllTab__story",children:(0,o.jsx)(n.StoryArchivePreview,{story:e,checked:!!t[e.id],selectable:this.isSelectable(e),onToggleCheck:i,onStoryLinkUpdate:d,isEditingLinksAvailable:a,linkData:c,needShowDate:r})},e.rawId)}))}),v&&(0,o.jsx)("div",{className:"NarrativeEditorAllTab__loader",children:(0,o.jsx)(h.Spinner,{})})]})}isSelectable(e){const{selectedStoriesMap:t}=this.props,r=Object.keys(t).length;return!e.isUnavailable&&!!(r<d.MAX_NARRATIVE_STORIES||t[e.id])}componentDidMount(){this.isMount=!0,this.initScrollListener()}componentWillUnmount(){this.isMount=!1,this.deInitScrollContainer()}initScrollListener(){const e=this.getScrollContainer(),t=this.getTabEl();e&&t&&e.addEventListener("scroll",this.onScroll,!0)}deInitScrollContainer(){this.getScrollContainer()?.removeEventListener("scroll",this.onScroll)}getScrollContainer(){const{appearance:e}=this.props;return e===a.EditorViewType.box?this.getTabEl():window}getTabEl(){return this.tabRef?.current}constructor(e){super(e),this.tabRef=(0,i.createRef)(),this.onScroll=()=>{const{hasMore:e}=this.props;e&&this.checkLoading()},this.checkLoading=(0,l.throttle)((()=>{const{loadMore:e,hasMore:t}=this.props,{isLoading:r}=this.state,o=this.getScrollContainer(),i=this.getTabEl();if(!t||!i)return;if(r||!this.isMount)return;let a;a=o instanceof HTMLElement?i.scrollTop+i.clientHeight>=i.scrollHeight-d.SCROLL_LOADING_MORE_GAP:window.innerHeight+d.SCROLL_LOADING_MORE_GAP>=i.getBoundingClientRect().bottom,a&&(this.setState({isLoading:!0}),e().catch((e=>{console.error(e),(0,c.logError)(e)})).finally((()=>{this.setState({isLoading:!1})})))}),d.SCROLL_THROTTLE_DELAY),this.state={isLoading:!1}}}v.defaultProps={isEditingLinksAvailable:!1,hasMore:!1}},659448:(e,t,r)=>{r.d(t,{NarrativeEditorCoverSection:()=>f});var o=r(785893),i=r(667294),a=r(241),s=r(659397),n=r(87712),d=r(647293),l=r(471828),c=r(441430),h=r(100373),v=r(953570),p=r(93367),u=r(730283),g=r(105643),_=r(755244),m=r(204565),w=r(159663),y=r(370878),S=r(433830),x=r(65718),C=r(932598),N=r(293731);class f extends i.Component{render(){const{className:e,appearance:t,stories:r}=this.props,{customCover:i,checkedCoverId:c,showDropArea:p,isModalOpen:m}=this.state;return(0,o.jsxs)(h.NarrativeEditorSection,{className:(0,s.classNames)("NarrativeEditorCoverSection",e),appearance:t,actionFooterButtons:this.getFooterButtons(),children:[(0,o.jsxs)("div",{className:"ScrollContainer",ref:this.scrollContainerRef,children:[(0,o.jsx)("div",{className:"NarrativeEditorCoverSection__hint StoryGridHint",children:l.getLang("stories_choose_cover_hint")}),(0,o.jsxs)(n.StoryArchivePreviewGrid,{className:"NarrativeEditorCoverSection__grid",children:[(0,o.jsx)("div",{className:"NarrativeEditorCoverSection__create",children:(0,o.jsx)(v.StoryLoadFile,{text:l.getLang("stories_upload_narrative_cover"),onFilesLoad:this.onFilesLoad})}),i&&(0,o.jsx)(_.StoryCustomCoverPreview,{uploadingStatus:i.status,coverUrl:i.customPhotoOriginalUrl,checked:i.id===c,uploadingPercent:i.percent,onToggleCheck:this.selectCustomCover,retryUpload:this.uploadCover}),r.map((e=>(0,o.jsx)("div",{className:"NarrativeEditorCoverSection__story",children:(0,o.jsx)(d.StoryArchivePreview,{story:e,checked:c===e.rawId,selectable:!0,onToggleCheck:this.toggleCheck})},e.rawId)))]})]}),p&&!m&&t===a.EditorViewType.box&&(0,o.jsx)(u.UploadDropBoxArea,{}),p&&!m&&t===a.EditorViewType.page&&(0,o.jsx)(g.UploadDropPageArea,{})]})}getThumbSizes(e,t){const r=e/t;let o,i;return e>=t?(o=Math.min(e,C.MAX_THUMB_WIDTH),i=Math.floor(o/r),i>C.MAX_THUMB_HEIGHT&&(i=C.MAX_THUMB_HEIGHT,o=Math.floor(i*r))):(i=Math.min(t,C.MAX_THUMB_HEIGHT),o=Math.floor(i*r),o>C.MAX_THUMB_WIDTH&&(o=C.MAX_THUMB_WIDTH,i=Math.floor(o/r))),[o,i]}saveCustomPhotoIfNeeded(){const{ownerId:e,coverUploadConfig:t}=this.props,{checkedCoverId:r}=this.state,o=this.getCoverById(r);return o?(0,N.needSavePhoto)(o)?new Promise(((r,i)=>{window.ajax.post("al_stories.php",{act:"save_narrative_cover",owner_id:e,upload_response:o.uploadResponse,hash:t.hash},{onDone:e=>{const{customCover:t}=this.state;if(!this.isMount||!t)return void i();const o={...t,customPhotoId:e};r(o)},onFail:e=>(console.error(e),i(e),!0)})})):Promise.resolve(o):Promise.reject()}componentDidMount(){this.isMount=!0;const e=this.getDragAndDropContainer();e&&(e.addEventListener("drop",this.onDragDrop),e.addEventListener("dragenter",this.onDragEnter),e.addEventListener("dragover",this.onDragEnter),e.addEventListener("dragleave",this.onDragLeave))}componentWillUnmount(){this.isMount=!1,null!=this.dragLeaveTimeout&&clearTimeout(this.dragLeaveTimeout);const e=this.getDragAndDropContainer();e&&(e.removeEventListener("drop",this.onDragDrop),e.removeEventListener("dragenter",this.onDragEnter),e.removeEventListener("dragover",this.onDragEnter),e.removeEventListener("dragleave",this.onDragLeave))}getDragAndDropContainer(){return this.props.appearance===a.EditorViewType.box?window.boxLayerWrap:document.body}getScrollContainer(){return this.props.appearance===a.EditorViewType.box?this.scrollContainerRef.current:document.documentElement}buildCovers(e){const{cover:t,stories:r}=e;let o;t&&(0,N.isCustomCover)(t)&&(o={id:N.CustomCoverId,...t});return[r.map((e=>t?.coverStoryId===e.id?{id:e.rawId,...t}:{id:e.rawId,url:e.preview,coverStoryId:e.id})),o]}getCoverById(e){return e===N.CustomCoverId?this.state.customCover:this.state.covers.find((t=>t.id===e))}getCoverOriginalUrl(e){const{storyMap:t}=this.props;let r="";return(0,N.isSelectableCustomCover)(e)?r=e.customPhotoOriginalUrl:e.coverStoryId&&(r=t[e.coverStoryId]?.originalPreviewUrl),r}constructor(e){super(e),this.scrollContainerRef=(0,i.createRef)(),this.isMount=!1,this.isCropSubmitted=!1,this.onFilesLoad=e=>{this.file=e[0],this.file&&this.uploadCover()},this.uploadCover=()=>{if(!this.file)return;const e=this.file,{coverUploadConfig:t}=this.props,r=new m.UploadPhoto(t,this.onUploadCoverProgress);r.validate(e).then((()=>{if(!this.isMount)return;const t=URL.createObjectURL(e),o={id:N.CustomCoverId,url:t,customPhotoOriginalUrl:t,percent:0,status:N.CoverUploadStatus.uploading};return this.setState({customCover:o}),r.upload({file:e}).then((e=>{if(!this.isMount)return;const t=JSON.stringify(e);this.setState({customCover:{...o,percent:100,status:N.CoverUploadStatus.uploaded,uploadResponse:t},checkedCoverId:N.CustomCoverId})}))})).catch((e=>{if(!this.isMount)return;let t=this.state.customCover;t&&(t={...t,percent:0,status:N.CoverUploadStatus.failed}),console.error(e),e=(0,s.isObject)(e)?e.text:String(e),(0,w.showFastBox)(l.getLang("global_error"),e||l.getLang("global_unknown_error")),(0,x.logError)(new Error("error with uploadCover"+(e?`: ${e}`:""))),this.setState({customCover:t})}))},this.onUploadCoverProgress=(e,t)=>{const r=Math.min(e/t*100,90);this.setState((e=>{let t=e.customCover;return t?{customCover:{...t,percent:r}}:null}))},this.selectCustomCover=()=>{this.setState({checkedCoverId:N.CustomCoverId})},this.toggleCheck=e=>{this.setState({checkedCoverId:e.rawId})},this.openCropper=()=>{const{checkedCoverId:e}=this.state,t=this.getCoverById(e);if(!t)return;const r=this.getCoverOriginalUrl(t);r&&(0,S.loadImage)(r).then((e=>{if(!this.isMount)return;const o=e.width,i=e.height,[a,s]=this.getThumbSizes(o,i);this.setState({isModalOpen:!0}),(0,y.showNarrativeCropCoverBox)({coverUrl:r,coverHeight:i,coverWidth:o,thumbHeight:s,thumbWidth:a,crop:t.crop,onSave:this.onCropSave,onClose:this.onCropClose})})).catch((e=>{console.error(e),e=String(e),(0,w.showFastBox)(l.getLang("global_error"),e||l.getLang("global_unknown_error")),(0,x.logError)(new Error("error with cover openCropper"+(e?`: ${e}`:"")))}))},this.onCropSave=(e,t)=>this.saveCustomPhotoIfNeeded().then((r=>{this.isCropSubmitted=!0;const{covers:o}=this.state;(0,N.isSelectableCustomCover)(r)?this.setState({customCover:{...r,url:t,crop:e}}):this.setState({covers:o.map((o=>o.id===r.id?{...r,url:t,crop:e}:o))})})),this.onCropClose=()=>{const{onSave:e}=this.props,{checkedCoverId:t}=this.state;this.setState({isModalOpen:!1});const r=this.getCoverById(t);r&&this.isCropSubmitted&&e({url:r.url,coverStoryId:r.coverStoryId,customPhotoOriginalUrl:r.customPhotoOriginalUrl,customPhotoId:r.customPhotoId,crop:r.crop})},this.getFooterButtons=()=>{const{onSave:e}=this.props,{customCover:t}=this.state;return[(0,o.jsx)(c.Button,{size:"m",mode:"tertiary",onClick:()=>e(),children:l.getLang("global_cancel")},"close"),(0,o.jsx)(c.Button,{size:"m",mode:"primary",onClick:this.openCropper,disabled:t?.status===N.CoverUploadStatus.uploading,children:l.getLang("stories_narrative_cover_next_step")},"save")]},this.onDragEnter=e=>{("file"===e?.dataTransfer?.items[0]?.kind||e?.dataTransfer?.types?.includes("Files"))&&(clearTimeout(this.dragLeaveTimeout),delete this.dragLeaveTimeout,this.setState({showDropArea:!0})),(0,p.cancelEvent)(e)},this.onDragLeave=e=>{clearTimeout(this.dragLeaveTimeout),this.dragLeaveTimeout=setTimeout((()=>{delete this.dragLeaveTimeout,this.setState({showDropArea:!1})}),100),(0,p.cancelEvent)(e)},this.onDragDrop=e=>{this.onDragLeave(e),e?.dataTransfer?.files?.length&&this.onFilesLoad(Array.from(e.dataTransfer.files));const t=this.getScrollContainer();t&&t.scrollTo({top:0,behavior:"smooth"}),(0,p.cancelEvent)(e)};const[t,r]=this.buildCovers(e);let a=t[0]?.id;if(e.cover){const t=e.cover.customPhotoId,r=e.cover.coverStoryId;a=t?N.CustomCoverId:r?e.storyMap[r].rawId:e.stories[0].rawId}this.state={showDropArea:!1,covers:t,customCover:r,checkedCoverId:a,isModalOpen:!1}}}},293731:(e,t,r)=>{var o;function i(e){return Boolean(e.customPhotoId||e.uploadResponse)}function a(e){return Boolean(e.customPhotoId)}function s(e){return e.uploadResponse&&!e.customPhotoId}function n(e){const t={url:e.coverUrl,crop:e.coverCrop};return e.customCover?(t.customPhotoId=e.customCover.photoId,t.customPhotoOriginalUrl=e.customCover.originalPhotoUrl):t.coverStoryId=e.coverStoryId,t}r.d(t,{CoverUploadStatus:()=>o,CustomCoverId:()=>d,getPreparedCover:()=>n,isCustomCover:()=>a,isSelectableCustomCover:()=>i,needSavePhoto:()=>s}),function(e){e[e.uploaded=0]="uploaded",e[e.uploading=1]="uploading",e[e.failed=2]="failed"}(o||(o={}));const d="custom"},450668:(e,t,r)=>{r.d(t,{NarrativeEditorDataPanel:()=>v});var o=r(785893),i=r(667294),a=r(471828),s=r(659397),n=r(683670),d=r(36703),l=r(93367),c=r(15042),h=r(752198);class v extends i.Component{render(){const{name:e,onNameChange:t,selectedStoriesCount:r,coverUrl:i,onCoverClick:l,className:c}=this.props,v=0===r;let p="";return v||(p=a.getLang("stories_choose_cover")),(0,o.jsxs)("div",{className:(0,s.classNames)("NarrativeEditorDataPanel",c),children:[(0,o.jsxs)("div",{className:"NarrativeEditorDataPanel__preview",children:[(0,o.jsx)(n.NarrativeItemPreviewCover,{className:(0,s.classNames)("NarrativeEditorDataPanel__cover",{"NarrativeEditorDataPanel__cover--active":!v}),onClick:l,cover:i,title:p,extra:!v&&(0,o.jsx)("div",{className:"NarrativeEditorDataPanel__pencil",children:(0,o.jsx)(h.Icon24Write,{})})}),(0,o.jsx)("span",{className:(0,s.classNames)("NarrativeEditorDataPanel__name",{"NarrativeEditorDataPanel__name--empty":!e}),children:e||a.getLang("stories_narrative_name_full")})]}),(0,o.jsxs)("div",{className:"NarrativeEditorDataPanel__form",children:[(0,o.jsx)("span",{className:"NarrativeEditorDataPanel__nameLabel",children:a.getLang("stories_narrative_name")}),(0,o.jsx)("input",{className:"NarrativeEditorDataPanel__nameInput",value:e,onChange:t,onKeyDown:this.onKeyDown,type:"text",placeholder:a.getLang("stories_enter_name"),maxLength:d.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0}),r>0&&(0,o.jsx)("span",{className:"NarrativeEditorDataPanel__selectedStoryCount",children:a.getLang("stories_selected_count",r)})]})]})}constructor(e){super(e),this.getInputEl=()=>this.nameInputRef&&this.nameInputRef.current,this.onKeyDown=e=>{e.keyCode===l.KEY.ENTER&&(e.ctrlKey||e.metaKey&&c.browser.mac)&&this.props.onSubmit()},this.nameInputRef=(0,i.createRef)()}}},895792:(e,t,r)=>{r.d(t,{NarrativeEditorFooter:()=>s});var o=r(785893),i=r(659397),a=r(249580);const s=({appearance:e,actionButtons:t})=>(0,o.jsx)("div",{className:(0,i.classNames)("NarrativeEditorFooter",`NarrativeEditorFooter--${e}`),children:(0,o.jsx)(a.ModalFooter,{actionButtons:t})})},100373:(e,t,r)=>{r.d(t,{NarrativeEditorSection:()=>n});var o=r(785893),i=r(667294),a=r(659397),s=r(895792);class n extends i.Component{render(){const{className:e,children:t,appearance:r,actionFooterButtons:i}=this.props;return(0,o.jsxs)("div",{className:(0,a.classNames)("NarrativeEditorSection",e),ref:this.scrollContainerRef,children:[(0,o.jsx)("div",{className:"NarrativeEditorSection__body",children:t}),Boolean(i)&&(0,o.jsx)(s.NarrativeEditorFooter,{appearance:r,actionButtons:i})]})}getSectionEl(){return this.scrollContainerRef?.current}constructor(...e){super(...e),this.scrollContainerRef=(0,i.createRef)()}}},214526:(e,t,r)=>{r.d(t,{NarrativeEditorSelectedTab:()=>v});var o=r(785893),i=r(667294),a=r(659397),s=r(241),n=r(87712),d=r(647293),l=r(36703),c=r(618030);const h="NarrativeEditorSelectedTab__storyPreview";class v extends i.Component{render(){const{stories:e,selectedStoriesMap:t,className:r,isEditingLinksAvailable:i,onStoryLinkUpdate:s,linkData:l,onToggleCheck:c}=this.props,{draggingStoryRawId:v}=this.state;return(0,o.jsx)("div",{className:(0,a.classNames)("NarrativeEditorSelectedTab ScrollContainer",r),ref:this.tabRef,children:(0,o.jsx)(n.StoryArchivePreviewGrid,{ref:this.gridContainerRef,children:e.map((e=>(0,o.jsx)("div",{className:"NarrativeEditorSelectedTab__story",children:(0,o.jsx)(d.StoryArchivePreview,{className:h,story:e,draggable:!0,isDragged:e.rawId===v,checked:!!t[e.id],selectable:this.isSelectable(e),onToggleCheck:c,onStoryLinkUpdate:s,isEditingLinksAvailable:i,linkData:l})},e.rawId)))})})}isSelectable(e){const{selectedStoriesMap:t}=this.props,r=Object.keys(t).length;return!e.isUnavailable&&!!(r<l.MAX_NARRATIVE_STORIES||t[e.rawId])}componentDidMount(){const{onReorder:e,appearance:t}=this.props,r=this.getGridContainer(),o={dragThreshold:0,onDragFinish:()=>{this.setState({draggingStoryRawId:""})},onDragStart:e=>{const t=e.querySelector(`.${h}`);if(!t)return;const r=t.dataset.id;this.setState({draggingStoryRawId:r})},onReorder:()=>{const{stories:t}=this.props,r=document.querySelectorAll(`.${h}`),o=[];r.forEach((e=>{const r=e.getAttribute("data-id"),i=t.find((e=>e.rawId===r));i&&o.push(i.id)})),e(o)}};r&&(t===s.EditorViewType.box&&(o.wrapNode=this.getTabEl()),this.sorter=new c.default(r,"",o))}componentWillUnmount(){this.sorter&&this.sorter.destroy()}getTabEl(){return this.tabRef?.current}getGridContainer(){return this.gridContainerRef?.current?.getGridContainer()}constructor(e){super(e),this.gridContainerRef=(0,i.createRef)(),this.tabRef=(0,i.createRef)(),this.state={draggingStoryRawId:""}}}},442787:(e,t,r)=>{r.d(t,{NarrativeEditorStoriesTabPanel:()=>p});var o=r(785893),i=r(667294),a=r(659397),s=r(564726),n=r(203844),d=r(241),l=r(471828),c=r(214526),h=r(643557),v=r(36703);class p extends i.Component{render(){const{selectedStoryIds:e,appearance:t,isEditingLinksAvailable:r,linkData:i,onStoryLinkUpdate:v,loadMore:p,hasMore:u}=this.props,{tabKey:g}=this.state,_=this.getSelectedStoriesMap(),m=this.getAllStories();return(0,o.jsxs)("div",{className:"NarrativeEditorStoriesTabPanel",children:[(0,o.jsx)("div",{className:"NarrativeEditorStoriesTabPanel__tabs",children:(0,o.jsxs)(s.Tabs,{disableStretch:!0,mode:"accent",children:[(0,o.jsx)(n.TabsItem,{disabled:!e.length,selected:this.state.tabKey===d.EditorTabKey.selected,after:e.length>0&&(0,o.jsx)("span",{children:e.length}),onClick:()=>this.onTabClick(d.EditorTabKey.selected),children:l.getLang("stories_narrative_editor_selected_tab")},d.EditorTabKey.selected),(0,o.jsx)(n.TabsItem,{selected:this.state.tabKey===d.EditorTabKey.all,onClick:()=>this.onTabClick(d.EditorTabKey.all),children:l.getLang("stories_narrative_editor_all_tab")},d.EditorTabKey.all)]})}),g===d.EditorTabKey.selected&&(0,o.jsx)(c.NarrativeEditorSelectedTab,{className:(0,a.classNames)("NarrativeEditorSelectPanel__grid",`NarrativeEditorSelectPanel__grid--${t}`),appearance:t,stories:this.getSelectedTabStories(),onReorder:this.onReorder,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:_,onStoryLinkUpdate:v,isEditingLinksAvailable:r,linkData:i}),g===d.EditorTabKey.all&&(0,o.jsx)(h.NarrativeEditorAllTab,{className:(0,a.classNames)("NarrativeEditorSelectPanel__grid",`NarrativeEditorSelectPanel__grid--${t}`),appearance:t,stories:m,loadMore:p,hasMore:u,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:_,onStoryLinkUpdate:v,isEditingLinksAvailable:r,linkData:i})]})}getSelectedTabStories(){return this.state.selectedTabStoryIds.map((e=>this.props.storyMap[e]))}getAllStories(){return this.props.storyIds.map((e=>this.props.storyMap[e]))}getSelectedStoriesMap(){return this.props.selectedStoryIds.reduce(((e,t)=>(e[t]=this.props.storyMap[t],e)),{})}constructor(e){super(e),this.onTabClick=e=>{this.setState({tabKey:e,selectedTabStoryIds:[...this.props.selectedStoryIds]})},this.onReorder=e=>{const{onSelectedStoriesUpdate:t}=this.props,r=this.getSelectedStoriesMap(),o=e.filter((e=>r[e]));this.setState({selectedTabStoryIds:e}),t(o)},this.onStorySelectToggle=e=>{const{selectedStoryIds:t,onSelectedStoriesUpdate:r}=this.props,{tabKey:o,selectedTabStoryIds:i}=this.state,a=this.getSelectedStoriesMap();if(!(Object.keys(a).length>=v.MAX_NARRATIVE_STORIES)||a[e.id]){if(!i.length)return this.setState({selectedTabStoryIds:[e.id]}),void r([e.id]);if(a[e.id]){r(t.filter((t=>t!==e.id)))}else{let t=[];const s={...a,[e.id]:e};if(o===d.EditorTabKey.selected)t=i.filter((e=>s[e]));else if(o===d.EditorTabKey.all){if(i.includes(e.id))t=i.filter((e=>s[e]));else{t=[...i,e.id].filter((e=>s[e])),this.setState({selectedTabStoryIds:[...i,e.id]})}}r(t)}}},this.state={tabKey:e.selectedStoryIds.length?d.EditorTabKey.selected:d.EditorTabKey.all,selectedTabStoryIds:[...e.selectedStoryIds]}}}p.defaultProps={isEditingLinksAvailable:!1}},683670:(e,t,r)=>{r.d(t,{NarrativeItemPreviewCover:()=>s});var o=r(785893),i=r(667294),a=r(659397);const s=(0,i.memo)((({title:e,onClick:t,cover:r,href:s,className:n="",extra:d,noBorder:l=!1,isDraft:c=!1,size:h=58})=>{const v=r?{backgroundImage:`url(${r})`}:{},p=(0,a.classNames)("NarrativeItemPreviewCover",`NarrativeItemPreviewCover--size${h}`,n,{"NarrativeItemPreviewCover--noBorder":l,"NarrativeItemPreviewCover--isDraft":c}),u=(0,o.jsx)("div",{className:"NarrativeItemPreviewCover__image",style:v,title:e||void 0,children:d});return(0,o.jsxs)(i.Fragment,{children:[s&&(0,o.jsx)("a",{href:s,className:p,onClick:t,children:u}),!s&&(0,o.jsx)("div",{className:p,onClick:t,children:u})]})}))},586010:(e,t,r)=>{r.d(t,{NarrativeRow:()=>c});var o=r(785893),i=r(667294),a=r(683670),s=r(127298),n=r(659397),d=r(471828),l=r(611695);const c=(0,i.memo)((({narrative:e,aside:t,onClick:r,className:c,clickable:h,size:v,noBorder:p})=>{const u=!e.storiesCount,g=u?"":`/narrative${e.ownerId}_${e.id}`;let _,m,w,y;return u?(_=(0,o.jsx)(a.NarrativeItemPreviewCover,{isDraft:!0,extra:(0,o.jsx)(l.Icon24NarrativeActiveOutline,{}),size:v}),m=(0,o.jsxs)(i.Fragment,{children:[d.getLang("groups_narrative_box_stories_count",e.storiesCount),(0,o.jsx)("span",{className:"dvd"}),(0,o.jsx)("span",{children:d.getLang("stories_narratives_draft")})]})):(_=(0,o.jsx)(a.NarrativeItemPreviewCover,{onClick:r,size:v,cover:e.coverUrl,href:g,noBorder:p}),m=(0,o.jsx)("span",{children:d.getLang("groups_narrative_box_stories_count",e.storiesCount)})),h?w=r:u||(y=r),(0,o.jsx)("div",{className:(0,n.classNames)("NarrativeRow NarrativeListItem",c,{"NarrativeRow--clickable":h}),"data-id":e.id,onClick:w,children:(0,o.jsx)(s.NarrativeRowBase,{className:"NarrativeRow__inner",href:g,onClick:y,preview:_,id:e.id,title:e.title,subtitle:m,size:v,aside:t})})}))},127298:(e,t,r)=>{r.d(t,{NarrativeRowBase:()=>s});var o=r(785893),i=r(667294),a=r(659397);const s=(0,i.memo)((({id:e,title:t,subtitle:r,preview:i,aside:s,href:n,onClick:d,className:l="",size:c=58,...h})=>{const v=Boolean(d||n);let p;return t=(0,a.decodeHTMLEntities)(t),p=n?(0,o.jsx)("a",{href:n,className:"NarrativeRowBase__title",onClick:d,children:t}):(0,o.jsx)("span",{className:"NarrativeRowBase__title",onClick:d,children:t}),(0,o.jsxs)("div",{className:(0,a.classNames)("NarrativeRowBase",`NarrativeRowBase--previewSize${c}`,l,{"NarrativeRowBase--clickable":v}),...h,children:[(0,o.jsx)("div",{className:"NarrativeRowBase__preview",children:i}),(0,o.jsxs)("div",{className:"NarrativeRowBase__inner",children:[(0,o.jsxs)("div",{className:"NarrativeRowBase__main",children:[(0,o.jsx)("div",{className:"NarrativeRowBase__title",children:p}),r&&(0,o.jsx)("div",{className:"NarrativeRowBase__subtitle",children:r})]}),s&&(0,o.jsx)("div",{className:"NarrativeRowBase__aside",children:s})]})]})}))},410137:(e,t,r)=>{r.d(t,{NarrativeRowCreation:()=>l});var o=r(785893),i=r(667294),a=r(127298),s=r(471828),n=r(659397),d=r(376175);const l=(0,i.memo)((({onClick:e,clickable:t=!1,size:r=58})=>{const i=s.getLang("stories_create_new_narrative"),l=(0,o.jsx)("div",{className:(0,n.classNames)("NarrativeRowCreation__preview",`NarrativeRowCreation__preview--size${r}`),children:(0,o.jsx)(d.Icon28AddOutline,{})});return(0,o.jsx)("div",{className:(0,n.classNames)("NarrativeRowCreation NarrativeListItem",{"NarrativeRowCreation--clickable":t}),nodrag:"true",children:(0,o.jsx)(a.NarrativeRowBase,{className:"NarrativeRowCreation__inner",title:i,onClick:e,preview:l,size:r})})}))},159361:(e,t,r)=>{r.d(t,{NarrativeSnippet:()=>s});var o=r(785893),i=r(471828),a=r(659397);const s=e=>{const{className:t,coverUrl:r,title:s,ownerName:n,storyCount:d}=e;return(0,o.jsx)("div",{className:(0,a.classNames)("NarrativeSnippet",t),children:(0,o.jsxs)("div",{className:"NarrativeSnippet__inner",children:[(0,o.jsx)("div",{className:"NarrativeSnippet__cover",children:(0,o.jsx)("div",{className:"NarrativeSnippet__image",style:{backgroundImage:`url(${r})`}})}),(0,o.jsxs)("div",{className:"NarrativeSnippet__info",children:[(0,o.jsx)("div",{className:(0,a.classNames)("NarrativeSnippet__title",{"NarrativeSnippet__title--empty":!s}),children:s||i.getLang("stories_narrative_name_full")}),(0,o.jsx)("span",{className:"NarrativeSnippet__author",children:n}),(0,o.jsxs)("span",{className:"NarrativeSnippet__description",children:[(0,o.jsx)("span",{children:i.getLang("global_type_narrative")}),(0,o.jsx)("span",{className:"dvd"}),(0,o.jsx)("span",{children:i.getLang("global_narrative_stories_count",d)})]})]})]})})}},647293:(e,t,r)=>{r.d(t,{StoryArchivePreview:()=>p});var o=r(785893),i=r(667294),a=r(659397),s=r(471828),n=r(370878),d=r(65718),l=r(411374),c=r(22378),h=r(113788),v=r(402622);class p extends i.PureComponent{componentDidUpdate(e,t){const{story:r,isDragged:o}=this.props,{isHovered:i}=this.state;r.videoUrl&&(o||(!t.isHovered&&i?this.playVideo():t.isHovered&&!i&&this.pauseVideo()),!e.isDragged&&o&&this.pauseVideo(),e.isDragged&&!o&&i&&this.playVideo())}componentWillUnmount(){this.cleanVideoPlayTimeout(),this.cleanVideoPauseTimeout(),this.cleanVideoLoaderTimeout()}playVideo(e=!1){null!=this.videoPauseDelayTimeout&&this.cleanVideoPauseTimeout();const t=()=>{delete this.videoPlayDelayTimeout,this.videoRef.current&&(this.videoRef.current.muted=!0,this.videoRef.current.play().then((()=>{if(this.hideLoader(),this.setState({canPlayVideo:!0}),this.needPauseAfterLoading)return this.videoRef.current?.pause(),void(this.needPauseAfterLoading=!1)})).catch((e=>{this.hideLoader(),console.error(e),(0,d.logError)(e)})))};e?t():null==this.videoPlayDelayTimeout&&(this.videoLoaderTimeout=setTimeout((()=>{this.setState({isLoading:!0})}),800),this.setState({preloadVideo:!0}),this.videoPlayDelayTimeout=setTimeout((()=>{t()}),200))}pauseVideo(e=!1){null!=this.videoPlayDelayTimeout&&this.cleanVideoPlayTimeout();const t=()=>{if(delete this.videoPauseDelayTimeout,this.hideLoader(),this.state.canPlayVideo){const e=this.videoRef?.current;e?.pause()}else this.needPauseAfterLoading=!0};e?t():null==this.videoPauseDelayTimeout&&(this.videoPauseDelayTimeout=setTimeout((()=>{t()}),200))}cleanVideoPlayTimeout(){this.videoPlayDelayTimeout&&(clearTimeout(this.videoPlayDelayTimeout),delete this.videoPlayDelayTimeout)}cleanVideoPauseTimeout(){this.videoPauseDelayTimeout&&(clearTimeout(this.videoPauseDelayTimeout),delete this.videoPauseDelayTimeout)}cleanVideoLoaderTimeout(){this.videoLoaderTimeout&&(clearTimeout(this.videoLoaderTimeout),delete this.videoLoaderTimeout)}hideLoader(){this.state.isLoading&&this.setState({isLoading:!1}),this.cleanVideoLoaderTimeout()}render(){const{story:e,checked:t,selectable:r,draggable:i,className:n,isEditingLinksAvailable:d,needShowDate:p}=this.props,{preloadVideo:u,canPlayVideo:g,isLoading:_}=this.state,m=Boolean(e.videoUrl),w=new Date(1e3*e.time);return(0,o.jsx)("div",{className:(0,a.classNames)("StoryArchivePreview","StoryPreviewContainer",n,{"StoryArchivePreview--video":m,"StoryArchivePreview--checked":t}),onClick:this.onToggleCheck,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,"data-id":e.rawId,children:(0,o.jsxs)("div",{className:"StoryArchivePreview__wrapper",children:[m&&(0,o.jsxs)(o.Fragment,{children:[u&&(0,o.jsx)("video",{className:(0,a.classNames)("StoryArchivePreview__media",{"StoryArchivePreview__media--hidden":!g}),src:e.videoUrl,ref:this.videoRef,controls:!1,preload:"metadata",loop:!0,playsInline:!0}),!g&&(0,o.jsx)("img",{className:"StoryArchivePreview__media",src:e.preview,alt:""})]}),!m&&(0,o.jsx)("img",{className:"StoryArchivePreview__media",src:e.preview,alt:""}),p&&(0,o.jsxs)("div",{className:"StoryArchivePreview__date",children:[(0,o.jsx)("div",{className:"StoryArchivePreview__day",children:w.getDate()}),(0,o.jsx)("div",{className:"StoryArchivePreview__month",children:(0,o.jsx)(c.InnerHTML,{children:s.getLang("months_sm_of")[w.getMonth()+1]})})]}),i&&!p&&(0,o.jsx)("div",{className:"StoryArchivePreview__draggableIcon"}),r&&(0,o.jsx)("div",{className:(0,a.classNames)("StoryArchivePreview__select",{"StoryArchivePreview__select--on":t})}),(d||e.videoUrl)&&(0,o.jsx)("div",{className:"StoryArchivePreview__footer",children:(0,o.jsxs)("div",{className:"StoryArchivePreview__footerInner",children:[e.videoUrl&&(0,o.jsxs)("div",{className:"StoryArchivePreview__play",children:[(0,o.jsx)(v.Icon16Videocam,{}),(0,o.jsx)("span",{className:"StoryArchivePreview__playTime",children:(0,l.formatTime)(e.duration||0)})]}),d&&(0,o.jsx)("div",{className:"StoryArchivePreview__linkBtn",onClick:e=>this.onLinkButtonClick(e),children:e.linkUrl?s.getLang("stories_edit_link"):s.getLang("stories_add_link")})]})}),_&&(0,o.jsx)("div",{className:"StoryArchivePreview__loader",children:(0,o.jsx)(h.Spinner,{})})]})})}constructor(e){super(e),this.videoRef=(0,i.createRef)(),this.needPauseAfterLoading=!1,this.onLinkButtonClick=e=>{const{story:t,onStoryLinkUpdate:r,linkData:o,isDragged:i}=this.props;i||((0,n.showStoryLinkEditorBox)({story:t,onStoryLinkUpdate:r,linkData:o}),e.stopPropagation())},this.onMouseEnter=()=>{this.setState({isHovered:!0})},this.onMouseLeave=()=>{this.setState({isHovered:!1})},this.onToggleCheck=()=>{const{onToggleCheck:e,story:t,isDragged:r}=this.props;!r&&e&&e(t)},this.state={isHovered:!1,preloadVideo:!1,canPlayVideo:!1,isLoading:!1}}}p.defaultProps={checked:!1,selectable:!1,draggable:!1,isDragged:!1,className:"",isEditingLinksAvailable:!1,onToggleCheck:()=>{},onStoryLinkUpdate:()=>{},linkData:[]}},87712:(e,t,r)=>{r.d(t,{StoryArchivePreviewGrid:()=>s});var o=r(785893),i=r(667294),a=r(659397);class s extends i.Component{getGridContainer(){return this.gridContainerRef.current}render(){const{className:e,children:t,isScrolling:r}=this.props;return(0,o.jsx)("div",{className:(0,a.classNames)("StoryArchivePreviewGrid",e,{"StoryArchivePreviewGrid--scrolling":r}),children:(0,o.jsx)("div",{className:"StoryArchivePreviewGrid__inner",ref:this.gridContainerRef,children:t})})}constructor(...e){super(...e),this.gridContainerRef=(0,i.createRef)()}}s.defaultProps={className:""}},755244:(e,t,r)=>{r.d(t,{StoryCustomCoverPreview:()=>c});var o=r(785893),i=r(667294),a=r(659397),s=r(986299),n=r(647605),d=r(471828),l=r(293731);class c extends i.PureComponent{render(){const{checked:e,coverUrl:t,onToggleCheck:r,uploadingStatus:i,uploadingPercent:c,retryUpload:h}=this.props,v=i===l.CoverUploadStatus.uploaded,p=i===l.CoverUploadStatus.uploading,u=i===l.CoverUploadStatus.failed,g=v;return(0,o.jsxs)("div",{className:(0,a.classNames)("StoryCustomCoverPreview StoryPreviewContainer",{"StoryCustomCoverPreview--empty":p||u}),onClick:()=>{g&&r()},children:[v&&(0,o.jsx)("div",{className:"StoryCustomCoverPreview__coverFrame",children:(0,o.jsx)("div",{className:"StoryCustomCoverPreview__coverWrap",children:(0,o.jsx)("img",{src:t,className:"StoryCustomCoverPreview__cover",alt:""})})}),p&&(0,o.jsx)(s.StoryProgressSpinner,{percent:c}),u&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.Icon24ErrorCircleOutline,{}),(0,o.jsx)("span",{className:"StoryCustomCoverPreview__errorText",children:d.getLang("stories_upload_error_text")}),(0,o.jsx)("div",{className:"StoryCustomCoverPreview__repeat",onClick:h,children:d.getLang("stories_upload_repeat")})]}),g&&(0,o.jsx)("div",{className:(0,a.classNames)("StoryCustomCoverPreview__select",{"StoryCustomCoverPreview__select--on":e})})]})}constructor(e){super(e)}}c.defaultProps={uploadingStatus:l.CoverUploadStatus.uploaded}},422447:(e,t,r)=>{r.d(t,{StoryLinkEditorBox:()=>y});var o=r(785893),i=r(667294),a=r(471828),s=r(636322),n=r(159663),d=r(488844),l=r(65718),c=r(251087),h=r(60811),v=r(242453),p=r(49169),u=r(467607),g=r(152827),_=r(249580),m=r(441430),w=r(86894);class y extends i.Component{componentDidUpdate(e,t){t.needErrorStatus!==this.state.needErrorStatus&&this.state.needErrorStatus&&setTimeout((()=>{this.setState({needErrorStatus:!1})}),3e3)}render(){const{onClose:e,linkData:t}=this.props,{linkType:r,link:i,needShowHint:s,needErrorStatus:n,isSaving:d,isDeleting:l}=this.state,c=this.isEditMode()?a.getLang("stories_edit_link_title"):a.getLang("stories_add_link_title");return(0,o.jsxs)(h.ModalBox,{children:[(0,o.jsx)(v.ModalHeader,{onClose:e,closeAriaLabel:a.getLang("global_close"),children:c}),(0,o.jsxs)(p.ModalBody,{insetLevel:1,children:[(0,o.jsx)(u.FormItem,{mode:"horizontal",topAlign:"right",topWidth:"s",top:a.getLang("stories_link_label_url"),status:n?"error":"default",children:(0,o.jsx)(g.TextTooltip,{text:a.getLang("stories_upload_link_format"),placement:"top",appearance:"neutral",shown:s,maxWidth:200,children:(0,o.jsx)(w.Input,{value:i,onChange:this.onChangeLink,onKeyUp:this.onKeyUpLink,autoFocus:!0,getRef:this.inputRef})})}),(0,o.jsx)(u.FormItem,{mode:"horizontal",topAlign:"right",topWidth:"s",top:a.getLang("stories_link_label_text"),children:(0,o.jsx)(w.Select,{options:t.items,value:r,onChange:this.onChangeLinkType})})]}),(0,o.jsx)(_.ModalFooter,{before:this.isEditMode()?(0,o.jsx)(m.Button,{loading:l,mode:"tertiary",size:"m",onClick:this.onDelete,children:a.getLang("stories_delete_link")},"delete"):void 0,actionButtons:[(0,o.jsx)(m.Button,{mode:"tertiary",size:"m",onClick:()=>e(),children:a.getLang("global_cancel")},"close"),(0,o.jsx)(m.Button,{loading:d,mode:"primary",size:"m",onClick:this.onSave,children:this.isEditMode()?a.getLang("global_save"):a.getLang("stories_add_link")},"save")]})]})}isEditMode(){return Boolean(this.props.story.linkUrl)}isLinkValid(e){if(e.length<2)return!1;if(!e.startsWith("http://")&&!e.startsWith("https://"))return!1;if(!e.match(/^[a-z0-9\/\-._:%=?&@#]+$/i))return!1;try{new URL(e)}catch(e){return!1}return!0}edit(e="",t="",r=!0,o){const{onStoryLinkUpdate:i,onClose:s,story:n,linkData:h}=this.props;window.ajax.post("al_stories.php",{act:"edit_link",story_raw_id:n.rawId,link_url:e,link_text:t,hash:h.editHash},{onDone:()=>{s(),i(n.rawId,e,t)},onFail:e=>{(0,c.showDoneBox)(e||a.getLang("global_unknown_error"));const t="Link saving error in StoryLinkEditor"+(e?": "+e:"");return(0,l.logError)(new Error(t)),!0},showProgress:()=>{r?this.setState({isSaving:!0}):this.setState({isDeleting:!0}),(0,d.lockButton)(o)},hideProgress:()=>{o&&((0,c.curBox)()?.hide(),(0,d.unlockButton)(o)),r?this.setState({isSaving:!1}):this.setState({isDeleting:!1})}})}delete(e){this.edit("","",!1,e)}constructor(e){super(e),this.inputRef=(0,i.createRef)(),this.onChangeLink=e=>{let t=(0,s.trim)(e.target.value);this.setState({link:t,needShowHint:!this.isLinkValid(t)})},this.onKeyUpLink=()=>{const{link:e}=this.state;this.setState({needShowHint:!this.isLinkValid(e)})},this.onChangeLinkType=e=>{this.setState({linkType:String(e.target.value)})},this.onSave=()=>{const{linkData:e}=this.props,{linkType:t}=this.state;let{link:r}=this.state;if(r=(0,s.trim)(r),!this.isLinkValid(r))return this.inputRef?.current?.focus(),void this.setState({needShowHint:!0,needErrorStatus:!0});e.needShowHint?(0,n.showFastBox)(a.getLang("stories_saving_link"),a.getLang("stories_link_editing_warning"),a.getLang("global_save"),(e=>{this.edit(r,t,!0,e)}),a.getLang("global_cancel")):this.edit(r,t)},this.onDelete=()=>{const{linkData:e}=this.props;e.needShowHint?(0,n.showFastBox)(a.getLang("stories_deleting_link"),a.getLang("stories_link_deleting_warning"),a.getLang("global_delete"),(e=>{this.delete(e)}),a.getLang("global_cancel")):this.delete()},this.state={link:e.story.linkUrl||"",linkType:e.story.linkType||e.linkData.items[0].value,needShowHint:!1,needErrorStatus:!1,isSaving:!1,isDeleting:!1}}}},953570:(e,t,r)=>{r.d(t,{StoryLoadFile:()=>a});var o=r(785893),i=r(523087);const a=({text:e,multiple:t=!1,onFilesLoad:r})=>(0,o.jsxs)("div",{className:"StoryLoadFile StoryPreviewContainer",children:[(0,o.jsx)(i.Icon36Add,{}),(0,o.jsx)("span",{className:"StoryLoadFile__text",children:e}),(0,o.jsx)("input",{type:"file",className:"StoryLoadFile__input",multiple:t,onChange:e=>{const t=e.currentTarget.files;t&&r(Array.from(t))}})]})},986299:(e,t,r)=>{r.d(t,{StoryProgressSpinner:()=>n});var o=r(785893),i=r(667294);const a=3,s=2*Math.PI*22,n=(0,i.memo)((({percent:e=60,width:t=24,height:r=24})=>{const i=(s-a)*e/100+a;return(0,o.jsx)("svg",{className:"StoryProgressSpinner",width:t,height:r,viewBox:"0 0 50 50",children:(0,o.jsx)("circle",{cx:"25",cy:"25",r:22,stroke:"#fff",fill:"none",strokeWidth:"6",strokeMiterlimit:"10",strokeDashoffset:"0",strokeDasharray:`${i},${s}`,strokeLinecap:"round"})})}))},730283:(e,t,r)=>{r.d(t,{UploadDropBoxArea:()=>a});var o=r(785893),i=r(471828);const a=()=>(0,o.jsx)("div",{className:"UploadDropBoxArea",children:(0,o.jsx)("div",{className:"UploadDropBoxArea__inner",children:(0,o.jsx)("div",{className:"UploadDropBoxArea__text",children:i.getLang("stories_narrative_cover_drop_hint")})})})},105643:(e,t,r)=>{r.d(t,{UploadDropPageArea:()=>s});var o=r(785893),i=r(471828),a=r(9129);const s=()=>(0,o.jsx)(a.WithPortal,{children:(0,o.jsx)("div",{className:"UploadDropPageArea",children:(0,o.jsxs)("div",{className:"UploadDropPageArea__inner",children:[(0,o.jsx)("div",{className:"UploadDropPageArea__image"}),(0,o.jsx)("div",{className:"UploadDropPageArea__text",children:i.getLang("stories_drop_page_area_label")})]})})})},36703:(e,t,r)=>{r.d(t,{ADMIN_STORY_VIEW_MODULE:()=>s,BOX_ITEM_DRAGGABLE_CLASS:()=>p,EMOJI_REACTIONS_ARR:()=>n,INIT_MAX_FEEDBACK_STORIES_COUNT:()=>c,LONG_PRESS_DELAY_MS:()=>a,MAX_FEEDBACK_STORIES_SLICE_COUNT:()=>l,MAX_NARRATIVE_STORIES:()=>h,NARRATIVE_MAX_TITLE_LENGTH:()=>v,QUESTION_SELECT_MODE:()=>d,SCROLL_LOADING_MORE_GAP:()=>g,SCROLL_THROTTLE_DELAY:()=>u,STORIES_MANAGE_MODULE:()=>i,dynamicStickerIds:()=>m,staticStickerIds:()=>_});var o=r(797235);const i="stories_manage",a=200,s="admin_story_view",n=[{code:"f09f9882",name:"face_with_tears_of_happiness"},{code:"f09f988d",name:"smiling_face_with_heart_eyes"},{code:"f09f918df09f8fbf",name:"thumbs_up"},{code:"f09f98ad",name:"loud_crying_face"},{code:"f09f98b1",name:"face_screaming_in_fear"},{code:"e298ba",name:"smiling_face"}],d={PUBLIC:0,AUTHOR_ONLY:1,ANONYMOUS:3},l=50,c=10,h=100,v=23,p="NarrativeBox__draggable",u=34,g=400,_=Object.values(o.StickerTypes).filter((e=>!Object.values(o.DynamicStickersTypes).includes(e))),m=Object.values(o.DynamicStickersTypes)},399565:(e,t,r)=>{r.d(t,{highlightNarrativeBlock:()=>_,prepareStoriesForPublishing:()=>u,updateNarrativeBlock:()=>g,updateNarrativeSnippetsFromQueueByPost:()=>m});var o=r(70689),i=r(251087),a=r(750498),s=r(471828),n=r(902947),d=r(412097),l=r(65718),c=r(977053),h=r(184132),v=r(259844);const p="NarrativeSnippet";function u(e){return e.map((e=>e.id)).join(",")}function g(e=!1){const t=(0,n.intval)(window.cur.oid);if(window.cur.narrativeBlock)window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t},{onDone:e=>{const t=(0,n.intval)(window.cur.oid),r=document.getElementById(`narratives_module${t}_wrapper`);if(r)if(e)(0,o.domReplaceEl)(r,e),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new window.NarrativeBlock);else{const e=r.parentElement;e?.children.length&&e?.children.length>1?r.remove():e?.remove(),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),delete window.cur.narrativeBlock}(0,v.removeStoryList)(`narratives${t}`)}});else if(h.Ranges.isUserId(t)&&"profile"===window.cur.module){const e=document.getElementById(d.PROFILE_MEDIA_NARROW_BLOCK_ID),r=!e;window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t,need_wrap_block:(0,n.intval)(r)},{onDone:r=>{if(e)e.insertAdjacentHTML("afterbegin",r);else{const e=document.getElementById("narrow_column");if(!e)return;e.insertAdjacentHTML("beforeend",r)}window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new window.NarrativeBlock,window.cur.narrativeBlock.showOnboardTooltipIfNeeded()),(0,v.removeStoryList)(`narratives${t}`)}})}else e&&function(e){window.boxQueue.hideAll();const t=document.querySelector("#box_layer_wrap"),r=document.querySelector("#box_loader");window.nav.reload({onDone:()=>{e&&e()},showProgress:()=>{(0,o.show)(t),(0,o.show)(r),(0,i.refreshBoxLoaderCoords)()},hideProgress:()=>{(0,o.hide)(t),(0,o.hide)(r)}})}((()=>{window.cur.needNarrativeOnboard=!0}))}function _(e){if(!e)return;const t=`narratives_module${window.vk.id}`;(0,a.highlightModule)({module:t,text:s.getLang("stories_narrative_block_onboarding_text"),onClose:()=>{delete window.cur.needNarrativeOnboard,window.ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"profile_narrative"})},autoCancelDelay:1e4,speed:600})}function m(e){if(!window.vk.id)return;if(!(0,c.partConfigEnabled)("update_private_snippets_by_queue"))return;const t=Array.from(e.querySelectorAll(`.${p}`));if(!t.length)return;const r=[];t.forEach((e=>{if(!window.vk.id||!e.dataset.needUpdate)return;const t=e.dataset.narrativeRawId;t&&r.push({narrative_raw_id:t,snippet_type:e.dataset.snippetType,from:e.dataset.from})})),r.length&&window.ajax.post("al_stories.php",{act:"get_narrative_snippets",narrative_snippets:JSON.stringify(r)},{onDone:e=>{t.forEach((t=>{t.dataset.narrativeRawId&&e[t.dataset.narrativeRawId]&&(t.outerHTML=e[t.dataset.narrativeRawId])}))},onFail:()=>((0,l.logError)(new Error("Fail: updateNarrativeSnippetFromQueueByPost")),!0)})}},625202:(e,t,r)=>{function o(e,t=!1){return new Promise(((r,o)=>{window.ajax.post("al_stories.php",{act:e.boxAct,owner_id:e.ownerId,start_from:e.startFrom,track_code:e.trackCode},{loader:!e.narratives.length&&!t,onDone:(e,t,o)=>{r([e,t,o])},onFail:e=>(o(e),!0)})}))}function i(e){return o(e).then((([t,,r])=>(e.narratives=e.narratives?.concat(t)||t,e.startFrom=r,t)))}function a(e={}){return o(s(e),!0)}function s(e={}){return{narratives:e.narratives?e.narratives:[],boxData:e.boxData,boxAct:"get_recommended_narratives",trackCode:e.trackCode,list:e.list,source:e.source}}function n(e){return window.stManager.add(e)}r.d(t,{addStatic:()=>n,fetchRecommendedNarrativesBoxData:()=>a,getRecommendedNarrativesStore:()=>s,load:()=>o,loadMoreNarratives:()=>i})},698133:(e,t,r)=>{r.d(t,{SIMPLE_BOX_WIDTH:()=>o,SMALL_BOX_WIDTH:()=>a,WIDE_BOX_WIDTH:()=>i});const o=560,i=638,a=450},370878:(e,t,r)=>{r.r(t),r.d(t,{fetchRecommendedNarrativesBoxData:()=>c.fetchRecommendedNarrativesBoxData,showNarrativeBox:()=>o.showNarrativeBox,showNarrativeChooseBox:()=>i.showNarrativeChooseBox,showNarrativeCreateLiteBox:()=>a.showNarrativeCreateLiteBox,showNarrativeCropCoverBox:()=>s.showNarrativeCropCoverBox,showNarrativeEditorBox:()=>n.showNarrativeEditorBox,showRecommendedNarrativesBox:()=>d.showRecommendedNarrativesBox,showStoryLinkEditorBox:()=>l.showStoryLinkEditorBox});var o=r(750324),i=r(986791),a=r(542984),s=r(656076),n=r(880651),d=r(479523),l=r(557556),c=r(625202)},750324:(e,t,r)=>{r.d(t,{showNarrativeBox:()=>m});var o=r(785893),i=r(845338),a=r(982322),s=r(251087),n=r(471828),d=r(488844),l=r(159663),c=r(520597),h=r(625202),v=r(698133),p=r(284658),u=r(667294),g=r(659397);function _({options:e,onClose:t,refreshCoordinates:r,onWasPublishChange:v}){const[g,_]=(0,u.useState)((()=>({narratives:[],ownerId:e.ownerId,boxAct:"get_narrative_box_data"})));(0,u.useEffect)((()=>{(0,h.load)(g,!0).then((([e,t,r])=>{_((o=>({...o,narratives:e,boxData:t,startFrom:r})))})).catch((r=>{(0,s.showDoneBox)(r||n.getLang("global_error")),t(),e.onClose?.()}))}),[]);const{boxData:m}=g;if(!m)return(0,o.jsx)(p.MessageBoxModalLoader,{refreshCoordinates:r});const w=m.canEdit?a.BoxType.edit:a.BoxType.view;return(0,o.jsx)(i.NarrativeBox,{type:w,boxData:m,narratives:g.narratives,onClose:t,onSave:t=>{e.onSave?.(t),v(!0)},onRemove:t=>{const r={title:n.getLang("global_warning")};(0,l.showFastBox)(r,n.getLang("stories_narrative_remove_warning"),n.getLang("stories_remove_confirm"),(r=>{const o=g.boxData;o&&window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:t.rawId,hash:o.removeHash},{onDone:()=>{(0,c.sendNarrativeAnalytic)(c.NarrativeAnalyticEventType.deleteNarrative,t,e.navScreen),_((e=>e.boxData?{...e,boxData:{...e.boxData,count:e.boxData.count-1},narratives:e.narratives.filter((e=>e.rawId!==t.rawId))}:e)),(0,s.showDoneBox)(n.getLang("stories_deleted_narrative")),e.onRemove?.()},onFail:e=>((0,s.showDoneBox)(e||n.getLang("global_error")),!0),showProgress:()=>(0,d.lockButton)(r),hideProgress:()=>{(0,s.curBox)()?.hide(),(0,d.unlockButton)(r)}})}),n.getLang("global_cancel"))},onBookmark:e=>{e.isBookmarked=!e.isBookmarked,_((e=>({...e})))},onReorder:t=>{_((e=>({...e,narratives:t}))),e.onReorder?.()},loadMore:()=>(0,h.loadMoreNarratives)(g).then((()=>{_((e=>({...e})))})).catch((e=>{(0,s.showDoneBox)(e||n.getLang("global_error"))})),navScreen:e.navScreen,refreshCoordinates:r})}function m(e){const t={current:!1},r={current:g.noop};(0,p.showMessageBoxModal)((i=>(r.current=i.onClose,(0,o.jsx)(_,{...i,options:e,onWasPublishChange:e=>{t.current=e}}))),{width:v.SIMPLE_BOX_WIDTH,onShow:()=>{t.current&&r.current()},onDestroy:e.onClose})}},986791:(e,t,r)=>{r.d(t,{showNarrativeChooseBox:()=>p});var o=r(785893),i=r(251087),a=r(471828),s=r(480762),n=r(625202),d=r(698133),l=r(284658),c=r(667294),h=r(659397);function v({onClose:e,refreshCoordinates:t,options:r,onAfterSavingChange:d}){const[h,v]=(0,c.useState)((()=>({narratives:[],ownerId:r.ownerId,boxAct:"get_narrative_choose_box_data"})));(0,c.useEffect)((()=>{(0,n.load)(h,!0).then((([e,t,r])=>{v((o=>({...o,narratives:e,boxData:t,startFrom:r})))})).catch((t=>{(0,i.showDoneBox)(t||a.getLang("global_error")),e()}))}),[]);const{boxData:p}=h;return p?(0,o.jsx)(s.NarrativeChooseBox,{story:r.story,narratives:h.narratives,onClose:e,onSave:e=>{d(!0),r.onSave?.(e)},boxData:p,loadMore:()=>(0,n.loadMoreNarratives)(h).then((e=>(v((e=>({...e}))),e))).catch((e=>((0,i.showDoneBox)(e||a.getLang("global_error")),[]))),navScreen:r.navScreen}):(0,o.jsx)(l.MessageBoxModalLoader,{refreshCoordinates:t})}function p(e){const t={current:!1},r={current:h.noop};(0,l.showMessageBoxModal)((i=>(r.current=i.onClose,(0,o.jsx)(v,{...i,options:e,onAfterSavingChange:e=>{t.current=e}}))),{width:d.SIMPLE_BOX_WIDTH,onShow:()=>{t.current&&r.current()},onDestroy:()=>{e.onClose?.(t.current)}})}},542984:(e,t,r)=>{r.d(t,{showNarrativeCreateLiteBox:()=>n});var o=r(785893),i=r(453727),a=r(284658),s=r(698133);function n(e){const{onSave:t,onClose:r,ownerId:n,ownerName:d,stories:l,publishNarrativeHash:c}=e;(0,a.showMessageBoxModal)((e=>(0,o.jsx)(i.NarrativeCreateLiteBox,{...e,stories:l,ownerId:n,ownerName:d,publishNarrativeHash:c,onSave:t})),{width:s.SIMPLE_BOX_WIDTH,onDestroy:r})}},656076:(e,t,r)=>{r.d(t,{showNarrativeCropCoverBox:()=>n});var o=r(785893),i=r(932598),a=r(284658),s=r(698133);function n(e){const{coverUrl:t,coverHeight:r,coverWidth:n,thumbHeight:d,thumbWidth:l,onClose:c,onSave:h,crop:v}=e;(0,a.showMessageBoxModal)((e=>(0,o.jsx)(i.NarrativeCoverCropper,{...e,coverUrl:t,coverHeight:r,coverWidth:n,thumbHeight:d,thumbWidth:l,onSave:h,crop:v})),{width:s.WIDE_BOX_WIDTH,onDestroy:c})}},880651:(e,t,r)=>{r.d(t,{showNarrativeEditorBox:()=>_});var o=r(785893),i=r(241),a=r(659397),s=r(251087),n=r(471828),d=r(65718),l=r(597915),c=r(293731),h=r(698133),v=r(625202),p=r(284658),u=r(667294);function g({ownerId:e,options:t,onClose:r,refreshCoordinates:h,onAfterSavingChange:v}){const{narrative:g}=t,[_,m]=(0,u.useState)(t.stories),[w,y]=(0,u.useState)(t.selectedStories||[]),[S,x]=(0,u.useState)(t.storiesCount),[C,N]=(0,u.useState)(t.publishHash),[f,b]=(0,u.useState)(t.editHash),[k,L]=(0,u.useState)(t.linkData),[B,T]=(0,u.useState)(t.isEditingLinksAvailable),[I,E]=(0,u.useState)(t.coverUploadConfig);(0,u.useEffect)((()=>{_&&C&&f&&S&&I||new Promise(((t,r)=>{window.ajax.post("al_stories.php",{act:"get_narrative_editor_data",owner_id:e},{loader:!0,onDone:e=>{m(e.stories),x(e.storiesCount),N(e.publishHash),b(e.editHash),L(e.linkData),T(e.isEditingLinksAvailable),E(e.coverUploadConfig),t(void 0)},onFail:e=>(r(e),!0)})})).catch((e=>{(0,s.showDoneBox)(e||n.getLang("global_error")),(0,d.logError)(e),r()}))}),[]);if(!(_?.length&&C&&f&&S&&I))return(0,o.jsx)(p.MessageBoxModalLoader,{refreshCoordinates:h});let j=_.reduce(((e,t)=>(e[t.id]=t,e)),{});j=w.reduce(((e,t)=>(e[t.id]=t,e)),j);const D=_.map((e=>e.id)),A=w.map((e=>e.id)),M=g?i.EditorModeType.edit:i.EditorModeType.create,R=g?.title?(0,a.decodeHTMLEntities)(g.title):"",P=S>_.length,H=g?(0,c.getPreparedCover)(g):void 0;return(0,o.jsx)(l.NarrativeEditor,{ownerId:e,type:M,name:R,narrativeRawId:g?.rawId,cover:H,selectedStoryIds:A,storyIds:D,hasMore:P,storyMap:j,close:r,loadMore:()=>_?.length?new Promise(((t,r)=>{if(!_?.length)return r("empty stories");window.ajax.post("al_stories.php",{act:"get_archive_stories",owner_id:e,offset:_.length},{onDone:(e,o)=>{if(!_)return void r("empty stories after loading");m((t=>[...t??[],...e])),x(o);const i=o>_.length;t(i)},onFail:e=>(r(e),!0)})})):Promise.reject("empty stories"),onSave:e=>{t.onSave?.(e),v(!0)},publishHash:C,editHash:f,linkData:k,isEditingLinksAvailable:B,onStoryLinkUpdate:(e,t,r)=>{if(!_?.length)return;const o=o=>o.map((o=>o.rawId===e?{...o,linkUrl:t,linkType:r}:o));m((e=>o(e??[]))),y((e=>o(e??[])))},appearance:i.EditorViewType.box,navScreen:t.navScreen,coverUploadConfig:I,getPublishDoneHTML:t.getPublishDoneHTML,refreshCoordinates:h})}function _(e,t={}){const r={current:!1};(0,v.addStatic)(["NarrativeEditor.css"]).then((()=>{(0,p.showMessageBoxModal)((i=>(0,o.jsx)(g,{...i,ownerId:e,options:t,onAfterSavingChange:e=>{r.current=e}})),{width:h.WIDE_BOX_WIDTH,onDestroy:()=>t.onClose?.(r.current)})})).catch((e=>{console.error(e),(0,d.logError)(e)}))}},479523:(e,t,r)=>{r.d(t,{showRecommendedNarrativesBox:()=>v});var o=r(785893),i=r(251087),a=r(471828),s=r(845338),n=r(625202),d=r(698133),l=r(284658),c=r(667294);function h({onClose:e,refreshCoordinates:t,options:r}){const[d,h]=(0,c.useState)((()=>(0,n.getRecommendedNarrativesStore)(r))),{narratives:v,boxData:p}=d,u=v?.length&&null!=p;(0,c.useEffect)((()=>{u||(0,n.load)(d).then((([e,t])=>{h((r=>({...r,narratives:e,boxData:t})))})).catch((t=>{(0,i.showDoneBox)(t||a.getLang("global_error")),e()}))}),[]);const g=()=>{h((e=>({...e})))};if(!u)return(0,o.jsx)(l.MessageBoxModalLoader,{refreshCoordinates:t});return(0,o.jsx)(s.NarrativeBox,{title:a.getLang("news_fb_block_recommend_narratives"),showNarrativeNumber:!1,boxData:p,narratives:v,loadMore:()=>(0,n.loadMoreNarratives)(d).then((()=>{g()})).catch((e=>{(0,i.showDoneBox)(e||a.getLang("global_error"))})),onClose:e,onBookmark:e=>{e.isBookmarked=!e.isBookmarked,g()},trackCode:d.trackCode,list:d.list,source:d.source,refreshCoordinates:t})}function v(e={}){(0,l.showMessageBoxModal)((t=>(0,o.jsx)(h,{...t,options:e})),{width:d.SIMPLE_BOX_WIDTH})}},557556:(e,t,r)=>{r.d(t,{showStoryLinkEditorBox:()=>d});var o=r(785893),i=r(659397),a=r(422447),s=r(284658),n=r(698133);function d(e){const{story:t,onClose:r,onStoryLinkUpdate:d}=e;let{linkData:l}=e;if(t.linkType&&t.linkText){l.items.find((e=>e.value===t.linkType))||(l={...l,items:[...l.items,{value:t.linkType,label:t.linkText}]})}(0,s.showMessageBoxModal)((e=>(0,o.jsx)(a.StoryLinkEditorBox,{...e,story:t,onStoryLinkUpdate:d,linkData:(0,i.decodeHTMLEntitiesDeep)(l)})),{width:n.SMALL_BOX_WIDTH,onDestroy:r})}},14134:(e,t,r)=>{r.d(t,{updateAriaLabelCounter:()=>a});var o=r(471828),i=r(205070);const a=(e,t,r)=>{if(!("number"==typeof t&&e instanceof HTMLElement&&e.classList.contains("PostBottomAction")))return;const a=(e=>{let t;switch(e){case i.LikeButtonTypes.comment:t=o.getLang("likes_comments_N_aria_short","raw");break;case i.LikeButtonTypes.like:t=o.getLang("likes_likes_N_aria_short","raw");break;case i.LikeButtonTypes.share:t=o.getLang("likes_shares_N_aria_short","raw")}return t})(r);if(!a)return;const s=(0,o.langNumeric)(t,a,!1);e.setAttribute("aria-label",s)}}}]);try{stManager.done("dist/web/chunks/774679ed.1fd76be2.js")}catch(e){}