"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[12039],{528610:(t,e,n)=>{n.d(e,{GraphEditor:()=>s});var r={996:t=>{var e=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===n}(t)}(t)},n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function r(t,e){return!1!==e.clone&&e.isMergeableObject(t)?s((n=t,Array.isArray(n)?[]:{}),t,e):t;var n}function o(t,e,n){return t.concat(e).map((function(t){return r(t,n)}))}function i(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return Object.propertyIsEnumerable.call(t,e)})):[]}(t))}function a(t,e){try{return e in t}catch(t){return!1}}function s(t,n,l){(l=l||{}).arrayMerge=l.arrayMerge||o,l.isMergeableObject=l.isMergeableObject||e,l.cloneUnlessOtherwiseSpecified=r;var c=Array.isArray(n);return c===Array.isArray(t)?c?l.arrayMerge(t,n,l):function(t,e,n){var o={};return n.isMergeableObject(t)&&i(t).forEach((function(e){o[e]=r(t[e],n)})),i(e).forEach((function(i){(function(t,e){return a(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,i)||(a(t,i)&&n.isMergeableObject(e[i])?o[i]=function(t,e){if(!e.customMerge)return s;var n=e.customMerge(t);return"function"==typeof n?n:s}(i,n)(t[i],e[i],n):o[i]=r(e[i],n))})),o}(t,n,l):r(n,l)}s.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,n){return s(t,n,e)}),{})};var l=s;t.exports=l},254:(t,e,n)=>{var r={"./icon_action.svg":485,"./icon_action_area.svg":492,"./icon_action_button.svg":580,"./icon_add.svg":490,"./icon_end_node.svg":181,"./icon_end_of_video.svg":71,"./icon_etc.svg":161,"./icon_inaction.svg":577,"./icon_legend_navigation.svg":893,"./icon_location.svg":978,"./icon_lock.svg":628,"./icon_minus.svg":246,"./icon_move.svg":696,"./icon_node.svg":872,"./icon_plus.svg":52,"./icon_random.svg":716,"./icon_start_node.svg":916,"./icon_warning.svg":123};function o(t){var e=i(t);return n(e)}function i(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}o.keys=function(){return Object.keys(r)},o.resolve=i,t.exports=o,o.id=254},521:t=>{t.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHBhdGggZD0iTTM1IDgxVjM3YTIgMiAwIDAgMSAyLTJoNjRhMiAyIDAgMCAxIDIgMnY0NGEyIDIgMCAwIDEtMiAySDM3YTIgMiAwIDAgMS0yLTJaIiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9Ii4wNiIvPjxwYXRoIGQ9Ik0yNyA4OVY0NWEyIDIgMCAwIDEgMi0yaDY0YTIgMiAwIDAgMSAyIDJ2NDRhMiAyIDAgMCAxLTIgMkgyOWEyIDIgMCAwIDEtMi0yWiIgZmlsbD0iI2ZmZiIgZmlsbC1vcGFjaXR5PSIuMTEiLz4KPC9zdmc+Cg=="},485:t=>{t.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M2.94559 5.07445L1.54456 6.40055L4.22088 8.93219C4.70945 9.3593 5.35248 9.15608 5.55006 8.93219L8.00186 6.54693L10.4537 4.16168L9.07059 2.81836L5.19063 6.52268C4.99911 6.70553 4.69825 6.70736 4.50452 6.52687L2.94559 5.07445Z" fill="currentColor"/>\n</svg>\n'},492:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M13.75 9C14.1642 9 14.5 9.33579 14.5 9.75V10.5C14.5 10.5 14.5 11.0055 14.4634 11.4531C14.4256 11.9163 14.3449 12.3347 14.1458 12.7255C13.8342 13.337 13.337 13.8342 12.7255 14.1458C12.3347 14.3449 11.9163 14.4256 11.4531 14.4634C11.0055 14.5 10.4999 14.5 10.4999 14.5L9.75 14.5C9.33579 14.5 9 14.1642 9 13.75C9 13.3358 9.33579 13 9.75 13L10.4685 13C10.4685 13 10.9517 12.9994 11.3309 12.9684C11.7014 12.9382 11.9004 12.8827 12.0445 12.8093C12.3738 12.6415 12.6415 12.3738 12.8093 12.0445C12.8827 11.9004 12.9382 11.7014 12.9684 11.3309C12.9994 10.9517 13 10.4686 13 10.4686V9.75C13 9.33579 13.3358 9 13.75 9Z" fill="currentColor"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M9 2.25C9 1.83579 9.33579 1.5 9.75 1.5H10.5C10.5 1.5 11.0054 1.50001 11.453 1.53657C11.9162 1.57442 12.3346 1.65516 12.7254 1.85425C13.3369 2.16584 13.8341 2.66303 14.1457 3.27455C14.3448 3.66529 14.4255 4.08369 14.4634 4.54695C14.4999 4.99452 14.4999 5.50002 14.4999 5.50002L14.5 6.25C14.5 6.66421 14.1642 7 13.75 7C13.3358 7 13 6.66421 13 6.25L12.9999 5.53143C12.9999 5.53143 12.9993 5.04836 12.9683 4.6691C12.9381 4.2986 12.8826 4.09958 12.8092 3.95554C12.6414 3.62626 12.3737 3.35854 12.0444 3.19076C11.9004 3.11737 11.7013 3.06186 11.3308 3.03159C10.9516 3.00061 10.4686 3 10.4686 3H9.75C9.33579 3 9 2.66421 9 2.25Z" fill="currentColor"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M7 13.75C7 14.1642 6.66421 14.5 6.25 14.5H5.5C5.5 14.5 4.99466 14.5 4.5471 14.4634C4.08383 14.4256 3.66544 14.3449 3.2747 14.1458C2.66317 13.8342 2.16598 13.337 1.85439 12.7255C1.6553 12.3347 1.57457 11.9163 1.53672 11.4531C1.50015 11.0055 1.50025 10.5 1.50025 10.5L1.5 9.75C1.5 9.33579 1.83579 9 2.25 9C2.66421 9 3 9.33579 3 9.75L3.00025 10.4686C3.00025 10.4686 3.00075 10.9517 3.03173 11.3309C3.06201 11.7014 3.11751 11.9004 3.1909 12.0445C3.35868 12.3738 3.6264 12.6415 3.95568 12.8093C4.09972 12.8827 4.29874 12.9382 4.66924 12.9684C5.0485 12.9994 5.53141 13 5.53141 13H6.25C6.66421 13 7 13.3358 7 13.75Z" fill="currentColor"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M2.25 7C1.83579 7 1.5 6.66421 1.5 6.25V5.5C1.5 5.5 1.49999 4.9945 1.53655 4.54693C1.5744 4.08367 1.65514 3.66527 1.85423 3.27453C2.16582 2.66301 2.66301 2.16582 3.27453 1.85423C3.66527 1.65514 4.08367 1.5744 4.54693 1.53655C4.9945 1.49999 5.50008 1.50002 5.50008 1.50002L6.25 1.5C6.66421 1.5 7 1.83579 7 2.25C7 2.66421 6.66421 3 6.25 3L5.53149 3.00002C5.53149 3.00002 5.04834 3.00058 4.66908 3.03157C4.29858 3.06184 4.09956 3.11735 3.95552 3.19074C3.62623 3.35852 3.35852 3.62623 3.19074 3.95552C3.11735 4.09956 3.06184 4.29858 3.03157 4.66908C3.00058 5.04834 3 5.53141 3 5.53141V6.25C3 6.66421 2.66421 7 2.25 7Z" fill="currentColor"/>\n<path d="M8 11C9.65685 11 11 9.65685 11 8C11 6.34315 9.65685 5 8 5C6.34315 5 5 6.34315 5 8C5 9.65685 6.34315 11 8 11Z" fill="currentColor"/>\n</svg>\n'},580:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M8 11.5C9.933 11.5 11.5 9.933 11.5 8C11.5 6.067 9.933 4.5 8 4.5C6.067 4.5 4.5 6.067 4.5 8C4.5 9.933 6.067 11.5 8 11.5Z" fill="currentColor"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM13.5 8C13.5 11.0376 11.0376 13.5 8 13.5C4.96243 13.5 2.5 11.0376 2.5 8C2.5 4.96243 4.96243 2.5 8 2.5C11.0376 2.5 13.5 4.96243 13.5 8Z" fill="currentColor"/>\n</svg>\n'},490:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M7 9v4.334c0 .666.448 1 1 1 .553 0 1-.334 1-1V9h4.334c.666 0 1-.447 1-1 0-.552-.334-1-1-1H9V2.667c0-.667-.447-1-1-1-.552 0-1 .333-1 1V7H2.667c-.667 0-1 .448-1 1 0 .553.333 1 1 1H7Z" fill="currentColor"/>\n</svg>\n'},181:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M4 2.75C4 2.25 3.57655 2 3.25 2C2.83579 2 2.5 2.33579 2.5 2.75V14.25C2.5 14.6642 2.83579 15 3.25 15C3.66421 15 4 14.6642 4 14.25V10H12.2461C12.6603 10 12.9961 9.66421 12.9961 9.25V3.75C12.9961 3.33579 12.6603 3 12.2461 3H4V2.75ZM7.01562 8.5H9.01562V6.5H7.01562V8.5ZM7.01562 4.5V6.5H5.01562V4.5H7.01562ZM9.01562 4.5H11V6.5H9.01562V4.5Z" fill="currentColor"/>\n</svg>\n'},71:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M9.93736 6.59854L6.22562 4.56868C5.49267 4.16785 5.1262 3.96744 4.82659 4.00385C4.56514 4.03562 4.32901 4.17562 4.17569 4.38976C3.99998 4.63517 3.99998 5.05286 3.99998 5.88825V10.1232C3.99998 10.9598 3.99998 11.3781 4.17592 11.6236C4.32944 11.8378 4.56585 11.9777 4.82751 12.0093C5.12738 12.0454 5.49408 11.8442 6.22749 11.4418L9.93934 9.40504C10.4254 9.13835 10.7699 8.94933 11 8.77819V11.2498C11 11.664 11.3358 11.9998 11.75 11.9998C12.1642 11.9998 12.5 11.664 12.5 11.2498V4.74999C12.5 4.33577 12.1642 3.99999 11.75 3.99999C11.3358 3.99999 11 4.33577 11 4.74999V7.2247C10.7696 7.05367 10.4245 6.86496 9.93736 6.59854Z" fill="currentColor"/>\n</svg>\n'},161:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M9.333 8a1.333 1.333 0 1 1-2.666 0 1.333 1.333 0 0 1 2.666 0ZM14 8a1.333 1.333 0 1 1-2.667 0A1.333 1.333 0 0 1 14 8ZM4.667 8A1.333 1.333 0 1 1 2 8a1.333 1.333 0 0 1 2.667 0Z" fill="currentColor"/>\n</svg>\n'},577:t=>{t.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M4.26103 6.00006L2.53537 7.72572C2.34011 7.92098 2.34011 8.23756 2.53537 8.43283L3.56723 9.46469C3.76249 9.65995 4.07908 9.65995 4.27434 9.46469L6 7.73903L7.72566 9.46469C7.92092 9.65996 8.2375 9.65996 8.43277 9.46469L9.46463 8.43283C9.65989 8.23757 9.65989 7.92099 9.46463 7.72572L7.73897 6.00006L9.46461 4.27441C9.65987 4.07915 9.65987 3.76257 9.4646 3.5673L8.43274 2.53544C8.23748 2.34018 7.9209 2.34018 7.72563 2.53544L6 4.26108L4.27436 2.53544C4.0791 2.34018 3.76252 2.34018 3.56725 2.53544L2.53539 3.56731C2.34013 3.76257 2.34013 4.07915 2.53539 4.27441L4.26103 6.00006Z" fill="currentColor"/>\n</svg>\n'},893:t=>{t.exports='<svg viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n<mask id="path-1-inside-1_2354_299569" fill="white">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M14.7071 26.7071C14.3166 27.0976 13.6834 27.0976 13.2929 26.7071L11.2929 24.7071C10.9024 24.3166 10.9024 23.6834 11.2929 23.2929C11.6834 22.9024 12.3166 22.9024 12.7071 23.2929L14 24.5858L15.2929 23.2929C15.6834 22.9024 16.3166 22.9024 16.7071 23.2929C17.0976 23.6834 17.0976 24.3166 16.7071 24.7071L14.7071 26.7071Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1.29289 14.7071C0.902369 14.3166 0.902369 13.6834 1.29289 13.2929L3.29289 11.2929C3.68342 10.9024 4.31658 10.9024 4.70711 11.2929C5.09763 11.6834 5.09763 12.3166 4.70711 12.7071L3.41421 14L4.70711 15.2929C5.09763 15.6834 5.09763 16.3166 4.70711 16.7071C4.31658 17.0976 3.68342 17.0976 3.29289 16.7071L1.29289 14.7071Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M26.7071 13.2929C27.0976 13.6834 27.0976 14.3166 26.7071 14.7071L24.7071 16.7071C24.3166 17.0976 23.6834 17.0976 23.2929 16.7071C22.9024 16.3166 22.9024 15.6834 23.2929 15.2929L24.5858 14L23.2929 12.7071C22.9024 12.3166 22.9024 11.6834 23.2929 11.2929C23.6834 10.9024 24.3166 10.9024 24.7071 11.2929L26.7071 13.2929Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M13.2929 1.29289C13.6834 0.902369 14.3166 0.902369 14.7071 1.29289L16.7071 3.29289C17.0976 3.68342 17.0976 4.31658 16.7071 4.70711C16.3166 5.09763 15.6834 5.09763 15.2929 4.70711L14 3.41421L12.7071 4.70711C12.3166 5.09763 11.6834 5.09763 11.2929 4.70711C10.9024 4.31658 10.9024 3.68342 11.2929 3.29289L13.2929 1.29289Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M13.8624 6.99995C13.067 6.99952 12.4764 6.9992 11.9647 7.1363C10.5844 7.50617 9.50616 8.58436 9.1363 9.96472C8.9992 10.4764 8.99952 11.067 8.99995 11.8624L9 16C9 18.7614 11.2386 21 14 21C16.7614 21 19 18.7614 19 16L19 11.8624C19.0005 11.067 19.0008 10.4764 18.8637 9.96472C18.4938 8.58436 17.4156 7.50617 16.0353 7.1363C15.5236 6.9992 14.933 6.99952 14.1376 6.99995H13.8624ZM14 9V13C14 13.5523 13.5523 14 13 14H11V16C11 17.6569 12.3431 19 14 19C15.6569 19 17 17.6569 17 16V12C17 11.0056 16.9914 10.7046 16.9319 10.4824C16.7469 9.79218 16.2078 9.25308 15.5176 9.06815C15.2954 9.00859 14.9944 9 14 9Z"/>\n</mask>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M14.7071 26.7071C14.3166 27.0976 13.6834 27.0976 13.2929 26.7071L11.2929 24.7071C10.9024 24.3166 10.9024 23.6834 11.2929 23.2929C11.6834 22.9024 12.3166 22.9024 12.7071 23.2929L14 24.5858L15.2929 23.2929C15.6834 22.9024 16.3166 22.9024 16.7071 23.2929C17.0976 23.6834 17.0976 24.3166 16.7071 24.7071L14.7071 26.7071Z" fill="white"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1.29289 14.7071C0.902369 14.3166 0.902369 13.6834 1.29289 13.2929L3.29289 11.2929C3.68342 10.9024 4.31658 10.9024 4.70711 11.2929C5.09763 11.6834 5.09763 12.3166 4.70711 12.7071L3.41421 14L4.70711 15.2929C5.09763 15.6834 5.09763 16.3166 4.70711 16.7071C4.31658 17.0976 3.68342 17.0976 3.29289 16.7071L1.29289 14.7071Z" fill="white"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M26.7071 13.2929C27.0976 13.6834 27.0976 14.3166 26.7071 14.7071L24.7071 16.7071C24.3166 17.0976 23.6834 17.0976 23.2929 16.7071C22.9024 16.3166 22.9024 15.6834 23.2929 15.2929L24.5858 14L23.2929 12.7071C22.9024 12.3166 22.9024 11.6834 23.2929 11.2929C23.6834 10.9024 24.3166 10.9024 24.7071 11.2929L26.7071 13.2929Z" fill="white"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M13.2929 1.29289C13.6834 0.902369 14.3166 0.902369 14.7071 1.29289L16.7071 3.29289C17.0976 3.68342 17.0976 4.31658 16.7071 4.70711C16.3166 5.09763 15.6834 5.09763 15.2929 4.70711L14 3.41421L12.7071 4.70711C12.3166 5.09763 11.6834 5.09763 11.2929 4.70711C10.9024 4.31658 10.9024 3.68342 11.2929 3.29289L13.2929 1.29289Z" fill="white"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M13.8624 6.99995C13.067 6.99952 12.4764 6.9992 11.9647 7.1363C10.5844 7.50617 9.50616 8.58436 9.1363 9.96472C8.9992 10.4764 8.99952 11.067 8.99995 11.8624L9 16C9 18.7614 11.2386 21 14 21C16.7614 21 19 18.7614 19 16L19 11.8624C19.0005 11.067 19.0008 10.4764 18.8637 9.96472C18.4938 8.58436 17.4156 7.50617 16.0353 7.1363C15.5236 6.9992 14.933 6.99952 14.1376 6.99995H13.8624ZM14 9V13C14 13.5523 13.5523 14 13 14H11V16C11 17.6569 12.3431 19 14 19C15.6569 19 17 17.6569 17 16V12C17 11.0056 16.9914 10.7046 16.9319 10.4824C16.7469 9.79218 16.2078 9.25308 15.5176 9.06815C15.2954 9.00859 14.9944 9 14 9Z" fill="white"/>\n<path d="M13.2929 26.7071L12.5858 27.4142L13.2929 26.7071ZM14.7071 26.7071L15.4142 27.4142L14.7071 26.7071ZM11.2929 23.2929L12 24V24L11.2929 23.2929ZM12.7071 23.2929L13.4142 22.5858V22.5858L12.7071 23.2929ZM14 24.5858L13.2929 25.2929C13.4804 25.4804 13.7348 25.5858 14 25.5858C14.2652 25.5858 14.5196 25.4804 14.7071 25.2929L14 24.5858ZM15.2929 23.2929L14.5858 22.5858V22.5858L15.2929 23.2929ZM16.7071 23.2929L17.4142 22.5858L16.7071 23.2929ZM16.7071 24.7071L17.4142 25.4142L16.7071 24.7071ZM1.29289 13.2929L0.585786 12.5858H0.585786L1.29289 13.2929ZM1.29289 14.7071L0.585786 15.4142H0.585786L1.29289 14.7071ZM3.29289 11.2929L2.58579 10.5858L3.29289 11.2929ZM4.70711 11.2929L4 12H4L4.70711 11.2929ZM4.70711 12.7071L5.41421 13.4142L4.70711 12.7071ZM3.41421 14L2.70711 13.2929C2.31658 13.6834 2.31658 14.3166 2.70711 14.7071L3.41421 14ZM4.70711 15.2929L5.41421 14.5858L4.70711 15.2929ZM4.70711 16.7071L5.41421 17.4142L4.70711 16.7071ZM3.29289 16.7071L2.58579 17.4142H2.58579L3.29289 16.7071ZM26.7071 14.7071L27.4142 15.4142L26.7071 14.7071ZM26.7071 13.2929L27.4142 12.5858L26.7071 13.2929ZM23.2929 16.7071L24 16H24L23.2929 16.7071ZM23.2929 15.2929L22.5858 14.5858H22.5858L23.2929 15.2929ZM24.5858 14L25.2929 14.7071C25.4804 14.5196 25.5858 14.2652 25.5858 14C25.5858 13.7348 25.4804 13.4804 25.2929 13.2929L24.5858 14ZM23.2929 12.7071L22.5858 13.4142H22.5858L23.2929 12.7071ZM23.2929 11.2929L22.5858 10.5858L23.2929 11.2929ZM24.7071 11.2929L25.4142 10.5858L24.7071 11.2929ZM14.7071 1.29289L15.4142 0.585786V0.585786L14.7071 1.29289ZM13.2929 1.29289L12.5858 0.585786V0.585786L13.2929 1.29289ZM16.7071 3.29289L17.4142 2.58579L16.7071 3.29289ZM16.7071 4.70711L16 4V4L16.7071 4.70711ZM15.2929 4.70711L14.5858 5.41421L15.2929 4.70711ZM14 3.41421L14.7071 2.70711C14.3166 2.31658 13.6834 2.31658 13.2929 2.70711L14 3.41421ZM12.7071 4.70711L13.4142 5.41421L12.7071 4.70711ZM11.2929 4.70711L10.5858 5.41421L11.2929 4.70711ZM11.2929 3.29289L10.5858 2.58579V2.58579L11.2929 3.29289ZM13.8624 6.99995L13.8619 7.99995H13.8624V6.99995ZM11.9647 7.1363L11.7059 6.17037L11.9647 7.1363ZM9.1363 9.96472L8.17037 9.7059L9.1363 9.96472ZM8.99995 11.8624L9.99995 11.8624L9.99995 11.8619L8.99995 11.8624ZM9 16H10V16L9 16ZM19 16L18 16V16H19ZM19 11.8624L18 11.8619V11.8624L19 11.8624ZM18.8637 9.96472L19.8296 9.7059V9.7059L18.8637 9.96472ZM16.0353 7.1363L15.7765 8.10222L16.0353 7.1363ZM14.1376 6.99995V7.99995H14.1381L14.1376 6.99995ZM14 9V8H13V9H14ZM11 14V13H10V14H11ZM16.9319 10.4824L17.8978 10.2235V10.2235L16.9319 10.4824ZM15.5176 9.06815L15.7765 8.10222H15.7765L15.5176 9.06815ZM12.5858 27.4142C13.3668 28.1953 14.6332 28.1953 15.4142 27.4142L14 26L12.5858 27.4142ZM10.5858 25.4142L12.5858 27.4142L14 26L12 24L10.5858 25.4142ZM10.5858 22.5858C9.80474 23.3668 9.80474 24.6332 10.5858 25.4142L12 24L10.5858 22.5858ZM13.4142 22.5858C12.6332 21.8047 11.3668 21.8047 10.5858 22.5858L12 24V24L13.4142 22.5858ZM14.7071 23.8787L13.4142 22.5858L12 24L13.2929 25.2929L14.7071 23.8787ZM14.5858 22.5858L13.2929 23.8787L14.7071 25.2929L16 24L14.5858 22.5858ZM17.4142 22.5858C16.6332 21.8047 15.3668 21.8047 14.5858 22.5858L16 24L17.4142 22.5858ZM17.4142 25.4142C18.1953 24.6332 18.1953 23.3668 17.4142 22.5858L16 24L17.4142 25.4142ZM15.4142 27.4142L17.4142 25.4142L16 24L14 26L15.4142 27.4142ZM0.585786 12.5858C-0.195262 13.3668 -0.195262 14.6332 0.585786 15.4142L2 14L0.585786 12.5858ZM2.58579 10.5858L0.585786 12.5858L2 14L4 12L2.58579 10.5858ZM5.41421 10.5858C4.63316 9.80474 3.36684 9.80474 2.58579 10.5858L4 12L5.41421 10.5858ZM5.41421 13.4142C6.19526 12.6332 6.19526 11.3668 5.41421 10.5858L4 12H4L5.41421 13.4142ZM4.12132 14.7071L5.41421 13.4142L4 12L2.70711 13.2929L4.12132 14.7071ZM5.41421 14.5858L4.12132 13.2929L2.70711 14.7071L4 16L5.41421 14.5858ZM5.41421 17.4142C6.19526 16.6332 6.19526 15.3668 5.41421 14.5858L4 16L5.41421 17.4142ZM2.58579 17.4142C3.36684 18.1953 4.63316 18.1953 5.41421 17.4142L4 16L2.58579 17.4142ZM0.585786 15.4142L2.58579 17.4142L4 16L2 14L0.585786 15.4142ZM27.4142 15.4142C28.1953 14.6332 28.1953 13.3668 27.4142 12.5858L26 14L27.4142 15.4142ZM25.4142 17.4142L27.4142 15.4142L26 14L24 16L25.4142 17.4142ZM22.5858 17.4142C23.3668 18.1953 24.6332 18.1953 25.4142 17.4142L24 16L22.5858 17.4142ZM22.5858 14.5858C21.8047 15.3668 21.8047 16.6332 22.5858 17.4142L24 16H24L22.5858 14.5858ZM23.8787 13.2929L22.5858 14.5858L24 16L25.2929 14.7071L23.8787 13.2929ZM22.5858 13.4142L23.8787 14.7071L25.2929 13.2929L24 12L22.5858 13.4142ZM22.5858 10.5858C21.8047 11.3668 21.8047 12.6332 22.5858 13.4142L24 12L22.5858 10.5858ZM25.4142 10.5858C24.6332 9.80474 23.3668 9.80474 22.5858 10.5858L24 12L25.4142 10.5858ZM27.4142 12.5858L25.4142 10.5858L24 12L26 14L27.4142 12.5858ZM15.4142 0.585786C14.6332 -0.195262 13.3668 -0.195262 12.5858 0.585786L14 2L15.4142 0.585786ZM17.4142 2.58579L15.4142 0.585786L14 2L16 4L17.4142 2.58579ZM17.4142 5.41421C18.1953 4.63316 18.1953 3.36684 17.4142 2.58579L16 4L17.4142 5.41421ZM14.5858 5.41421C15.3668 6.19526 16.6332 6.19526 17.4142 5.41421L16 4V4L14.5858 5.41421ZM13.2929 4.12132L14.5858 5.41421L16 4L14.7071 2.70711L13.2929 4.12132ZM13.4142 5.41421L14.7071 4.12132L13.2929 2.70711L12 4L13.4142 5.41421ZM10.5858 5.41421C11.3668 6.19526 12.6332 6.19526 13.4142 5.41421L12 4L10.5858 5.41421ZM10.5858 2.58579C9.80474 3.36684 9.80474 4.63316 10.5858 5.41421L12 4L10.5858 2.58579ZM12.5858 0.585786L10.5858 2.58579L12 4L14 2L12.5858 0.585786ZM12.2235 8.10222C12.5804 8.00661 13.0225 7.9995 13.8619 7.99995L13.863 5.99995C13.1116 5.99954 12.3724 5.99179 11.7059 6.17037L12.2235 8.10222ZM10.1022 10.2235C10.3796 9.18827 11.1883 8.37962 12.2235 8.10222L11.7059 6.17037C9.98044 6.63271 8.63271 7.98044 8.17037 9.7059L10.1022 10.2235ZM9.99995 11.8619C9.9995 11.0225 10.0066 10.5804 10.1022 10.2235L8.17037 9.7059C7.99179 10.3724 7.99954 11.1116 7.99995 11.863L9.99995 11.8619ZM14 20C11.7909 20 10 18.2091 10 16H8C8 19.3137 10.6863 22 14 22V20ZM18 16C18 18.2091 16.2091 20 14 20V22C17.3137 22 20 19.3137 20 16H18ZM17.8978 10.2235C17.9934 10.5804 18.0005 11.0225 18 11.8619L20 11.863C20.0005 11.1116 20.0082 10.3724 19.8296 9.7059L17.8978 10.2235ZM15.7765 8.10222C16.8117 8.37962 17.6204 9.18827 17.8978 10.2235L19.8296 9.7059C19.3673 7.98044 18.0196 6.63271 16.2941 6.17037L15.7765 8.10222ZM14.1381 7.99995C14.9775 7.9995 15.4196 8.00661 15.7765 8.10222L16.2941 6.17037C15.6276 5.99179 14.8884 5.99954 14.137 5.99995L14.1381 7.99995ZM13 9V13H15V9H13ZM13 13V15C14.1046 15 15 14.1046 15 13H13ZM13 13H11V15H13V13ZM10 14V16H12V14H10ZM10 16C10 18.2091 11.7909 20 14 20V18C12.8954 18 12 17.1046 12 16H10ZM14 20C16.2091 20 18 18.2091 18 16H16C16 17.1046 15.1046 18 14 18V20ZM18 16V12H16V16H18ZM18 12C18 11.0776 18.0004 10.6065 17.8978 10.2235L15.9659 10.7412C15.9677 10.7478 15.9807 10.7937 15.9892 10.9938C15.9977 11.1963 16 11.4985 16 12H18ZM17.8978 10.2235C17.6204 9.18827 16.8117 8.37962 15.7765 8.10222L15.2588 10.0341C15.6039 10.1265 15.8735 10.3961 15.9659 10.7412L17.8978 10.2235ZM15.7765 8.10222C15.3935 7.9996 14.9224 8 14 8V10C14.5015 10 14.8037 10.0023 15.0062 10.0109C15.2063 10.0193 15.2522 10.0323 15.2588 10.0341L15.7765 8.10222ZM13.8624 7.99995H14.1376V5.99995H13.8624V7.99995ZM10 16L9.99995 11.8624L7.99995 11.8624L8 16L10 16ZM18 11.8624L18 16L20 16L20 11.8624L18 11.8624Z" fill="white" mask="url(#path-1-inside-1_2354_299569)"/>\n</svg>\n'},978:t=>{t.exports='<svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M6 12C6 16.0237 8.93828 21.8231 14.8148 29.3979L14.8148 29.3979C15.3226 30.0525 16.2649 30.1714 16.9194 29.6637C17.0188 29.5866 17.1081 29.4973 17.1852 29.3979C23.0617 21.8231 26 16.0237 26 12C26 6.47143 21.5286 2 16 2C10.4714 2 6 6.47143 6 12ZM12.5014 12.0015C12.5014 10.0695 14.0694 8.50148 16.0014 8.50148C17.9334 8.50148 19.5014 10.0695 19.5014 12.0015C19.5014 13.9335 17.9334 15.5015 16.0014 15.5015C14.0694 15.5015 12.5014 13.9335 12.5014 12.0015Z" fill="currentColor"/>\n</svg>\n'},628:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M14 10V11C14 12.4001 14 13.1002 13.7275 13.635C13.4878 14.1054 13.1054 14.4878 12.635 14.7275C12.1002 15 11.4001 15 10 15H6C4.59987 15 3.8998 15 3.36502 14.7275C2.89462 14.4878 2.51217 14.1054 2.27248 13.635C2 13.1002 2 12.4001 2 11V10C2 8.59987 2 7.8998 2.27248 7.36502C2.51217 6.89462 2.89462 6.51217 3.36502 6.27248C3.54965 6.17841 3.75397 6.11682 4 6.07649V5C4 2.79086 5.79086 1 8 1C10.2091 1 12 2.79086 12 5V6.07649C12.246 6.11682 12.4504 6.17841 12.635 6.27248C13.1054 6.51217 13.4878 6.89462 13.7275 7.36502C14 7.8998 14 8.59987 14 10ZM10 5V6H6V5C6 3.89543 6.89543 3 8 3C9.10457 3 10 3.89543 10 5Z" fill="currentColor"/>\n</svg>\n'},246:t=>{t.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd" d="M1.96875 6.00013C1.96875 5.64868 2.25366 5.36377 2.60511 5.36377H9.39299C9.74445 5.36377 10.0294 5.64868 10.0294 6.00013C10.0294 6.35159 9.74445 6.6365 9.39299 6.6365H2.60511C2.25366 6.6365 1.96875 6.35159 1.96875 6.00013Z" fill="currentColor"/>\n</svg>\n'},696:t=>{t.exports='<svg viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="m10 3.5.53-.53a.75.75 0 0 0-1.06 0l.53.53Zm0 14-.53.53a.75.75 0 0 0 1.06 0L10 17.5Zm7-7 .53.53a.75.75 0 0 0 0-1.06l-.53.53Zm-14 0-.53-.53a.75.75 0 0 0 0 1.06L3 10.5Zm4.37-5.43a.75.75 0 0 0 1.06 1.06L7.37 5.07Zm4.2 1.06a.75.75 0 1 0 1.06-1.06l-1.06 1.06Zm3.86 1.74a.75.75 0 1 0-1.06 1.06l1.06-1.06Zm-1.06 4.2a.75.75 0 1 0 1.06 1.06l-1.06-1.06ZM5.63 8.93a.75.75 0 0 0-1.06-1.06l1.06 1.06Zm-1.06 4.2a.75.75 0 0 0 1.06-1.06l-1.06 1.06Zm8.06 2.8a.75.75 0 1 0-1.06-1.06l1.06 1.06Zm-4.2-1.06a.75.75 0 0 0-1.06 1.06l1.06-1.06ZM9.25 3.5v7h1.5v-7h-1.5Zm0 7v7h1.5v-7h-1.5Zm.75.75h7v-1.5h-7v1.5Zm0-1.5H3v1.5h7v-1.5Zm-.53-6.78-2.1 2.1 1.06 1.06 2.1-2.1-1.06-1.06Zm0 1.06 2.1 2.1 1.06-1.06-2.1-2.1-1.06 1.06Zm8.06 5.94-2.1-2.1-1.06 1.06 2.1 2.1 1.06-1.06Zm-1.06 0-2.1 2.1 1.06 1.06 2.1-2.1-1.06-1.06ZM3.53 11.03l2.1-2.1-1.06-1.06-2.1 2.1 1.06 1.06Zm-1.06 0 2.1 2.1 1.06-1.06-2.1-2.1-1.06 1.06Zm8.06 7 2.1-2.1-1.06-1.06-2.1 2.1 1.06 1.06Zm0-1.06-2.1-2.1-1.06 1.06 2.1 2.1 1.06-1.06Z" fill="currentColor"/>\n</svg>\n'},872:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M4.6 12.5001C3.71634 12.5001 3 11.7541 3 10.8338V9.00003L1.5 9.00003C0.947716 9.00003 0.5 8.55231 0.5 8.00003C0.5 7.44774 0.947715 7.00003 1.5 7.00003H3V5.1663C3 4.24603 3.71634 3.5 4.6 3.5H11.4C12.2837 3.5 13 4.24603 13 5.1663V7.00003H14.5C15.0523 7.00003 15.5 7.44774 15.5 8.00003C15.5 8.55231 15.0523 9.00003 14.5 9.00003H13V10.8338C13 11.7541 12.2837 12.5001 11.4 12.5001H4.6Z" fill="currentColor"/>\n</svg>\n'},52:t=>{t.exports='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M6.75 1.75105C6.75 1.33684 6.41421 1.00105 6 1.00105C5.58579 1.00105 5.25 1.33684 5.25 1.75105V5.25105H1.75C1.33579 5.25105 1 5.58684 1 6.00105C1 6.41527 1.33579 6.75105 1.75 6.75105H5.25V10.2511C5.25 10.6653 5.58579 11.0011 6 11.0011C6.41421 11.0011 6.75 10.6653 6.75 10.2511V6.75105H10.25C10.6642 6.75105 11 6.41527 11 6.00105C11 5.58684 10.6642 5.25105 10.25 5.25105H6.75V1.75105Z" fill="currentColor"/>\n</svg>\n'},716:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M12.713 2.55708C12.9932 2.441 13.3158 2.50516 13.5303 2.71966L14.7803 3.96966C15.0732 4.26255 15.0732 4.73743 14.7803 5.03032L13.5303 6.28032C13.3158 6.49482 12.9932 6.55899 12.713 6.4429C12.4327 6.32682 12.25 6.05334 12.25 5.74999V5.25155C11.3851 5.27952 10.6303 5.68239 9.85664 6.36406C9.54585 6.6379 9.07192 6.60795 8.79809 6.29717C8.52425 5.98639 8.5542 5.51246 8.86498 5.23862C9.78862 4.42478 10.8814 3.78015 12.25 3.75101V3.24999C12.25 2.94664 12.4327 2.67317 12.713 2.55708ZM1 4.49999C1 4.08577 1.33579 3.74999 1.75 3.74999C4.59632 3.74999 6.40513 5.8005 7.87948 7.51019C7.93447 7.57396 7.98901 7.63731 8.04315 7.70019C8.74976 8.52099 9.38845 9.26288 10.0789 9.82432C10.7759 10.391 11.4671 10.7231 12.25 10.7484V10.25C12.25 9.94664 12.4327 9.67317 12.713 9.55708C12.9932 9.441 13.3158 9.50516 13.5303 9.71966L14.7803 10.9697C15.0732 11.2626 15.0732 11.7374 14.7803 12.0303L13.5303 13.2803C13.3158 13.4948 12.9932 13.559 12.713 13.4429C12.4327 13.3268 12.25 13.0533 12.25 12.75V12.249C11.0124 12.2226 9.99878 11.6924 9.13262 10.9881C8.48049 10.4579 7.8782 9.79958 7.30755 9.14373C5.93869 10.6759 4.24592 12.25 1.75 12.25C1.33579 12.25 1 11.9142 1 11.5C1 11.0858 1.33579 10.75 1.75 10.75C3.61653 10.75 4.93343 9.56285 6.31646 8.00027C4.93633 6.44253 3.6229 5.24999 1.75 5.24999C1.33579 5.24999 1 4.9142 1 4.49999Z" fill="currentColor"/>\n</svg>\n'},916:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M4.75 2C5.16421 2 5.5 2.33579 5.5 2.75V3.02132L12.0658 6.06975C12.3306 6.19268 12.5 6.45808 12.5 6.75C12.5 7.04193 12.3306 7.30733 12.0658 7.43026L5.5 10.4787V14.2461C5.5 14.6603 5.16421 14.9961 4.75 14.9961C4.33579 14.9961 4 14.6603 4 14.2461V2.75C4 2.33579 4.33579 2 4.75 2Z" fill="currentColor"/>\n</svg>\n'},123:t=>{t.exports='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M19.81 12.84a.608.608 0 0 0-.45-.194h-2.24v-3l1.73-1.765a.634.634 0 0 0 .19-.46.634.634 0 0 0-.19-.459.609.609 0 0 0-.45-.194.609.609 0 0 0-.45.194l-1.73 1.766H7.78L6.05 6.962a.609.609 0 0 0-.45-.194.61.61 0 0 0-.45.194.634.634 0 0 0-.19.46c0 .176.063.33.19.459l1.73 1.765v3H4.64a.609.609 0 0 0-.45.194.634.634 0 0 0-.19.459c0 .177.063.33.19.46.127.128.277.193.45.193h2.24c0 1.088.193 2.02.58 2.796l-2.02 2.316a.659.659 0 0 0-.155.475.66.66 0 0 0 .205.454c.127.109.27.163.43.163a.633.633 0 0 0 .48-.214l1.83-2.112.15.143c.093.088.238.199.435.331.197.133.417.265.66.398.243.133.533.245.87.337a3.84 3.84 0 0 0 1.015.138v-9.143h1.28v9.143c.32 0 .643-.044.97-.133.326-.088.6-.187.82-.296a6.31 6.31 0 0 0 .65-.372c.213-.14.353-.236.42-.291.066-.055.116-.099.15-.133l1.98 2.01c.12.13.27.194.45.194a.59.59 0 0 0 .45-.194.636.636 0 0 0 .19-.459.635.635 0 0 0-.19-.459l-2.08-2.133c.447-.81.67-1.796.67-2.959h2.24a.608.608 0 0 0 .45-.194.634.634 0 0 0 .19-.459.633.633 0 0 0-.19-.46Z" fill="currentColor"/><path d="M14.265 5.11A3.054 3.054 0 0 0 12 4.156c-.887 0-1.642.318-2.265.954-.623.636-.935 1.407-.935 2.312h6.4c0-.905-.312-1.676-.935-2.312Z" fill="currentColor"/>\n</svg>\n'}},o={};function i(t){var e=o[t];if(void 0!==e)return e.exports;var n=o[t]={exports:{}};return r[t](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var a={};(()=>{i.d(a,{Q:()=>ni,$:()=>vs});var t={node:{width:186,defaultHeight:115,heightWithPreview:151,heightWithPreviewEov:196,heightFull:237,borderRadius:12,headerHeight:36,componentAddActionHeight:40,componentPreviewHeight:114,componentControlHeight:44,componentOrderRadius:12,defaultConnectorPositionY:57,connectorPositionY:93,connectorPositionDiff:20,control:{connectorRadius:8,actionLinkY:12,inactionLinkY:32,lineLength:22},previewPlaceholder:{textColor:"#76787A",borderColor:"#5D5F61",backgroundColor:"#19191A"}},tool:{menuItemWidth:200,menuItemHeight:32,menuItemTooltipOffset:214,borderRadius:4,strokeColor:"rgba(255, 255, 255, 0.11)",textColor:"#F2F5FF",eov:{size:22,radius:10},copyPasteDx:50,copyPasteDy:50},strokeSize:1,iconSize:16,controlConnectorIconSize:12,color:{percentDiff:20,error:"#F2A218",text:"#FFFFFF",stroke:"#FFFFFF",disabledStroke:"#86898F",elementBackground:"#232324",elementBackgroundAlt:"#1A1D20",elementBackgroundHover:"#363738",elementBackgroundHover2:"#505358",elementStroke:"#141414",nodeStroke:"#232324",shadowNodeFill:"rgba(255, 255, 255, 0.11)",shadowNodeStroke:"rgba(255, 255, 255, 0.48)",connectorStroke:"#797B82"},prefix:{nodeEOV:"eov_",nodeBorder:"border_",nodeFlipConnector:"flip_connector_",nodeActionConnector:"action_connector_",nodeInactionConnector:"inaction_connector_",nodeError:"error_"},grid:{size:18.6,steps:10}},e={node_video_error:"No video",node_video_choose:"Choose video",node_video_change:"Change video",node_open_editor:"Open editor",node_eov:"Flip to",node_add_control:"Add action",node_not_visited:"Not visited",node_watch_again_from:"Watch again",error_node_message:"Add the required elements:",error_no_video:"Video file",error_no_eov:"Flip to",error_no_branches:"Connection with the node",tool_menu_item_rename:"Rename",tool_menu_item_copy:"Copy",tool_menu_item_paste:"Paste",tool_menu_item_delete:"Delete",tool_menu_item_add_node:"Add node",tool_menu_item_as_start_node:"Set as Start node",tool_menu_item_as_end_node:"Set as End node",tool_menu_item_as_node:"Set as node",tool_menu_item_start_preview:"Preview from this node",tool_menu_item_next_node:"Next node",tool_menu_item_random:"Random",tool_menu_item_random_tooltip:'Add action to use "Random"',tool_menu_item_control_area:"Area",tool_menu_item_control_button:"Button",tool_shadow_node_text:"Click on the left mouse \nbutton to create a node. \nClick on the right \nbutton to cancel \nthe action.",tool_shadow_node_link_text:"New node",tool_shadow_node_error:"The area must\nnot be in contact\nwith other nodes",popup_error_title:"Error",popup_error_message_1:"Manifest is broken",popup_error_message_2:"Manifest media metadata should be parsed",new_chapter_label:"[Untitled]",new_text_label:"Text",new_text_content:"Enter text",new_button_label:"Button",new_area_label:"Area",tooltip_inaction_not_available:'Not available because the <br/>"Waiting for interaction" option is enabled',copy_chapter:"Node copied",copy_multiple_chapters:"Multiple nodes copied",remove_initial_chapter:"Start node cannot be removed",graph_node_start:"Start",graph_node_end:"End",graph_location:"Current position",navigation_controls:"Zoom"},n={node_video_error:"Нет видео",node_video_choose:"Выбрать видео",node_video_change:"Заменить видео",node_open_editor:"Открыть редактор",node_eov:"Перейти к",node_add_control:"Добавить действие",node_not_visited:"Не пройдено",node_watch_again_from:"Пересмотреть",error_node_message:"Добавьте нужные элементы:",error_no_video:"Видеофайл",error_no_eov:"Перейти к",error_no_branches:"Связь с нодом",tool_menu_item_rename:"Переименовать",tool_menu_item_copy:"Копировать",tool_menu_item_paste:"Вставить",tool_menu_item_delete:"Удалить",tool_menu_item_add_node:"Новый нод",tool_menu_item_as_start_node:"Назначить нод стартовым",tool_menu_item_as_end_node:"Назначить нод финальным",tool_menu_item_as_node:"Назначить нод обычным",tool_menu_item_start_preview:"Начать предпросмотр",tool_menu_item_next_node:"Следующий нод",tool_menu_item_random:"Случайный",tool_menu_item_random_tooltip:'Добавьте действие чтобы использовать "Случайный"',tool_menu_item_control_area:"Область",tool_menu_item_control_button:"Кнопка",tool_shadow_node_text:"Нажмите на левую кнопку \nмыши, чтобы создать нод. \nНажмите на правую кнопку \nмыши, чтобы отменить \nдействие.",tool_shadow_node_link_text:"Новый нод",tool_shadow_node_error:"Область не должна\nзадевать другие ноды",popup_error_title:"Ошибка",popup_error_message_1:"Манифест сломан",popup_error_message_2:"Необходим парсинг поля 'metadata.media'",new_chapter_label:"[Без названия]",new_text_label:"Текст",new_text_content:"Введите текст",new_button_label:"Кнопка",new_area_label:"Область",tooltip_inaction_not_available:'Недоступно, так как включен параметр <br/>"Ожидание взаимодействия"',copy_chapter:"Нод скопирован",copy_multiple_chapters:"Несколько нод скопированы",remove_initial_chapter:"Стартовый нод нельзя удалить",graph_node_start:"Начало",graph_node_end:"Конец",graph_location:"Моя позиция",navigation_controls:"Перемещение"},r=function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};const o=new function(){var o=this;this.init=function(t){t&&(o._mode=t.mode||o._mode,t.lang&&(o.translation="en"===t.lang?e:n),t.translation&&(o.translation=r(r({},o.translation),t.translation)))},this.isViewMode=function(){return"read"===o._mode},this.isEditMode=function(){return"edit"===o._mode},this.isPreViewMode=function(){return"pre_view"===o._mode},this.isViewOrPreViewMode=function(){return o.isViewMode()||o.isPreViewMode()},this.isEditOrPreViewMode=function(){return o.isEditMode()||o.isPreViewMode()},this.switchMode=function(t){o._mode=t},this._mode="edit",this.render=t,this.translation=e};const s=new(function(){function t(){var t=this;this.on=function(e,n){t._listeners[e].push(n)},this.off=function(e,n){t._listeners[e]=t._listeners[e].filter((function(t){return t!==n}))},this.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];t._listeners[e].forEach((function(t){return t.apply(void 0,function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(n),!1))}))},this.dispose=function(){t.resetListeners()},this.resetListeners()}return t.prototype.resetListeners=function(){this._listeners={manifestUpdate:[],selectChapters:[],deleteChapters:[],selectBranches:[],control:[],zoom:[],zoomEnd:[],notification:[],events:[]}},t}());var l;!function(t){t.Node="icon_node",t.StartNode="icon_start_node",t.EndNode="icon_end_node",t.EndOfVideo="icon_end_of_video",t.ActionButton="icon_action_button",t.ActionArea="icon_action_area",t.Etc="icon_etc",t.Add="icon_add",t.Random="icon_random",t.Warning="icon_warning",t.Move="icon_move",t.Plus="icon_plus",t.Minus="icon_minus",t.Action="icon_action",t.Inaction="icon_inaction",t.Location="icon_location",t.Lock="icon_lock",t.LegendNavigation="icon_legend_navigation"}(l||(l={}));var c,d=[l.Plus,l.Minus,l.Action,l.Inaction],u=function(t){var e,n,r;try{for(var a=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}((r=l,Object.keys(r).filter((function(t){return Number.isNaN(+t)})))),s=a.next();!s.done;s=a.next()){var c=s.value;t.append("svg").attr("id",l[c]).attr("class","icon").attr("height",d.includes(l[c])?o.render.controlConnectorIconSize:o.render.iconSize).attr("width",d.includes(l[c])?o.render.controlConnectorIconSize:o.render.iconSize).html(i(254)("./".concat(l[c],".svg")))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},h="M 0, 0  m -5, 0  a 5,5 0 1,0 10,0  a 5,5 0 1,0 -10,0",p="-7 -7 14 14";!function(t){t.Circle="marker_circle",t.CircleDisabled="marker_circle_disabled",t.Connector="marker_connector"}(c||(c={}));var f=[{name:c.Circle,path:h,viewBox:p,stroke:o.render.color.stroke,strokeWidth:2,size:8,fill:o.render.color.stroke},{name:c.CircleDisabled,path:h,viewBox:p,stroke:"#76787A",strokeWidth:2,size:8,fill:"#76787A"},{name:c.Connector,path:h,viewBox:p,stroke:"#F2F5FF",strokeWidth:2,size:16,fill:"#35383C"}];function v(){}function m(t){return null==t?v:function(){return this.querySelector(t)}}function y(){return[]}function g(t){return null==t?y:function(){return this.querySelectorAll(t)}}function _(t){return function(){return this.matches(t)}}function b(t){return function(e){return e.matches(t)}}var w=Array.prototype.find;function C(){return this.firstElementChild}var x=Array.prototype.filter;function E(){return Array.from(this.children)}function M(t){return new Array(t.length)}function k(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function S(t,e,n,r,o,i){for(var a,s=0,l=e.length,c=i.length;s<c;++s)(a=e[s])?(a.__data__=i[s],r[s]=a):n[s]=new k(t,i[s]);for(;s<l;++s)(a=e[s])&&(o[s]=a)}function I(t,e,n,r,o,i,a){var s,l,c,d=new Map,u=e.length,h=i.length,p=new Array(u);for(s=0;s<u;++s)(l=e[s])&&(p[s]=c=a.call(l,l.__data__,s,e)+"",d.has(c)?o[s]=l:d.set(c,l));for(s=0;s<h;++s)c=a.call(t,i[s],s,i)+"",(l=d.get(c))?(r[s]=l,l.__data__=i[s],d.delete(c)):n[s]=new k(t,i[s]);for(s=0;s<u;++s)(l=e[s])&&d.get(p[s])===l&&(o[s]=l)}function N(t){return t.__data__}function L(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function O(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}k.prototype={constructor:k,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var T="http://www.w3.org/1999/xhtml";const A={svg:"http://www.w3.org/2000/svg",xhtml:T,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function P(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),A.hasOwnProperty(e)?{space:A[e],local:t}:t}function j(t){return function(){this.removeAttribute(t)}}function B(t){return function(){this.removeAttributeNS(t.space,t.local)}}function V(t,e){return function(){this.setAttribute(t,e)}}function z(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function R(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function D(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function F(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function H(t){return function(){this.style.removeProperty(t)}}function Z(t,e,n){return function(){this.style.setProperty(t,e,n)}}function $(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function W(t,e){return t.style.getPropertyValue(e)||F(t).getComputedStyle(t,null).getPropertyValue(e)}function Y(t){return function(){delete this[t]}}function G(t,e){return function(){this[t]=e}}function X(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function q(t){return t.trim().split(/^|\s+/)}function U(t){return t.classList||new K(t)}function K(t){this._node=t,this._names=q(t.getAttribute("class")||"")}function Q(t,e){for(var n=U(t),r=-1,o=e.length;++r<o;)n.add(e[r])}function J(t,e){for(var n=U(t),r=-1,o=e.length;++r<o;)n.remove(e[r])}function tt(t){return function(){Q(this,t)}}function et(t){return function(){J(this,t)}}function nt(t,e){return function(){(e.apply(this,arguments)?Q:J)(this,t)}}function rt(){this.textContent=""}function ot(t){return function(){this.textContent=t}}function it(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function at(){this.innerHTML=""}function st(t){return function(){this.innerHTML=t}}function lt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function ct(){this.nextSibling&&this.parentNode.appendChild(this)}function dt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ut(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===T&&e.documentElement.namespaceURI===T?e.createElement(t):e.createElementNS(n,t)}}function ht(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function pt(t){var e=P(t);return(e.local?ht:ut)(e)}function ft(){return null}function vt(){var t=this.parentNode;t&&t.removeChild(this)}function mt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function yt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function gt(t){return function(){var e=this.__on;if(e){for(var n,r=0,o=-1,i=e.length;r<i;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++o]=n:this.removeEventListener(n.type,n.listener,n.options);++o?e.length=o:delete this.__on}}}function _t(t,e,n){return function(){var r,o=this.__on,i=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(o)for(var a=0,s=o.length;a<s;++a)if((r=o[a]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),void(r.value=e);this.addEventListener(t.type,i,n),r={type:t.type,name:t.name,value:e,listener:i,options:n},o?o.push(r):this.__on=[r]}}function bt(t,e,n){var r=F(t),o=r.CustomEvent;"function"==typeof o?o=new o(e,n):(o=r.document.createEvent("Event"),n?(o.initEvent(e,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(e,!1,!1)),t.dispatchEvent(o)}function wt(t,e){return function(){return bt(this,t,e)}}function Ct(t,e){return function(){return bt(this,t,e.apply(this,arguments))}}K.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var xt=[null];function Et(t,e){this._groups=t,this._parents=e}function Mt(){return new Et([[document.documentElement]],xt)}Et.prototype=Mt.prototype={constructor:Et,select:function(t){"function"!=typeof t&&(t=m(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var i,a,s=e[o],l=s.length,c=r[o]=new Array(l),d=0;d<l;++d)(i=s[d])&&(a=t.call(i,i.__data__,d,s))&&("__data__"in i&&(a.__data__=i.__data__),c[d]=a);return new Et(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return function(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}(t.apply(this,arguments))}}(t):g(t);for(var e=this._groups,n=e.length,r=[],o=[],i=0;i<n;++i)for(var a,s=e[i],l=s.length,c=0;c<l;++c)(a=s[c])&&(r.push(t.call(a,a.__data__,c,s)),o.push(a));return new Et(r,o)},selectChild:function(t){return this.select(null==t?C:function(t){return function(){return w.call(this.children,t)}}("function"==typeof t?t:b(t)))},selectChildren:function(t){return this.selectAll(null==t?E:function(t){return function(){return x.call(this.children,t)}}("function"==typeof t?t:b(t)))},filter:function(t){"function"!=typeof t&&(t=_(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var i,a=e[o],s=a.length,l=r[o]=[],c=0;c<s;++c)(i=a[c])&&t.call(i,i.__data__,c,a)&&l.push(i);return new Et(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,N);var n=e?I:S,r=this._parents,o=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var i=o.length,a=new Array(i),s=new Array(i),l=new Array(i),c=0;c<i;++c){var d=r[c],u=o[c],h=u.length,p=L(t.call(d,d&&d.__data__,c,r)),f=p.length,v=s[c]=new Array(f),m=a[c]=new Array(f);n(d,u,v,m,l[c]=new Array(h),p,e);for(var y,g,_=0,b=0;_<f;++_)if(y=v[_]){for(_>=b&&(b=_+1);!(g=m[b])&&++b<f;);y._next=g||null}}return(a=new Et(a,r))._enter=s,a._exit=l,a},enter:function(){return new Et(this._enter||this._groups.map(M),this._parents)},exit:function(){return new Et(this._exit||this._groups.map(M),this._parents)},join:function(t,e,n){var r=this.enter(),o=this,i=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(o=e(o))&&(o=o.selection()),null==n?i.remove():n(i),r&&o?r.merge(o).order():o},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,o=n.length,i=r.length,a=Math.min(o,i),s=new Array(o),l=0;l<a;++l)for(var c,d=n[l],u=r[l],h=d.length,p=s[l]=new Array(h),f=0;f<h;++f)(c=d[f]||u[f])&&(p[f]=c);for(;l<o;++l)s[l]=n[l];return new Et(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,o=t[e],i=o.length-1,a=o[i];--i>=0;)(r=o[i])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=O);for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var a,s=n[i],l=s.length,c=o[i]=new Array(l),d=0;d<l;++d)(a=s[d])&&(c[d]=a);c.sort(e)}return new Et(o,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],o=0,i=r.length;o<i;++o){var a=r[o];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var o,i=e[n],a=0,s=i.length;a<s;++a)(o=i[a])&&t.call(o,o.__data__,a,i);return this},attr:function(t,e){var n=P(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?B:j:"function"==typeof e?n.local?D:R:n.local?z:V)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?H:"function"==typeof e?$:Z)(t,e,null==n?"":n)):W(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Y:"function"==typeof e?X:G)(t,e)):this.node()[t]},classed:function(t,e){var n=q(t+"");if(arguments.length<2){for(var r=U(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each(("function"==typeof e?nt:e?tt:et)(n,e))},text:function(t){return arguments.length?this.each(null==t?rt:("function"==typeof t?it:ot)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?at:("function"==typeof t?lt:st)(t)):this.node().innerHTML},raise:function(){return this.each(ct)},lower:function(){return this.each(dt)},append:function(t){var e="function"==typeof t?t:pt(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:pt(t),r=null==e?ft:"function"==typeof e?e:m(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(vt)},clone:function(t){return this.select(t?yt:mt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,o,i=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),a=i.length;if(!(arguments.length<2)){for(s=e?_t:gt,r=0;r<a;++r)this.each(s(i[r],e,n));return this}var s=this.node().__on;if(s)for(var l,c=0,d=s.length;c<d;++c)for(r=0,l=s[c];r<a;++r)if((o=i[r]).type===l.type&&o.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?Ct:wt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,o=t[e],i=0,a=o.length;i<a;++i)(r=o[i])&&(yield r)}};const kt=Mt;var St={value:()=>{}};function It(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Nt(r)}function Nt(t){this._=t}function Lt(t,e){for(var n,r=0,o=t.length;r<o;++r)if((n=t[r]).name===e)return n.value}function Ot(t,e,n){for(var r=0,o=t.length;r<o;++r)if(t[r].name===e){t[r]=St,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}Nt.prototype=It.prototype={constructor:Nt,on:function(t,e){var n,r=this._,o=function(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}(t+"",r),i=-1,a=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++i<a;)if(n=(t=o[i]).type)r[n]=Ot(r[n],t.name,e);else if(null==e)for(n in r)r[n]=Ot(r[n],t.name,null);return this}for(;++i<a;)if((n=(t=o[i]).type)&&(n=Lt(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Nt(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,o=new Array(n),i=0;i<n;++i)o[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,n=(r=this._[t]).length;i<n;++i)r[i].value.apply(e,o)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,i=r.length;o<i;++o)r[o].value.apply(e,n)}};const Tt=It;var At,Pt,jt=0,Bt=0,Vt=0,zt=0,Rt=0,Dt=0,Ft="object"==typeof performance&&performance.now?performance:Date,Ht="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Zt(){return Rt||(Ht($t),Rt=Ft.now()+Dt)}function $t(){Rt=0}function Wt(){this._call=this._time=this._next=null}function Yt(t,e,n){var r=new Wt;return r.restart(t,e,n),r}function Gt(){Rt=(zt=Ft.now())+Dt,jt=Bt=0;try{!function(){Zt(),++jt;for(var t,e=At;e;)(t=Rt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--jt}()}finally{jt=0,function(){for(var t,e,n=At,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:At=e);Pt=t,qt(r)}(),Rt=0}}function Xt(){var t=Ft.now(),e=t-zt;e>1e3&&(Dt-=e,zt=t)}function qt(t){jt||(Bt&&(Bt=clearTimeout(Bt)),t-Rt>24?(t<1/0&&(Bt=setTimeout(Gt,t-Ft.now()-Dt)),Vt&&(Vt=clearInterval(Vt))):(Vt||(zt=Ft.now(),Vt=setInterval(Xt,1e3)),jt=1,Ht(Gt)))}function Ut(t,e,n){var r=new Wt;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}Wt.prototype=Yt.prototype={constructor:Wt,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Zt():+n)+(null==e?0:+e),this._next||Pt===this||(Pt?Pt._next=this:At=this,Pt=this),this._call=t,this._time=n,qt()},stop:function(){this._call&&(this._call=null,this._time=1/0,qt())}};var Kt=Tt("start","end","cancel","interrupt"),Qt=[];function Jt(t,e,n,r,o,i){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var r,o=t.__transition;function i(l){var c,d,u,h;if(1!==n.state)return s();for(c in o)if((h=o[c]).name===n.name){if(3===h.state)return Ut(i);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete o[c]):+c<e&&(h.state=6,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete o[c])}if(Ut((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(l))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(u=n.tween.length),c=0,d=-1;c<u;++c)(h=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++d]=h);r.length=d+1}}function a(e){for(var o=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),i=-1,a=r.length;++i<a;)r[i].call(t,o);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var r in n.state=6,n.timer.stop(),delete o[e],o)return;delete t.__transition}o[e]=n,n.timer=Yt((function(t){n.state=1,n.timer.restart(i,n.delay,n.time),n.delay<=t&&i(t-n.delay)}),0,n.time)}(t,n,{name:e,index:r,group:o,on:Kt,tween:Qt,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})}function te(t,e){var n=ne(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function ee(t,e){var n=ne(t,e);if(n.state>3)throw new Error("too late; already running");return n}function ne(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function re(t,e){var n,r,o,i=t.__transition,a=!0;if(i){for(o in e=null==e?null:e+"",i)(n=i[o]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[o]):a=!1;a&&delete t.__transition}}function oe(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var ie,ae=180/Math.PI,se={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function le(t,e,n,r,o,i){var a,s,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),t*r<e*n&&(t=-t,e=-e,l=-l,a=-a),{translateX:o,translateY:i,rotate:Math.atan2(e,t)*ae,skewX:Math.atan(l)*ae,scaleX:a,scaleY:s}}function ce(t,e,n,r){function o(t){return t.length?t.pop()+" ":""}return function(i,a){var s=[],l=[];return i=t(i),a=t(a),function(t,r,o,i,a,s){if(t!==o||r!==i){var l=a.push("translate(",null,e,null,n);s.push({i:l-4,x:oe(t,o)},{i:l-2,x:oe(r,i)})}else(o||i)&&a.push("translate("+o+e+i+n)}(i.translateX,i.translateY,a.translateX,a.translateY,s,l),function(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(o(n)+"rotate(",null,r)-2,x:oe(t,e)})):e&&n.push(o(n)+"rotate("+e+r)}(i.rotate,a.rotate,s,l),function(t,e,n,i){t!==e?i.push({i:n.push(o(n)+"skewX(",null,r)-2,x:oe(t,e)}):e&&n.push(o(n)+"skewX("+e+r)}(i.skewX,a.skewX,s,l),function(t,e,n,r,i,a){if(t!==n||e!==r){var s=i.push(o(i)+"scale(",null,",",null,")");a.push({i:s-4,x:oe(t,n)},{i:s-2,x:oe(e,r)})}else 1===n&&1===r||i.push(o(i)+"scale("+n+","+r+")")}(i.scaleX,i.scaleY,a.scaleX,a.scaleY,s,l),i=a=null,function(t){for(var e,n=-1,r=l.length;++n<r;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var de=ce((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?se:le(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),ue=ce((function(t){return null==t?se:(ie||(ie=document.createElementNS("http://www.w3.org/2000/svg","g")),ie.setAttribute("transform",t),(t=ie.transform.baseVal.consolidate())?le((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):se)}),", ",")",")");function he(t,e){var n,r;return function(){var o=ee(this,t),i=o.tween;if(i!==n)for(var a=0,s=(r=n=i).length;a<s;++a)if(r[a].name===e){(r=r.slice()).splice(a,1);break}o.tween=r}}function pe(t,e,n){var r,o;if("function"!=typeof n)throw new Error;return function(){var i=ee(this,t),a=i.tween;if(a!==r){o=(r=a).slice();for(var s={name:e,value:n},l=0,c=o.length;l<c;++l)if(o[l].name===e){o[l]=s;break}l===c&&o.push(s)}i.tween=o}}function fe(t,e,n){var r=t._id;return t.each((function(){var t=ee(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return ne(t,r).value[e]}}function ve(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function me(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ye(){}var ge=.7,_e=1/ge,be="\\s*([+-]?\\d+)\\s*",we="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ce="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xe=/^#([0-9a-f]{3,8})$/,Ee=new RegExp(`^rgb\\(${be},${be},${be}\\)$`),Me=new RegExp(`^rgb\\(${Ce},${Ce},${Ce}\\)$`),ke=new RegExp(`^rgba\\(${be},${be},${be},${we}\\)$`),Se=new RegExp(`^rgba\\(${Ce},${Ce},${Ce},${we}\\)$`),Ie=new RegExp(`^hsl\\(${we},${Ce},${Ce}\\)$`),Ne=new RegExp(`^hsla\\(${we},${Ce},${Ce},${we}\\)$`),Le={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Oe(){return this.rgb().formatHex()}function Te(){return this.rgb().formatRgb()}function Ae(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=xe.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Pe(e):3===n?new Ve(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?je(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?je(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Ee.exec(t))?new Ve(e[1],e[2],e[3],1):(e=Me.exec(t))?new Ve(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=ke.exec(t))?je(e[1],e[2],e[3],e[4]):(e=Se.exec(t))?je(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Ie.exec(t))?Ze(e[1],e[2]/100,e[3]/100,1):(e=Ne.exec(t))?Ze(e[1],e[2]/100,e[3]/100,e[4]):Le.hasOwnProperty(t)?Pe(Le[t]):"transparent"===t?new Ve(NaN,NaN,NaN,0):null}function Pe(t){return new Ve(t>>16&255,t>>8&255,255&t,1)}function je(t,e,n,r){return r<=0&&(t=e=n=NaN),new Ve(t,e,n,r)}function Be(t,e,n,r){return 1===arguments.length?function(t){return t instanceof ye||(t=Ae(t)),t?new Ve((t=t.rgb()).r,t.g,t.b,t.opacity):new Ve}(t):new Ve(t,e,n,null==r?1:r)}function Ve(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function ze(){return`#${He(this.r)}${He(this.g)}${He(this.b)}`}function Re(){const t=De(this.opacity);return`${1===t?"rgb(":"rgba("}${Fe(this.r)}, ${Fe(this.g)}, ${Fe(this.b)}${1===t?")":`, ${t})`}`}function De(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Fe(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function He(t){return((t=Fe(t))<16?"0":"")+t.toString(16)}function Ze(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new We(t,e,n,r)}function $e(t){if(t instanceof We)return new We(t.h,t.s,t.l,t.opacity);if(t instanceof ye||(t=Ae(t)),!t)return new We;if(t instanceof We)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,o=Math.min(e,n,r),i=Math.max(e,n,r),a=NaN,s=i-o,l=(i+o)/2;return s?(a=e===i?(n-r)/s+6*(n<r):n===i?(r-e)/s+2:(e-n)/s+4,s/=l<.5?i+o:2-i-o,a*=60):s=l>0&&l<1?0:a,new We(a,s,l,t.opacity)}function We(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Ye(t){return(t=(t||0)%360)<0?t+360:t}function Ge(t){return Math.max(0,Math.min(1,t||0))}function Xe(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function qe(t,e,n,r,o){var i=t*t,a=i*t;return((1-3*t+3*i-a)*e+(4-6*i+3*a)*n+(1+3*t+3*i-3*a)*r+a*o)/6}ve(ye,Ae,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Oe,formatHex:Oe,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return $e(this).formatHsl()},formatRgb:Te,toString:Te}),ve(Ve,Be,me(ye,{brighter(t){return t=null==t?_e:Math.pow(_e,t),new Ve(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?ge:Math.pow(ge,t),new Ve(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ve(Fe(this.r),Fe(this.g),Fe(this.b),De(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ze,formatHex:ze,formatHex8:function(){return`#${He(this.r)}${He(this.g)}${He(this.b)}${He(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Re,toString:Re})),ve(We,(function(t,e,n,r){return 1===arguments.length?$e(t):new We(t,e,n,null==r?1:r)}),me(ye,{brighter(t){return t=null==t?_e:Math.pow(_e,t),new We(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?ge:Math.pow(ge,t),new We(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,o=2*n-r;return new Ve(Xe(t>=240?t-240:t+120,o,r),Xe(t,o,r),Xe(t<120?t+240:t-120,o,r),this.opacity)},clamp(){return new We(Ye(this.h),Ge(this.s),Ge(this.l),De(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=De(this.opacity);return`${1===t?"hsl(":"hsla("}${Ye(this.h)}, ${100*Ge(this.s)}%, ${100*Ge(this.l)}%${1===t?")":`, ${t})`}`}}));const Ue=t=>()=>t;function Ke(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):Ue(isNaN(t)?e:t)}const Qe=function t(e){var n=function(t){return 1==(t=+t)?Ke:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Ue(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=Be(t)).r,(e=Be(e)).r),o=n(t.g,e.g),i=n(t.b,e.b),a=Ke(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=o(e),t.b=i(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function Je(t){return function(e){var n,r,o=e.length,i=new Array(o),a=new Array(o),s=new Array(o);for(n=0;n<o;++n)r=Be(e[n]),i[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return i=t(i),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=i(t),r.g=a(t),r.b=s(t),r+""}}}Je((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),o=t[r],i=t[r+1],a=r>0?t[r-1]:2*o-i,s=r<e-1?t[r+2]:2*i-o;return qe((n-r/e)*e,a,o,i,s)}})),Je((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),o=t[(r+e-1)%e],i=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return qe((n-r/e)*e,o,i,a,s)}}));var tn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,en=new RegExp(tn.source,"g");function nn(t,e){var n,r,o,i=tn.lastIndex=en.lastIndex=0,a=-1,s=[],l=[];for(t+="",e+="";(n=tn.exec(t))&&(r=en.exec(e));)(o=r.index)>i&&(o=e.slice(i,o),s[a]?s[a]+=o:s[++a]=o),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,l.push({i:a,x:oe(n,r)})),i=en.lastIndex;return i<e.length&&(o=e.slice(i),s[a]?s[a]+=o:s[++a]=o),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)s[(n=l[r]).i]=n.x(t);return s.join("")})}function rn(t,e){var n;return("number"==typeof e?oe:e instanceof Ae?Qe:(n=Ae(e))?(e=n,Qe):nn)(t,e)}function on(t){return function(){this.removeAttribute(t)}}function an(t){return function(){this.removeAttributeNS(t.space,t.local)}}function sn(t,e,n){var r,o,i=n+"";return function(){var a=this.getAttribute(t);return a===i?null:a===r?o:o=e(r=a,n)}}function ln(t,e,n){var r,o,i=n+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===i?null:a===r?o:o=e(r=a,n)}}function cn(t,e,n){var r,o,i;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttribute(t))===(s=l+"")?null:a===r&&s===o?i:(o=s,i=e(r=a,l));this.removeAttribute(t)}}function dn(t,e,n){var r,o,i;return function(){var a,s,l=n(this);if(null!=l)return(a=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:a===r&&s===o?i:(o=s,i=e(r=a,l));this.removeAttributeNS(t.space,t.local)}}function un(t,e){var n,r;function o(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,o)),n}return o._value=e,o}function hn(t,e){var n,r;function o(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,o)),n}return o._value=e,o}function pn(t,e){return function(){te(this,t).delay=+e.apply(this,arguments)}}function fn(t,e){return e=+e,function(){te(this,t).delay=e}}function vn(t,e){return function(){ee(this,t).duration=+e.apply(this,arguments)}}function mn(t,e){return e=+e,function(){ee(this,t).duration=e}}var yn=kt.prototype.constructor;function gn(t){return function(){this.style.removeProperty(t)}}var _n=0;function bn(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function wn(){return++_n}var Cn=kt.prototype;bn.prototype=function(t){return kt().transition(t)}.prototype={constructor:bn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=m(t));for(var r=this._groups,o=r.length,i=new Array(o),a=0;a<o;++a)for(var s,l,c=r[a],d=c.length,u=i[a]=new Array(d),h=0;h<d;++h)(s=c[h])&&(l=t.call(s,s.__data__,h,c))&&("__data__"in s&&(l.__data__=s.__data__),u[h]=l,Jt(u[h],e,n,h,u,ne(s,n)));return new bn(i,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=g(t));for(var r=this._groups,o=r.length,i=[],a=[],s=0;s<o;++s)for(var l,c=r[s],d=c.length,u=0;u<d;++u)if(l=c[u]){for(var h,p=t.call(l,l.__data__,u,c),f=ne(l,n),v=0,m=p.length;v<m;++v)(h=p[v])&&Jt(h,e,n,v,p,f);i.push(p),a.push(l)}return new bn(i,a,e,n)},selectChild:Cn.selectChild,selectChildren:Cn.selectChildren,filter:function(t){"function"!=typeof t&&(t=_(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var i,a=e[o],s=a.length,l=r[o]=[],c=0;c<s;++c)(i=a[c])&&t.call(i,i.__data__,c,a)&&l.push(i);return new bn(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,o=n.length,i=Math.min(r,o),a=new Array(r),s=0;s<i;++s)for(var l,c=e[s],d=n[s],u=c.length,h=a[s]=new Array(u),p=0;p<u;++p)(l=c[p]||d[p])&&(h[p]=l);for(;s<r;++s)a[s]=e[s];return new bn(a,this._parents,this._name,this._id)},selection:function(){return new yn(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=wn(),r=this._groups,o=r.length,i=0;i<o;++i)for(var a,s=r[i],l=s.length,c=0;c<l;++c)if(a=s[c]){var d=ne(a,e);Jt(a,t,n,c,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new bn(r,this._parents,t,n)},call:Cn.call,nodes:Cn.nodes,node:Cn.node,size:Cn.size,empty:Cn.empty,each:Cn.each,on:function(t,e){var n=this._id;return arguments.length<2?ne(this.node(),n).on.on(t):this.each(function(t,e,n){var r,o,i=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?te:ee;return function(){var a=i(this,t),s=a.on;s!==r&&(o=(r=s).copy()).on(e,n),a.on=o}}(n,t,e))},attr:function(t,e){var n=P(t),r="transform"===n?ue:rn;return this.attrTween(t,"function"==typeof e?(n.local?dn:cn)(n,r,fe(this,"attr."+t,e)):null==e?(n.local?an:on)(n):(n.local?ln:sn)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=P(t);return this.tween(n,(r.local?un:hn)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?de:rn;return null==e?this.styleTween(t,function(t,e){var n,r,o;return function(){var i=W(this,t),a=(this.style.removeProperty(t),W(this,t));return i===a?null:i===n&&a===r?o:o=e(n=i,r=a)}}(t,r)).on("end.style."+t,gn(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,o,i;return function(){var a=W(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=W(this,t)),a===l?null:a===r&&l===o?i:(o=l,i=e(r=a,s))}}(t,r,fe(this,"style."+t,e))).each(function(t,e){var n,r,o,i,a="style."+e,s="end."+a;return function(){var l=ee(this,t),c=l.on,d=null==l.value[a]?i||(i=gn(e)):void 0;c===n&&o===d||(r=(n=c).copy()).on(s,o=d),l.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,o,i=n+"";return function(){var a=W(this,t);return a===i?null:a===r?o:o=e(r=a,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,o;function i(){var i=e.apply(this,arguments);return i!==o&&(r=(o=i)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,i,n)),r}return i._value=e,i}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(fe(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,o=ne(this.node(),n).tween,i=0,a=o.length;i<a;++i)if((r=o[i]).name===t)return r.value;return null}return this.each((null==e?he:pe)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?pn:fn)(e,t)):ne(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?vn:mn)(e,t)):ne(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){ee(this,t).ease=e}}(e,t)):ne(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;ee(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,o=n.size();return new Promise((function(i,a){var s={value:a},l={value:function(){0==--o&&i()}};n.each((function(){var n=ee(this,r),o=n.on;o!==t&&((e=(t=o).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e})),0===o&&i()}))},[Symbol.iterator]:Cn[Symbol.iterator]};var xn={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function En(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}kt.prototype.interrupt=function(t){return this.each((function(){re(this,t)}))},kt.prototype.transition=function(t){var e,n;t instanceof bn?(e=t._id,t=t._name):(e=wn(),(n=xn).time=Zt(),t=null==t?null:t+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var a,s=r[i],l=s.length,c=0;c<l;++c)(a=s[c])&&Jt(a,t,e,c,s,n||En(a,e));return new bn(r,this._parents,t,e)};const{abs:Mn,max:kn,min:Sn}=Math;function In(t){return{type:t}}function Nn(t){return"string"==typeof t?new Et([[document.querySelector(t)]],[document.documentElement]):new Et([[t]],xt)}function Ln(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var o=e.getBoundingClientRect();return[t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop]}}return[t.pageX,t.pageY]}["w","e"].map(In),["n","s"].map(In),["n","w","e","s","nw","ne","sw","se"].map(In);const On={passive:!1},Tn={capture:!0,passive:!1};function An(t){t.stopImmediatePropagation()}function Pn(t){t.preventDefault(),t.stopImmediatePropagation()}function jn(t){var e=t.document.documentElement,n=Nn(t).on("dragstart.drag",Pn,Tn);"onselectstart"in e?n.on("selectstart.drag",Pn,Tn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Bn(t,e){var n=t.document.documentElement,r=Nn(t).on("dragstart.drag",null);e&&(r.on("click.drag",Pn,Tn),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Vn=t=>()=>t;function zn(t,{sourceEvent:e,subject:n,target:r,identifier:o,active:i,x:a,y:s,dx:l,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}function Rn(t){return!t.ctrlKey&&!t.button}function Dn(){return this.parentNode}function Fn(t,e){return null==e?{x:t.x,y:t.y}:e}function Hn(){return navigator.maxTouchPoints||"ontouchstart"in this}function Zn(){var t,e,n,r,o=Rn,i=Dn,a=Fn,s=Hn,l={},c=Tt("start","drag","end"),d=0,u=0;function h(t){t.on("mousedown.drag",p).filter(s).on("touchstart.drag",m).on("touchmove.drag",y,On).on("touchend.drag touchcancel.drag",g).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(a,s){if(!r&&o.call(this,a,s)){var l=_(this,i.call(this,a,s),a,s,"mouse");l&&(Nn(a.view).on("mousemove.drag",f,Tn).on("mouseup.drag",v,Tn),jn(a.view),An(a),n=!1,t=a.clientX,e=a.clientY,l("start",a))}}function f(r){if(Pn(r),!n){var o=r.clientX-t,i=r.clientY-e;n=o*o+i*i>u}l.mouse("drag",r)}function v(t){Nn(t.view).on("mousemove.drag mouseup.drag",null),Bn(t.view,n),Pn(t),l.mouse("end",t)}function m(t,e){if(o.call(this,t,e)){var n,r,a=t.changedTouches,s=i.call(this,t,e),l=a.length;for(n=0;n<l;++n)(r=_(this,s,t,e,a[n].identifier,a[n]))&&(An(t),r("start",t,a[n]))}}function y(t){var e,n,r=t.changedTouches,o=r.length;for(e=0;e<o;++e)(n=l[r[e].identifier])&&(Pn(t),n("drag",t,r[e]))}function g(t){var e,n,o=t.changedTouches,i=o.length;for(r&&clearTimeout(r),r=setTimeout((function(){r=null}),500),e=0;e<i;++e)(n=l[o[e].identifier])&&(An(t),n("end",t,o[e]))}function _(t,e,n,r,o,i){var s,u,p,f=c.copy(),v=Ln(i||n,e);if(null!=(p=a.call(t,new zn("beforestart",{sourceEvent:n,target:h,identifier:o,active:d,x:v[0],y:v[1],dx:0,dy:0,dispatch:f}),r)))return s=p.x-v[0]||0,u=p.y-v[1]||0,function n(i,a,c){var m,y=v;switch(i){case"start":l[o]=n,m=d++;break;case"end":delete l[o],--d;case"drag":v=Ln(c||a,e),m=d}f.call(i,t,new zn(i,{sourceEvent:a,subject:p,target:h,identifier:o,active:m,x:v[0]+s,y:v[1]+u,dx:v[0]-y[0],dy:v[1]-y[1],dispatch:f}),r)}}return h.filter=function(t){return arguments.length?(o="function"==typeof t?t:Vn(!!t),h):o},h.container=function(t){return arguments.length?(i="function"==typeof t?t:Vn(t),h):i},h.subject=function(t){return arguments.length?(a="function"==typeof t?t:Vn(t),h):a},h.touchable=function(t){return arguments.length?(s="function"==typeof t?t:Vn(!!t),h):s},h.on=function(){var t=c.on.apply(c,arguments);return t===c?h:t},h.clickDistance=function(t){return arguments.length?(u=(t=+t)*t,h):Math.sqrt(u)},h}zn.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var $n=Math.sqrt(50),Wn=Math.sqrt(10),Yn=Math.sqrt(2);function Gn(t,e,n){var r=(e-t)/Math.max(0,n),o=Math.floor(Math.log(r)/Math.LN10),i=r/Math.pow(10,o);return o>=0?(i>=$n?10:i>=Wn?5:i>=Yn?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(i>=$n?10:i>=Wn?5:i>=Yn?2:1)}function Xn(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function qn(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Un(t){let e,n,r;function o(t,r,o=0,i=t.length){if(o<i){if(0!==e(r,r))return i;do{const e=o+i>>>1;n(t[e],r)<0?o=e+1:i=e}while(o<i)}return o}return 2!==t.length?(e=Xn,n=(e,n)=>Xn(t(e),n),r=(e,n)=>t(e)-n):(e=t===Xn||t===qn?t:Kn,n=t,r=t),{left:o,center:function(t,e,n=0,i=t.length){const a=o(t,e,n,i-1);return a>n&&r(t[a-1],e)>-r(t[a],e)?a-1:a},right:function(t,r,o=0,i=t.length){if(o<i){if(0!==e(r,r))return i;do{const e=o+i>>>1;n(t[e],r)<=0?o=e+1:i=e}while(o<i)}return o}}}function Kn(){return 0}const Qn=Un(Xn),Jn=Qn.right,tr=(Qn.left,Un((function(t){return null===t?NaN:+t})).center,Jn);function er(t,e){var n,r=e?e.length:0,o=t?Math.min(r,t.length):0,i=new Array(o),a=new Array(r);for(n=0;n<o;++n)i[n]=ir(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<o;++n)a[n]=i[n](t);return a}}function nr(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function rr(t,e){var n,r={},o={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=ir(t[n],e[n]):o[n]=e[n];return function(t){for(n in r)o[n]=r[n](t);return o}}function or(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,o=e.slice();return function(i){for(n=0;n<r;++n)o[n]=t[n]*(1-i)+e[n]*i;return o}}function ir(t,e){var n,r,o=typeof e;return null==e||"boolean"===o?Ue(e):("number"===o?oe:"string"===o?(n=Ae(e))?(e=n,Qe):nn:e instanceof Ae?Qe:e instanceof Date?nr:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?er:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?rr:oe:or))(t,e)}function ar(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function sr(t){return+t}var lr=[0,1];function cr(t){return t}function dr(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function ur(t,e,n){var r=t[0],o=t[1],i=e[0],a=e[1];return o<r?(r=dr(o,r),i=n(a,i)):(r=dr(r,o),i=n(i,a)),function(t){return i(r(t))}}function hr(t,e,n){var r=Math.min(t.length,e.length)-1,o=new Array(r),i=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)o[a]=dr(t[a],t[a+1]),i[a]=n(e[a],e[a+1]);return function(e){var n=tr(t,e,1,r)-1;return i[n](o[n](e))}}function pr(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}var fr,vr=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function mr(t){if(!(e=vr.exec(t)))throw new Error("invalid format: "+t);var e;return new yr({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function yr(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function gr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function _r(t){return(t=gr(Math.abs(t)))?t[1]:NaN}function br(t,e){var n=gr(t,e);if(!n)return t+"";var r=n[0],o=n[1];return o<0?"0."+new Array(-o).join("0")+r:r.length>o+1?r.slice(0,o+1)+"."+r.slice(o+1):r+new Array(o-r.length+2).join("0")}mr.prototype=yr.prototype,yr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const wr={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>br(100*t,e),r:br,s:function(t,e){var n=gr(t,e);if(!n)return t+"";var r=n[0],o=n[1],i=o-(fr=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,a=r.length;return i===a?r:i>a?r+new Array(i-a+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+gr(t,Math.max(0,e+i-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Cr(t){return t}var xr,Er,Mr,kr=Array.prototype.map,Sr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Ir(){var t=function(){var t,e,n,r,o,i,a=lr,s=lr,l=ir,c=cr;function d(){var t,e,n,l=Math.min(a.length,s.length);return c!==cr&&(t=a[0],e=a[l-1],t>e&&(n=t,t=e,e=n),c=function(n){return Math.max(t,Math.min(e,n))}),r=l>2?hr:ur,o=i=null,u}function u(e){return null==e||isNaN(e=+e)?n:(o||(o=r(a.map(t),s,l)))(t(c(e)))}return u.invert=function(n){return c(e((i||(i=r(s,a.map(t),oe)))(n)))},u.domain=function(t){return arguments.length?(a=Array.from(t,sr),d()):a.slice()},u.range=function(t){return arguments.length?(s=Array.from(t),d()):s.slice()},u.rangeRound=function(t){return s=Array.from(t),l=ar,d()},u.clamp=function(t){return arguments.length?(c=!!t||cr,d()):c!==cr},u.interpolate=function(t){return arguments.length?(l=t,d()):l},u.unknown=function(t){return arguments.length?(n=t,u):n},function(n,r){return t=n,e=r,d()}}()(cr,cr);return t.copy=function(){return function(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}(t,Ir())},pr.apply(t,arguments),function(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){var r,o,i,a,s=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(o=t,t=e,e=o),0===(a=Gn(t,e,n))||!isFinite(a))return[];if(a>0){let n=Math.round(t/a),r=Math.round(e/a);for(n*a<t&&++n,r*a>e&&--r,i=new Array(o=r-n+1);++s<o;)i[s]=(n+s)*a}else{a=-a;let n=Math.round(t*a),r=Math.round(e*a);for(n/a<t&&++n,r/a>e&&--r,i=new Array(o=r-n+1);++s<o;)i[s]=(n+s)/a}return r&&i.reverse(),i}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return function(t,e,n,r){var o,i=function(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),o=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),i=r/o;return i>=$n?o*=10:i>=Wn?o*=5:i>=Yn&&(o*=2),e<t?-o:o}(t,e,n);switch((r=mr(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(o=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(_r(e)/3)))-_r(Math.abs(t)))}(i,a))||(r.precision=o),Mr(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(o=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,_r(e)-_r(t))+1}(i,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=o-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(o=function(t){return Math.max(0,-_r(Math.abs(t)))}(i))||(r.precision=o-2*("%"===r.type))}return Er(r)}(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,o,i=e(),a=0,s=i.length-1,l=i[a],c=i[s],d=10;for(c<l&&(o=l,l=c,c=o,o=a,a=s,s=o);d-- >0;){if((o=Gn(l,c,n))===r)return i[a]=l,i[s]=c,e(i);if(o>0)l=Math.floor(l/o)*o,c=Math.ceil(c/o)*o;else{if(!(o<0))break;l=Math.ceil(l*o)/o,c=Math.floor(c*o)/o}r=o}return t},t}(t)}function Nr(t){return Nn(pt(t).call(document.documentElement))}xr=function(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Cr:(e=kr.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var o=t.length,i=[],a=0,s=e[0],l=0;o>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),i.push(t.substring(o-=s,o+s)),!((l+=s+1)>r));)s=e[a=(a+1)%e.length];return i.reverse().join(n)}),o=void 0===t.currency?"":t.currency[0]+"",i=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Cr:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(kr.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"−":t.minus+"",d=void 0===t.nan?"NaN":t.nan+"";function u(t){var e=(t=mr(t)).fill,n=t.align,u=t.sign,h=t.symbol,p=t.zero,f=t.width,v=t.comma,m=t.precision,y=t.trim,g=t.type;"n"===g?(v=!0,g="g"):wr[g]||(void 0===m&&(m=12),y=!0,g="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var _="$"===h?o:"#"===h&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",b="$"===h?i:/[%p]/.test(g)?l:"",w=wr[g],C=/[defgprs%]/.test(g);function x(t){var o,i,l,h=_,x=b;if("c"===g)x=w(t)+x,t="";else{var E=(t=+t)<0||1/t<0;if(t=isNaN(t)?d:w(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,r=1,o=-1;r<n;++r)switch(t[r]){case".":o=e=r;break;case"0":0===o&&(o=r),e=r;break;default:if(!+t[r])break t;o>0&&(o=0)}return o>0?t.slice(0,o)+t.slice(e+1):t}(t)),E&&0==+t&&"+"!==u&&(E=!1),h=(E?"("===u?u:c:"-"===u||"("===u?"":u)+h,x=("s"===g?Sr[8+fr/3]:"")+x+(E&&"("===u?")":""),C)for(o=-1,i=t.length;++o<i;)if(48>(l=t.charCodeAt(o))||l>57){x=(46===l?a+t.slice(o+1):t.slice(o))+x,t=t.slice(0,o);break}}v&&!p&&(t=r(t,1/0));var M=h.length+t.length+x.length,k=M<f?new Array(f-M+1).join(e):"";switch(v&&p&&(t=r(k+t,k.length?f-x.length:1/0),k=""),n){case"<":t=h+t+x+k;break;case"=":t=h+k+t+x;break;case"^":t=k.slice(0,M=k.length>>1)+h+t+x+k.slice(M);break;default:t=k+h+t+x}return s(t)}return m=void 0===m?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),x.toString=function(){return t+""},x}return{format:u,formatPrefix:function(t,e){var n=u(((t=mr(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(_r(e)/3))),o=Math.pow(10,-r),i=Sr[8+r/3];return function(t){return n(o*t)+i}}}}({thousands:",",grouping:[3],currency:["$",""]}),Er=xr.format,Mr=xr.formatPrefix;const Lr=Math.PI,Or=2*Lr,Tr=1e-6,Ar=Or-Tr;function Pr(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function jr(){return new Pr}Pr.prototype=jr.prototype={constructor:Pr,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,o,i){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+o)+","+(this._y1=+i)},arcTo:function(t,e,n,r,o){t=+t,e=+e,n=+n,r=+r,o=+o;var i=this._x1,a=this._y1,s=n-t,l=r-e,c=i-t,d=a-e,u=c*c+d*d;if(o<0)throw new Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(u>Tr)if(Math.abs(d*s-l*c)>Tr&&o){var h=n-i,p=r-a,f=s*s+l*l,v=h*h+p*p,m=Math.sqrt(f),y=Math.sqrt(u),g=o*Math.tan((Lr-Math.acos((f+u-v)/(2*m*y)))/2),_=g/y,b=g/m;Math.abs(_-1)>Tr&&(this._+="L"+(t+_*c)+","+(e+_*d)),this._+="A"+o+","+o+",0,0,"+ +(d*h>c*p)+","+(this._x1=t+b*s)+","+(this._y1=e+b*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,n,r,o,i){t=+t,e=+e,i=!!i;var a=(n=+n)*Math.cos(r),s=n*Math.sin(r),l=t+a,c=e+s,d=1^i,u=i?r-o:o-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+c:(Math.abs(this._x1-l)>Tr||Math.abs(this._y1-c)>Tr)&&(this._+="L"+l+","+c),n&&(u<0&&(u=u%Or+Or),u>Ar?this._+="A"+n+","+n+",0,1,"+d+","+(t-a)+","+(e-s)+"A"+n+","+n+",0,1,"+d+","+(this._x1=l)+","+(this._y1=c):u>Tr&&(this._+="A"+n+","+n+",0,"+ +(u>=Lr)+","+d+","+(this._x1=t+n*Math.cos(o))+","+(this._y1=e+n*Math.sin(o))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};const Br=jr;var Vr=Array.prototype.slice;function zr(t){return function(){return t}}class Rr{constructor(t,e){this._context=t,this._x=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,e,t,e):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+e)/2,t,this._y0,t,e)}this._x0=t,this._y0=e}}function Dr(t){return t[0]}function Fr(t){return t[1]}function Hr(t){return t.source}function Zr(t){return t.target}function $r(t){return((t=Math.exp(t))+1/t)/2}const Wr=function t(e,n,r){function o(t,o){var i,a,s=t[0],l=t[1],c=t[2],d=o[0],u=o[1],h=o[2],p=d-s,f=u-l,v=p*p+f*f;if(v<1e-12)a=Math.log(h/c)/e,i=function(t){return[s+t*p,l+t*f,c*Math.exp(e*t*a)]};else{var m=Math.sqrt(v),y=(h*h-c*c+r*v)/(2*c*n*m),g=(h*h-c*c-r*v)/(2*h*n*m),_=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(g*g+1)-g);a=(b-_)/e,i=function(t){var r,o=t*a,i=$r(_),d=c/(n*m)*(i*(r=e*o+_,((r=Math.exp(2*r))-1)/(r+1))-function(t){return((t=Math.exp(t))-1/t)/2}(_));return[s+d*p,l+d*f,c*i/$r(e*o+_)]}}return i.duration=1e3*a*e/Math.SQRT2,i}return o.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},o}(Math.SQRT2,2,4),Yr=t=>()=>t;function Gr(t,{sourceEvent:e,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function Xr(t,e,n){this.k=t,this.x=e,this.y=n}Xr.prototype={constructor:Xr,scale:function(t){return 1===t?this:new Xr(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Xr(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var qr,Ur=new Xr(1,0,0);function Kr(t){t.stopImmediatePropagation()}function Qr(t){t.preventDefault(),t.stopImmediatePropagation()}function Jr(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function to(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function eo(){return this.__zoom||Ur}function no(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function ro(){return navigator.maxTouchPoints||"ontouchstart"in this}function oo(t,e,n){var r=t.invertX(e[0][0])-n[0][0],o=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),a>i?(i+a)/2:Math.min(0,i)||Math.max(0,a))}function io(t,e){var n=!1;"#"===t[0]&&(t=t.slice(1),n=!0);var r=parseInt(t,16),o=(r>>16)+e;o>255?o=255:o<0&&(o=0);var i=(r>>8&255)+e;i>255?i=255:i<0&&(i=0);var a=(255&r)+e;a>255?a=255:a<0&&(a=0);var s=a|i<<8|o<<16;return n?"#"+s.toString(16):s.toString(16)}Xr.prototype,function(t){t.ErrorMarker="error_marker"}(qr||(qr={}));var ao,so=function(t){var e=t.x,n=t.y,r=t.w,o=t.h,i=t.r,a=void 0===i?0:i,s=t.border,l={tl:!1,tr:!1,br:!1,bl:!1};a&&(s?(l.tl=s[0],l.tr=s[1],l.br=s[3],l.bl=s[2]):(l.tl=!0,l.tr=!0,l.br=!0,l.bl=!0));var c="M"+(e+a)+","+n+"h"+(r-2*a);return l.tr?c+="a"+a+","+a+" 0 0 1 "+a+","+a:(c+="h"+a,c+="v"+a),c+="v"+(o-2*a),l.br?c+="a"+a+","+a+" 0 0 1 "+-a+","+a:(c+="v"+a,c+="h"+-a),c+="h"+(2*a-r),l.bl?c+="a"+a+","+a+" 0 0 1 "+-a+","+-a:(c+="h"+-a,c+="v"+-a),c+="v"+(2*a-o),l.tl?c+="a"+a+","+a+" 0 0 1 "+a+","+-a:(c+="v"+-a,c+="h"+a),c+"z"},lo="clip-",co=o.render.strokeSize/2,uo=2*co,ho=function(t){var e=t.id,n=t.width,r=t.height,i=t.element,a=t.strokeColor,s=void 0===a?o.render.color.nodeStroke:a,l=t.r,c=void 0===l?o.render.node.borderRadius:l;po({id:e,width:n,height:r,element:i,strokeColor:s,r:c}),fo({id:e,width:n,height:r,element:i,r:c})},po=function(t){var e=t.id,n=t.width,r=t.height,i=t.element,a=t.strokeColor,s=t.r;i.append("path").attr("id","clip-border-"+e).attr("d",so({x:uo,y:uo,w:n-2*uo,h:r-2*uo,r:s-co})).attr("fill","none").attr("stroke-width",o.render.strokeSize).attr("stroke",a)},fo=function(t){var e=t.id,n=t.width,r=t.height,o=t.element,i=t.r;o.append("clipPath").attr("id",lo+e).append("path").attr("d",so({x:co,y:co,w:n-2*co,h:r-2*co,r:i})),o.attr("clip-path","url(#".concat(lo).concat(e,")"))},vo=function(t){return"#clip-border-"+t},mo=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var r=Nr("svg:g");return r.append("circle").attr("class","connector_circle").attr("r",o.render.node.control.connectorRadius-o.render.strokeSize).attr("fill",o.render.color.elementBackground).attr("stroke",n?o.render.color.disabledStroke:o.render.color.stroke).attr("stroke-width",o.render.strokeSize).attr("cx",o.render.node.control.connectorRadius).attr("cy",o.render.node.control.connectorRadius),r.append("use").style("color",o.render.tool.textColor).attr("x",2).attr("y",2).attr("href","#".concat(t)).style("opacity",n?.4:1),e&&r.on("mouseover",(function(){Nn(this).select(".connector_circle").attr("fill",o.render.color.elementBackgroundHover2)})).on("mouseout",(function(){Nn(this).select(".connector_circle").attr("fill",o.render.color.elementBackground)})),r},yo=function(t){let e=Hr,n=Zr,r=Dr,o=Fr,i=null,a=null;function s(){let s;const l=Vr.call(arguments),c=e.apply(this,l),d=n.apply(this,l);if(null==i&&(a=t(s=Br())),a.lineStart(),l[0]=c,a.point(+r.apply(this,l),+o.apply(this,l)),l[0]=d,a.point(+r.apply(this,l),+o.apply(this,l)),a.lineEnd(),s)return a=null,s+""||null}return s.source=function(t){return arguments.length?(e=t,s):e},s.target=function(t){return arguments.length?(n=t,s):n},s.x=function(t){return arguments.length?(r="function"==typeof t?t:zr(+t),s):r},s.y=function(t){return arguments.length?(o="function"==typeof t?t:zr(+t),s):o},s.context=function(e){return arguments.length?(null==e?i=a=null:a=t(i=e),s):i},s}((function(t){return new Rr(t,!0)})).x((function(t){return t[0]})).y((function(t){return t[1]})),go=function(t){var e=t.text,n=t.posX,r=t.posY,i=t.width,a=t.height,s=void 0===a?16:a,l=t.fontSize,c=void 0===l?12:l,d=t.fontWeight,u=void 0===d?500:d,h=t.color,p=void 0===h?o.render.color.text:h,f=Nr("svg:foreignObject");return f.attr("x",n).attr("y",r).attr("width",i).attr("height",s).append("xhtml:div").style("font-weight",u).style("font-size",c).style("color",p).style("overflow","hidden").style("white-space","nowrap").style("text-overflow","ellipsis").html(e),f.node()};!function(t){t.Order="node_order",t.PreviewPlaceholder="preview_placeholder",t.PreviewClipPath="preview_clip_path",t.Connector="node_connector",t.ConnectorDisabled="node_connector_disabled",t.LinearGradient="linear_gradient"}(ao||(ao={}));var _o=function(t){var e,n=this;this._defsDOMElement=t,this.dispose=function(){n._defsDOMElement.selectAll("*").remove()},u(t),t.selectAll("marker").data(f).join("marker").attr("id",(function(t){return t.name})).attr("stroke",(function(t){return t.stroke})).attr("stroke-width",(function(t){return t.strokeWidth})).attr("markerHeight",(function(t){return t.size})).attr("markerWidth",(function(t){return t.size})).attr("markerUnits","strokeWidth").attr("orient","auto").attr("refX",0).attr("refY",0).attr("viewBox",(function(t){return t.viewBox})).append("path").attr("d",(function(t){return t.path})).attr("fill",(function(t){return t.fill})),(e=t).append((function(){return(t=Nr("svg:g").attr("id",ao.PreviewPlaceholder)).append("rect").attr("x",2).attr("y",0).attr("width",o.render.node.width-4).attr("height",o.render.node.componentPreviewHeight).attr("fill",o.render.node.previewPlaceholder.backgroundColor),t.append("path").attr("d",so({x:8,y:8,w:o.render.node.width-16,h:o.render.node.componentPreviewHeight-16,r:8})).attr("stroke-width",o.render.strokeSize).attr("stroke",o.render.node.previewPlaceholder.borderColor).style("stroke-dasharray","2, 4").attr("fill","none"),t.append("text").text(o.translation.node_video_error).attr("text-anchor","middle").attr("font-weight",600).attr("font-size",15).style("fill",o.render.node.previewPlaceholder.textColor).attr("x",o.render.node.width/2).attr("y",o.render.node.componentPreviewHeight/2+6).attr("text-rendering","optimizeSpeed"),t.node();var t})),e.append((function(){return Nr("svg:path").attr("id",ao.Connector).attr("d","M0,0 L1,1z").attr("fill","none").style("marker-start","url(#".concat(c.Circle,")")).node()})),e.append((function(){return Nr("svg:path").attr("id",ao.ConnectorDisabled).attr("d","M0,0 L1,1z").attr("fill","none").style("marker-start","url(#".concat(c.CircleDisabled,")")).node()})),e.append((function(){return(t=Nr("svg").attr("id",ao.Order)).append("circle").attr("r",o.render.node.componentOrderRadius).attr("fill","#FFFFFF").attr("cx",o.render.node.componentOrderRadius).attr("cy",o.render.node.componentOrderRadius),t.node();var t})),e.append((function(){return function(){var t=Ir().range([o.render.color.nodeStroke,"rgba(0, 0, 0, 0)"]).domain([1,2]),e=Nr("svg:linearGradient").attr("id",ao.LinearGradient);return e.append("stop").attr("offset","5%").attr("stop-color",t(1)),e.append("stop").attr("offset","70%").attr("stop-color",t(2)),e.node()}()})),e.append((function(){return(t=Nr("svg:clipPath").attr("id",ao.PreviewClipPath)).append("path").attr("d",so({x:2,y:o.render.node.headerHeight+1,w:o.render.node.width-4,h:o.render.node.componentPreviewHeight-1,r:8})),t.node();var t})),function(t){t.append((function(){return t=o.render.iconSize+8,(e=Nr("svg:g").attr("id",qr.ErrorMarker)).append("svg").attr("width",t).attr("height",t).attr("viewBox","0 0 ".concat(o.render.iconSize," ").concat(o.render.iconSize)).append("use").style("color",o.render.color.error).attr("href","#".concat(l.Warning)),e.append("rect").attr("fill","transparent").attr("width",t).attr("height",t),e.node();var t,e}))}(t)};function bo(t){return"number"==typeof t}function wo(t){var e={};return Object.keys(t).forEach((function(n){(function(t){return null!==t&&"object"==typeof t})(t[n])&&(e[n]=wo(t[n])),null!==t[n]&&(e[n]=t[n])})),e}var Co,xo=i(996),Eo=i.n(xo);!function(t){t[t.NoVideo=0]="NoVideo",t[t.NoEOV=1]="NoEOV",t[t.NoBranches=2]="NoBranches"}(Co||(Co={}));const Mo={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let ko;const So=new Uint8Array(16);function Io(){if(!ko&&(ko="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ko))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ko(So)}const No=[];for(let t=0;t<256;++t)No.push((t+256).toString(16).slice(1));const Lo=function(t,e,n){if(Mo.randomUUID&&!e&&!t)return Mo.randomUUID();const r=(t=t||{}).random||(t.rng||Io)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(let t=0;t<16;++t)e[n+t]=r[t];return e}return function(t,e=0){return(No[t[e+0]]+No[t[e+1]]+No[t[e+2]]+No[t[e+3]]+"-"+No[t[e+4]]+No[t[e+5]]+"-"+No[t[e+6]]+No[t[e+7]]+"-"+No[t[e+8]]+No[t[e+9]]+"-"+No[t[e+10]]+No[t[e+11]]+No[t[e+12]]+No[t[e+13]]+No[t[e+14]]+No[t[e+15]]).toLowerCase()}(r)};var Oo,To=function(){return To=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},To.apply(this,arguments)},Ao=["Button"],Po=["Button"],jo=Object.freeze({background:"#0D0F12",border:"#0D0F12",text:"#F2F5FF"}),Bo=function(t,e,n){switch(e){case"setNextBranch":return{type:t,action:{type:e,args:{branchId:n,shouldOpenNow:!0}}};case"continuePlayback":return{type:t,action:{type:e,args:{shouldOpenNow:!0}}}}},Vo=function(t){var e="Text"===t;return{x:.5,y:e?0:.3,width:.4,height:e?.12:.09,angle:0,innerSizesDependOn:"video"}},zo=function(t,e){var n="Text"===t,r=n?"start":"center",o=n?"top":"center";return To({background:{type:"color",color:jo.background,alpha:Ao.includes(t)?1:0},shape:{border:{width:.005,color:jo.border,alpha:Po.includes(t)?1:0},type:"rectangle",roundCorners:.02}},e&&{text:{value:e,gravityHorizontal:r,gravityVertical:o,color:jo.text,size:n?.1:.03,alpha:1}})},Ro=function(){return Ro=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Ro.apply(this,arguments)},Do=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n},Fo=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ho=function(){return Ho=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Ho.apply(this,arguments)},Zo=function(){return Zo=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Zo.apply(this,arguments)},$o=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Wo=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},Yo=function(t,e){return{type:"onSuspense",action:{type:t,args:{branchId:e,shouldOpenNow:!0}}}},Go=function(t,e){return e.map((function(e){return e.action.args.branchId&&t.includes(e.action.args.branchId)?Zo(Zo({},e),{action:Zo(Zo({},e.action),{args:Zo(Zo({},e.action.args),{branchId:void 0})})}):e}))},Xo=function(t,e){return e.length?Zo(Zo({},t),{branches:t.branches.filter((function(t){return!e.includes(t.id)})),containers:t.containers.map((function(t){return Zo(Zo({},t),{controls:t.controls.map((function(t){return Zo(Zo({},t),{events:Go(e,t.events)})})),events:Go(e,t.events)})})),events:Go(e,t.events)}):t},qo=function(t){return void 0===t&&(t=[]),{edit:{chapters:t},view:{}}},Uo=function(){return Uo=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Uo.apply(this,arguments)},Ko=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n},Qo=[{version:"3.0",migrate:function(t){var e,n,r,o,i,a,s,l,c=[];try{for(var d=Fo(t.chapters),u=d.next();!u.done;u=d.next()){var h=u.value,p=void 0,f=[];try{for(var v=(r=void 0,Fo(h.branches)),m=v.next();!m.done;m=v.next()){var y=m.value,g=y.isDefault,_=Do(y,["isDefault"]);g&&(p=_.id),f.push(_)}}catch(t){r={error:t}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(r)throw r.error}}var b=void 0,w=[];try{for(var C=(i=void 0,Fo(h.containers)),x=C.next();!x.done;x=C.next()){var E=x.value,M=E.fallbackStrategy,k=Do(E,["fallbackStrategy"]);switch(M){case"await":b=[];break;case"default":b=[{type:"onSuspense",action:{type:"setNextBranch",args:{branchId:p,shouldOpenNow:!0}}}];break;case"weightlessRandom":case"random":b=[{type:"onSuspense",action:{type:"setRandomBranch",args:{shouldOpenNow:!0}}}]}try{for(var S=(s=void 0,Fo(k.controls)),I=S.next();!I.done;I=S.next()){var N=I.value;w.push(Ro(Ro({},k),{controls:[Ro(Ro({},N),{events:"Text"===N.subtype||N.events.length?N.events:[Bo("onClick","continuePlayback")]})],id:Lo(),events:[{type:"onSuspense",action:{type:"continuePlayback",args:{shouldOpenNow:!0}}}]}))}}catch(t){s={error:t}}finally{try{I&&!I.done&&(l=S.return)&&l.call(S)}finally{if(s)throw s.error}}}}catch(t){i={error:t}}finally{try{x&&!x.done&&(a=C.return)&&a.call(C)}finally{if(i)throw i.error}}c.push(Ro(Ro({},h),{containers:w,events:b,branches:f}))}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(e)throw e.error}}return t.metadata.version="3.1",t.metadata.updated=(new Date).toISOString(),Ro(Ro({},t),{chapters:c})}},{version:"3.1",migrate:function(t){var e=t.metadata,n=e.media,r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(e,["media"]);if("string"==typeof n)throw new Error("Manifest media should be parsed");return{chapters:t.chapters,metadata:Ho(Ho({},r),{version:"3.2"}),media:n}}},{version:"3.2",migrate:function(t){var e,n,r=[],o=[],i=function(t){var e=t.x,n=t.y,i=Ko(t,["x","y"]),a=Array.isArray(t.events)&&!t.events.length,s=[],l=i.containers.map((function(t){var e;return Uo(Uo({},t),{events:(a?null===(e=t.events)||void 0===e?void 0:e.map((function(t){return"onSuspense"===t.type?(t.action.args.branchId&&s.push(t.action.args.branchId),Yo("expect")):t})):t.events)||[],controls:t.controls.map((function(t){var e=t.subtype,n=Ko(t,["subtype"]);return Uo(Uo({},n),{type:e,events:n.events||[Bo("onClick","continuePlayback")]})}))})}));r.push(Xo(Uo(Uo({},i),{containers:l,events:t.events||[]}),s)),o.push({id:i.id,x:e,y:n})};try{for(var a=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t.chapters),s=a.next();!s.done;s=a.next())i(s.value)}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return Uo(Uo({},t),{chapters:r,graph:qo(o),metadata:Uo(Uo({},t.metadata),{version:"3.3"})})}}],Jo=function(t,e){return null==e?void 0:e.find((function(e){return e.type===t}))};function ti(t,e){var n,r=((n={})[ei.Flip]=1,n[ei.Action]=2,n[ei.Inaction]=3,n);return r[t]<r[e]?-1:r[t]>r[e]?1:0}!function(t){t.Failed="ManifestParsingFailed",t.UnsupportedVersion="ManifestUnsupportedVersion"}(Oo||(Oo={}));var ei,ni={edit:{background:{color:"#0D0F12",grid:{enabled:!0,color:"#474747"}},defaultChapter:{flipTo:{enabled:!0,backgroundColor:"#232324",textColor:"#FFFFFF"},controls:{enabled:!0,backgroundColor:"#232324",textColor:"#FFFFFF"},hover:{enabled:!0,borderColor:"#7B68EE"}},chapters:[]},view:{background:{color:"#0D0F12",grid:{enabled:!1,color:"#474747"}},defaultChapter:{header:{enabled:!0,backgroundColor:"#232324",textColor:"#FFFFFF"},flipTo:{enabled:!1,backgroundColor:"#232324",textColor:"#FFFFFF"},controls:{enabled:!1,backgroundColor:"#232324",textColor:"#FFFFFF"},hover:{enabled:!0,borderColor:"#2688EB"},watchAgain:{enabled:!0,backgroundColor:"#2688EB",textColor:"#FFFFFF"},preview:{visible:!1,backgroundColor:"#19191A",textColor:"#5D5F61"},goBlind:!1}}},ri=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};!function(t){t.Flip="flip",t.Action="action",t.Inaction="inaction"}(ei||(ei={}));var oi=function(){function t(t,e,n,r,o){var i=this;this._parentNode=r,this._targetedNode=o,this.updateSourceAbsolutePosition=function(t){var e=ri(t,2),n=e[0],r=e[1];return i.source.position.absolute=[n+i.source.position.relative[0],r+i.source.position.relative[1]],i},this.updateTargetAbsolutePosition=function(t){var e=ri(t,2),n=e[0],r=e[1];return i.target.position.absolute=[n+i.target.position.relative[0],r+i.target.position.relative[1]],i},this.isAssociatedNodeLocked=function(){return!(pi.visitedNodes.has(i.source.chapterId)&&pi.visitedNodes.has(i.target.chapterId))},this.updateInitialTargetCoordinates=function(){var t=i._targetedNode.getIncomingConnectorsCoordinates()[i.connectorType];return t&&(i.target.position.absolute[1]=i._targetedNode.styles.y+t[1],i.target.position.relative[1]=t[1]),i},this.id=t.id,this.type=e,this.connectorType=n,this.isHidden=this._parentNode.isEndNode();var a=this._parentNode.render.previewMiddleYCoordinate,s=this._targetedNode.render.previewMiddleYCoordinate;this.source={chapterId:this._parentNode.chapter.id,position:{absolute:[this._parentNode.styles.x+this._parentNode.render.width,this._parentNode.styles.y+a],relative:[this._parentNode.render.width,a]}},this.target={chapterId:t.chapterId,position:{absolute:[this._targetedNode.styles.x,this._targetedNode.styles.y+s],relative:[0,s]}},this.updateSourceCoordinates(t)}return t.prototype.updateSourceCoordinates=function(t){var e,n,r,i;switch(this.type){case ei.Flip:if(o.isEditMode()||o.isViewOrPreViewMode()&&(null===(e=this._parentNode.stylesWithDefaults.flipTo)||void 0===e?void 0:e.enabled)){var a=ri((i=(r=this._parentNode).render.flipToYCoordinate,[r.styles.x+r.render.width+44,r.styles.y+i+o.render.node.componentControlHeight/2]),2),s=a[0],l=a[1];this.source.position.absolute=[s,l],this.source.position.relative=[s-this._parentNode.styles.x,l-this._parentNode.styles.y]}break;case ei.Action:case ei.Inaction:if(o.isEditMode()||o.isViewOrPreViewMode()&&(null===(n=this._parentNode.stylesWithDefaults.controls)||void 0===n?void 0:n.enabled)){var c=ri(function(t,e){var n=t.controls().findIndex((function(t){var n;return null===(n=t.events)||void 0===n?void 0:n.some((function(t){return t.action.args.branchId===e}))})),r=-1===n;r&&(n=t.containers().reverse().findIndex((function(t){var n;return null===(n=t.events)||void 0===n?void 0:n.some((function(t){return t.action.args.branchId===e}))})));var i=t.render.controlsContainerYCoordinate;return[t.styles.x+t.render.width,t.styles.y+i+o.render.node.componentControlHeight*n+(r?o.render.node.control.inactionLinkY:o.render.node.control.actionLinkY)]}(this._parentNode,t.id),2);s=c[0],l=c[1],this.source.position.absolute=[s,l],this.source.position.relative=[s-this._parentNode.styles.x,l-this._parentNode.styles.y]}}},t}(),ii=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ai=function(){function t(t,e){var n,r=this;this.branches=[],this.saveViewChapterDesign=!1,this.parentChaptersConnections=[],this.chapterErrors=[],this.isDragged=!1,this.getContainerControls=function(t){var e;return(null===(e=r.chapter.containers.find((function(e){return e.id===t})))||void 0===e?void 0:e.controls.filter((function(t){return"Text"!==t.type})))||[]},this.controls=function(){return r.chapter.containers.flatMap((function(t){return t.controls})).reverse().filter((function(t){return"Text"!==t.type}))},this.containers=function(){return r.chapter.containers.filter((function(t){return t.controls.some((function(t){return"Text"!==t.type}))}))},this.hasParentChapters=function(t){return t?r.parentChaptersConnections.some((function(e){return e.type===t})):!!r.parentChaptersConnections.length},this.getParentChaptersByType=function(t){return r.parentChaptersConnections.filter((function(e){return e.type===t}))},this.hasBranches=function(t){return t?r.branches.some((function(e){return e.type===t})):!!r.branches.length},this.isConnected=function(){return r.hasParentChapters()||r.hasBranches()||"start"===r.chapter.order},this.isEndNode=function(){return"end"===r.chapter.order},this.hasErrors=function(){return!!r.chapterErrors.length},this.getPolygon=function(){return[[r.styles.x,r.styles.y],[r.styles.x+r.render.width,r.styles.y],[r.styles.x+r.render.width,r.styles.y+r.render.height],[r.styles.x,r.styles.y+r.render.height]]},this.getBBox=function(){return{minX:r.styles.x,minY:r.styles.y,maxX:r.styles.x+r.render.width,maxY:r.styles.y+r.render.height}},this.getCenter=function(){return[r.styles.x+r.render.width/2,r.styles.y+r.render.height/2]},this.validateNode=function(){r.chapterErrors=function(t){var e=[];if(t.videoId||e.push(Co.NoVideo),"end"!==t.order){var n=!t.events||t.events.some((function(t){return"onSuspense"===t.type&&"setNextBranch"===t.action.type&&!t.action.args.branchId}));n&&e.push(Co.NoEOV);var r=t.containers.flatMap((function(t){return t.controls}));(!r.length&&n||r.some((function(t){var e;return"Text"!==t.type&&!(null===(e=null==t?void 0:t.events)||void 0===e?void 0:e.length)})))&&e.push(Co.NoBranches)}return e}(r.chapter)},this.updatePosition=function(t,e){return r.styles.x=t,r.styles.y=e,o.isPreViewMode()&&(r.saveViewChapterDesign=!0),r},this.updateOrder=function(t){var e=r.chapter.order;return r.chapter.order=t,"start"===e&&pi.manifest.updateInitChapterId(),"end"===t&&(r.chapter.events=[]),r.render=r.getGraphNodeRender(),r},this.addControlToContainer=function(t){var e="".concat(r.getControlTypeLabelTranslation(t)," [").concat(r.controls().length+1,"]"),n=function(t,e,n){return{id:Lo(),type:t,label:e,layoutParams:Vo(t),props:zo(t,n),events:"Text"!==t?[Bo("onClick","continuePlayback")]:[]}}(t,e,"Text"===t?o.translation.new_text_content:e);return r.chapter=function(t,e){var n=t.containers.reduce((function(t,n){return t+n.controls.filter((function(t){return t.type===e.type})).length}),0)+1,r=n%2==0?.5:.05,o=e.layoutParams.y+.17*Math.round(n/2);return Zo(Zo({},t),{containers:Wo(Wo([],$o(t.containers),!1),[{id:Lo(),startTime:0,endTime:null,controls:[Zo(Zo({},e),{layoutParams:Zo(Zo({},e.layoutParams),{x:r,y:o})})],events:[{type:"onSuspense",action:{type:"continuePlayback",args:{shouldOpenNow:!0}}}],layout:{type:"Relative"},type:"Choice"}],!1)})}(r.chapter,n),r.render=r.getGraphNodeRender(),r},this.addBranch=function(t,e,n){var o=function(t){return{id:Lo(),chapterId:t}}(t);return r.chapter=function(t,e,n,r){var o;return Zo(Zo({},t),n?{containers:t.containers.map((function(t){return Zo(Zo({},t),{controls:t.controls.map((function(t){return t.id===n?Zo(Zo({},t),{events:[Bo("onClick","setNextBranch",e.id)]}):t}))})})),branches:Wo(Wo([],$o(t.branches),!1),[e],!1)}:r?{containers:t.containers.map((function(t){return t.id===r?Zo(Zo({},t),{events:[Yo("setNextBranch",e.id)]}):t})),branches:Wo(Wo([],$o(t.branches),!1),[e],!1)}:{branches:Wo(Wo([],$o(t.branches),!1),[e],!1),events:null===(o=t.events)||void 0===o?void 0:o.map((function(t){return"onSuspense"===t.type?Zo(Zo({},t),{action:Zo(Zo({},t.action),{args:{branchId:e.id,shouldOpenNow:!0}})}):t}))})}(r.chapter,o,e,n),r},this.deleteBranch=function(t){return r.chapter=Xo(r.chapter,[t]),r},this.updateChapterSuspenseAction=function(t){return r.chapter=function(t,e){var n,r=t.events||[],o=null===(n=t.events)||void 0===n?void 0:n.find((function(t){return"onSuspense"===t.type})),i=null==o?void 0:o.action.args.branchId;return e&&(r=o?r.map((function(t){return"onSuspense"===t.type?Zo(Zo({},t),{action:Zo(Zo({},t.action),{type:e,args:Zo(Zo({},t.action.args),{branchId:"setNextBranch"===e?t.action.args.branchId:void 0})})}):t})):Wo(Wo([],$o(r),!1),[{type:"onSuspense",action:{type:e,args:{shouldOpenNow:!0}}}],!1)),Zo(Zo({},t),{events:r,branches:"setNextBranch"!==e?t.branches.filter((function(t){return t.id!==i})):t.branches})}(r.chapter,t),r},this.getIncomingConnectorsCoordinates=function(){return r._incomingConnectorsCoordinates||(r._incomingConnectorsCoordinates=r.getConnectorCoordinatesForBranchTypes(r.getUniqueParentConnectionTypes())),r._incomingConnectorsCoordinates},this.getConnectorCoordinatesForBranchTypes=function(t){var e=t.sort(ti),n=(e.length-1)*o.render.node.connectorPositionDiff/2,r=o.render.node.connectorPositionY-n;return e.reduce((function(t,e,n){return t[e]=[0,r+o.render.node.connectorPositionDiff*n],t}),{})},this.id=t.id,this.chapter=t;var i=null===(n=e.view.chapters)||void 0===n?void 0:n.find((function(e){return e.id===t.id})),a=e.edit.chapters.find((function(e){return e.id===t.id}));o.isEditMode()?(this.styles=wo(a),this._stylesWithDefaults=Eo()(e.edit.defaultChapter,this.styles)):(this.styles=wo(i||a),this._stylesWithDefaults=Eo()(e.view.defaultChapter,this.styles)),this.saveViewChapterDesign=o.isPreViewMode()&&!!i,this.render=this.getGraphNodeRender()}return Object.defineProperty(t.prototype,"stylesWithDefaults",{get:function(){return this._stylesWithDefaults},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLocked",{get:function(){return!!o.isViewOrPreViewMode()&&"start"!==this.chapter.order&&!pi.visitedNodes.has(this.id)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayLockedContent",{get:function(){return!o.isViewOrPreViewMode()||"start"===this.chapter.order||!!this.stylesWithDefaults.preview.visible||!this.isLocked},enumerable:!1,configurable:!0}),t.prototype.getSuspenseActionType=function(){return function(t){if(t.events){var e=t.events.find((function(t){return"onSuspense"===t.type}));return null==e?void 0:e.action.type}}(this.chapter)},t.prototype.getSuspenseBranchId=function(){var t,e;return null===(e=null===(t=this.chapter.events)||void 0===t?void 0:t.find((function(t){return"onSuspense"===t.type})))||void 0===e?void 0:e.action.args.branchId},t.prototype.getContainerBranchIds=function(){var t,e,n,r,o=[];try{for(var i=ii(this.containers().reverse()),a=i.next();!a.done;a=i.next()){var s=a.value;try{for(var l=(n=void 0,ii(s.events||[])),c=l.next();!c.done;c=l.next()){var d=c.value;"onSuspense"===d.type&&d.action.args.branchId&&o.push(d.action.args.branchId)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return o},t.prototype.updateControlActionEvent=function(t,e,n){return this.chapter=function(t,e,n,r){var o,i=null===(o=t.containers.find((function(t){return t.id===e})))||void 0===o?void 0:o.controls.find((function(t){return t.id===n})),a=(null==i?void 0:i.events)||[],s=Jo("onClick",null==i?void 0:i.events),l=null==s?void 0:s.action.args.branchId;"setNextBranch"!==r&&"continuePlayback"!==r||(s?a=a.map((function(t){return t===s?To(To({},t),{action:To(To({},t.action),{type:r,args:To(To({},t.action.args),{branchId:"setNextBranch"===r?t.action.args.branchId:void 0})})}):t})):a.push(Bo("onClick",r)));var c="setNextBranch"!==r?t.branches.filter((function(t){return t.id!==l})):t.branches;return To(To({},t),{branches:c,containers:t.containers.map((function(t){return t.id===e?To(To({},t),{controls:t.controls.map((function(t){return t.id===n?To(To({},t),{events:a}):t}))}):t}))})}(this.chapter,t.id,e.id,n),this},t.prototype.updateContainerSuspenseAction=function(t,e){return this.chapter=function(t,e,n){var r=e.events||[],o=Jo("onSuspense",e.events),i=null==o?void 0:o.action.args.branchId;n&&(r=o?r.map((function(t){return"onSuspense"===t.type?Zo(Zo({},t),{action:Zo(Zo({},t.action),{type:n,args:Zo(Zo({},t.action.args),{branchId:"setNextBranch"===n?t.action.args.branchId:void 0})})}):t})):Wo(Wo([],$o(r),!1),[{type:"onSuspense",action:{type:n,args:{shouldOpenNow:!0}}}],!1));var a="setNextBranch"!==n?t.branches.filter((function(t){return t.id!==i})):t.branches,s=Zo(Zo({},e),{events:r});return Zo(Zo({},t),{branches:a,containers:t.containers.map((function(t){return t.id===e.id?s:t}))})}(this.chapter,t,e),this},t.prototype.getGraphNodeRender=function(){var t,e,n,r=this.calculateNodeHeight(),i=o.render.node.connectorPositionY,a=o.render.node.heightWithPreview,s=o.render.node.heightWithPreviewEov+o.render.node.componentAddActionHeight+1;return o.isViewOrPreViewMode()&&((null===(t=this.stylesWithDefaults.header)||void 0===t?void 0:t.enabled)||(i=o.render.node.defaultConnectorPositionY),(null===(e=this.stylesWithDefaults.flipTo)||void 0===e?void 0:e.enabled)&&(a=o.render.node.heightWithPreview),s=(null===(n=this.stylesWithDefaults.flipTo)||void 0===n?void 0:n.enabled)?o.render.node.heightWithPreviewEov+1:a+1),{height:r,width:o.render.node.width,previewMiddleYCoordinate:i,flipToYCoordinate:a,controlsContainerYCoordinate:s}},t.prototype.calculateNodeHeight=function(){var t,e,n,r;return"end"===this.chapter.order?o.isViewOrPreViewMode()&&!(null===(t=this.stylesWithDefaults.header)||void 0===t?void 0:t.enabled)?o.render.node.defaultHeight:o.render.node.heightWithPreview:o.isViewOrPreViewMode()?((null===(e=this.stylesWithDefaults.header)||void 0===e?void 0:e.enabled)?o.render.node.heightWithPreview:o.render.node.defaultHeight)+((null===(n=this.stylesWithDefaults.flipTo)||void 0===n?void 0:n.enabled)?o.render.node.componentControlHeight:0)+((null===(r=this.stylesWithDefaults.controls)||void 0===r?void 0:r.enabled)?this.controls().length*o.render.node.componentControlHeight:0):o.render.node.heightFull+this.controls().length*o.render.node.componentControlHeight},t.prototype.getControlTypeLabelTranslation=function(t){switch(t){case"Text":return o.translation.new_text_label;case"Button":return o.translation.new_button_label;case"Area":return o.translation.new_area_label}},t.prototype.getUniqueParentConnectionTypes=function(){return Array.from(new Set(this.parentChaptersConnections.map((function(t){return t.connectorType}))))},t}(),si=function(){return si=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},si.apply(this,arguments)},li=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ci=function(){function t(){var t=this;this._graphDesign=ni,this._nodes={},this._branches={},this._displayNodeErrors=!1,this.getGraphNodeById=function(e){return t._nodes[e]},this.getBranchById=function(e){return t._branches[e]},this.selectBranch=function(e){return t._branches[e]},this.reset=function(){t._metadata=void 0,t._media=void 0,t._nodes={},t._branches={},t._graphDesign=ni},this.rebuildNodesAndBranches=function(){t.buildNodesAndBranches()},this.set=function(e){e=function(t){return Qo.reduce((function(t,e){return t.metadata.version===e.version?e.migrate(t):t}),t)}(e),t._metadata=e.metadata,t._media=e.media,t._chapters=e.chapters,t._graphDesign=Eo()(t._graphDesign,{edit:wo(e.graph.edit),view:wo(e.graph.view)}),t.buildNodesAndBranches()},this.save=function(){var e,n;if(t._metadata&&t._media&&t._graphDesign){t._metadata.updated=(new Date).toISOString();var r=Object.values(t._nodes),i=[],a=[],l=o.isEditMode()?"edit":"view";try{for(var c=li(r),d=c.next();!d.done;d=c.next()){var u=d.value,h=u.chapter,p=u.styles,f=u.saveViewChapterDesign;i.push(h),("view"===l&&f||"edit"===l)&&a.push(p)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}var v={chapters:i,metadata:t._metadata,media:t._media,graph:si(si({},t._graphDesign),{edit:si(si({},t._graphDesign.edit),"edit"===l?{chapters:a}:{}),view:si(si({},t._graphDesign.view),"view"===l?{chapters:a}:{})})};s.emit("manifestUpdate",v),t.updateNodeErrors(),fs.layers.update()}},this.updateBranches=function(){var e,n,r,o,i,a;t._branches={};try{for(var s=li(Object.values(t._nodes)),l=s.next();!l.done;l=s.next())(u=l.value).parentChaptersConnections=[]}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}try{for(var c=li(Object.values(t._nodes)),d=c.next();!d.done;d=c.next()){var u=d.value;t.buildNodeBranches(u)}}catch(t){r={error:t}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}try{for(var h=li(Object.values(t._branches)),p=h.next();!p.done;p=h.next())p.value.updateInitialTargetCoordinates()}catch(t){i={error:t}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}return t},this.updateInitChapterId=function(e){return t._metadata&&(t._metadata.initChapterId&&"start"===t._nodes[t._metadata.initChapterId].chapter.order&&t._nodes[t._metadata.initChapterId].updateOrder("simple"),t._metadata.initChapterId=e),t},this.createNode=function(e,n,r){var i,a=(void 0===(i=o.translation.new_chapter_label)&&(i="[Untitled]"),{id:Lo(),label:i,order:"simple",branches:[],containers:[],events:[]}),s=function(t,e){var n=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(e,2);return{id:t,x:n[0],y:n[1]}}(a.id,e);return t._graphDesign.edit.chapters.push(s),t._nodes[a.id]=new ai(a,t._graphDesign),null==r||r(a.id),t},this.duplicateNode=function(e,n,r){var o=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(n,2),i=o[0],a=o[1],s=t._nodes[e],l=s.styles,c=function(t){var e;return Zo(Zo({},t),{id:Lo(),order:"start"===t.order?"simple":t.order,branches:[],containers:t.containers.map((function(t){return Zo(Zo({},t),{id:Lo(),controls:t.controls.map((function(t){return Zo(Zo({},t),{id:Lo(),events:"Text"!==t.type?[Bo("onClick","continuePlayback")]:[]})})),events:[Yo("continuePlayback")]})})),events:null===(e=t.events)||void 0===e?void 0:e.map((function(t){return"onSuspense"===t.type&&"setNextBranch"===t.action.type?Zo(Zo({},t),{action:Zo(Zo({},t.action),{args:Zo(Zo({},t.action.args),{branchId:void 0})})}):t}))})}(s.chapter),d=JSON.parse(JSON.stringify(si(si({},l),{id:c.id,x:t._nodes[e].styles.x+i,y:t._nodes[e].styles.y+a})));return t._graphDesign.edit.chapters.push(d),t.buildNodeFromChapter(c),null==r||r(c.id),t},this.setDisplayNodeErrors=function(e){void 0===e&&(e=!1),t._displayNodeErrors=e,t.updateNodeErrors()},this.getManifestBoundingBox=function(){var e,n,r=0,o=0,i=0,a=0;try{for(var s=li(Object.values(t._nodes)),l=s.next();!l.done;l=s.next()){var c=l.value.getBBox();r=c.minX<r?c.minX:r,o=c.minY<o?c.minY:o,i=c.maxX>i?c.maxX:i,a=c.maxY>a?c.maxY:a}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return{minX:r,minY:o,maxX:i,maxY:a}}}return Object.defineProperty(t.prototype,"metadata",{get:function(){return this._metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodes",{get:function(){var t=this;return o.isViewMode()?Object.values(this._nodes).filter((function(e){return!(e.isLocked&&t.styles.defaultChapter.goBlind)})):Object.values(this._nodes)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styles",{get:function(){var t=o.isEditMode()?"edit":"view";return this._graphDesign[t]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodesWithErrors",{get:function(){return this._displayNodeErrors?Object.values(this._nodes).filter((function(t){return t.hasErrors()})):[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"branches",{get:function(){if(o.isViewOrPreViewMode()){var t=!!o.isViewMode()&&this.styles.defaultChapter.goBlind;return Object.values(this._branches).filter((function(e){return!(e.isHidden||e.isAssociatedNodeLocked()&&t)}))}return Object.values(this._branches).filter((function(t){return!t.isHidden}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayNodeErrors",{get:function(){return this._displayNodeErrors},enumerable:!1,configurable:!0}),t.prototype.deleteGraphBranches=function(t){var e,n,r,o;return null===(n=null===(e=this._graphDesign)||void 0===e?void 0:e.edit.branches)||void 0===n||n.filter((function(e){return!t.includes(e.id)})),null===(o=null===(r=this._graphDesign)||void 0===r?void 0:r.view.branches)||void 0===o||o.filter((function(e){return!t.includes(e.id)})),this},t.prototype.buildNodesAndBranches=function(){var t,e;if(this._chapters){try{for(var n=li(this._chapters),r=n.next();!r.done;r=n.next()){var o=r.value;this.buildNodeFromChapter(o)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.updateBranches()}},t.prototype.updateNodeErrors=function(){var t,e;if(this._displayNodeErrors)try{for(var n=li(Object.values(this._nodes)),r=n.next();!r.done;r=n.next())r.value.validateNode()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.buildNodeBranches=function(t){var e,n,r,i,a=[],s=function(e){var n=l.getGraphNodeById(e.chapterId);if(!n)return l.showErrorMessage(o.translation.popup_error_message_1),{value:void 0};var s,c=void 0;if(c=s=t.getSuspenseBranchId()===e.id?ei.Flip:t.getContainerBranchIds().includes(e.id)?ei.Inaction:ei.Action,o.isViewOrPreViewMode()&&(s===ei.Flip&&!(null===(r=t.stylesWithDefaults.flipTo)||void 0===r?void 0:r.enabled)||!(null===(i=t.stylesWithDefaults.controls)||void 0===i?void 0:i.enabled))){if(c=ei.Flip,a.find((function(t){return t.connectorType===ei.Flip&&t.targetNodeId===n.id})))return"continue";a.push({connectorType:ei.Flip,targetNodeId:n.id})}var d=new oi(e,s,c,t,n);if(l._branches[e.id]=d,t.branches.push(d),l._branches[e.id].isHidden)return{value:void 0};l._nodes[e.chapterId].parentChaptersConnections.push({chapterId:t.id,type:d.type,connectorType:d.connectorType,branchId:d.id})},l=this;try{for(var c=li(t.chapter.branches),d=c.next();!d.done;d=c.next()){var u=s(d.value);if("object"==typeof u)return u.value}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}},t.prototype.buildNodeFromChapter=function(t){var e;if(this._media&&(this._nodes[t.id]=new ai(t,this._graphDesign),t.videoId)){var n=this._media.videos.find((function(e){return e.id===t.videoId}));if(!n)return void console.warn("videoId ".concat(t.videoId," for chapter ").concat(t.id," not found}"));var r=pi.videosInfo.find((function(e){return e.id===t.videoId}));this._nodes[t.id].videoInfo={id:(null==r?void 0:r.id)||n.id,cover:(null==r?void 0:r.cover)||(null===(e=n.variants.find((function(t){return t.cover})))||void 0===e?void 0:e.cover)||"",title:(null==r?void 0:r.title)||n.title}}},t.prototype.showErrorMessage=function(t){fs.popups.show(t,o.translation.popup_error_title),this.reset()},t}(),di=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},ui=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},hi=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const pi=new function(){var t=this;this.selectedNodes=new Set,this.selectedBranches=new Set,this.copiedNodes=new Set,this.visitedNodes=new Set,this.hoveredNodes=new Set,this.videosInfo=[],this.updateVideosInfo=function(e){t.videosInfo=e},this.selectNodes=function(e,n){void 0===n&&(n=!0);var r,o,i=new Set(e);r=t.selectedNodes,o=i,(r.size!==o.size||!function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(r),!1).every((function(t){return o.has(t)})))&&(t.selectedNodes=new Set(e),n&&s.emit("selectChapters",ui([],di(e),!1)))},this.addNodeToSelected=function(e){t.selectedNodes.add(e),s.emit("selectChapters",ui([],di(t.selectedNodes),!1))},this.removeNodeFromSelected=function(e){t.selectedNodes.delete(e),s.emit("selectChapters",ui([],di(t.selectedNodes),!1))},this.clearSelectedNodes=function(e){void 0===e&&(e=!0),e&&t.selectedNodes.size&&s.emit("selectChapters",[]),t.selectedNodes.clear()},this.addNodesToHovered=function(e){e.forEach((function(e){return t.hoveredNodes.add(e)}))},this.removeNodesFromHovered=function(e){e.forEach((function(e){return t.hoveredNodes.delete(e)}))},this.clearHoveredNodes=function(){t.hoveredNodes.clear()},this.selectBranches=function(e){t.selectedBranches=new Set(e),s.emit("selectBranches",ui([],di(t.selectedBranches),!1))},this.clearSelectedBranches=function(){t.selectedBranches.clear(),s.emit("selectBranches",[])},this.copySelectedNodes=function(){t.selectedNodes.size&&(t.copiedNodes=new Set(t.selectedNodes),1===t.copiedNodes.size?s.emit("notification",{id:"copy_chapter",defaultTranslation:o.translation.copy_chapter}):s.emit("notification",{id:"copy_multiple_chapters",defaultTranslation:o.translation.copy_multiple_chapters}))},this.pasteNodes=function(e){var n,r;if(t.copiedNodes.size){var i=o.render.tool.copyPasteDx,a=o.render.tool.copyPasteDy;if(e){var s=di(t.copiedNodes,1)[0],l=t.manifest.getGraphNodeById(s);i=e[0]-l.styles.x,a=e[1]-l.styles.y}t.clearSelectedNodes(!1);var c=[];try{for(var d=hi(t.copiedNodes),u=d.next();!u.done;u=d.next()){var h=u.value;t.manifest.duplicateNode(h,[i,a],(function(t){c.push(t)}))}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}t.selectNodes(c),t.manifest.save()}},this.deleteSelection=function(e){var n,r,i;if(t.selectedBranches.size){try{for(var a=hi(t.selectedBranches),l=a.next();!l.done;l=a.next()){var c=l.value,d=t.manifest.selectBranch(c);t.manifest.getGraphNodeById(d.source.chapterId).deleteBranch(d.id)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}t.clearSelectedBranches(),t.manifest.deleteGraphBranches(Array.from(t.selectedBranches)).updateBranches().save(),null==e||e()}t.selectedNodes.size&&((null===(i=t.manifest.metadata)||void 0===i?void 0:i.initChapterId)&&t.selectedNodes.has(t.manifest.metadata.initChapterId)?s.emit("notification",{id:"remove_init_chapter",defaultTranslation:o.translation.remove_initial_chapter}):s.emit("deleteChapters",ui([],di(t.selectedNodes),!1)),null==e||e())},this.setVisitedNodes=function(e){t.visitedNodes=new Set(e)},this.updatedSelectedElements=function(){var e=t.manifest.nodes.map((function(t){return t.id}));t.selectedNodes.forEach((function(n){e.includes(n)||t.selectedNodes.delete(n)}));var n=t.manifest.branches.map((function(t){return t.id}));t.selectedBranches.forEach((function(e){n.includes(e)||t.selectedBranches.delete(e)}))},this.clearSelection=function(){t.clearSelectedNodes(),t.clearSelectedBranches()},this.reset=function(){t.manifest.reset()},this.manifest=new ci,this.reset()};var fi,vi=function(){function t(t){var e=this;this.dispose=function(){e._root.selectAll("*").remove(),e._root.remove()},this.getRelativeEventCoordinates=function(t,n){return Ln(t,n||e._map.node())},this.getEditorWindowSize=function(){var t,n=null===(t=e._root.node())||void 0===t?void 0:t.getBoundingClientRect();return{width:(null==n?void 0:n.width)||0,height:(null==n?void 0:n.height)||0}},this.updateEditorBackgroundColor=function(){e._root.style("background-color",pi.manifest.styles.background.color)},this._root=Nn(t).append("div").attr("id","movika-graph-editor").style("position","relative").style("width","100%").style("height","100%").style("padding",0).style("margin",0).on("contextmenu",(function(t){t.preventDefault()})),this.initStyles(),this._svg=this._root.append("svg").style("width","100%").style("height","100%"),this._grid=this._svg.append("g").attr("id","grid-group"),this._map=this._svg.append("g").attr("id","map-group").attr("transform","translate(0, 0) scale(1)").style("will-change","transform"),this._staticTools=this._svg.append("g").attr("id","static-tools-group"),this._defs=this._svg.append("defs"),s.on("zoom",(function(t){e._map.attr("transform","translate(".concat(t.x,", ").concat(t.y,") scale(").concat(t.value,")"))}))}return Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"svg",{get:function(){return this._svg},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grid",{get:function(){return this._grid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"map",{get:function(){return this._map},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"staticTools",{get:function(){return this._staticTools},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defs",{get:function(){return this._defs},enumerable:!1,configurable:!0}),t.prototype.select=function(t){return this._root.select(t)},t.prototype.selectAll=function(t){return this._root.selectAll(t)},t.prototype.initStyles=function(){this._root.append("style").html("\n      #movika-graph-editor {\n        background-color: ".concat(pi.manifest.styles.background.color,";\n        font-family: inherit;\n        font-size: 12px;\n      }\n\n      #movika-graph-editor * { box-sizing: border-box; }\n\n      #movika-graph-editor.zoom_hand_tool { cursor: grab; }\n\n      #movika-graph-editor.zoom_hand_tool_active { cursor: grabbing; }\n\n      #movika-graph-editor.zoom_hand_tool #map-group,\n      #movika-graph-editor.zoom_hand_tool_active #map-group { pointer-events: none; }\n\n      #movika-graph-editor svg { user-select: none; -webkit-user-select: none; }\n\n      #movika-graph-editor svg text, #movika-graph-editor svg div { pointer-events: none; }\n\n      .mge-editorPopup {\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        font-size: 14px;\n        background-color: ").concat(o.render.color.elementBackground,";\n        color: ").concat(o.render.color.text,';\n        border: 1px solid #35373B;\n        border-radius: 4px;\n        padding: 16px;\n        position: absolute;\n        will-change: transform;\n      }\n\n      #movika-graph-editor .mge-legend {\n        display: flex;\n        align-items: center;\n        background-color: rgba(17, 17, 17, 0.8);\n        border-radius: 8px;\n        padding: 2px 4px;\n        color: #FFFFFF;\n        font-weight: 400;\n        text-shadow: 0px 0px 4px rgba(21, 18, 49, 0.23);\n        position: absolute;\n        top: calc(10px + env(safe-area-inset-top));\n        user-select: none;\n        pointer-events: none;\n      }\n      #movika-graph-editor .mge-legend.mge-graph { left: 10px; }\n      #movika-graph-editor .mge-legend.mge-navigation { right: 10px; }\n      #movika-graph-editor .mge-legend.mge-navigation .mge-icon {\n        width: 28px;\n        height: 28px;\n      }\n      #movika-graph-editor .mge-legendItem {\n        display: flex;\n        align-items: center;\n        position: relative;\n        height: 36px;\n        padding: 8px;\n      }\n      #movika-graph-editor .mge-legendItem:not(:last-child) { margin-right: 12px; }\n      #movika-graph-editor .mge-legendItem:not(:last-child)::after {\n        content: "•";\n        color: rgba(255, 255, 255, 0.4);\n        position: absolute;\n        right: -8px;\n        top: 10px;\n      }\n      #movika-graph-editor .mge-legendItem .mge-icon {\n        color: #FFFFFF;\n        width: 20px;\n        height: 20px;\n        margin-right: 8px;\n      }\n      #movika-graph-editor .mge-legendItem .mge-icon.withBg {\n        color: #222222;\n        background-color: #FFFFFF;\n        border-radius: 50%;\n        padding: 4px;\n      }\n      #movika-graph-editor .mge-legendItem .mge-icon svg { display: inline-block; }\n      @media screen and (max-device-width: 600px) and (orientation: portrait) {\n        #movika-graph-editor .mge-legend.mge-navigation { display: none; }\n      }\n      @media screen and (max-device-width: 900px) and (orientation: landscape) {\n        #movika-graph-editor .mge-legend.mge-navigation { display: none; }\n      }\n    '))},t}(),mi=o.render.grid.size*o.render.grid.steps,yi=[{id:"grid",numberOfCells:1,strokeWidth:.2,fillOpacity:1},{id:"inner_grid",numberOfCells:o.render.grid.steps,strokeWidth:.2,fillOpacity:.8}],gi=function(){function t(t){var e=this;this._gridDomElement=t,this._zoom={value:1,x:0,y:0},this._displayGrid=pi.manifest.styles.background.grid.enabled,this.dispose=function(){e._gridDomElement.selectAll("*").remove()},this.getSnappedCoordinates=function(t){var n=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(t,2),r=n[0],o=n[1];return[e.getSnappedCoordinateValue(r),e.getSnappedCoordinateValue(o)]},this.getSnappedCoordinateValue=function(t){return fs.inputs.keydown.shiftHold&&e._displayGrid?+(Math.floor(t/o.render.grid.size)*o.render.grid.size).toFixed(2):t},this.update=function(){e._displayGrid=pi.manifest.styles.background.grid.enabled,e.updateGridVisibility(),e._displayGrid&&e.updateGridColor()},this.renderPatterns(t),this.renderRect(t),this.updateGridColor(),this.updateGridVisibility(),s.on("zoom",(function(t){e._zoom=t,e._displayGrid&&e.updateGridSize()}))}return t.prototype.updateGridColor=function(){fs.dom.select("#grid rect").attr("stroke",pi.manifest.styles.background.grid.color),fs.dom.select("#inner_grid rect").attr("stroke",pi.manifest.styles.background.grid.color)},t.prototype.updateGridSize=function(){var t=this;yi.forEach((function(e){if("inner_grid"===e.id){if(t._zoom.value<=.3)return void fs.dom.select("#inner_grid_rect").style("display","none");fs.dom.select("#inner_grid_rect").style("display",null)}var n=t._zoom.value*mi/e.numberOfCells;fs.dom.select("#".concat(e.id)).attr("x",t._zoom.x%n).attr("y",t._zoom.y%n).attr("width",n).attr("height",n)}))},t.prototype.updateGridVisibility=function(){this._displayGrid?(this.updateGridSize(),this._gridDomElement.style("display",null)):this._gridDomElement.style("display","none")},t.prototype.renderPatterns=function(t){t.selectAll("pattern").data(yi).join("pattern").attr("id",(function(t){return t.id})).attr("width",(function(t){return mi/t.numberOfCells})).attr("height",(function(t){return mi/t.numberOfCells})).attr("patternUnits","userSpaceOnUse").append("rect").attr("width","100%").attr("height","100%").attr("stroke-width",(function(t){return t.strokeWidth})).attr("fill","none")},t.prototype.renderRect=function(t){yi.forEach((function(e){t.append("rect").attr("x",0).attr("y",0).attr("id",e.id+"_rect").attr("width","100%").attr("height","100%").attr("fill","url(#".concat(e.id,")")).attr("fill-opacity",e.fillOpacity)}))},t}();!function(t){t.C="KeyC",t.V="KeyV",t.G="KeyG",t.H="KeyH",t.Equal="Equal",t.Minus="Minus",t.NumpadAdd="NumpadAdd",t.NumpadSubtract="NumpadSubtract",t.Delete="Delete",t.Backspace="Backspace",t.ShiftLeft="ShiftLeft",t.Space="Space"}(fi||(fi={}));var _i,bi=function(){function t(){var t=this;this._shiftHold=!1,this._spaceHold=!1,this.dispose=function(){document.removeEventListener("keydown",t.shortcutsHandler),document.removeEventListener("keydown",t.holdKeyHandler),document.removeEventListener("keyup",t.holdKeyHandler),window.removeEventListener("blur",t.resetHoldKey)},this.shortcutsHandler=function(e){if(!t.ignoreKeyboardEvent(e)){switch(e.code){case fi.Equal:case fi.NumpadAdd:t.handleZoomIn();break;case fi.Minus:case fi.NumpadSubtract:t.handleZoomOut()}if(o.isEditMode()){if(e.repeat)return;if(e.ctrlKey||e.metaKey){if(e.code===fi.C)return void t.handleCopy();if(e.code===fi.V)return void t.handlePaste()}switch(e.code){case fi.Backspace:case fi.Delete:t.handleDelete();break;case fi.H:fs.inputs.zoom.toggleMousedownZoom();break;default:return}}else if(o.isPreViewMode()){if(e.repeat)return;if(e.code!==fi.H)return;fs.inputs.zoom.toggleMousedownZoom()}}},this.holdKeyHandler=function(e){if(!t.ignoreKeyboardEvent(e)&&!e.repeat){var n="keydown"===e.type;switch(e.code){case fi.ShiftLeft:t._shiftHold=n;break;case fi.Space:t._spaceHold=n,n?fs.inputs.zoom.enableMousedownZoom():fs.inputs.zoom.disableMousedownZoom();break;default:return}}},this.resetHoldKey=function(){t._shiftHold=!1,t._spaceHold=!1},document.addEventListener("keydown",this.shortcutsHandler),document.addEventListener("keydown",this.holdKeyHandler),document.addEventListener("keyup",this.holdKeyHandler),window.addEventListener("blur",this.resetHoldKey)}return Object.defineProperty(t.prototype,"shiftHold",{get:function(){return this._shiftHold},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spaceHold",{get:function(){return this._spaceHold},enumerable:!1,configurable:!0}),t.prototype.handleCopy=function(){pi.copySelectedNodes()},t.prototype.handlePaste=function(){pi.selectedNodes.forEach((function(){return s.emit("events",{name:"addChapter"})})),pi.pasteNodes()},t.prototype.handleDelete=function(){pi.deleteSelection((function(){fs.tools.disable()}))},t.prototype.handleZoomIn=function(){fs.inputs.zoom.update((function(t){return t+.1}))},t.prototype.handleZoomOut=function(){fs.inputs.zoom.update((function(t){return t-.1}))},t.prototype.ignoreKeyboardEvent=function(t){return t.defaultPrevented||["INPUT","TEXTAREA"].includes(t.target.nodeName)},t}(),wi=function(){function t(t){this.toolId=t,this.toolElement=Nr("svg:g").datum([0,0]).attr("id",t).attr("transform","translate(0, 0)").style("display","none").call(fs.inputs.nullableDrag())}return t.prototype.render=function(t){var e=this;t.append((function(){return e.toolElement.node()}))},t.prototype.start=function(){fs.inputs.zoom.disable(),this.toolElement.style("display","inline")},t.prototype.stop=function(){fs.inputs.zoom.enable(),this.toolElement.style("display","none")},t.prototype.clear=function(){this.toolElement.selectAll("*").remove()},t.prototype.position=function(t){var e=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(t,2),n=e[0],r=e[1];return this.toolElement.datum([n,r]).attr("transform",(function(){return"translate(".concat(n,", ").concat(r,")")})),this},t.test=!0,t}(),Ci=186,xi=12*o.render.grid.size,Ei=function(t){return t.append("path").attr("d",(function(){return so({x:0,y:0,w:Ci,h:xi,r:o.render.node.borderRadius})})).attr("width",Ci).attr("height",xi).attr("stroke-width",o.render.strokeSize).style("stroke-dasharray","3, 3").attr("stroke",o.render.color.shadowNodeStroke).attr("fill",o.render.color.shadowNodeFill)},Mi=function(t,e,n){return{primaryTextContainer:ki(t,e),secondaryTextContainer:n?ki(t,n,!0):void 0}},ki=function(t,e,n){void 0===n&&(n=!1);var r=e.split("\n"),o=t.append("text").style("display",n?"none":"inline").style("fill","#F2F5FF").attr("font-weight",500).attr("y",xi/2.2).attr("transform","translate(".concat(93,")")).attr("text-rendering","optimizeSpeed");return r.forEach((function(t){o.append("tspan").text(t).attr("text-anchor","middle").attr("x",0).attr("dy",17)})),o},Si=function(t,e){return!(t.minX>e.maxX||t.maxX<e.minX||t.minY>e.maxY||t.maxY<e.minY)},Ii=function(t){return pi.manifest.nodes.some((function(e){return Si(t,e.getBBox())}))},Ni=(_i=function(t,e){return _i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},_i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}_i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Li=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Oi=function(t){function e(){var e=t.call(this,"area-select")||this;return e._rectBoundingBox={minX:0,minY:0,maxX:0,maxY:0},e._needForRAF=!0,e._selectedNodeIds=[],e.render=function(n){t.prototype.render.call(e,n),e._rectElement=e.toolElement.append("rect").attr("id","select-area-rect").attr("fill","#7b68ee").attr("fill-opacity","0.05").attr("stroke","#8978F0").attr("stroke-width","0.5").attr("shape-rendering","crispEdges")},e}return Ni(e,t),e.prototype.start=function(){var e=this;t.prototype.start.call(this),fs.dom.svg.on("mousedown.areaSelect",(function(){var t;null===(t=e._rectElement)||void 0===t||t.attr("width",0).attr("height",0)})).on("mousemove.areaSelect",(function(t){if(e._needForRAF){e._needForRAF=!1,fs.dom.select("#nodes").attr("pointer-events","none"),fs.dom.select("#branches").attr("pointer-events","none");var n=Li(e.toolElement.datum(),2),r=n[0],o=n[1],i=Li(Ln(t),2),a=i[0],s=i[1];e.animationFrame=requestAnimationFrame((function(){var t,n=Math.abs(r-a),i=Math.abs(o-s),l=r<a?0:-n,c=o<s?0:-i;null===(t=e._rectElement)||void 0===t||t.attr("x",l).attr("y",c).attr("width",n).attr("height",i),e._selectedNodeIds=fs.inputs.keydown.shiftHold?function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],Li(pi.selectedNodes),!1):[];var d=Li(fs.inputs.zoom.getRelativeCoordinates([r,o]),2),u=d[0],h=d[1],p=Li(fs.inputs.zoom.getRelativeCoordinates([a,s]),2),f=p[0],v=p[1];e._rectBoundingBox.minX=f<u?f:u,e._rectBoundingBox.maxX=f<u?u:f,e._rectBoundingBox.minY=v<h?v:h,e._rectBoundingBox.maxY=v<h?h:v,pi.manifest.nodes.forEach((function(t){Si(e._rectBoundingBox,t.getBBox())&&e._selectedNodeIds.push(t.id)})),pi.selectNodes(e._selectedNodeIds),fs.layers.updateSelected(),e._needForRAF=!0}))}})).on("mouseup.areaSelect",(function(){pi.selectNodes(e._selectedNodeIds),fs.layers.updateSelected(),e.stop()}))},e.prototype.data=function(){return this},e.prototype.stop=function(){var e;fs.dom.svg.on("mousemove.areaSelect",null).on("mouseup.areaSelect",null),this.animationFrame&&cancelAnimationFrame(this.animationFrame),null===(e=this._rectElement)||void 0===e||e.attr("x",0).attr("y",0).attr("width",0).attr("height",0),this._rectBoundingBox.minX=0,this._rectBoundingBox.maxX=0,this._rectBoundingBox.minY=0,this._rectBoundingBox.maxY=0,this._needForRAF=!0,this._selectedNodeIds.length=0,fs.dom.select("#nodes").attr("pointer-events",null),fs.dom.select("#branches").attr("pointer-events",null),t.prototype.stop.call(this)},e}(wi),Ti=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ai=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Pi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._numberOfItems=0,e._isTooltipActive=!1,e}return Ti(e,t),e.prototype.start=function(){t.prototype.start.call(this),this._numberOfItems=0,this.clear()},e.prototype.position=function(t){var e=Ai(t,2),n=e[0],r=e[1],i=this.getSafeMenuToolArea(),a=i.minXPosition,s=i.minYPosition,l=i.horizontal,c=i.vertical,d=l-o.render.tool.menuItemWidth,u=c-o.render.tool.menuItemHeight*this._numberOfItems,h=Math.min(d,Math.max(a,n)),p=Math.min(u,Math.max(s,r));return this.toolElement.datum([n,r]).attr("transform",(function(){return"translate(".concat(h,", ").concat(p,")")})),this},e.prototype.addMenuItem=function(t){var e=this,n=o.render.tool.menuItemHeight*this._numberOfItems,r=function(t){var e=t.label,n=t.icon,r=t.disabled,i=void 0!==r&&r,a=t.width,s=void 0===a?o.render.node.width:a,l=t.height,c=t.onClick,d=Nr("svg:g").on("click",(function(){i||c()}));return d.append("rect").attr("x",0).attr("y",0).attr("width",s).attr("height",l||o.render.node.componentControlHeight).attr("fill",i?o.render.color.elementBackgroundAlt:o.render.color.elementBackground).on("mouseenter",(function(){i||Nn(this).attr("fill",o.render.color.elementBackgroundHover)})).on("mouseleave",(function(){i||Nn(this).attr("fill",o.render.color.elementBackground)})).style("cursor",i?"not-allowed":"pointer"),n&&d.append("use").style("color",o.render.tool.textColor).attr("x",8).attr("y",8).attr("href","#"+n).style("opacity",i?.4:1),d.append("text").text(e).attr("x",n?30:8).attr("y",20).attr("font-size",12).attr("font-weight",500).attr("text-anchor","start").style("fill",i?"#797B82":o.render.tool.textColor).attr("text-rendering","optimizeSpeed"),d}({label:t.label,icon:t.icon,disabled:t.disabled,width:o.render.tool.menuItemWidth,height:o.render.tool.menuItemHeight,onClick:function(){t.onClick(),e.stop()}}).attr("transform","translate(0, ".concat(n,")"));if(t.tooltip){var i=t.tooltip;r.on("mouseenter",(function(){if(!e._isTooltipActive){e._isTooltipActive=!0;var t=Ai(e.toolElement.datum(),2),r=t[0],a=t[1];fs.popups.position([r+o.render.tool.menuItemTooltipOffset,a+n-10]).show(i,void 0,"tooltip")}})).on("mouseleave",(function(){e._isTooltipActive&&(e._isTooltipActive=!1,fs.popups.hide())}))}this.toolElement.append((function(){return r.node()})),this._numberOfItems+=1},e.prototype.createMenu=function(t){ho({id:this.toolId,width:o.render.tool.menuItemWidth,height:o.render.tool.menuItemHeight*this._numberOfItems,element:this.toolElement,strokeColor:t||o.render.tool.strokeColor,r:o.render.tool.borderRadius})},e.prototype.getSafeMenuToolArea=function(){var t=fs.dom.getEditorWindowSize();return{minXPosition:10,minYPosition:10,horizontal:t.width-10,vertical:t.height-10}},e}(wi),ji=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Bi=function(t){function e(){return t.call(this,"control-menu")||this}return ji(e,t),e.prototype.start=function(){if(t.prototype.start.call(this),!this._node||!this._control)throw new Error("[Tool]: ControlMenuTool requires 'GraphNode' and 'Control' data");this.renderMenuItems(this._node,this._control)},e.prototype.data=function(t,e){return this._node=t,this._control=e,this},e.prototype.renderMenuItems=function(t,e){var n=t.chapter.containers.find((function(t){return!!t.controls.find((function(t){return t.id===e.id}))})).id;this.addMenuItem({label:o.translation.tool_menu_item_rename,disabled:o.isPreViewMode(),onClick:function(){s.emit("control",{name:"renameControl",chapterId:t.id,containerId:n,control:e})}}),this.addMenuItem({label:o.translation.tool_menu_item_delete,disabled:o.isPreViewMode(),onClick:function(){s.emit("control",{name:"deleteControl",chapterId:t.id,controlId:e.id,containerId:n})}}),this.createMenu()},e}(Pi),Vi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zi=function(t){function e(){return t.call(this,"control-type-menu")||this}return Vi(e,t),e.prototype.start=function(){if(t.prototype.start.call(this),!this._node)throw new Error("[Tool]: ControlTypeMenuTool requires 'GraphNode' data");this.renderMenuItems(this._node)},e.prototype.data=function(t){return this._node=t,this},e.prototype.renderMenuItems=function(t){this.addMenuItem({label:o.translation.tool_menu_item_control_button,icon:l.ActionButton,onClick:function(){t.addControlToContainer("Button"),s.emit("events",{name:"addControl",type:"Button"}),pi.manifest.save()}}),this.addMenuItem({label:o.translation.tool_menu_item_control_area,icon:l.ActionArea,onClick:function(){t.addControlToContainer("Area"),s.emit("events",{name:"addControl",type:"Area"}),pi.manifest.save()}}),this.createMenu()},e}(Pi),Ri=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Di=function(t){function e(){return t.call(this,"editor-context-menu")||this}return Ri(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.renderMenuItems()},e.prototype.data=function(){return this},e.prototype.renderMenuItems=function(){var t=this;this.addMenuItem({label:o.translation.tool_menu_item_add_node,disabled:o.isPreViewMode(),onClick:function(){var e=fs.inputs.zoom.getRelativeCoordinates(t.toolElement.datum());pi.manifest.createNode(e).save(),s.emit("events",{name:"addChapter"})}}),this.addMenuItem({label:o.translation.tool_menu_item_copy,disabled:!pi.selectedNodes.size||o.isPreViewMode(),onClick:function(){pi.copySelectedNodes()}}),this.addMenuItem({label:o.translation.tool_menu_item_paste,disabled:!pi.copiedNodes.size||o.isPreViewMode(),onClick:function(){var e=fs.inputs.zoom.getRelativeCoordinates(t.toolElement.datum());pi.selectedNodes.forEach((function(){return s.emit("events",{name:"addChapter"})})),pi.pasteNodes(e)}}),this.addMenuItem({label:o.translation.tool_menu_item_delete,disabled:!pi.selectedNodes.size||o.isPreViewMode(),onClick:function(){pi.deleteSelection()}}),this.createMenu()},e}(Pi),Fi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Hi=function(t){function e(){return t.call(this,"eov-menu")||this}return Fi(e,t),e.prototype.start=function(){if(t.prototype.start.call(this),!this._node)throw new Error("[Tool]: EOVMenuTool requires 'GraphNode' data");this.renderMenuItems(this._node)},e.prototype.data=function(t){return this._node=t,this},e.prototype.renderMenuItems=function(t){this.addMenuItem({label:o.translation.tool_menu_item_next_node,icon:l.Node,onClick:function(){t.updateChapterSuspenseAction("setNextBranch"),pi.manifest.updateBranches().save()}});var e=!!t.containers().length;this.addMenuItem({label:o.translation.tool_menu_item_random,icon:l.Random,disabled:!e,tooltip:e?void 0:o.translation.tool_menu_item_random_tooltip,onClick:function(){t.updateChapterSuspenseAction("setRandomBranch"),pi.manifest.updateBranches().save()}}),this.createMenu(o.render.color.stroke)},e}(Pi),Zi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$i=function(t){function e(){return t.call(this,"node-menu")||this}return Zi(e,t),e.prototype.start=function(){if(t.prototype.start.call(this),!this._node)throw new Error("[Tool]: NodeMenuTool requires 'GraphNode' data");this.renderMenuItems(this._node)},e.prototype.data=function(t){return this._node=t,this},e.prototype.renderMenuItems=function(t){this.addMenuItem({label:o.translation.tool_menu_item_rename,onClick:function(){s.emit("control",{name:"renameChapter",chapterId:t.id})}}),this.addMenuItem({label:o.translation.tool_menu_item_copy,disabled:o.isPreViewMode(),onClick:function(){pi.copySelectedNodes()}}),this.addMenuItem({label:o.translation.tool_menu_item_delete,disabled:"start"===t.chapter.order||o.isPreViewMode(),onClick:function(){s.emit("deleteChapters",[t.id])}}),this.addMenuItem({label:o.translation.tool_menu_item_as_start_node,icon:l.StartNode,disabled:"start"===t.chapter.order||o.isPreViewMode(),onClick:function(){t.updateOrder("start"),pi.manifest.updateInitChapterId(t.id).save()}}),this.addMenuItem({label:o.translation.tool_menu_item_as_node,icon:l.Node,disabled:"simple"===t.chapter.order||o.isPreViewMode(),onClick:function(){t.updateOrder("simple"),pi.manifest.save()}}),this.addMenuItem({label:o.translation.tool_menu_item_as_end_node,icon:l.EndNode,disabled:!!t.getSuspenseBranchId()||!!t.controls().length||o.isPreViewMode(),onClick:function(){t.updateOrder("end"),pi.manifest.save()}}),this.addMenuItem({label:o.translation.tool_menu_item_start_preview,onClick:function(){s.emit("control",{name:"openPreview",chapterId:t.id})}}),this.createMenu()},e}(Pi),Wi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yi=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Gi=xi/3.3,Xi=function(t){function e(){var e=t.call(this,"shadow-node")||this;return e._displayToolError=!1,e.render=function(n){t.prototype.render.call(e,n),e._shadowNode=Ei(e.toolElement),e.toolElement.append("svg").attr("x",83).attr("y",Gi).attr("width",o.render.iconSize+5).attr("height",o.render.iconSize+5).attr("viewBox","0 0 ".concat(o.render.iconSize," ").concat(o.render.iconSize)).append("use").style("color",o.render.tool.textColor).attr("href","#".concat(l.Move));var r=Mi(e.toolElement,o.translation.tool_shadow_node_text,o.translation.tool_shadow_node_error),i=r.primaryTextContainer,a=r.secondaryTextContainer;e._primaryText=i,e._secondaryText=a,e.toolElement.on("click",(function(t){return t.preventDefault()})).on("contextmenu",(function(t){return t.preventDefault()}))},e}return Wi(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.redraw(),this.enableMouseMove()},e.prototype.data=function(){return this},e.prototype.stop=function(){fs.dom.svg.style("cursor",null).on("click.shadowNode",null).on("mousemove.shadowNode",null).on("contextmenu.shadowNode",null),s.emit("control",{name:"addChapterStopped"}),t.prototype.stop.call(this)},e.prototype.enableMouseMove=function(){var t=this;fs.dom.svg.style("cursor","none"),fs.dom.svg.on("click.shadowNode",(function(e){e.preventDefault(),t._displayToolError||(pi.manifest.createNode(t.toolElement.datum()).save(),s.emit("events",{name:"addChapter"})),t.stop()})).on("mousemove.shadowNode",(function(e){var n=Yi(fs.dom.getRelativeEventCoordinates(e),2),r=n[0],o=n[1],i=fs.grid.getSnappedCoordinates([r-93,o-Gi]);t.toolElement.datum(i).attr("transform",(function(){return"translate(".concat(i[0],", ").concat(i[1],")")})),t.redraw()})).on("contextmenu.shadowNode",(function(e){e.preventDefault(),t.stop()}))},e.prototype.redraw=function(){var t=Ii(this.getShadowNodeBox());this._displayToolError!==t&&(this._displayToolError=t,this.renderToolError())},e.prototype.renderToolError=function(){var t,e,n;null===(t=this._shadowNode)||void 0===t||t.attr("fill",this._displayToolError?o.render.color.error:o.render.color.shadowNodeFill).attr("fill-opacity","0.21").attr("stroke",this._displayToolError?o.render.color.error:o.render.color.shadowNodeStroke).attr("stroke-opacity","0.3"),null===(e=this._primaryText)||void 0===e||e.style("display",this._displayToolError?"none":"inline"),null===(n=this._secondaryText)||void 0===n||n.style("display",this._displayToolError?"inline":"none")},e.prototype.getShadowNodeBox=function(){var t=Yi(this.toolElement.datum(),2),e=t[0],n=t[1];return{minX:e,minY:n,maxX:e+Ci,maxY:n+xi}},e}(wi),qi="branchElement",Ui="#654BDD",Ki=function(t){return o.isViewMode()?t.isAssociatedNodeLocked()?"#76787A":o.render.color.stroke:pi.selectedBranches.has(t.id)?Ui:o.render.color.stroke},Qi=function(t){return"translate(".concat(t.styles.x+t.render.width/2-12,", ").concat(t.styles.y-28,")")},Ji=function(t){return fs.dom.select('[id="'.concat(t,'"]'))},ta=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},ea=o.render.node.headerHeight-8,na=o.render.node.width-o.render.node.headerHeight,ra=o.render.iconSize+4,oa=function(t,e,n){var r=t.append("g").attr("class","header");aa(r,e,n),o.isEditMode()&&sa(r,e,n)};function ia(t,e){o.isViewOrPreViewMode()&&Ji(t.id).select(".headerBg").attr("fill",e?t.stylesWithDefaults.hover.borderColor:t.stylesWithDefaults.header.backgroundColor)}var aa=function(t,e,n){var r=ta(e,2),i=r[0],a=r[1];t.append("rect").attr("class","headerBg").attr("width",o.render.node.width).attr("height",o.render.node.headerHeight).attr("fill",o.isViewOrPreViewMode()?n.stylesWithDefaults.header.backgroundColor:o.render.color.elementBackground),t.append((function(){var t;return go({text:n.displayLockedContent?n.chapter.label:o.translation.node_not_visited,posX:i+12,posY:a+10,width:140,fontWeight:600,color:o.isViewOrPreViewMode()?null===(t=n.stylesWithDefaults.header)||void 0===t?void 0:t.textColor:void 0})}))},sa=function(t,e,n){var r=ta(e,2)[1],i=t.append("g").attr("id","options").style("cursor","pointer").on("click",(function(t){t.preventDefault();var e=fs.inputs.zoom.getRelativeCoordinates([n.styles.x+n.render.width+5,n.styles.y],!0);fs.tools.use(pa.NodeMenu).data(n).position(e).start(),Nn(this).selectChild().attr("fill","#363738")})).on("mousedown",(function(){Nn(this).selectChild().attr("fill","#454647")})).on("mouseenter",(function(){Nn(this).selectChild().attr("fill","#363738")})).on("mouseleave",(function(){Nn(this).selectChild().attr("fill",o.render.color.elementBackground)}));i.append("path").attr("d",so({x:na+4,y:r+4,w:ea,h:ea,r:10})).attr("fill",o.render.color.elementBackground),i.append("use").style("color",o.render.color.text).attr("x",na+ra/2).attr("y",r+ra/2).attr("href","#".concat(l.Etc))},la=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},ca="previewControls",da="previewBackground",ua=function(t,e,n){var r,i=la(e,2),a=i[0],s=i[1],l=t.append("g").attr("class","preview");l.append("rect").attr("class",da).attr("x",a).attr("y",s-1).attr("width",o.render.node.width).attr("height",o.render.node.componentPreviewHeight+4).attr("fill",o.isViewOrPreViewMode()?n.stylesWithDefaults.header.backgroundColor:o.render.color.elementBackground);var c=l.append("g").attr("class","previewContainer").attr("clip-path","url(#".concat(ao.PreviewClipPath,")")),d=[a,s+1];fa(c,d,n),o.isEditMode()?(va(c,d,n),ma(c,d,n)):o.isViewOrPreViewMode()&&(null===(r=n.stylesWithDefaults.watchAgain)||void 0===r?void 0:r.enabled)&&ya(c,d,n),l.on("mouseenter",(function(){!n.isDragged&&n.displayLockedContent&&Nn(this).select(".".concat(ca)).style("display","inline")})).on("mouseleave",(function(){!n.isDragged&&n.displayLockedContent&&Nn(this).select(".".concat(ca)).style("display","none")}))};function ha(t,e){o.isViewOrPreViewMode()&&Ji(t.id).select(".".concat(da)).attr("fill",e?t.stylesWithDefaults.hover.borderColor:t.stylesWithDefaults.header.backgroundColor)}var pa,fa=function(t,e,n){var r=la(e,2),a=r[0],s=r[1],c=t.append("g").attr("class","previewContent");if(!n.displayLockedContent)return c.append("rect").attr("x",a).attr("y",s).attr("width",n.render.width-2).attr("height",o.render.node.componentPreviewHeight).attr("fill",n.stylesWithDefaults.preview.backgroundColor),void c.append("svg").attr("x",o.render.node.width/2-10).attr("y",s+o.render.node.componentPreviewHeight/2-10).attr("width",o.render.iconSize+4).attr("height",o.render.iconSize+4).attr("viewBox","0 0 ".concat(o.render.iconSize," ").concat(o.render.iconSize)).append("use").style("color",n.stylesWithDefaults.preview.textColor).attr("href","#".concat(l.Lock));n.videoInfo?(c.append("rect").attr("x",a).attr("y",s).attr("width",n.render.width-2).attr("height",o.render.node.componentPreviewHeight).attr("fill",o.render.node.previewPlaceholder.backgroundColor),c.append("svg:image").attr("id","dropZone_".concat(n.id)).attr("x",a).attr("y",s).attr("width",n.render.width-2).attr("height",o.render.node.componentPreviewHeight).attr("preserveAspectRatio","xMidYMid meet").attr("href",n.videoInfo.cover).on("error",(function(t){Nn(t.target).attr("href",(function(){return i(521)}))}))):c.append("use").attr("id","dropZone_".concat(n.id)).attr("x",a).attr("y",s).attr("href","#".concat(ao.PreviewPlaceholder))},va=function(t,e,n){var r,i=la(e,2),a=i[0],s=i[1];(null===(r=n.videoInfo)||void 0===r?void 0:r.title)&&(t.append("rect").attr("class","previewContentTitle").attr("x",a).attr("y",s+o.render.node.componentPreviewHeight-32).attr("width",n.render.width-2).attr("height",32).attr("fill","rgba(13, 15, 18, 0.89)"),t.append((function(){var t;return go({text:(null===(t=n.videoInfo)||void 0===t?void 0:t.title)||"",posX:a+8,posY:o.render.node.componentPreviewHeight+12,width:o.render.node.width-16,fontSize:14,fontWeight:600})})))},ma=function(t,e,n){var r=la(e,2),i=r[0],a=r[1],l=t.append("g").attr("class",ca).attr("transform","translate(".concat(i,", ").concat(a,")")).style("display","none");l.append("rect").attr("width",n.render.width-2).attr("height",o.render.node.componentPreviewHeight).attr("fill","rgba(0, 0, 0, 0.8)"),l.append((function(){return ga(n.chapter.videoId?o.translation.node_video_change:o.translation.node_video_choose,"rgba(255, 255, 255, 0.17)","rgba(255, 255, 255, 0.22)","rgba(255, 255, 255, 0.27)",(t=n.id,function(){s.emit("control",{name:"changeVideo",chapterId:t})})).attr("transform","translate(16, 25)").node();var t})),l.append((function(){return ga(o.translation.node_open_editor,"#7B68EE","#8978F0","#9889F2",(t=n.id,function(){s.emit("control",{name:"openEditor",chapterId:t})})).attr("transform","translate(16, 61)").node();var t}))},ya=function(t,e,n){var r=la(e,2),i=r[0],a=r[1],l=t.append("g").attr("class",ca).attr("transform","translate(".concat(i,", ").concat(a,")")).style("display","none");l.append("rect").attr("width",n.render.width-2).attr("height",o.render.node.componentPreviewHeight).attr("fill","rgba(0, 0, 0, 0.8)"),l.append((function(){return ga(o.translation.node_watch_again_from,n.stylesWithDefaults.watchAgain.backgroundColor,n.stylesWithDefaults.watchAgain.backgroundColor,n.stylesWithDefaults.watchAgain.backgroundColor,(t=n.id,function(){s.emit("control",{name:"openPreview",chapterId:t})}),n.stylesWithDefaults.watchAgain.textColor,130,30,8).attr("transform","translate(28, 42)").node();var t}))},ga=function(t,e,n,r,i,a,s,l,c){void 0===a&&(a=o.render.color.text),void 0===s&&(s=o.render.node.width-32),void 0===l&&(l=28),void 0===c&&(c=4);var d=Nr("svg:g").attr("class","previewControlButton").on("mouseenter",(function(){Nn(this).select(".buttonBg").attr("fill",n)})).on("mouseleave",(function(){Nn(this).select(".buttonBg").attr("fill",e)})).on("mousedown",(function(){Nn(this).select(".buttonBg").attr("fill",r)})).on("click",(function(t){Nn(this).select(".buttonBg").attr("fill",n),i(t)}));return d.append("path").attr("class","buttonBg").attr("d",so({x:0,y:0,w:s,h:l,r:c})).attr("fill",e).style("cursor","pointer"),d.append("text").text(t).attr("class","buttonText").attr("x",s/2).attr("y",l-10).attr("font-weight",500).attr("font-size",14).attr("text-anchor","middle").style("fill",a).attr("text-rendering","optimizeSpeed"),d},_a="rgba(255, 255, 255, 0.17)",ba=function(t,e,n){var r,i,a=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(e,2),s=a[0],l=a[1],c=t.append("g").attr("class","controls"),d=0;try{for(var u=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n.containers().reverse()),h=u.next();!h.done;h=u.next()){var p=h.value;n.getContainerControls(p.id).forEach((function(t){c.append((function(){var e=l+o.render.node.componentControlHeight*d++;return wa(n,t).attr("transform","translate(".concat(s,", ").concat(e,")")).node()}))}))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}},wa=function(t,e){var n=Nr("svg:g").append("g").attr("class","nodeControl");return n.style("cursor","pointer").on("mouseenter",(function(){fs.dom.select(".control_add_link_button_".concat(e.id)).attr("display","inline"),Nn(this).select(".controlElementRect").attr("fill",io(t.stylesWithDefaults.controls.backgroundColor,o.render.color.percentDiff))})).on("mouseleave",(function(){fs.dom.select(".control_add_link_button_".concat(e.id)).attr("display","none"),Nn(this).select(".controlElementRect").attr("fill",t.stylesWithDefaults.controls.backgroundColor)})).on("contextmenu",(function(n){n.preventDefault(),n.stopImmediatePropagation();var r=fs.dom.getRelativeEventCoordinates(n,fs.dom.staticTools.node());fs.tools.use(pa.ControlMenu).data(t,e).position(r).start()})),n.append("rect").attr("class","controlElementRect").attr("width",o.render.node.width).attr("height",o.render.node.componentControlHeight).attr("fill",t.stylesWithDefaults.controls.backgroundColor).attr("stroke-width",o.render.strokeSize).attr("stroke",o.render.color.elementStroke),n.append("use").style("color",o.render.color.text).attr("x",8).attr("y",o.render.node.componentControlHeight/2-o.render.iconSize/2).attr("href","#".concat(Ca(e))),n.append((function(){return go({text:xa(e),posX:o.render.iconSize+14,posY:o.render.node.componentControlHeight/2-8,width:o.render.node.width-(o.render.iconSize+30),color:t.stylesWithDefaults.controls.textColor})})),n},Ca=function(t){switch(t.type){case"Area":return l.ActionArea;case"Button":return l.ActionButton}},xa=function(t){return t.label||t.type},Ea=function(t,e,n){var r=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(e,2),i=r[0],a=r[1],s=t.append("g").attr("class","eov");s.style("cursor","pointer").on("mouseenter",(function(){Nn(this).select(".endOfVideoRect").attr("fill",io(n.stylesWithDefaults.flipTo.backgroundColor,o.render.color.percentDiff))})).on("mouseleave",(function(){Nn(this).select(".endOfVideoRect").attr("fill",n.stylesWithDefaults.flipTo.backgroundColor)})),s.append("rect").attr("class","endOfVideoRect").attr("width",o.render.node.width).attr("height",o.render.node.componentControlHeight).attr("fill",n.stylesWithDefaults.flipTo.backgroundColor).attr("y",a),s.append("use").style("color",o.render.color.text).attr("x",i+8).attr("y",a+14).attr("href","#".concat(l.EndOfVideo)),s.append("text").text(o.translation.node_eov).attr("font-weight",400).attr("x",i+8+o.render.iconSize+6).attr("y",a+26).style("fill",n.stylesWithDefaults.flipTo.textColor).attr("text-rendering","optimizeSpeed")},Ma=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},ka=function(t,e){t.append("rect").attr("fill","transparent").attr("height",e).attr("width",e).attr("x",-e/2).attr("y",-e/2)},Sa=function(t,e){var n=Ma(e,2),r=n[0],i=n[1],a=Nr("svg:g").attr("id",o.render.prefix.nodeFlipConnector+t.id).attr("class","nodeConnector").style("transform","translate(".concat(r,"px, ").concat(i,"px)")).style("display","inline");return ka(a,8),a.append("svg:use").attr("href","#".concat(t.displayLockedContent?ao.Connector:ao.ConnectorDisabled)),a.node()},Ia=function(t){var e=Ma(t.getIncomingConnectorsCoordinates()[ei.Action]||[0,t.render.previewMiddleYCoordinate],2),n=e[0],r=e[1];return n-=o.render.node.control.connectorRadius,r-=o.render.node.control.connectorRadius,mo(l.Action).attr("transform","translate(".concat(n,", ").concat(r,")")).attr("id",o.render.prefix.nodeActionConnector+t.id).attr("class","nodeActionConnector").style("display",t.hasParentChapters(ei.Action)?"inline":"none").node()},Na=function(t){var e=Ma(t.getIncomingConnectorsCoordinates()[ei.Inaction]||[0,t.render.previewMiddleYCoordinate],2),n=e[0],r=e[1];return n-=o.render.node.control.connectorRadius,r-=o.render.node.control.connectorRadius,mo(l.Inaction).attr("transform","translate(".concat(n,", ").concat(r,")")).attr("id",o.render.prefix.nodeInactionConnector+t.id).attr("class","nodeActionConnector").style("display",t.hasParentChapters(ei.Inaction)?"inline":"none").node()},La=o.render.iconSize/2,Oa=function(t){var e=Nr("svg:g");return e.append("path").attr("fill","none").attr("stroke",o.render.color.stroke).attr("d",yo({source:[0,0],target:[23,0]})).attr("pointer-events","none"),e.append((function(){return mo(t).attr("transform","translate(".concat(-o.render.node.control.connectorRadius,", ").concat(-o.render.node.control.connectorRadius,")")).node()})),e},Ta=o.render.iconSize/2,Aa=o.render.iconSize/2,Pa="#7B68EE",ja=function(t){var e=t.render.width,n=o.render.node.heightWithPreview+o.render.node.componentControlHeight/2,r=t.getSuspenseActionType(),i="setNextBranch"===r?2*o.render.tool.eov.size:o.render.tool.eov.size,a=Nr("svg:g").attr("id",o.render.prefix.nodeEOV+t.id).attr("stroke",o.render.color.stroke).attr("stroke-width",o.render.strokeSize);return a.append("path").attr("class","eovTypeLine").attr("fill","none").attr("d",yo({source:[e,n],target:[e+i,n]})).attr("pointer-events","none").style("marker-start","url(#".concat(c.Circle)).style("marker-end",t.getSuspenseBranchId()?"":"url(#".concat(c.Circle)),"setNextBranch"!==r||t.getSuspenseBranchId()||a.append("rect").attr("fill","transparent").attr("stroke","none").attr("x",e+i-Aa/2).attr("y",n-Aa/2).attr("width",Aa).attr("height",Aa).on("mouseenter",(function(r){r.buttons||fs.tools.use(pa.ShadowNodeLink).data(t,ei.Flip).position([t.styles.x+e+i,n+t.styles.y]).start()})).on("mouseleave",(function(){})),a.append((function(){return Ba(t,[e+11,n-16]).attr("transform","translate(".concat(e+12,", ").concat(n-12,")")).node()})),a.node()},Ba=function(t,e){var n=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(e,2),r=n[0],i=n[1],a=Nr("svg:g");return a.on("click",(function(e){if(!o.isViewOrPreViewMode()){e.preventDefault();var n=fs.inputs.zoom.getRelativeCoordinates([t.styles.x+r,t.styles.y+i],!0);fs.tools.use(pa.EOVMenu).data(t).position(n).start(),Nn(this).select(".eovButtonBg").attr("stroke",o.render.color.stroke).attr("fill",o.render.color.elementBackground)}})).on("mouseenter",(function(){o.isViewOrPreViewMode()||Nn(this).select(".eovButtonBg").attr("stroke",Pa).attr("fill",Pa)})).on("mouseleave",(function(){o.isViewOrPreViewMode()||Nn(this).select(".eovButtonBg").attr("stroke",o.render.color.stroke).attr("fill",o.render.color.elementBackground)})).call(fs.inputs.nullableDrag()),a.append("path").attr("class","eovButtonBg").attr("stroke",o.render.color.stroke).attr("fill",o.render.color.elementBackground).attr("d",so({x:0,y:0,w:o.render.tool.eov.size,h:o.render.tool.eov.size,r:o.render.tool.eov.radius})),a.append("use").style("color",o.render.tool.textColor).attr("x",5).attr("y",5).attr("width",12).attr("height",12).attr("viewBox","0 0 ".concat(o.render.iconSize," ").concat(o.render.iconSize)).attr("href","#".concat(Va(t.getSuspenseActionType()))),a},Va=function(t){switch(t){case"setNextBranch":return l.Node;case"setRandomBranch":return l.Random;default:return l.Add}},za=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ra=function(t,e){var n=this;this.clear=function(){n._layer.selectAll("*").remove()},this.allowReRendering=function(){return!0},this._layer=t.append("g").attr("id",e)},Da=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fa=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ha="mge-node",Za=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._needForRAF=!0,e.render=function(){e._nodes=e._layer.selectAll("g.".concat(Ha)).data(pi.manifest.nodes).join("g").attr("class",Ha).attr("id",(function(t){return t.id})).attr("transform",(function(t){return"translate(".concat(t.styles.x,", ").concat(t.styles.y,")")})).on("contextmenu",(function(t,e){t.preventDefault();var n=fs.dom.getRelativeEventCoordinates(t,fs.dom.staticTools.node());fs.tools.use(pa.NodeMenu).data(e).position(n).start()})).on("click",(function(t,n){o.isViewMode()||(t.preventDefault(),e.processNodeSelection(n))})).on("mousedown",(function(t,n){o.isViewMode()||1===t.button||pi.selectedNodes.has(n.id)||fs.inputs.keydown.shiftHold||e.processNodeSelection(n)})).on("mouseenter touchstart",(function(t,n){return e.onNodeMouseEnter(n)}),{passive:!0}).on("mouseleave",(function(t,n){return e.onNodeMouseLeave(n)})).call(o.isEditOrPreViewMode()?e.initNodeDrag():function(){}),e._nodes.append((function(t){return function(t){var e,n,r,i=Nr("svg:g").attr("class","nodeContent");if(o.isEditMode()){var a=o.render.node.heightWithPreviewEov,s=a+o.render.node.componentAddActionHeight;oa(i,[0,0],t),ua(i,[0,o.render.node.headerHeight],t),t.isEndNode()||(Ea(i,[0,o.render.node.heightWithPreview+1],t),function(t,e,n){var r=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(e,2),i=r[0],a=r[1],s=t.append("g").attr("class","addAction").style("cursor","pointer").on("click",(function(t){var e=fs.dom.getRelativeEventCoordinates(t,fs.dom.staticTools.node());fs.tools.use(pa.ControlTypeMenu).data(n).position(e).start()})).on("mouseenter",(function(){Nn(this).select(".addActionRect").attr("fill","#626366")})).on("mouseleave",(function(){Nn(this).select(".addActionRect").attr("fill",_a)}));s.append("rect").attr("x",i).attr("y",a).attr("width",n.render.width).attr("height",o.render.node.componentAddActionHeight).attr("fill",o.render.color.elementBackground).attr("stroke-width",o.render.strokeSize).attr("stroke",o.render.color.elementStroke),s.append("path").attr("class","addActionRect").attr("d",(function(){return so({x:i+8,y:a+8,w:n.render.width-16,h:o.render.node.componentAddActionHeight-16,r:8})})).attr("fill",_a),s.append("text").text(o.translation.node_add_control).attr("font-weight",600).attr("text-anchor","middle").style("fill",o.render.color.text).attr("x",n.render.width/2).attr("y",a+24).attr("text-rendering","optimizeSpeed")}(i,[0,a],t),ba(i,[0,s],t))}else s=(null===(e=t.stylesWithDefaults.flipTo)||void 0===e?void 0:e.enabled)?o.render.node.heightWithPreviewEov:o.render.node.heightWithPreview+1,oa(i,[0,0],t),ua(i,[0,o.render.node.headerHeight],t),t.isEndNode()||((null===(n=t.stylesWithDefaults.flipTo)||void 0===n?void 0:n.enabled)&&Ea(i,[0,o.render.node.heightWithPreview+1],t),(null===(r=t.stylesWithDefaults.controls)||void 0===r?void 0:r.enabled)&&ba(i,[0,s],t));return ho({id:t.id,width:t.render.width,height:t.render.height,element:i}),i.node()}(t)})),e._nodes.append((function(t){return function(t){return Nr("svg:path").attr("class","border").attr("id",o.render.prefix.nodeBorder+t.id).attr("d",(function(){return so({x:1,y:1,w:t.render.width-2,h:t.render.height-2,r:o.render.node.borderRadius})})).attr("fill","none").attr("stroke-width",o.render.strokeSize+1).attr("stroke",t.stylesWithDefaults.hover.borderColor).style("pointer-events","none").style("display","none").node()}(t)})),e._nodes.append((function(t){return function(t){var e=t.render.width-o.render.node.componentOrderRadius,n=-o.render.node.componentOrderRadius,r=Nr("svg:g").attr("class","nodeOrder").attr("transform","translate(".concat(e,", ").concat(n,")")).style("color","#19191A");return"simple"!==t.chapter.order&&(r.append("use").attr("href","#".concat(ao.Order)),r.append("use").attr("y",o.render.node.componentOrderRadius-o.render.iconSize/2).attr("x",o.render.node.componentOrderRadius-o.render.iconSize/2).attr("href","#".concat(function(t){switch(t.chapter.order){case"start":return l.StartNode;case"end":return l.EndNode;case"simple":return l.Node}}(t)))),r.node()}(t)})),e._nodes.append((function(t){return o.isEditMode()?function(t){var e,n,r=Nr("svg:g").attr("class","nodeTools");if(r.append((function(){return function(t){var e=Ma(t.getIncomingConnectorsCoordinates()[ei.Flip]||[0,t.render.previewMiddleYCoordinate],2)[1],n=Nr("svg:g").attr("id",o.render.prefix.nodeFlipConnector+t.id).attr("class","nodeConnector").style("transform","translateY(".concat(e,"px)")).style("display",t.hasParentChapters(ei.Flip)?"inline":"none");return ka(n,8),n.append("svg:use").attr("href","#".concat(ao.Connector)),n.node()}(t)})),r.append((function(){return Ia(t)})),r.append((function(){return Na(t)})),t.isEndNode())return r.node();r.append((function(){return ja(t)}));var i=0,a=function(e){t.getContainerControls(e.id).forEach((function(n){var a,s,c=null===(a=n.events)||void 0===a?void 0:a.some((function(t){return"onClick"===t.type&&"setNextBranch"===t.action.type})),d=null===(s=e.events)||void 0===s?void 0:s.some((function(t){return"onSuspense"===t.type&&"setNextBranch"===t.action.type}));c&&d||r.append((function(){return function(t,e,n,r){var i,a,s,c,d=!1,u=null===(i=e.events)||void 0===i?void 0:i.some((function(t){return"onSuspense"===t.type&&"setNextBranch"===t.action.type})),h=null===(a=n.events)||void 0===a?void 0:a.some((function(t){return"onClick"===t.type&&"setNextBranch"===t.action.type}));c=u||h?h?o.render.node.control.inactionLinkY:o.render.node.control.actionLinkY:(o.render.node.control.actionLinkY+o.render.node.control.inactionLinkY)/2;var p=o.render.node.componentControlHeight*r,f=t.render.controlsContainerYCoordinate+p,v=Nr("svg:g").attr("class","controlAddLinks").attr("transform","translate(".concat(t.render.width,", ").concat(f,")")).call(fs.inputs.nullableDrag()),m=Nr("svg:g").attr("class","control_link_choice_".concat(e.id)).attr("display","none").on("mouseenter",(function(){Nn(this).attr("display","inline"),b.attr("display","inline"),w.attr("stroke",o.render.color.stroke)})).on("mouseleave",(function(t){t.toElement.closest("#shadow-node-link")||(Nn(this).attr("display","none"),b.attr("display","none"),w.attr("stroke",o.render.color.connectorStroke))}));if(m.append("rect").attr("fill","transparent").attr("x",0).attr("y",0).attr("width",o.render.node.componentControlHeight).attr("height",o.render.node.componentControlHeight),!h){m.append((function(){return mo(l.Action).attr("transform","translate(15, ".concat(o.render.node.control.actionLinkY-o.render.node.control.connectorRadius,")")).on("mouseenter",(function(r){r.buttons||fs.tools.use(pa.ShadowNodeLink).data(t,ei.Action,e,n,!1).position([t.styles.x+t.render.width+23,t.styles.y+f+o.render.node.control.actionLinkY]).start()})).node()})),m.append("path").attr("fill","none").attr("stroke",o.render.color.stroke).attr("d",yo({source:[7,c],target:[16,o.render.node.control.actionLinkY]})).attr("pointer-events","none");var y=Oa(l.Action).attr("class","start_link_".concat(n.id)).attr("transform","translate(0, ".concat(o.render.node.control.actionLinkY,")")).attr("display","none");v.append((function(){return y.node()}))}if(!u){var g="expect"===(null===(s=Jo("onSuspense",e.events))||void 0===s?void 0:s.action.type);m.append((function(){return mo(l.Inaction,!1,g).attr("transform","translate(15, ".concat(o.render.node.control.inactionLinkY-o.render.node.control.connectorRadius,")")).on("mouseenter",(function(r){if(!g||d)r.buttons||fs.tools.use(pa.ShadowNodeLink).data(t,ei.Inaction,e,n,!1).position([t.styles.x+t.render.width+23,t.styles.y+f+o.render.node.control.inactionLinkY]).start();else{d=!0;var i=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(fs.dom.getRelativeEventCoordinates(r,fs.dom.staticTools.node()),2),a=i[0],s=i[1];fs.popups.position([a,s+10]).show(o.translation.tooltip_inaction_not_available,void 0,"tooltip")}})).on("mouseleave",(function(){g&&d&&(d=!1,fs.popups.hide())})).node()})),m.append("path").attr("fill","none").attr("stroke",o.render.color.stroke).attr("d",yo({source:[7,c],target:[16,o.render.node.control.inactionLinkY]})).attr("pointer-events","none");var _=Oa(l.Inaction).attr("class","start_link_".concat(e.id)).attr("transform","translate(0, ".concat(o.render.node.control.inactionLinkY,")")).attr("display","none");v.append((function(){return _.node()}))}v.append((function(){return m.node()}));var b=mo(l.Plus,!0).attr("transform","translate(".concat(-o.render.node.control.connectorRadius,", ").concat(c-o.render.node.control.connectorRadius,")")).attr("class","control_add_link_button_".concat(n.id)).attr("display","none").on("mouseenter",(function(){Nn(this).attr("display","inline"),m.attr("display","inline"),w.attr("stroke",o.render.color.stroke)})).on("mouseleave",(function(){Nn(this).attr("display","none"),m.attr("display","none"),w.attr("stroke",o.render.color.connectorStroke)})),w=b.select(".connector_circle");return w.attr("stroke",o.render.color.connectorStroke),v.append((function(){return b.node()})),v.node()}(t,e,n,i)})),c&&r.append((function(){return function(t,e,n,r){var i,a=o.render.node.componentControlHeight*r,s=t.render.controlsContainerYCoordinate+o.render.node.control.actionLinkY+a,c=!!(null===(i=n.events)||void 0===i?void 0:i.some((function(t){return t.action.args.branchId}))),d=Nr("svg:g").attr("class","controlActionLink").attr("transform","translate(".concat(t.render.width,", ").concat(s,")"));d.append((function(){return mo(l.Action).attr("transform","translate(".concat(-o.render.node.control.connectorRadius,", ").concat(-o.render.node.control.connectorRadius,")")).on("mouseenter",(function(){c||u.style("display","inline")})).node()}));var u=mo(l.Minus,!0).attr("transform","translate(".concat(-o.render.node.control.connectorRadius,", ").concat(-o.render.node.control.connectorRadius,")")).style("display","none").on("mouseleave",(function(){u.style("display","none")})).on("click",(function(){t.updateControlActionEvent(e,n,"continuePlayback"),pi.manifest.save(),fs.tools.use(pa.ShadowNodeLink).stop()}));return d.append((function(){return u.node()})),c||(d.on("mouseenter",(function(r){r.buttons||fs.tools.use(pa.ShadowNodeLink).data(t,ei.Action,e,n).position([t.styles.x+t.render.width+o.render.node.control.lineLength,t.styles.y+s]).start()})).on("mouseleave",(function(){})).call(fs.inputs.nullableDrag()),d.append("rect").attr("fill","transparent").attr("x",o.render.node.control.lineLength-La/2).attr("y",-La/2).attr("width",La).attr("height",La),d.append("path").attr("fill","none").attr("stroke",o.render.color.stroke).attr("d",yo({source:[7,0],target:[o.render.node.control.lineLength,0]})).attr("pointer-events","none"),d.append("use").attr("class","control_connector_".concat(n.id)).attr("x",o.render.node.control.lineLength).attr("y",0).attr("href","#".concat(ao.Connector))),d.node()}(t,e,n,i)})),d&&r.append((function(){return function(t,e,n,r){var i,a=o.render.node.componentControlHeight*r,s=t.render.controlsContainerYCoordinate+o.render.node.control.inactionLinkY+a,c=!!(null===(i=e.events)||void 0===i?void 0:i.some((function(t){return t.action.args.branchId}))),d=Nr("svg:g").attr("class","controlInactionLink").attr("transform","translate(".concat(t.render.width,", ").concat(s,")"));d.append((function(){return mo(l.Inaction).attr("transform","translate(".concat(-o.render.node.control.connectorRadius,", ").concat(-o.render.node.control.connectorRadius,")")).on("mouseenter",(function(){c||u.style("display","inline")})).node()}));var u=mo(l.Minus,!0).attr("transform","translate(".concat(-o.render.node.control.connectorRadius,", ").concat(-o.render.node.control.connectorRadius,")")).style("display","none").on("mouseleave",(function(){u.style("display","none")})).on("click",(function(){t.updateContainerSuspenseAction(e,"continuePlayback"),pi.manifest.save(),fs.tools.use(pa.ShadowNodeLink).stop()}));return d.append((function(){return u.node()})),c||(d.on("mouseenter",(function(r){r.buttons||fs.tools.use(pa.ShadowNodeLink).data(t,ei.Inaction,e,n).position([t.styles.x+t.render.width+o.render.node.control.lineLength,t.styles.y+s]).start()})).on("mouseleave",(function(){})).call(fs.inputs.nullableDrag()),d.append("rect").attr("fill","transparent").attr("x",o.render.node.control.lineLength-Ta/2).attr("y",-Ta/2).attr("width",Ta).attr("height",Ta),d.append("path").attr("fill","none").attr("stroke",o.render.color.stroke).attr("d",yo({source:[7,0],target:[o.render.node.control.lineLength,0]})).attr("pointer-events","none"),d.append("use").attr("class","control_connector_".concat(e.id)).attr("x",o.render.node.control.lineLength).attr("y",0).attr("href","#".concat(ao.Connector))),d.node()}(t,e,n,i)})),i++}))};try{for(var s=za(t.containers().reverse()),c=s.next();!c.done;c=s.next())a(c.value)}catch(t){e={error:t}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return r.node()}(t):function(t){var e,n,r,i,a,s,c,d=Nr("svg:g").attr("class","nodeTools"),u=t.getIncomingConnectorsCoordinates();if(Object.keys(u).forEach((function(e){switch(e){case ei.Flip:d.append((function(){return Sa(t,u[e])}));break;case ei.Action:d.append((function(){return Ia(t)}));break;case ei.Inaction:d.append((function(){return Na(t)}))}})),(null===(r=t.stylesWithDefaults.controls)||void 0===r?void 0:r.enabled)&&!t.isEndNode()){var h=0,p=function(e){t.getContainerControls(e.id).forEach((function(n){var r,i,a=null===(r=n.events)||void 0===r?void 0:r.some((function(t){return"onClick"===t.type&&"setNextBranch"===t.action.type})),s=null===(i=e.events)||void 0===i?void 0:i.some((function(t){return"onSuspense"===t.type&&"setNextBranch"===t.action.type}));a&&d.append((function(){return function(t,e){var n=o.render.node.componentControlHeight*e,r=t.render.controlsContainerYCoordinate+o.render.node.control.actionLinkY+n,i=Nr("svg:g").attr("transform","translate(".concat(t.render.width,", ").concat(r,")"));return i.append((function(){return mo(l.Action).attr("transform","translate(".concat(-o.render.node.control.connectorRadius,", ").concat(-o.render.node.control.connectorRadius,")")).node()})),i.node()}(t,h)})),s&&d.append((function(){return function(t,e){var n=o.render.node.componentControlHeight*e,r=t.render.controlsContainerYCoordinate+o.render.node.control.inactionLinkY+n,i=Nr("svg:g").attr("transform","translate(".concat(t.render.width,", ").concat(r,")"));return i.append((function(){return mo(l.Inaction).attr("transform","translate(".concat(-o.render.node.control.connectorRadius,", ").concat(-o.render.node.control.connectorRadius,")")).node()})),i.node()}(t,h)})),h++}))};try{for(var f=za(t.containers().reverse()),v=f.next();!v.done;v=f.next())p(v.value)}catch(t){e={error:t}}finally{try{v&&!v.done&&(n=f.return)&&n.call(f)}finally{if(e)throw e.error}}}return t.isEndNode()||((!(null===(i=t.stylesWithDefaults.flipTo)||void 0===i?void 0:i.enabled)&&t.hasBranches(ei.Flip)||!(null===(a=t.stylesWithDefaults.controls)||void 0===a?void 0:a.enabled)&&t.hasBranches(ei.Action)||!(null===(s=t.stylesWithDefaults.controls)||void 0===s?void 0:s.enabled)&&t.hasBranches(ei.Inaction))&&d.append((function(){return Sa(t,[t.render.width,t.render.previewMiddleYCoordinate])})),(null===(c=t.stylesWithDefaults.flipTo)||void 0===c?void 0:c.enabled)&&d.append((function(){return ja(t)}))),d.node()}(t)})),e.updateSelected()},e.updateSelected=function(){var t,n;fs.dom.selectAll(".".concat(Ha)).each((function(t){fs.dom.select(vo(t.id)).attr("stroke",e.getNodeBorderColor(t)).attr("stroke-opacity",pi.manifest.displayNodeErrors&&t.hasErrors()?.21:1),pi.selectedNodes.has(t.id)?(e.applySelectedNode(t),ha(t,!0),ia(t,!0)):(e.applyDefaultNode(t),ha(t,!1),ia(t,!1))}));try{for(var r=Fa(pi.manifest.nodes),o=r.next();!o.done;o=r.next()){var i=o.value;pi.selectedNodes.has(i.id)||Ji(i.id).lower()}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.setHovered=function(t){var n,r,o,i,a=new Set(t);try{for(var s=Fa(pi.hoveredNodes.values()),l=s.next();!l.done;l=s.next()){var c=l.value;(h=pi.manifest.getGraphNodeById(c))&&!a.has(h.id)&&e.onNodeMouseLeave(h)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}try{for(var d=Fa(a.values()),u=d.next();!u.done;u=d.next()){var h,p=u.value;(h=pi.manifest.getGraphNodeById(p))&&!pi.hoveredNodes.has(h.id)&&e.onNodeMouseEnter(h)}}catch(t){o={error:t}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}},e}return Da(e,t),e.prototype.onNodeMouseEnter=function(t){pi.selectedNodes.has(t.id)||(o.isViewMode()&&t.stylesWithDefaults.hover.enabled?Nn(vo(t.id)).attr("stroke",t.stylesWithDefaults.hover.borderColor):Nn(vo(t.id)).attr("stroke",t.stylesWithDefaults.hover.borderColor).attr("stroke-opacity",1),pi.addNodesToHovered([t.id]))},e.prototype.onNodeMouseLeave=function(t){pi.selectedNodes.has(t.id)||(fs.dom.select(vo(t.id)).attr("stroke",this.getNodeBorderColor(t)).attr("stroke-opacity",pi.manifest.displayNodeErrors&&t.hasErrors()?.21:1),pi.removeNodesFromHovered([t.id]))},e.prototype.applySelectedNode=function(t){fs.dom.select("#"+o.render.prefix.nodeBorder+t.id).style("display","inline")},e.prototype.applyDefaultNode=function(t){fs.dom.select("#"+o.render.prefix.nodeBorder+t.id).style("display","none")},e.prototype.getNodeBorderColor=function(t){return pi.manifest.displayNodeErrors&&t.hasErrors()?o.render.color.error:t.isConnected()?o.render.color.nodeStroke:"none"},e.prototype.processNodeSelection=function(t){fs.inputs.keydown.shiftHold?pi.selectedNodes.has(t.id)?pi.removeNodeFromSelected(t.id):pi.addNodeToSelected(t.id):pi.selectNodes([t.id]),this.updateSelected()},e.prototype.initNodeDrag=function(){var t=this,e=0,n=0;return Zn().clickDistance(50).on("start",(function(t,r){fs.tools.disable(),e=t.x-r.styles.x,n=t.y-r.styles.y})).on("drag",(function(r,i){pi.selectedNodes.has(i.id)&&t._needForRAF&&(t._needForRAF=!1,requestAnimationFrame((function(){i.isDragged=!0;var a=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(fs.grid.getSnappedCoordinates([r.x,r.y]),2),s=a[0],l=a[1],c=s-e-i.styles.x,d=l-n-i.styles.y;pi.selectedNodes.forEach((function(t){var r=pi.manifest.getGraphNodeById(t),o=t===i.id?s-e:r.styles.x+c,a=t===i.id?l-n:r.styles.y+d;Ji(t).datum(r.updatePosition(o,a)).attr("transform","translate(".concat(o,", ").concat(a,")"))})),pi.manifest.displayNodeErrors&&pi.selectedNodes.forEach((function(t){var e=pi.manifest.getGraphNodeById(t);e.hasErrors()&&fs.dom.select("#"+o.render.prefix.nodeError+e.id).attr("transform",Qi(e))})),pi.selectedNodes.forEach((function(t){!function(t){fs.dom.selectAll(".mge-branch").each((function(e){e.source.chapterId===t.id?Nn(this).datum(e.updateSourceAbsolutePosition([t.styles.x,t.styles.y])).select(".".concat(qi)).attr("d",yo({source:e.source.position.absolute,target:e.target.position.absolute})):e.target.chapterId===t.id&&Nn(this).datum(e.updateTargetAbsolutePosition([t.styles.x,t.styles.y])).select(".".concat(qi)).attr("d",yo({source:e.source.position.absolute,target:e.target.position.absolute}))}))}(pi.manifest.getGraphNodeById(t))})),t._needForRAF=!0})))})).on("end",(function(e,n){n.isDragged&&(n.isDragged=!1,pi.manifest.save()),t._needForRAF=!0}))},e}(Ra),$a=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wa=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Ya=function(t){function e(){var e=t.call(this,"shadow-node-link")||this;return e._displayToolError=!1,e.render=function(n){t.prototype.render.call(e,n),e._shadowNodeContainer=e.toolElement.append("g").style("display","none"),e._shadowNode=Ei(e._shadowNodeContainer);var r=Mi(e._shadowNodeContainer,o.translation.tool_shadow_node_link_text,o.translation.tool_shadow_node_error),i=r.primaryTextContainer,a=r.secondaryTextContainer;e._primaryText=i,e._secondaryText=a,e._shadowBranch=e.toolElement.append("path").attr("fill","none").attr("stroke",o.render.color.stroke),e.renderDefaultLine(),e.toolElement.append("rect").attr("fill","transparent").attr("x",-o.render.iconSize/2).attr("y",-o.render.iconSize/2).attr("width",o.render.iconSize).attr("height",o.render.iconSize).style("cursor","pointer"),e.toggleHoverEffects(!0)},e.stop=function(){e.renderDefaultLine(),e._node=void 0,e._parentControl=void 0,e._parentContainer=void 0,e._type=void 0,e.toolElement.call(fs.inputs.nullableDrag()),t.prototype.stop.call(e)},e.createSetNextBranchEvent=function(){var t,n;if(!e._hasSetNextBranchEvent&&e._type!==ei.Flip){switch(e._type){case ei.Action:null===(t=e._node)||void 0===t||t.updateControlActionEvent(e._parentContainer,e._parentControl,"setNextBranch");break;case ei.Inaction:null===(n=e._node)||void 0===n||n.updateContainerSuspenseAction(e._parentContainer,"setNextBranch")}pi.manifest.save()}},e.renderDefaultLine=function(){var t;null===(t=e._shadowBranch)||void 0===t||t.attr("d",yo({source:[0,0],target:[0,0]})).style("marker-start","").style("marker-end","")},e}return $a(e,t),e.prototype.start=function(){if(t.prototype.start.call(this),!this._node)throw new Error("[Tool]: ShadowNodeLinkTool requires 'GraphNode' data");this.redraw(this.toolElement.datum()),this.enableDrag(this._node)},e.prototype.data=function(t,e,n,r,o){return void 0===o&&(o=!0),this._node=t,this._parentContainer=n,this._parentControl=r,this._type=e,this._hasSetNextBranchEvent=o,this},e.prototype.enableDrag=function(t){var e,n,r,o=this,i=!1;Zn().on("start",(function(e){var i;pi.selectedNodes.has(t.id)||(pi.selectNodes([t.id]),fs.layers.updateSelected()),fs.dom.select("#nodes").attr("pointer-events","none"),fs.dom.select("#branches").attr("pointer-events","none"),o._type===ei.Flip?o.updateEOVTool():(null===(i=o._shadowBranch)||void 0===i||i.style("marker-start","url(#".concat(c.Connector,")")),o.updateControlTool());var a=fs.grid.getSnappedCoordinates(e.subject);n=e.subject[0]-a[0],r=e.subject[1]-a[1],o.toggleHoverEffects(!1)})).on("drag",(function(a){var s,l,d;o.toolElement.style("display","inline");var u=fs.grid.getSnappedCoordinates([a.x-a.subject[0],a.y-a.subject[1]]),h=u[0]-n,p=u[1]-r;null===(s=o._shadowBranch)||void 0===s||s.attr("d",yo({source:[0,0],target:[h,p]})).style("marker-start","").style("marker-end","url(#".concat(c.Connector,")")),(e=o.pointInsideNodeBBox(fs.dom.getRelativeEventCoordinates(a)))&&t.id!==e?(i=!1,null===(l=o._shadowNodeContainer)||void 0===l||l.style("display","none"),fs.dom.select(o.getNodeConnectorId(e)).style("display","inline"),fs.dom.select(vo(e)).attr("stroke","url(#".concat(ao.LinearGradient,")"))):(i=!0,null===(d=o._shadowNodeContainer)||void 0===d||d.attr("transform","translate(".concat(h,", ").concat(p-xi/2,")")).style("display","inline"),o.redraw(fs.dom.getRelativeEventCoordinates(a)))})).on("end",(function(n){var r;if(null===(r=o._shadowNodeContainer)||void 0===r||r.style("display","none"),o._type===ei.Flip?o.updateEOVTool(!1):o.updateControlTool(!1),fs.dom.select("#nodes").attr("pointer-events",null),fs.dom.select("#branches").attr("pointer-events",null),i)if(o._displayToolError)o.createSetNextBranchEvent();else{var a=Wa(fs.grid.getSnappedCoordinates(fs.dom.getRelativeEventCoordinates(n)),2),l=a[0],c=a[1];pi.manifest.createNode([l,fs.grid.getSnappedCoordinateValue(c-xi/2)],t.id,(function(t){o.createNodeBranch(t)})).updateBranches().save(),s.emit("events",{name:"addChapter"})}else e?(o.createNodeBranch(e),pi.manifest.updateBranches().save()):o.createSetNextBranchEvent();i=!1,e=void 0,o.toggleHoverEffects(!0),o.stop()}))(this.toolElement)},e.prototype.createNodeBranch=function(t){var e,n,r,o;this._parentControl?null===(e=this._node)||void 0===e||e.addBranch(t,this._type===ei.Action?null===(n=this._parentControl)||void 0===n?void 0:n.id:void 0,this._type===ei.Inaction?null===(r=this._parentContainer)||void 0===r?void 0:r.id:void 0):null===(o=this._node)||void 0===o||o.addBranch(t)},e.prototype.redraw=function(t){var e=Ii(this.getShadowNodeBox(t));this._displayToolError!==e&&(this._displayToolError=e,this.renderToolError())},e.prototype.renderToolError=function(){var t,e,n;null===(t=this._shadowNode)||void 0===t||t.attr("fill",this._displayToolError?o.render.color.error:o.render.color.shadowNodeFill).attr("fill-opacity","0.21").attr("stroke",this._displayToolError?o.render.color.error:o.render.color.shadowNodeStroke).attr("stroke-opacity","0.3"),null===(e=this._primaryText)||void 0===e||e.style("display",this._displayToolError?"none":"inline"),null===(n=this._secondaryText)||void 0===n||n.style("display",this._displayToolError?"inline":"none")},e.prototype.getShadowNodeBox=function(t){var e=Wa(t,2),n=e[0],r=e[1];return{minX:n,minY:r-xi/2,maxX:n+Ci,maxY:r+xi/2}},e.prototype.pointInsideNodeBBox=function(t){var e,n=this;return fs.dom.selectAll(".".concat(Ha)).each((function(r){e||(e=function(t,e){for(var n,r,o=t.length,i=t[o-1],a=e[0],s=e[1],l=i[0],c=i[1],d=!1,u=0;u<o;++u)n=(i=t[u])[0],(r=i[1])>s!=c>s&&a<(l-n)*(s-r)/(c-r)+n&&(d=!d),l=n,c=r;return d}(r.getPolygon(),[t[0]+0,t[1]])?r.id:void 0),e||r.hasParentChapters(n._type)||fs.dom.select(n.getNodeConnectorId(r.id)).style("display","none"),fs.dom.select(vo(r.id)).attr("stroke",n.getNodeBorderColor(r)).attr("stroke-opacity",pi.manifest.displayNodeErrors&&r.hasErrors()?.21:1)})),e},e.prototype.updateEOVTool=function(t){void 0===t&&(t=!0),this._node&&!this._parentControl&&fs.dom.select("#".concat(o.render.prefix.nodeEOV+this._node.id)).select(".eovTypeLine").style("marker-start","url(#".concat(c.Circle)).style("marker-end",t?"":"url(#".concat(c.Circle))},e.prototype.updateControlTool=function(t){var e,n,r,o;void 0===t&&(t=!0),fs.dom.select(".control_add_link_button_".concat(null===(e=this._parentControl)||void 0===e?void 0:e.id)).style("display","none"),fs.dom.select(".control_link_choice_".concat(null===(n=this._parentContainer)||void 0===n?void 0:n.id)).style("display","none");var i="action"===this._type?null===(r=this._parentControl)||void 0===r?void 0:r.id:null===(o=this._parentContainer)||void 0===o?void 0:o.id;fs.dom.select(".control_connector_".concat(i)).style("display",t?"none":"inline"),fs.dom.select(".start_link_".concat(i)).style("display","inline")},e.prototype.getNodeConnectorId=function(t){var e;switch(this._type){case ei.Action:e=o.render.prefix.nodeActionConnector;break;case ei.Inaction:e=o.render.prefix.nodeInactionConnector;break;default:e=o.render.prefix.nodeFlipConnector}return"#"+e+t},e.prototype.getNodeBorderColor=function(t){return pi.manifest.displayNodeErrors&&t.hasErrors()?o.render.color.error:t.isConnected()?o.render.color.nodeStroke:"none"},e.prototype.toggleHoverEffects=function(t){var e=this;t?this.toolElement.on("mouseenter",(function(){var t;e.toolElement.style("display","inline"),null===(t=e._shadowBranch)||void 0===t||t.style("marker-start",e._hasSetNextBranchEvent?"url(#".concat(c.Connector,")"):"")})).on("mouseleave",(function(){var t;null===(t=e._shadowBranch)||void 0===t||t.style("marker-start",e._hasSetNextBranchEvent?"url(#".concat(c.Circle,")"):"")})):this.toolElement.on("mouseenter",null).on("mouseleave",null)},e}(wi);!function(t){t.ShadowNode="shadow-node",t.ShadowNodeLink="shadow-node-link",t.NodeMenu="node-menu",t.EOVMenu="eov-menu",t.ControlMenu="control-menu",t.ControlTypeMenu="control-type-menu",t.EditorContextMenu="editor-context-menu",t.AreaSelectTool="area-select-tool"}(pa||(pa={}));var Ga=function(){function t(t){this._svgDOMElement=t,this.handleOutsideClick=function(t){t.defaultPrevented||fs.inputs.zoom.isMousedownZoomEnabled||fs.tools.disableContextMenu()},this._svgDOMElement.on("contextmenu",(function(t){t.defaultPrevented||fs.inputs.zoom.isMousedownZoomEnabled||fs.tools.use(pa.EditorContextMenu).position(Ln(t)).start()})),this._svgDOMElement.on("mousedown",(function(t){t.defaultPrevented||fs.inputs.zoom.isMousedownZoomEnabled||fs.tools.use(pa.AreaSelectTool).position(Ln(t)).start()})),this._svgDOMElement.on("click",(function(t){t.defaultPrevented||fs.inputs.zoom.isMousedownZoomEnabled||(pi.selectedBranches.size&&(pi.clearSelectedBranches(),fs.layers.updateSelected()),fs.tools.disable())})),document.addEventListener("click",this.handleOutsideClick)}return t.prototype.dispose=function(){this._svgDOMElement.on("contextmenu",null),document.removeEventListener("click",this.handleOutsideClick)},t}(),Xa=.1,qa=function(){function t(t){var e=this;this._svgDOMElement=t,this._zoomTransform=Ur,this._wheelDelay=300,this._wheel=null,this._mouse=[[0,0],[0,0]],this._mousedownZoomEnabled=!1,this._isZoomActive=!1,this._isZoomDisabled=!1,this.update=function(t){var n;e._isZoomDisabled||(n=Ua(n="function"==typeof t?t(e._zoomTransform.k):t),e._zoom.scaleTo(e._svgDOMElement,n))},this.translateTo=function(t,n){var r=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(t,2),o=r[0],i=r[1];if(void 0===n&&(n=e._zoomTransform.k),!e._isZoomDisabled){var a=e._svgDOMElement.node();if(a){var s=a.getBoundingClientRect(),l=s.width,c=s.height;if(!l||!c)return;var d=Ua(n);e._svgDOMElement.transition().duration(750).call(e._zoom.transform,Ur.translate(l/2,c/2).scale(d).translate(-o,-i))}}},this.getRelativeCoordinates=function(t,n){return n?e._zoomTransform.apply(t):e._zoomTransform.invert(t)},this.toggleMousedownZoom=function(){e._mousedownZoomEnabled?e.disableMousedownZoom():e.enableMousedownZoom()},this.enableMousedownZoom=function(){e._isZoomDisabled||(e._mousedownZoomEnabled=!0,fs.dom.root.attr("class","zoom_hand_tool"))},this.disableMousedownZoom=function(){e._isZoomDisabled||(e._mousedownZoomEnabled=!1,e._isZoomActive||fs.dom.root.attr("class",null))},this.enable=function(){e._isZoomDisabled=!1},this.disable=function(){e._isZoomDisabled=!0},this._zoom=function(){var t,e,n,r=Jr,o=to,i=oo,a=no,s=ro,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],d=250,u=Wr,h=Tt("start","zoom","end"),p=500,f=0,v=10;function m(t){t.property("__zoom",eo).on("wheel.zoom",x,{passive:!1}).on("mousedown.zoom",E).on("dblclick.zoom",M).filter(s).on("touchstart.zoom",k).on("touchmove.zoom",S).on("touchend.zoom touchcancel.zoom",I).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,e){return(e=Math.max(l[0],Math.min(l[1],e)))===t.k?t:new Xr(e,t.x,t.y)}function g(t,e,n){var r=e[0]-n[0]*t.k,o=e[1]-n[1]*t.k;return r===t.x&&o===t.y?t:new Xr(t.k,r,o)}function _(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function b(t,e,n,r){t.on("start.zoom",(function(){w(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){w(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,i=arguments,a=w(t,i).event(r),s=o.apply(t,i),l=null==n?_(s):"function"==typeof n?n.apply(t,i):n,c=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),d=t.__zoom,h="function"==typeof e?e.apply(t,i):e,p=u(d.invert(l).concat(c/d.k),h.invert(l).concat(c/h.k));return function(t){if(1===t)t=h;else{var e=p(t),n=c/e[2];t=new Xr(n,l[0]-e[0]*n,l[1]-e[1]*n)}a.zoom(null,t)}}))}function w(t,e,n){return!n&&t.__zooming||new C(t,e)}function C(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=o.apply(t,e),this.taps=0}function x(t,...e){if(r.apply(this,arguments)){var n=w(this,e).event(t),o=this.__zoom,s=Math.max(l[0],Math.min(l[1],o.k*Math.pow(2,a.apply(this,arguments)))),d=Ln(t);if(n.wheel)n.mouse[0][0]===d[0]&&n.mouse[0][1]===d[1]||(n.mouse[1]=o.invert(n.mouse[0]=d)),clearTimeout(n.wheel);else{if(o.k===s)return;n.mouse=[d,o.invert(d)],re(this),n.start()}Qr(t),n.wheel=setTimeout((function(){n.wheel=null,n.end()}),150),n.zoom("mouse",i(g(y(o,s),n.mouse[0],n.mouse[1]),n.extent,c))}}function E(t,...e){if(!n&&r.apply(this,arguments)){var o=t.currentTarget,a=w(this,e,!0).event(t),s=Nn(t.view).on("mousemove.zoom",(function(t){if(Qr(t),!a.moved){var e=t.clientX-d,n=t.clientY-u;a.moved=e*e+n*n>f}a.event(t).zoom("mouse",i(g(a.that.__zoom,a.mouse[0]=Ln(t,o),a.mouse[1]),a.extent,c))}),!0).on("mouseup.zoom",(function(t){s.on("mousemove.zoom mouseup.zoom",null),Bn(t.view,a.moved),Qr(t),a.event(t).end()}),!0),l=Ln(t,o),d=t.clientX,u=t.clientY;jn(t.view),Kr(t),a.mouse=[l,this.__zoom.invert(l)],re(this),a.start()}}function M(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,a=Ln(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(a),l=n.k*(t.shiftKey?.5:2),u=i(g(y(n,l),a,s),o.apply(this,e),c);Qr(t),d>0?Nn(this).transition().duration(d).call(b,u,a,t):Nn(this).call(m.transform,u,a,t)}}function k(n,...o){if(r.apply(this,arguments)){var i,a,s,l,c=n.touches,d=c.length,u=w(this,o,n.changedTouches.length===d).event(n);for(Kr(n),a=0;a<d;++a)l=[l=Ln(s=c[a],this),this.__zoom.invert(l),s.identifier],u.touch0?u.touch1||u.touch0[2]===l[2]||(u.touch1=l,u.taps=0):(u.touch0=l,i=!0,u.taps=1+!!t);t&&(t=clearTimeout(t)),i&&(u.taps<2&&(e=l[0],t=setTimeout((function(){t=null}),p)),re(this),u.start())}}function S(t,...e){if(this.__zooming){var n,r,o,a,s=w(this,e).event(t),l=t.changedTouches,d=l.length;for(Qr(t),n=0;n<d;++n)o=Ln(r=l[n],this),s.touch0&&s.touch0[2]===r.identifier?s.touch0[0]=o:s.touch1&&s.touch1[2]===r.identifier&&(s.touch1[0]=o);if(r=s.that.__zoom,s.touch1){var u=s.touch0[0],h=s.touch0[1],p=s.touch1[0],f=s.touch1[1],v=(v=p[0]-u[0])*v+(v=p[1]-u[1])*v,m=(m=f[0]-h[0])*m+(m=f[1]-h[1])*m;r=y(r,Math.sqrt(v/m)),o=[(u[0]+p[0])/2,(u[1]+p[1])/2],a=[(h[0]+f[0])/2,(h[1]+f[1])/2]}else{if(!s.touch0)return;o=s.touch0[0],a=s.touch0[1]}s.zoom("touch",i(g(r,o,a),s.extent,c))}}function I(t,...r){if(this.__zooming){var o,i,a=w(this,r).event(t),s=t.changedTouches,l=s.length;for(Kr(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),p),o=0;o<l;++o)i=s[o],a.touch0&&a.touch0[2]===i.identifier?delete a.touch0:a.touch1&&a.touch1[2]===i.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(i=Ln(i,this),Math.hypot(e[0]-i[0],e[1]-i[1])<v)){var c=Nn(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return m.transform=function(t,e,n,r){var o=t.selection?t.selection():t;o.property("__zoom",eo),t!==o?b(t,e,n,r):o.interrupt().each((function(){w(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},m.scaleBy=function(t,e,n,r){m.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},m.scaleTo=function(t,e,n,r){m.transform(t,(function(){var t=o.apply(this,arguments),r=this.__zoom,a=null==n?_(t):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(a),l="function"==typeof e?e.apply(this,arguments):e;return i(g(y(r,l),a,s),t,c)}),n,r)},m.translateBy=function(t,e,n,r){m.transform(t,(function(){return i(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),o.apply(this,arguments),c)}),null,r)},m.translateTo=function(t,e,n,r,a){m.transform(t,(function(){var t=o.apply(this,arguments),a=this.__zoom,s=null==r?_(t):"function"==typeof r?r.apply(this,arguments):r;return i(Ur.translate(s[0],s[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}),r,a)},C.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Nn(this.that).datum();h.call(t,this.that,new Gr(t,{sourceEvent:this.sourceEvent,target:m,type:t,transform:this.that.__zoom,dispatch:h}),e)}},m.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:Yr(+t),m):a},m.filter=function(t){return arguments.length?(r="function"==typeof t?t:Yr(!!t),m):r},m.touchable=function(t){return arguments.length?(s="function"==typeof t?t:Yr(!!t),m):s},m.extent=function(t){return arguments.length?(o="function"==typeof t?t:Yr([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):o},m.scaleExtent=function(t){return arguments.length?(l[0]=+t[0],l[1]=+t[1],m):[l[0],l[1]]},m.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(t){return arguments.length?(i=t,m):i},m.duration=function(t){return arguments.length?(d=+t,m):d},m.interpolate=function(t){return arguments.length?(u=t,m):u},m.on=function(){var t=h.on.apply(h,arguments);return t===h?m:t},m.clickDistance=function(t){return arguments.length?(f=(t=+t)*t,m):Math.sqrt(f)},m.tapDistance=function(t){return arguments.length?(v=+t,m):v},m}().scaleExtent([Xa,2]).clickDistance(50).on("start",(function(){e._isZoomActive=!0,e._mousedownZoomEnabled&&fs.dom.root.attr("class","zoom_hand_tool_active")})).on("zoom",(function(t){var n=t.transform;e._zoomTransform=n,e.zoom()})).on("end",(function(){e._isZoomActive=!1,e.zoomEnd(),fs.dom.root.attr("class",e._mousedownZoomEnabled?"zoom_hand_tool":null),fs.dom.map.attr("pointer-events",null)})),o.isEditOrPreViewMode()?(this._zoom.filter((function(t){var n="touchstart"===t.type,r="mousedown"===t.type;return!(e._isZoomDisabled||n&&t.defaultPrevented)&&(r&&1===t.button||n?(fs.dom.root.attr("class","zoom_hand_tool_active"),!0):r&&e._mousedownZoomEnabled)})),this._svgDOMElement.call(this._zoom).on("dblclick.zoom",null).on("wheel.zoom",(function(t){if(!e._isZoomDisabled){t.preventDefault(),t.stopImmediatePropagation();var n=Math.max(Xa,Math.min(2,e._zoomTransform.k*Math.pow(2,function(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey||t.metaKey?5:1)}(t)))),r=Ln(t);e._wheel?(e._mouse[0][0]===r[0]&&e._mouse[0][1]===r[1]||(e._mouse[1]=e._zoomTransform.invert(e._mouse[0]=r)),clearTimeout(e._wheel)):(e._mouse=[r,e._zoomTransform.invert(r)],re(e._svgDOMElement.node()),fs.dom.map.attr("pointer-events","none")),e._wheel=window.setTimeout((function(){e._wheel=null,e._svgDOMElement.call(e._zoom.transform,Ur.translate(e._zoomTransform.x,e._zoomTransform.y).scale(e._zoomTransform.k))}),e._wheelDelay),t.ctrlKey||t.metaKey?e._zoomTransform=Ka(function(t,e){return(e=Math.max(Xa,Math.min(2,e)))===t.k?t:new Xr(e,t.x,t.y)}(e._zoomTransform,n),e._mouse[0],e._mouse[1]):e._zoomTransform=Ka(e._zoomTransform,[e._mouse[0][0]-t.deltaX,e._mouse[0][1]-t.deltaY],e._mouse[1]),e._mouse[1]=e._zoomTransform.invert(e._mouse[0]),e.zoom()}}),{passive:!1})):this._svgDOMElement.call(this._zoom)}return Object.defineProperty(t.prototype,"zoomConfig",{get:function(){return{min:Xa,max:2,step:+.019.toFixed(5)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMousedownZoomEnabled",{get:function(){return this._mousedownZoomEnabled},enumerable:!1,configurable:!0}),t.prototype.zoom=function(){s.emit("zoom",{value:this._zoomTransform.k,x:this._zoomTransform.x,y:this._zoomTransform.y})},t.prototype.zoomEnd=function(){s.emit("zoomEnd",{value:this._zoomTransform.k,x:this._zoomTransform.x,y:this._zoomTransform.y})},t}();function Ua(t){if(t<Xa||t>2){if(t<Xa)return Xa;if(t>2)return 2}return t}function Ka(t,e,n){var r=e[0]-n[0]*t.k,o=e[1]-n[1]*t.k;return r===t.x&&o===t.y?t:new Xr(t.k,r,o)}var Qa=function(){function t(t){var e=this;this.dispose=function(){var t,n;null===(t=e._keydownEvents)||void 0===t||t.dispose(),null===(n=e._mouseEvents)||void 0===n||n.dispose()},this.nullableDrag=function(){return Zn().on("drag",null)},this._zoom=new qa(t),this._keydownEvents=new bi,o.isEditOrPreViewMode()&&(this._mouseEvents=new Ga(t))}return Object.defineProperty(t.prototype,"zoom",{get:function(){return this._zoom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keydown",{get:function(){return this._keydownEvents},enumerable:!1,configurable:!0}),t}(),Ja=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ts="mge-branch",es=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.render=function(){e._branches=e._layer.selectAll("g.".concat(ts)).data(pi.manifest.branches).join("g").attr("class",ts).attr("id",(function(t){return t.id})).style("cursor",o.isEditOrPreViewMode()?"pointer":"default").on("contextmenu",(function(t){t.preventDefault()})).on("click",(function(t,n){o.isViewMode()||(t.preventDefault(),pi.selectBranches([n.id]),e.updateSelected())})).on("mouseenter",(function(t,n){o.isViewMode()||pi.selectedBranches.has(n.id)||e.applySelectedBranch(n)})).on("mouseleave",(function(t,n){o.isViewMode()||pi.selectedBranches.has(n.id)||e.applyDefaultBranch(n)})),e._branches.append((function(t){return function(t){var e=Nr("svg:path").attr("class","shadowBranchElement");return e.attr("d",yo({source:t.source.position.absolute,target:t.target.position.absolute})).attr("fill","none").attr("stroke","transparent").attr("stroke-width",o.render.strokeSize+5),e.node()}(t)})),e._branches.append((function(t){return function(t){var e=Nr("svg:path").attr("class",qi);return e.attr("d",yo({source:t.source.position.absolute,target:t.target.position.absolute})).attr("fill","none").attr("stroke",Ki(t)).attr("stroke-width",o.render.strokeSize),e.node()}(t)}))},e.updateSelected=function(){fs.dom.selectAll(".".concat(ts)).each((function(t){e.applyBranchColor(t)}))},e.setHovered=function(){},e}return Ja(e,t),e.prototype.applyBranchColor=function(t){fs.dom.select('[id="'.concat(t.id,'"]')).select(".".concat(qi)).attr("stroke",Ki(t))},e.prototype.applySelectedBranch=function(t){fs.dom.select('[id="'.concat(t.id,'"]')).select(".".concat(qi)).attr("stroke",Ui)},e.prototype.applyDefaultBranch=function(t){fs.dom.select('[id="'.concat(t.id,'"]')).select(".".concat(qi)).attr("stroke",o.render.color.stroke)},e}(Ra),ns=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),rs="mge-nodeError",os=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isTooltipActive=!1,e.setHovered=function(){},e}return ns(e,t),e.prototype.render=function(){var t=this;this._layer.selectAll("g.".concat(rs)).data(pi.manifest.nodesWithErrors).join("g").attr("class",rs).attr("id",(function(t){return o.render.prefix.nodeError+t.id})).attr("transform",(function(t){return Qi(t)})).append("use").attr("href","#".concat(qr.ErrorMarker)).on("mouseenter",(function(e,n){if(!t._isTooltipActive){t._isTooltipActive=!0;var r=fs.dom.getRelativeEventCoordinates(e);fs.popups.position(r).withScale().show(t.buildNodeErrorMessage(n),void 0,"tooltip")}})).on("mouseleave",(function(){t._isTooltipActive&&(t._isTooltipActive=!1,fs.popups.hide())}))},e.prototype.updateSelected=function(){},e.prototype.buildNodeErrorMessage=function(t){var e=this;return o.translation.error_node_message+"</br></br>"+t.chapterErrors.map((function(t){return"&nbsp;&nbsp;&#8226;&nbsp;&nbsp;".concat(e.getChapterErrorTranslation(t),"</br>")})).join("")},e.prototype.getChapterErrorTranslation=function(t){switch(t){case Co.NoVideo:return o.translation.error_no_video;case Co.NoEOV:return o.translation.error_no_eov;case Co.NoBranches:return o.translation.error_no_branches}},e}(Ra),is=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),as=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._hadInitialRender=!1,e.setHovered=function(){},e.allowReRendering=function(){return!e._hadInitialRender},e}return is(e,t),e.prototype.render=function(){var t,e;this._marker=(t=this._layer,e=t.append("g").attr("class","navigationMarker"),e.append("svg").attr("x",-o.render.iconSize).attr("y",0).attr("width",2*o.render.iconSize).attr("height",2*o.render.iconSize).attr("viewBox","0 0 ".concat(o.render.iconSize," ").concat(o.render.iconSize)).append("use").attr("href","#".concat(l.Location)),e).style("display","none"),this._hadInitialRender=!0},e.prototype.updateSelected=function(){if(this._marker)if(pi.selectedNodes.size){var t=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(pi.selectedNodes,1)[0],e=pi.manifest.getGraphNodeById(t),n=e.styles.x+e.render.width/2,r=e.styles.y-40;this._marker.attr("transform","translate(".concat(n,", ").concat(r,")")).style("display","inline").style("color",e.stylesWithDefaults.hover.borderColor)}else this._marker.style("display","none")},e}(Ra),ss=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ls=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},cs=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},ds=function(t){var e=this;this._editorMapElement=t,this.update=function(){var t,n;try{for(var r=ss(e._layers),o=r.next();!o.done;o=r.next()){var i=o.value;i.allowReRendering()&&(i.clear(),i.render())}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},this.updateSelected=function(){var t,n;try{for(var r=ss(e._layers),o=r.next();!o.done;o=r.next())o.value.updateSelected()}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},this.updateHovered=function(t){var n,r;try{for(var o=ss(e._layers),i=o.next();!i.done;i=o.next())i.value.setHovered(t)}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},this.dispose=function(){e._editorMapElement.selectAll("*").remove()},this._layers=cs(cs([new es(t,"branches"),new Za(t,"nodes")],ls(o.isEditMode()?[new os(t,"chapter-errors")]:[]),!1),ls(o.isViewMode()?[new as(t,"navigation")]:[]),!1)},us=function(){function t(t){var e=this;this._editorDOMElement=t,this._withScale=!1,this._zoom={x:0,y:0,value:1},this.show=function(t,n,r){void 0===r&&(r="popup"),e.renderPopup(t,n,r)},this.hide=function(){var t;e._currentPopupType="popup",e._popupPosition=void 0,e._withScale=!1,null===(t=e._popup)||void 0===t||t.remove()},this.position=function(t){return e._popupPosition=t,e},this.withScale=function(){return e._withScale=!0,e},this._currentPopupType="popup",s.on("zoom",(function(t){e._zoom=t,"popup"!==e._currentPopupType&&e.hide()}))}return t.prototype.renderPopup=function(t,e,n){if(this._currentPopupType=n,this._popup=this._editorDOMElement.append("div").attr("class","mge-editorPopup").style("min-width","popup"===n?"324px":"244px").style("pointer-events","popup"===n?"all":"none"),e&&this._popup.append("div").style("font-size",17).style("font-weight",600).html(e),this._popup.append("div").html(t),this._popupPosition)if(this._popup.style("top","0").style("left","0").style("transform-origin","top left"),this._withScale){var r=this._popupPosition[0]*this._zoom.value+this._zoom.x,o=this._popupPosition[1]*this._zoom.value+this._zoom.y;this._popup.style("transform","translate(".concat(r,"px, ").concat(o,"px) scale(").concat(this._zoom.value,")"))}else r=this._popupPosition[0],o=this._popupPosition[1],this._popup.style("transform","translate(".concat(r,"px, ").concat(o,"px)"));else this._popup.style("top","50%").style("left","50%"),this._withScale?this._popup.style("transform","translate(-50%, -50%) scale(".concat(this._zoom.value,")")):this._popup.style("transform","translate(-50%, -50%)")},t}(),hs=function(){function t(t,e){var n,r=this;this.use=function(t){return r.disable(),r._activeTool=t,r._tools[t].tool},this.disable=function(){r._activeTool&&(r._tools[r._activeTool].tool.stop(),r._activeTool=null)},this.disableContextMenu=function(){r._activeTool&&[pa.NodeMenu,pa.EOVMenu,pa.ControlMenu,pa.ControlTypeMenu,pa.EditorContextMenu].includes(r._activeTool)&&(r._tools[r._activeTool].tool.stop(),r._activeTool=null)},this._activeTool=null,this._tools=((n={})[pa.ShadowNode]={render:"map",tool:new Xi},n[pa.ShadowNodeLink]={render:"map",tool:new Ya},n[pa.NodeMenu]={render:"staticTools",tool:new $i},n[pa.EOVMenu]={render:"staticTools",tool:new Hi},n[pa.ControlMenu]={render:"staticTools",tool:new Bi},n[pa.ControlTypeMenu]={render:"staticTools",tool:new zi},n[pa.EditorContextMenu]={render:"staticTools",tool:new Di},n[pa.AreaSelectTool]={render:"staticTools",tool:new Oi},n);var o=t.append("g").attr("id","editor-tools");Object.values(this._tools).forEach((function(t){switch(t.render){case"map":t.tool.render(o);break;case"staticTools":t.tool.render(e)}}))}return Object.defineProperty(t.prototype,"activeTool",{get:function(){return this._activeTool},enumerable:!1,configurable:!0}),t}(),ps=function(){function t(t){this._editorDOMElement=t,this.renderGraphLegend(),this.renderNavigationLegend()}return t.prototype.dispose=function(){},t.prototype.renderGraphLegend=function(){var t=this._editorDOMElement.append("div").attr("class","mge-legend mge-graph");this.renderLegendItem(t,o.translation.graph_node_start,l.StartNode,12,!0),this.renderLegendItem(t,o.translation.graph_node_end,l.EndNode,12,!0),this.renderLegendItem(t,o.translation.graph_location,l.Location)},t.prototype.renderNavigationLegend=function(){var t=this._editorDOMElement.append("div").attr("class","mge-legend mge-navigation");this.renderLegendItem(t,o.translation.navigation_controls,l.LegendNavigation,28)},t.prototype.renderLegendItem=function(t,e,n,r,i){void 0===r&&(r=20),void 0===i&&(i=!1);var a=t.append("div").attr("class","mge-legendItem");a.append("div").attr("class",i?"mge-icon withBg":"mge-icon").append("svg").attr("x",0).attr("y",0).attr("width",r).attr("height",r).attr("viewBox","0 0 ".concat(o.render.iconSize," ").concat(o.render.iconSize)).append("use").attr("href","#".concat(n)),a.append("div").text(e)},t}();const fs=new(function(){function t(){}return t.prototype.init=function(t){this._dom=new vi(t),this._grid=new gi(this._dom.grid),this._defs=new _o(this._dom.defs),this._inputs=new Qa(this._dom.svg),this._layers=new ds(this._dom.map),this._popups=new us(this._dom.root),o.isEditOrPreViewMode()&&(this._tools=new hs(this._dom.map,this._dom.staticTools)),o.isViewMode()&&(this._legend=new ps(this._dom.root))},t.prototype.dispose=function(){var t,e,n,r,o,i,a,s;null===(t=this._legend)||void 0===t||t.dispose(),null===(e=this._tools)||void 0===e||e.disable(),null===(n=this._popups)||void 0===n||n.hide(),null===(r=this._layers)||void 0===r||r.dispose(),null===(o=this._inputs)||void 0===o||o.dispose(),null===(i=this._defs)||void 0===i||i.dispose(),null===(a=this._grid)||void 0===a||a.dispose(),null===(s=this._dom)||void 0===s||s.dispose()},Object.defineProperty(t.prototype,"dom",{get:function(){return this._dom||this.throwModuleError("DOM"),this._dom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layers",{get:function(){return this._layers||this.throwModuleError("Layers"),this._layers},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this._inputs||this.throwModuleError("Inputs"),this._inputs},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"popups",{get:function(){return this._popups||this.throwModuleError("Popups"),this._popups},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tools",{get:function(){return this._tools||this.throwModuleError("Tools"),this._tools},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grid",{get:function(){return this._grid||this.throwModuleError("Grid"),this._grid},enumerable:!1,configurable:!0}),t.prototype.throwModuleError=function(t){throw new Error(t+" manager was not initialized. Did you forget to init()?")},t}());var vs=function(){function t(t,e){var n=this;this.update=function(t){pi.reset(),pi.manifest.set(t),pi.setVisitedNodes([t.metadata.initChapterId]),n.reRenderAfterUpdate()},this.updateVideosInfo=function(t){try{pi.updateVideosInfo(t),pi.manifest.rebuildNodesAndBranches(),fs.layers.update()}catch(t){throw new Error("Argument type mismatch.")}},this.dispose=function(){pi.reset(),s.dispose(),fs.dispose()},this.zoom=function(t){bo(t)&&fs.inputs.zoom.update(t)},this.zoomTo=function(t){(function(t){return Array.isArray(t)&&bo(t[0])&&bo(t[1])})(t)&&fs.inputs.zoom.translateTo(t)},this.zoomConfig=function(){return fs.inputs.zoom.zoomConfig},this.zoomEnable=function(){fs.inputs.zoom.enable()},this.zoomDisable=function(){fs.inputs.zoom.disable()},this.selectChapter=function(t,e){void 0===e&&(e=!1),pi.selectNodes("string"==typeof t?[t]:t,!1),fs.layers.updateSelected();var r="string"==typeof t?t:t[0];e&&r&&n.focusChapter(r)},this.hoverOverChapters=function(t){var e=Array.isArray(t)?t:[t];fs.layers.updateHovered(e)},this.focusChapter=function(t,e){void 0===e&&(e=n.zoomConfig().max/2);var r=pi.manifest.getGraphNodeById(t);r&&fs.inputs.zoom.translateTo(r.getCenter(),e)},this.recenterGraph=function(){if(pi.manifest.nodes.length){var t=pi.manifest.getManifestBoundingBox(),e=fs.dom.getEditorWindowSize(),n=(t.maxX+t.minX)/2,r=(t.maxY+t.minY)/2,o=e.width/(t.maxX-t.minX),i=e.height/(t.maxY-t.minY),a=Math.min(Math.min(o,i),1)-.05;fs.inputs.zoom.translateTo([n,r],a)}},this.toggleChapterErrors=function(t){if(void 0===t&&(t=!0),!o.isEditMode())throw new Error("Only applicable in 'edit' mode");pi.manifest.setDisplayNodeErrors(t),fs.layers.update()},this.toggleAddChapterTool=function(t){if(void 0===t&&(t=!0),!o.isEditMode())throw new Error("Only applicable in 'edit' mode");if(t){var e=fs.inputs.zoom.getRelativeCoordinates([100,100]);fs.tools.use(pa.ShadowNode).position(e).start()}else fs.tools.disable()},this.toggleHandTool=function(t){fs.inputs.zoom.toggleMousedownZoom(),t(fs.inputs.zoom.isMousedownZoomEnabled)},this.setVisitedChapters=function(t){if(!o.isViewMode())throw new Error("Only applicable in 'view' mode");pi.setVisitedNodes(t),fs.layers.update()},this.setMode=function(t){if(["edit","pre_view"].includes(t)){if(!o.isEditOrPreViewMode())throw new Error("Only applicable in 'edit' mode");o.switchMode(t),pi.manifest.rebuildNodesAndBranches(),n.reRenderAfterUpdate()}},this.on=function(t,e){s.on(t,e)},o.init(e),fs.init(t)}return t.prototype.reRenderAfterUpdate=function(){pi.updatedSelectedElements(),fs.dom.updateEditorBackgroundColor(),fs.grid.update(),fs.layers.update(),fs.layers.updateSelected()},t}()})();var s=a.$},361189:(t,e,n)=>{n.d(e,{CustomError:()=>ft,EVENT_NAMES:()=>Ft,INTERACTIVE_CLICK_ACTIONS:()=>ct,Interactives:()=>an,SDKInfo:()=>yn,compareVersions:()=>et,graphEventTypes:()=>Ht,hasEndTemplate:()=>Pt,interactivesEventTypes:()=>Zt,isLastChapter:()=>At,isSupportedManifest:()=>ht,vkVideoIdsToChapterIds:()=>ue});var r=n(570912),o=n(615816),i=n(877741),a=n(172045),s=n(419249);function l(t,e=1){let n="0",r="0",o="0";return 4===t.length?(n="0x"+t[1]+t[1],r="0x"+t[2]+t[2],o="0x"+t[3]+t[3]):7===t.length&&(n="0x"+t[1]+t[2],r="0x"+t[3]+t[4],o="0x"+t[5]+t[6]),`rgba(${+n},${+r},${+o},${e})`}const c="SDK_NAME",d=()=>document.querySelector(".SDK_NAME-controls-container"),u={textColor:"#000",textSize:.4,textContent:"",roundCorners:0,borderWidth:0,borderColor:"#000",borderAlpha:1,backgroundColor:"#fff",backgroundAlpha:1,innerSizesDependOn:"self",angle:0},h={top:"flex-start",bottom:"flex-end",center:"center"},p={start:"flex-start",end:"flex-end",center:"center"},f={start:"left",end:"right",center:"center"},v=({target:t,props:e})=>{t.style.alignItems=h[e?.text?.gravityVertical]??h.center,t.style.justifyContent=p[e?.text?.gravityHorizontal]??p.center,t.style.textAlign=f[e?.text?.alignment]??f.start},m=({target:t,props:e,fallback:n,dependsOn:r})=>{t.style.color=e?.text?.color??n.textColor,t.style.fontSize=`calc(${r.height} * ${e?.text?.size??n.textSize})`,t.textContent=e?.text?.value??n.textContent},y=({target:t,props:e,fallback:n})=>{t.style.backgroundColor=l(e?.background?.color??n.backgroundColor,e?.background?.alpha??n.backgroundAlpha)},g=({target:t,props:e,fallback:n,dependsOn:r})=>{t.style.border=`calc(${r.height} * ${e?.shape?.border?.width??n.borderWidth}) solid ${l(e?.shape?.border?.color??n.borderColor,e?.shape?.border?.alpha??n.borderAlpha)}`,t.style.borderRadius=`calc(${r.height} * ${e?.shape?.roundCorners??n.roundCorners})`},_=({target:t,layoutParams:e,fallback:n})=>{t.style.transform=`rotate(${-e.angle}rad)`},b="int",w={AREA:`${b}_area`,TEXT:`${b}_text`,BUTTON:`${b}_bttn`};class C{createView(t){const e=document.createElement("div");e.classList.add(`${c}-control-container-${this.control.id}`),t(e,this.control.layoutParams);return{controlContainerEl:e,dependsOn:"self"===(this.control.layoutParams.innerSizesDependOn??u.innerSizesDependOn)?{height:e.style.height,width:e.style.width}:{height:"var(--interactive-content-height)",width:"var(--interactive-content-width)"}}}setEvents(t,e){t&&this.control.events.forEach((n=>{if("onclick"===n.type.trim().toLowerCase())t.addEventListener("click",(t=>{t.stopPropagation(),e&&e({action:n.action,controlId:this.control.id,controlType:this.control.type})}))}))}getElement(){return document.querySelector(`.${c}-control-container-${this.control.id}`)}constructor(t){this.control=t}}const x=t=>{if("area"===t.type.trim().toLowerCase())return new E(t)};class E extends C{createView({parent:t,layoutFn:e}){const{dependsOn:n,controlContainerEl:r}=super.createView(e),o=document.createElement("button");return o.classList.add(`${c}-${this.control.id}`),o.setAttribute("data-testid",w.AREA),o.style.display="flex",o.style.width="100%",o.style.height="100%",o.style.cursor="pointer",o.type="button",y({target:o,props:this.control.props,fallback:{...u,backgroundColor:"transparent"}}),g({target:o,props:this.control.props,fallback:{...u,borderAlpha:0},dependsOn:n}),_({target:o,layoutParams:this.control.layoutParams,fallback:u}),r.append(o),t.append(r),this.controlEl=o,r}disable(){this.controlEl&&(this.controlEl.style.cursor="default")}enable(){this.controlEl&&(this.controlEl.style.cursor="pointer")}getElement(){return document.querySelector(`.${c}-${this.control.id}`)}constructor(t){super(t)}}const M=t=>{if("button"===t.type.trim().toLowerCase())return new k(t)};class k extends C{createView({parent:t,layoutFn:e}){const{dependsOn:n,controlContainerEl:r}=super.createView(e),o=document.createElement("button");o.type="button",o.classList.add(`${c}-${this.control.id}`),o.setAttribute("data-testid",w.BUTTON),o.style.display="flex",o.style.width="100%",o.style.height="100%",o.style.cursor="pointer",o.style.fontFamily="inherit";const i=document.createElement("span");return i.style.display="inline-block",i.style.whiteSpace="pre",i.style.overflow="hidden",i.style.textOverflow="ellipsis",_({target:o,layoutParams:this.control.layoutParams,fallback:u}),y({target:o,props:this.control.props,fallback:u}),g({target:o,props:this.control.props,fallback:u,dependsOn:n}),v({target:o,props:this.control.props}),m({target:i,props:this.control.props,fallback:u,dependsOn:n}),o.append(i),r.append(o),t.append(r),this.controlEl=o,r}disable(){this.controlEl&&(this.controlEl.style.cursor="default")}enable(){this.controlEl&&(this.controlEl.style.cursor="pointer")}getElement(){return document.querySelector(`.${c}-${this.control.id}`)}constructor(t){super(t)}}const S=t=>{if("text"===t.type.trim().toLowerCase())return new I(t)};class I extends C{createView({parent:t,layoutFn:e}){const{dependsOn:n,controlContainerEl:r}=super.createView(e),o=document.createElement("div");o.classList.add(`${c}-${this.control.id}`),o.setAttribute("data-testid",w.TEXT),o.style.display="flex",o.style.width="100%",o.style.height="100%",o.style.fontFamily="inherit";const i=document.createElement("span");return i.style.whiteSpace="pre",_({target:o,layoutParams:this.control.layoutParams,fallback:u}),v({target:o,props:this.control.props}),m({target:i,props:this.control.props,fallback:u,dependsOn:n}),o.append(i),r.append(o),t.append(r),this.controlEl=o,r}disable(){}enable(){}getElement(){return document.querySelector(`.${c}-${this.control.id}`)}constructor(t){super(t)}}class N{constructor(t){this.layout=t}}class L extends N{setContainerLayout(t){t.style.position="relative"}setControlLayout(t,e){t.style.position="absolute",t.style.width=`calc(var(--interactive-content-width) * ${e.width})`,t.style.height=`calc(var(--interactive-content-height) * ${e.height})`,t.style.left=`calc(var(--interactive-content-width) * ${e.x} + ((var(--interactive-width) - var(--interactive-content-width)) / 2))`,t.style.top=`calc(var(--interactive-content-height) * ${e.y} + ((var(--interactive-height) - var(--interactive-content-height)) / 2))`}constructor(t){super(t)}}var O=(0,o._)("_s"),T=(0,o._)("_a");class A{addControlFactory(t,e){this.factories.set(t.trim().toLowerCase(),e),(0,r._)(this,O)[O]()}removeControlFactory(t){this.factories.delete(t.trim().toLowerCase()),(0,r._)(this,O)[O]()}constructor(t){Object.defineProperty(this,O,{value:P}),Object.defineProperty(this,T,{value:j}),this.container=t,this.factories=new Map,(0,r._)(this,O)[O]()}}function P(){this.controls=(0,r._)(this,T)[T]()}function j(){return this.container.controls?.reduce(((t,e)=>{const n=e.type.trim().toLowerCase(),r=this.factories.get(n);return r?[...t,r(e)]:[...t]}),[])}const B=(t,e)=>{if("choice"===t.type.trim().toLowerCase())return new V(t,e)};class V extends A{createView(t){const e=document.createElement("div");return e.classList.add(`${c}-${this.container.id}`),this.layout.setContainerLayout(e),this.controls.forEach((n=>{const r=n.createView({parent:e,layoutFn:this.layout.setControlLayout});n.setEvents(r,t)})),this.rootElement.append(e),this.isRemoved=!1,e}hide(){const t=this.getElement();t&&(t.style.visibility="hidden")}show(){const t=this.getElement();t&&(t.style.visibility="visible")}enable(){const t=this.getElement();t&&(this.controls.forEach((t=>t.enable())),t.style.opacity=1,this.isDisabled=!1)}disable(){const t=this.getElement();t&&(this.controls.forEach((t=>t.disable())),t.style.opacity=.4,this.isDisabled=!0)}removeView(){this.isRemoved||(this.getElement()?.remove(),this.isRemoved=!0)}getElement(){return this.rootElement.querySelector(`.${c}-${this.container.id}`)}constructor(t,e){super(t),this.rootElement=e??d(),this.layout=new L(this.container.layout),this.isRemoved=!1,this.isDisabled=!1,this.addControlFactory("button",M),this.addControlFactory("text",S),this.addControlFactory("area",x)}}function z(t,e){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>t(...r)),e)}}const R="Object",D="String",F="Array",H="Number",Z="Function",$=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`,W=t=>$(t,R),Y=t=>$(t,D),G=t=>$(t,F),X=t=>$(t,H),q=t=>X(t)&&!isNaN(t),U=t=>W(t)&&0===Object.keys(t).length,K=t=>G(t)&&!t.length,Q=(t,e)=>Y(t)&&(e?t.trim():t).length,J=window.navigator.userAgent.toLowerCase();/mobi/i.test(J);J.indexOf("android");class tt{init({root:t,onOpenPreviewClick:e,onError:n,lang:r,visitedChapters:o=[]}){this.isHidden=!0,this.currentManifestId=void 0,this.currentChapterId=void 0,this.visitedChapterIds=new Set(o),this.onOpenPreviewClick=e,this.onError=n,this.lang=r??"ru",this.zoom=.7,this.isReady=!1,this.lastZoomInfo=void 0,this.ngEditorSize=void 0,this.ngEditor=void 0,this.graphWrapperElement=function(t){const e=document.createElement("div");return e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.height="100%",e.style.width="100%",e.style.display="none",t.append(e),e}(t),this.resizeObserver=new ResizeObserver(z(this.onResize,250)),this.resizeObserver.observe(this.graphWrapperElement)}getNextPoint(t=this.ngEditorSize){return[(this.lastZoomInfo.x-t.width/2)/this.lastZoomInfo.value*-1,(this.lastZoomInfo.y-t.height/2)/this.lastZoomInfo.value*-1]}setVisitedChapters(t){this.visitedChapterIds=new Set([...this.visitedChapterIds,...t]),this.ngEditor.setVisitedChapters(Array.from(this.visitedChapterIds))}updateVideosInfo(t){this.ngEditor.updateVideosInfo(t)}show(){!this.ngEditor||!this.isReady||(this.graphWrapperElement.style.display="block",this.lastZoomInfo||this.ngEditor.focusChapter(this.currentChapterId),this.isHidden=!1)}hide(){this.graphWrapperElement.style.display="none",this.isHidden=!0}destroy(){this.hide(),this.resizeObserver.disconnect(),this.ngEditor?.setVisitedChapters([]),this.onOpenPreviewClick=void 0,this.ngEditor?.dispose(),this.graphWrapperElement.remove(),this.isReady=!1}constructor(t){this.onResize=t=>{this.isReady&&(!t[0].contentRect.width||!t[0].contentRect.height||(this.lastZoomInfo&&this.ngEditor.zoomTo(this.getNextPoint()),this.ngEditorSize={width:t[0].contentRect.width,height:t[0].contentRect.height}))},this.handleChapterChange=t=>{if(this.isReady){if(this.isHidden||this.hide(),!t?.id)return this.onError?.("Id is not found"),void console.error("Id is not found");this.visitedChapterIds.add(t.id),this.ngEditor.selectChapter(t.id),this.ngEditor.setVisitedChapters(Array.from(this.visitedChapterIds)),this.currentChapterId=t.id,this.lastZoomInfo=void 0}},this.handleManifestChange=async(t,e=[])=>{if(!X(t.graph.edit.chapters[0].x))return this.isReady=!1,this.onError?.("Can't show graph"),void console.error("Can't show graph");if(this.lastZoomInfo=void 0,!this.ngEditor){let t;try{t=await(0,i.loadVKLangPack)(this.lang,"video_interactive","videoint")}catch{console.log("Unable to load graph language pack")}const{GraphEditor:e}=await n.e(12039).then(n.bind(n,528610));this.ngEditor=new e(this.graphWrapperElement,{mode:"read",lang:this.lang,translation:t}),this.ngEditor.on("control",(({name:t,chapterId:e})=>{"openPreview"===t&&this.onOpenPreviewClick(e)})),this.ngEditor.on("zoomEnd",(t=>{this.lastZoomInfo={...t}}))}this.visitedChapterIds=new Set(e),t.metadata.id!==this.currentManifestId?(this.ngEditor.update(t),this.currentManifestId=t.metadata.id):this.ngEditor.setVisitedChapters(Array.from(this.visitedChapterIds)),this.isReady=!0},this.init(t)}}const et=(t="",e="")=>{t=t.split("."),e=e.split(".");let n=0;for(let r=0;r<Math.max(t.length,e.length)&&!n;r++)n=t[r]>e[r]?1:t[r]<e[r]?-1:0;return n},nt={default:"setNextBranch",random:"setRandomBranch",weightlessRandom:"setWeightlessRandomBranch",max:"setMaxWeightBranch",min:"setMinWeightBranch"},rt={type:"onSuspense",action:{type:"continuePlayback",args:{shouldOpenNow:!0,isDetachContainer:!0}}},ot=(t=[])=>({edit:{chapters:t},view:{}}),it={type:"onSuspense",action:{type:"expect",args:{shouldOpenNow:!0,isDetachContainer:!0}}},at=[{version:"3.0",migrate:t=>{const e=[];for(const n of t.chapters){let t;const r=[];for(const{isDefault:e,...o}of n.branches)e&&(t=o.id),r.push(o);let o=[];const i=[];for(const{fallbackStrategy:e,...r}of n.containers){const n=!!r.endTime;let s=[rt];switch(e){case"await":n?s=[]:o=[];break;case"default":{const e={type:"onSuspense",action:{type:nt.default,args:{branchId:t,shouldOpenNow:!n,isDetachContainer:!0}}};n?s=[e]:o=[e];break}case"random":case"weightlessRandom":case"max":case"min":{const t={type:"onSuspense",action:{type:nt[e],args:{}}};n?s=[t]:o=[t];break}}for(const t of r.controls)i.push({...r,controls:[{...t}],id:(0,a.default)(),events:s})}e.push({...n,containers:i,events:o,branches:r})}return t.metadata.version="3.1",t.metadata.updated=(new Date).toISOString(),{...t,chapters:e}}},{version:"3.1",migrate:t=>{if(!t.media){const{media:e,...n}=t.metadata;return{...t,metadata:{...n,version:"3.2"},media:e}}return t}},{version:"3.2",migrate:t=>{const e=[],n=[];for(const r of t.chapters){const{id:t,x:o,y:i,...a}=r,s=a.containers.map((t=>({...t,controls:t.controls.map((({subtype:t,type:e,...n})=>({...n,type:t??e}))),events:t.events?.length?t.events:[it]})));e.push({id:t,...a,containers:s,events:a.events?.length?a.events:[it]}),n.push({id:t,x:o,y:i})}return{...t,chapters:e,graph:ot(n),metadata:{...t.metadata,version:"3.3"}}}}],st=Object.freeze({Button:"Button",Area:"Area",Text:"Text"}),lt=Object.freeze({openURI:"openURI",setNextBranch:"setNextBranch",setWeightlessRandomBranch:"setWeightlessRandomBranch",setRandomBranch:"setRandomBranch",setMaxWeightBranch:"setMaxWeightBranch",setMinWeightBranch:"setMinWeightBranch",setDefaultBranch:"setDefaultBranch",continuePlayback:"continuePlayback",expect:"expect"});var ct,dt;(dt=ct||(ct={})).GO_NEXT_BUTTON="GO_NEXT_BUTTON",dt.GO_NEXT_AREA="GO_NEXT_AREA",dt.WATCH_AGAIN="WATCH_AGAIN",dt.OPEN_GRAPH="OPEN_GRAPH",dt.CLOSE_GRAPH="CLOSE_GRAPH";const ut={metadata:"Object",chapters:"Array"},ht=t=>{const e=et(t,"3.0.0");return-1!==e&&(0===e||1!==et(t,"3.3.0"))},pt=t=>t.type===st.Text;class ft{toString(){return`SDK_NAME ERROR ${JSON.stringify(this,null,"  ")}`}constructor(t,e,...n){this.severity=t,this.category=e,this.data=n}}ft.Severity={RECOVERABLE:1,CRITICAL:2},ft.Category={VIDEO:0,INTERACTIVES:1,GRAPH:2,MANIFEST:3,LOADERS:4,HISTORY:5,SEAMLESS:6};class vt{addListener(t,e){return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e),this}on(t,e){return this.addListener(t,e)}once(t,e){this.listeners[t]=this.listeners[t]||[];const n=()=>{e(),this.off(t,n)};return this.listeners[t].push(n),this}off(t,e){return this.removeListener(t,e)}reset(){this.listeners={}}removeListener(t,e){const n=this.listeners[t];if(!n)return this;for(let t=n.length;t>0;t--)if(n[t]===e){n.splice(t,1);break}return this}emit(t,...e){const n=this.listeners[t];return!!n&&(n.forEach((t=>{t(...e)})),!0)}listenerCount(t){return(this.listeners[t]||[]).length}rawListeners(t){return this.listeners[t]}constructor(){this.listeners={}}}class mt{release(){this.cancelAnimation(),this.fn=void 0,this.fns=[]}constructor(t){this.addFn=(t,e=!1)=>{(t=>$(t,Z))(t)&&(this.fns.push(t),e&&this.updateFn())},this.removeFn=(t,e=!1)=>{this.fns=this.fns.filter((e=>e!==t)),e&&this.updateFn()},this.updateFn=()=>{this.fn=()=>{this.fns.forEach((t=>t())),this.raf&&this.forceRequestAnimation()}},this.forceRequestAnimation=()=>{this.fn&&(this.raf=requestAnimationFrame(this.fn))},this.requestAnimation=()=>{this.raf||this.forceRequestAnimation()},this.cancelAnimation=()=>{cancelAnimationFrame(this.raf),this.raf=void 0},this.raf,this.fn,this.fns=[],this.addFn(t)}}class yt{async exec(t,e){return function(...t){return async function(e){const n=[...t];for(;n.length>0;)e=await n.shift()(e);return e}}(...this.loaders[t])(e)}constructor(t){this.loaders={chapterLoaders:t?.chapterLoaders??[],manifestLoaders:t?.manifestLoaders??[]}}}function gt(t,e,n){return t?{...t,[e]:t[e]?[n,...t[e]]:[n]}:{[e]:[n]}}function _t({actions:t,errors:e,chapterId:n,...r}){if(n){const o=t.getManifest(),i=t.getChapter(o.chapters,n);if(i){const n=t.getMedia(o.media,i.videoId),a=t.getGraph(o.graph,i.id);return n?{...r,actions:t,errors:e,result:{chapter:i,media:n,graph:a}}:{...r,errors:gt(e,_t.name,"Could not find media"),actions:t}}}return{...r,errors:gt(e,_t.name,"Could not find chapter"),actions:t}}class bt{addEventListener(t,e,n){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push({callback:e,options:n})}removeEventListener(t,e){if(!(t in this.listeners))return;const n=this.listeners[t];for(let t=0,r=n.length;t<r;t++)if(n[t].callback===e)return void n.splice(t,1)}dispatchEvent(t){if(!(t.type in this.listeners))return;const e=this.listeners[t.type].slice();for(let n=0,r=e.length;n<r;n++){const r=e[n];try{r.callback.call(this,t)}catch(t){Promise.resolve().then((()=>{throw t}))}r.options&&r.options.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}}class wt extends bt{toString(){return"[object AbortSignal]"}dispatchEvent(t){"abort"===t.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,t)),super.dispatchEvent(t)}constructor(){super(),this.listeners||bt.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}}function Ct(t){return t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof t.Request&&!t.Request.prototype.hasOwnProperty("signal")||!t.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(class{abort(t){let e;try{e=new Event("abort")}catch{typeof document<"u"?document.createEvent?(e=document.createEvent("Event"),e.initEvent("abort",!1,!1)):(e=document.createEventObject(),e.type="abort"):e={type:"abort",bubbles:!1,cancelable:!1}}let n=t;if(void 0===n)if(typeof document>"u")n=new Error("This operation was aborted"),n.name="AbortError";else try{n=new DOMException("signal is aborted without reason")}catch{n=new Error("This operation was aborted"),n.name="AbortError"}this.signal.reason=n,this.signal.dispatchEvent(e)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new wt,writable:!0,configurable:!0})}}.prototype[Symbol.toStringTag]="AbortController",wt.prototype[Symbol.toStringTag]="AbortSignal");const xt=Ct({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Et=xt?function(t){"function"==typeof t&&(t={fetch:t});const{fetch:e,Request:n=e.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o=!1}=t;if(!Ct({fetch:e,Request:n,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o}))return{fetch:e,Request:i};let i=n;(i&&!i.prototype.hasOwnProperty("signal")||o)&&(i=function(t,e){let r;e&&e.signal&&(r=e.signal,delete e.signal);const o=new n(t,e);return r&&Object.defineProperty(o,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),o},i.prototype=n.prototype);const a=e;return{fetch:(t,e)=>{const n=i&&i.prototype.isPrototypeOf(t)?t.signal:e?e.signal:void 0;if(n){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(n.aborted)return Promise.reject(r);const o=new Promise(((t,e)=>{n.addEventListener("abort",(()=>e(r)),{once:!0})}));return e&&e.signal&&delete e.signal,Promise.race([o,a(t,e)])}return a(t,e)},Request:i}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Mt=xt?Et.fetch:window.fetch;xt?Et.Request:window.Request;const kt=async t=>{try{let e,n;if(W(t))e=t;else{if(!Y(t))return{};{n=new URL(t).href;const r=await Mt(n);if(!r.ok)return{};e=await r.json()}}if(!(t=>{if(!W(t))return!1;for(const e in ut)if(!t[e]||!$(t[e],ut[e]))return!1;return ht(t.metadata.version)})(e))return{};const r=e.metadata.media;if(Y(r)&&!e.media)try{let t;n?t=new URL(r,n).href:(t=new URL(r).href,n=t);const o=await Mt(t);if(!o.ok)throw new Error;e.metadata.media=await o.json()}catch{return function(t){return et(t,"3.2.0")>=0}(e.metadata.version)?{manifest:e}:{}}return{manifest:e,manifestURL:n}}catch{return{}}};async function St(t){const{manifest:e,manifestURL:n}=await kt(t),r=(t=>at.reduce(((t,e)=>et(t.metadata.version,e.version)?t:e.migrate(t)),t))(e);return r.media=function(t,e){return{...t,videos:t.videos.map((t=>({...t,variants:t.variants.map((t=>{const n=function(t,e){try{return new URL(t,e).href}catch{return""}}(t.url,e);return{...t,url:n||t.url}}))})))}}(r.media,n),delete r.metadata.media,r}function It(t,e){return t.find((t=>t.id===e))}function Nt(t,e){return t.edit?.chapters?t.edit.chapters.find((t=>t.id===e)):t.view?.chapters?t.view.chapters.find((t=>t.id===e)):void 0}function Lt(t,e){return t.videos.find((t=>t.id===e))}const Ot=Object.freeze({nothing:0,beforeInteractive:1,interactive:2,afterInteractive:3,end:4,removed:5,destroyed:6}),Tt=t=>G(t)&&!K(t),At=t=>"end"===t.order,Pt=t=>G(t.containers)&&!K(t.containers)&&At(t),jt=(t,e)=>{const n=1e3*t;return Tt(e.controls)&&n>=(e.startTime??0)&&n<=(e.endTime??1/0)},Bt=t=>t.some((t=>"expect"===t.action.type)),Vt=t=>t.find((t=>"expect"===t.action.type)),zt=t=>(t=>1===t?.length)(t)&&pt(t[0]);class Rt extends yt{release(){return this.manifest=null,this.chapter=null,this.media=null,this.graph=null,this.prevChapter$.next(null),this}async setManifest(t){this.release();const e=await this.exec("manifestLoaders",{actions:{addErrorMessage:gt},result:null,errors:null,source:t});e.errors&&this.errorHandler(e.errors);const n=await St(e.result??t);return this.manifest=n,this}async setInitial(){return this.setNext()}async setNext(t=this.manifest.metadata.initChapterId){this.prevChapter$.next(this.chapter);const e=await this.exec("chapterLoaders",_t({actions:{getManifest:()=>this.manifest,getCurrent:this.getCurrent,getGraph:Nt,getChapter:It,getMedia:Lt,getByBranches:this.getByBranches.bind(this),addErrorMessage:gt},result:null,errors:null,chapterId:t}));return e.errors&&this.errorHandler(e.errors),this.chapter=e.result.chapter,this.media=e.result.media,this.graph=e.result.graph,this}errorHandler(t){this.onError(t),console.error("Something went wrong with loaders",{errors:t})}getInitial(){return this.getByChapterId(this.manifest.metadata.initChapterId)||null}getByChapterId(t=this.manifest.metadata.initChapterId){const e=It(this.manifest.chapters,t);if(e){const t=Lt(this.manifest.media,e.videoId),n=Nt(this.manifest.graph,e.id);if(t)return{chapter:e,media:t,graph:n}}return null}getBranches(t=this.chapter.id){if(t===this.chapter.id)return this.getByBranches(this.chapter.branches);{const e=It(this.manifest.chapters,t);return this.getByBranches(e?.branches)}}getByBranches(t=[]){return t.reduce(((t,e)=>{const n=this.getByChapterId(e.chapterId);return n&&t.push(n),t}),[])}getCurrent(){return{chapter:this.chapter,media:this.media,graph:this.graph}}isInitialChapter(){return this.chapter.id===this.manifest.metadata.initChapterId}isEndChapter(){return At(this.chapter)}constructor(t,e){super(t),this.onError=e,this.prevChapter$=new i.ValueSubject(null),this.release()}}const Dt=t=>{const e=t.variants.find((t=>"vk"===t.payload?.type));if(e&&"payload"in e){const[t,n]=e.payload.id.split("_");return[t,n]}return[]},Ft={graph:"graph",interactives:"interactives",chapterChanged:"chapter-changed",playerChanged:"player-changed",manifestChanged:"manifest-changed",errors:"errors",eachTick:"eachTick",historyInited:"history-inited",historyDestroyed:"history-destroyed"},Ht={visibility:"visibility",watchAgainClicked:"watchAgainClicked"},Zt={actionChoiceCanceled:"action-choice-canceled",actionChoice:"action-choice",actionExecution:"action-execution",visibility:"visibility",containerRemoved:"container-removed",rangeEnded:"range-ended"};function $t(t,e=[]){let n,r={};const o=!e.length;for(const i of t.variants)if(!n&&"cover"in i&&(n=i.cover),"url"in i)switch(i.type.toLowerCase()){case"mp4":(o||e.includes("mp4"))&&(r.MPEG={...r.MPEG,[i.standard??"Invariant quality"]:i.url});break;case"mpeg":(o||e.includes("mpeg"))&&(r.MPEG={...r.MPEG,[i.standard??"Invariant quality"]:i.url});break;case"hls":(o||e.includes("hls"))&&(r={...r,HLS:{type:"url",url:i.url}});break;case"dash":(o||e.includes("dash"))&&(r={...r,DASH_SEP:{compatibilityMode:!0,type:"url",url:i.url}})}return{sources:r,thumbUrl:n,title:t.title??""}}const Wt=(t,e)=>{const n=t.info.currentQuality$.getValue(),r=t.info.availableQualities$.getValue();n!==e&&r.includes(e)&&(t.setQuality(e),t.setAutoQuality(!1))},Yt={activePlayerChanged:"sc-active-player-changed",initiated:"sc-initiated",playerCreated:"sc-player-created"},Gt=2;function Xt(t){const e=function(){const t=new Map;function e(e,n){const r=t.get(e);if(r){if(n)return r[n]?.player.destroy(),r[n]?.container.remove(),r[n]?.subscription.unsubscribe(),delete r[n],Object.keys(r).length||t.delete(e),!0;for(const t of Object.values(r))t.player.destroy(),t.container.remove();return t.delete(e),!0}throw Error("Can't remove. Not find.")}return{createPlayer:function({listId:e=Math.random().toString(),itemId:n=Math.random().toString(),...r}){const o=t.get(e),i={...r};return o?o[n]=i:t.set(e,{[n]:i}),{listId:e,itemId:n,...r}},removePlayer:e,map:t,removeAll:function(){for(const n of t)e(n[0])}}}();let n,r;const o=new vt;let a,l={},c=!1,d=null,u=!1;function h(t){d=t}function p(t,i,a){if(!d)throw Error("need to set interactive controller");const s=(e.map.get(t)??{})[i];if(s){l={chapterId:a,listId:t,itemId:i,...s};const h=l.player;return r=h.info.currentQuality$.subscribe((t=>{if(t&&h.info.position$.getValue()){n=t;for(const n of e.map)Object.values(n[1]).forEach((({player:e})=>{h.info.isAutoQualityEnabled$.getValue()||Wt(e,t)}))}})),s.container.remove(),c=!1,d.setPlayer(s.player),u||(d.init(),u=!0),void o.emit(Yt.activePlayerChanged,{player:l.player,config:l.config})}throw Error("Can't set. Not find.")}async function f({chapter:{id:t},media:n}){if(U(l))return;r?.unsubscribe();const o=l.player.info.muted$.getValue(),i=l.player.info.currentQuality$.getValue(),a=l.player.info.isAutoQualityEnabled$.getValue(),s=l.player.info.volume$.getValue(),c=l.player.info.currentPlaybackRate$.getValue(),d=!a;let u=!1;for(const r of e.map)if(r[0]===n.id){const n=Object.keys(r[1]);for(const a of n)a===l.itemId?(n.length<Gt||(u=!0),e.removePlayer(r[0],a)):(u=!0,p(r[0],a,t),d?Wt(l.player,i):l.player.setAutoQuality(!0),l.player.setVolume(s),l.player.setMuted(o),l.player.setPlaybackRate(c))}else e.removePlayer(r[0]);u||(await v({media:n,chapterId:t,setAsActive:!0,playbackRate:c}),d?Wt(l.player,i):l.player.setAutoQuality(!0),l.player.setVolume(s),l.player.setMuted(o))}async function v({media:t,chapterId:r,prefetch:u=!0,setAsActive:h=!0,autoplay:f=!1,preferredExt:m,title:y,playbackRate:g}){const _=Math.random().toString(),b=document.createElement("div");a.append(b);const w=l?.player?.info.isAutoQualityEnabled$.getValue();let C;if(d?.options?.vkVideoLoader){const e=Dt(t);e.length&&(C=await d.options.vkVideoLoader(...e))}const x={container:b,...C?.videos?.[0]||{sources:$t(t,m).sources},title:y},E=new s.Player;E.initVideo(x);const M=b.lastChild,k=new i.Subscription;k.add(E.info.position$.subscribe((function(t){!async function(t,e,n){if(!d)throw Error("need to set interactive controller");if(!U(l)&&t===l.itemId&&n>=0&&!c){const t=d.getChapterBranches();c=!0;const e=new Set;for(const n of t)e.has(n.media.id)||(await v({media:n.media,chapterId:n.chapter.id,setAsActive:!1,title:n.chapter.label}),e.add(n.media.id))}}(_,E.info.duration$.getValue(),t)}))).add(E.events.canplay$.subscribe((function(){w||Wt(E,n),g&&E.setPlaybackRate(g)}))),M&&(b.style.display="none",b.classList.add(r));const S=e.createPlayer({listId:t.id,itemId:_,player:E,container:b,sources:$t(t,m).sources,config:x,subscription:k});return h&&p(t.id,S.itemId,r),f&&S.player.play(),u&&!f&&S.player.prepare(),o.emit(Yt.playerCreated,S.player),{player:S.player,config:S.config}}function m(){d?.off(Ft.chapterChanged,f),e.removeAll(),l={},u=!1,c=!1}return t&&h(t),{...e,on:o.on.bind(o),off:o.off.bind(o),init:async function({container:t}){if(!d)throw Error("need to set interactive controller");m(),a=t;const{media:e,chapter:n}=d.getCurrentChapter();if(e){d.on(Ft.chapterChanged,f);const{player:r,config:i}=await v({media:e,chapterId:n.id,title:n.label});return o.emit(Yt.initiated,{container:t,media:e,chapterId:n.id}),{player:r,config:i}}console.error("not found")},setInteractiveController:h,createPlayer:v,removeAll:function(){m(),d=null},getActivePlayer:function(){return l}}}const qt=(()=>{let t=[],e=null;return{setPlayer:t=>{e=t},setContainers:e=>{t=e},deleteContainer:e=>{t=t.filter((t=>t.id!==e))},getNextInteractiveTime:(n=3e3)=>{if(!t.length||null===e)return null;let r=-1,o=!1;const i=Math.round(1e3*e.info.position$.getValue());for(const e of t){const t=e.startTime-n;if(t<=i&&(i<=e.endTime||null===e.endTime)){o=!0;break}i<t&&(r=-1===r?t:Math.min(r,t))}return o||-1===r?null:r}}})();class Ut{registerEvents(){this.subscription.add(this.player.events.playing$.subscribe(this.show)).add(this.player.events.paused$.subscribe(this.hide)).add(this.player.events.ended$.subscribe(this.onEndOfVideo)),this.subscription.add(this.disabledControls$.subscribe((t=>{t?this.container.disable?.():this.container.enable?.()})))}selectContainerEvent(t=!1){this.interactiveEvents.containersEventsCallState.setCalled({timestamp:t?1/0:this.container.container.endTime,id:this.container.container.id}),!this.isSelectedControlEvent&&!this.isSelectedContainerEvent&&(this.isSelectedContainerEvent=!0,this.ignoreContainerEvent()||this.selectBranches.setManifestContainerEvents({container:this.container.container,branches:this.branches,isEOV:t}),!t&&this.interactiveEvents.exec(this.container.container.endTime))}onStartTime(){this.show()}onEndTime(){this.selectContainerEvent(!1);const t=Bt(this.container.container.events)||this.ignoreContainerEvent();(this.isSelectedControlEvent||!t)&&this.removeView()}onBeforeStartTime(){this.container.hide?.(),this.globalEventEmitter.emit(Ft.interactives,{subjectId:this.container.container.id,subjectName:"container",type:Zt.visibility,visibility:!1})}reset(){this.isSelectedControlEvent=!1,this.isSelectedContainerEvent=!1,this.gameState=Ot.beforeInteractive}removeView(){this.container.removeView(),this.globalEventEmitter.emit(Ft.interactives,{subjectId:this.container.container.id,subjectName:"container",type:Zt.containerRemoved,visibility:!1}),this.gameState=Ot.removed}destroy(){this.reset(),this.removeView(),this.gameState=Ot.destroyed,this.subscription.unsubscribe(),this.branches=[],this.interactiveEvents.containersEventsCallState.setCalled({timestamp:this.container.container.endTime??1/0,id:this.container.container.id}),qt.deleteContainer(this.container.container.id)}constructor({player:t,container:e,branches:n,selectBranches:r,interactiveEvents:o,globalEventEmitter:a,ignoreContainerEvent:s,permanentTextControls:l,disabledControls$:c}){this.hide=()=>{setTimeout((()=>{this.gameState!==Ot.end&&(Bt(this.container.container.events)&&this.gameState===Ot.afterInteractive||this.selectBranches.state.isExpect||(this.gameState!==Ot.interactive&&this.container.hide?.(),this.globalEventEmitter.emit(Ft.interactives,{subjectId:this.container.container.id,subjectName:"container",type:Zt.visibility,visibility:!1})))}))},this.show=()=>{if(this.gameState===Ot.interactive&&!this.isSelectedControlEvent)if(this.container.getElement())this.container.show?.(),this.globalEventEmitter.emit(Ft.interactives,{subjectId:this.container.container.id,subjectName:"container",type:Zt.visibility,visibility:!0,isFirst:!1});else{const t=(({fn:t,type:e=1},...n)=>(...r)=>e?t(...r,...n):t({...r[e],...n[e]}))({fn:this.selectBranches.onControlEvent,type:0},{isDisabled:()=>this.container.isDisabled,branches:this.branches,containerId:this.container.container.id,onDetachContainer:()=>{this.removeView(),this.globalEventEmitter.emit(Ft.interactives,{subjectId:this.container.container.id,subjectName:"container",type:Zt.visibility,visibility:!1})},onEvent:(t,e)=>{this.isSelectedControlEvent=!0,!1!==t&&(this.removeView(),this.globalEventEmitter.emit(Ft.interactives,{subjectId:this.container.container.id,subjectName:"container",type:Zt.visibility,visibility:!1})),(this.gameState===Ot.end||this.gameState===Ot.afterInteractive||this.selectBranches.state.isExpect)&&(this.selectBranches.stopExpect(),e(),this.removeView(),this.globalEventEmitter.emit(Ft.interactives,{subjectId:this.container.container.id,subjectName:"container",type:Zt.visibility,visibility:!1})),qt.deleteContainer(this.container.container.id)},isEOV:()=>this.gameState===Ot.end});this.container.createView(t),this.globalEventEmitter.emit(Ft.interactives,{subjectId:this.container.container.id,subjectName:"container",type:Zt.visibility,visibility:!0,isFirst:!0}),this.disabledControls$.getValue()&&this.container.disable?.()}},this.onEndOfVideo=()=>{this.gameState=Ot.end,this.selectContainerEvent(!0)},this.whilePlaying=()=>{if(this.player.experimental.element$.getValue()?.readyState<1||[Ot.destroyed,Ot.removed].includes(this.gameState)&&!this.isPermanentText)return;const t=this.player.getExactTime();if(((t,e)=>{const n=1e3*t;return Tt(e.controls)&&n<(e.startTime??0)})(t,this.container.container))this.gameState!==Ot.beforeInteractive&&(this.gameState=Ot.beforeInteractive,this.onBeforeStartTime());else if(jt(t,this.container.container))this.gameState!==Ot.interactive&&(this.gameState=Ot.interactive,this.onStartTime());else if(this.gameState!==Ot.afterInteractive){const t=this.gameState;this.gameState=Ot.afterInteractive,t===Ot.interactive&&this.onEndTime()}else this.gameState!==Ot.destroyed&&this.removeView();const e=jt(t,this.container.container),n=this.container.container.startTime?[this.container.container.startTime,this.container.container.endTime??1/0]:[];this.container.onProgress?.(t,e),this.globalEventEmitter.emit(Ft.eachTick,{subjectId:this.container.container.id,subjectName:"container",range:n,currentTime:t,isInteractiveTime:e})},this.container=e,this.branches=n,this.selectBranches=r,this.subscription=new i.Subscription,this.player=t,this.interactiveEvents=o,this.ignoreContainerEvent=s,this.isPermanentText=l&&zt(e.container.controls),this.disabledControls$=c,this.globalEventEmitter=a,this.gameState=Ot.nothing,this.isSelectedControlEvent=!1,this.isSelectedContainerEvent=!1,this.registerEvents()}}function Kt(){const t={};return{map:t,remove:function({timestamp:e,priority:n,initiator:r}){if(q(e)){if(t[e]){if(Q(n,!0)){if(!t[e][n])return!1;if(Q(r,!0)){if(!t[e][n][r])return!1;if(delete t[e][n][r],!U(t[e][n]))return!0}if(delete t[e][n],!U(t[e]))return!0}return delete t[e]}return!1}},add:function({timestamp:e,priority:n,initiator:r,...o}){t[e]?.[n]?.[r]?t[e][n][r].push({...o}):t[e]?.[n]?t[e][n]={...t[e][n],[r]:[{...o}]}:t[e]?t[e]={...t[e],[n]:{[r]:[{...o}]}}:t[e]={[n]:{[r]:[{...o}]}}},removeAll:function(){for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&delete t[e];return!0},get:function({timestamp:e,priority:n,initiator:r}){if(q(e)){const o=t[e]??null;if(o&&Q(n,!0)){let t={};const e=o[n];return e&&(t={...t,...e}),t=U(t)?null:t,t&&Q(r,!0)?t[r]??null:t}return o}return null},getLte:function(e){const n={};for(const r in t)+r<=e&&(n[r]=t[r]);return n},getGte:function(e){const n={};for(const r in t)+r>=e&&(n[r]=t[r]);return n}}}const Qt=[lt.expect,lt.setNextBranch],Jt=1/0;function te(t){let e,n=t;const r=function(){const t=new Map;return{setCalled:({timestamp:e,id:n})=>{const r=t.get(e);r&&void 0!==r[n]&&(r[n]=!0)},setData:(e=[])=>{for(const n of e){const e=n.endTime??Jt,r=t.get(e)??{};t.set(e,{...r,[n.id]:!1})}},resetCalled:e=>{const n=t.get(e);if(n)for(const t in n)n[t]=!1},isReady:e=>{const n=t.get(e);return!n||!Object.values(n).some((t=>!t))},release:()=>t.clear()}}(),o=new Kt;let i;const a=(t=[])=>{for(const e of t)if(e.action(),Qt.includes(e.actionType))break},s=(t=1/0)=>[...ee(o.get({timestamp:t,priority:"control"})??{}),...ee(o.get({timestamp:t,priority:"container"})??{}),...ee(o.get({timestamp:t,priority:"chapter"})??{})],l=t=>{r.isReady(t)&&a(s(t))},c=()=>{e&&(i?.unsubscribe(),e=void 0)},d=()=>{e||(e=()=>setTimeout((()=>{l(1/0)})),i=n.events.ended$.subscribe(e))},u=()=>{r.release(),o.removeAll()};return{setPlayer:t=>{c(),n=t},add:t=>{o.add.call(void 0,t),d()},remove:t=>{"container"===t.priority&&r.resetCalled(t.timestamp),o.remove(t)},exec:l,execEndOfVideo:()=>{a([...ee(o.get({timestamp:1/0,priority:"chapter"})??{})])},listen:d,unlisten:c,release:()=>{c(),u()},containersEventsCallState:r,getPreparedToExecActions:s}}function ee(t){return Object.values(t).flat().sort((t=>t.actionType===lt.expect?-1:1))}function ne(t){let e=()=>{};const n=new ResizeObserver((t=>{r(t),e=r.bind(null,t)}));const r=z((e=>{const{fns:n=[]}=t();!function(e){const{parentElement:n,player:r}=t();if(n&&r){const{videoContentWidth:t,videoContentHeight:o}=((t,e)=>{const{height:n,width:r}=e.info.intrinsicVideoSize$.getValue()||{};if(!n||!r)return{videoContentHeight:0,videoContentWidth:0};const{clientHeight:o,clientWidth:i}=e.experimental.element$.value||{};if(!o||!i)return{videoContentHeight:0,videoContentWidth:0};const a=n/r,s=o/i;let l,c;return s>a?(c=i,l=i*a):s<a?(c=o/a,l=o):(c=i,l=o),{videoContentWidth:c,videoContentHeight:l}})(0,r);n.style.setProperty("--interactive-content-width",`${t}px`),n.style.setProperty("--interactive-content-height",`${o}px`),n.style.setProperty("--interactive-width",`${e[0].contentRect.width}px`),n.style.setProperty("--interactive-height",`${e[0].contentRect.height}px`)}}(e);for(const t of n)t()}),250);return{resizeObserver:n,calc:()=>{e()},release:function(){e=void 0,n.disconnect(),function(){const{parentElement:e}=t();e.removeAttribute("style")}()}}}class re{push(t,e){t in this.map?this.map[t].push(e):this.map[t]=[e]}get(t){const e=this.map[t];return e?e.slice():null}getAll(){const t=[];for(const e in this.map)t.push(...this.map[e]);return t}remove(t,e){t in this.map&&(this.map[t]=this.map[t].filter((t=>t!==e)),0===this.map[t].length&&delete this.map[t])}clear(){this.map={}}size(){return Object.keys(this.map).length}keys(){return Object.keys(this.map)}constructor(){this.map={}}}const oe=t=>{const e=(t=>Math.floor(Math.random()*t))(t.length);return t[e]},ie=Object.freeze({shouldOpenNow:!0,isDetachContainer:!0}),ae=(t,e=!1)=>({...t,args:e?{...t.args,...ie}:{...ie,...t.args}}),se=({globalEventEmitter:t,player:e,interactiveEvents:n,removeControllers:r})=>{const o={isExpect:!1},i=({action:e,container:{id:o,endTime:i},branches:a=[],isEOV:s=!1,autoSelected:l=!1})=>{const h=ae(e,s),p={timestamp:!h.args.shouldOpenNow||s?1/0:i,priority:"container",initiator:o,actionType:h.type},f=t.emit.bind(t,Ft.interactives,{subjectId:o,subjectName:"container",type:Zt.actionChoice,actionType:h.type,payload:h.args});switch(h.type.trim().toLowerCase()){case lt.setNextBranch.trim().toLowerCase():{const t=a.find((t=>t.id===h.args.branchId));if(!t)return;return f(),n.add({...p,action:d.bind(null,{subjectId:o,subjectName:"container",action:h,payload:{chapterId:t.chapterId,autoSelect:l}})}),void r?.()}case lt.setMaxWeightBranch.trim().toLowerCase():case lt.setMinWeightBranch.trim().toLowerCase():case lt.setRandomBranch.trim().toLowerCase():case lt.setWeightlessRandomBranch.trim().toLowerCase():return;case lt.continuePlayback.trim().toLowerCase():return f(),void n.add({...p,action:c.bind(null,{subjectId:o,subjectName:"container",action:h})});case lt.openURI.trim().toLowerCase():return f(),n.add({...p,action:u.bind(null,{subjectId:o,subjectName:"container",action:h,payload:{URI:e.args.uri}})}),void r?.();default:return console.error("Unexpected container event"),void t.emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.INTERACTIVES,{message:"Unexpected container event"}))}};const a=({chapterId:e,action:n,branches:r=[]})=>{const o=t.emit.bind(t,Ft.interactives,{subjectId:e,subjectName:"chapter",type:Zt.actionChoice,actionType:n.type,payload:n.args});switch(n.type.trim().toLowerCase()){case lt.setNextBranch.trim().toLowerCase():{const t=r.find((t=>t.id===n.args.branchId));return t?.chapterId?(o(),d.bind(null,{subjectId:e,subjectName:"chapter",action:n,payload:{chapterId:t.chapterId,autoSelect:!0}})):void 0}case lt.setWeightlessRandomBranch.trim().toLowerCase():{const t=oe(r);return t?.chapterId?(o(),d.bind(null,{subjectId:e,subjectName:"chapter",action:n,payload:{chapterId:t.chapterId,autoSelect:!0}})):void 0}case lt.setRandomBranch.trim().toLowerCase():{const t=(t=>{let e=0;for(let n=0;n<t.length;++n)e+=t[n].weight??1;const n=Math.random()*e;e=0;for(let r=0;r<t.length-1;++r)if(e+=t[r].weight??1,e>=n)return t[r];return t[t.length-1]})(r);return t?.chapterId?(o(),d.bind(null,{subjectId:e,subjectName:"chapter",action:n,payload:{chapterId:t.chapterId,autoSelect:!0}})):void 0}case lt.setMaxWeightBranch.trim().toLowerCase():{const t=(t=>{let e=t.length,n=-1/0,r=null;for(;e--;)t[e].weight>n&&(n=t[e].weight,r=t[e]);return r})(r);return t?.chapterId?(o(),d.bind(null,{subjectId:e,subjectName:"chapter",action:n,payload:{chapterId:t.chapterId,autoSelect:!0}})):void 0}case lt.setMinWeightBranch.trim().toLowerCase():{const t=(t=>{let e=t.length,n=1/0,r=null;for(;e--;)t[e].weight<n&&(n=t[e].weight,r=t[e]);return r})(r);return t?.chapterId?(o(),d.bind(null,{subjectId:e,subjectName:"chapter",action:n,payload:{chapterId:t.chapterId,autoSelect:!0}})):void 0}case lt.continuePlayback.trim().toLowerCase():return o(),c.bind(null,{subjectId:e,subjectName:"chapter",action:n});case lt.openURI.trim().toLowerCase():return o(),u.bind(null,{subjectId:e,subjectName:"chapter",action:n,payload:{URI:n.args.uri}});default:return console.error("Unexpected chapter event"),void t.emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.INTERACTIVES,{message:"Unexpected chapter event"}))}};const s=({subjectId:n,subjectName:r,action:o})=>{e.pause(),t.emit(Ft.interactives,{subjectId:n,subjectName:r,type:Zt.actionExecution,actionType:o?.type??lt.expect})},l=({subjectId:r,subjectName:o})=>{e.info.isEnded$.getValue()?n.execEndOfVideo():e.play(),t.emit(Ft.interactives,{subjectId:r,subjectName:o,type:Zt.actionExecution,actionType:"after-expect"})},c=({subjectId:e,subjectName:n,subjectType:r,action:o})=>{t.emit(Ft.interactives,{subjectId:e,subjectName:n,subjectType:r,type:Zt.actionExecution,actionType:o.type})},d=({subjectId:e,subjectName:n,subjectType:r,action:o,payload:i})=>{i.behaviour="change-chapter",t.emit(Ft.interactives,{subjectId:e,subjectName:n,subjectType:r,type:Zt.actionExecution,actionType:o.type,payload:i})},u=({subjectId:e,subjectName:n,subjectType:r,action:o,payload:i})=>{if(!i.URI)return;const a=window.open(i.URI,"_blank","noopener,noreferrer");a&&(a.opener=null),t.emit(Ft.interactives,{subjectId:e,subjectName:n,subjectType:r,type:Zt.actionExecution,actionType:o.type})};return{onControlEvent:({action:e,controlType:o,controlId:i,containerId:a,branches:s=[],onEvent:h,isEOV:p=(()=>!1),isDisabled:f=(()=>!1)})=>{const v=ae(e,p()),m={timestamp:1/0,priority:"control",initiator:i,actionType:v.type},y=f(),g=t.emit.bind(t,Ft.interactives,{subjectId:i,subjectType:o,subjectName:"control",type:y?Zt.actionChoiceCanceled:Zt.actionChoice,actionType:e.type,payload:{containerId:a,...v.args}});if(y)g();else switch(v.type.trim().toLowerCase()){case lt.setNextBranch.trim().toLowerCase():{const t=s.find((t=>t.id===v.args.branchId));if(!t)return;return h(v.args.isDetachContainer,l.bind(null,{subjectId:i,subjectName:"control"})),g(),void(v.args.shouldOpenNow?d({subjectId:i,subjectName:"control",subjectType:o,action:v,payload:{chapterId:t.chapterId,autoSelect:!1}}):(n.add({...m,action:d.bind(null,{subjectId:i,subjectName:"control",subjectType:o,action:v,payload:{chapterId:t.chapterId,autoSelect:!1}})}),r?.()))}case lt.continuePlayback.trim().toLowerCase():return h(v.args.isDetachContainer,l.bind(null,{subjectId:i,subjectName:"control"})),g(),void(v.args.shouldOpenNow?c({subjectId:i,subjectName:"control",subjectType:o,action:e}):n.add({...m,action:c.bind(null,{subjectId:i,subjectName:"control",subjectType:o,action:e})}));case lt.openURI.trim().toLowerCase():return h(v.args.isDetachContainer,l.bind(null,{subjectId:i,subjectName:"control"})),g(),void(v.args.shouldOpenNow?u({subjectId:i,subjectName:"control",subjectType:o,action:v,payload:{URI:e.args.uri}}):(n.add({...m,action:u.bind(null,{subjectId:i,subjectName:"control",subjectType:o,action:v,payload:{URI:e.args.uri}})}),r?.()));default:return console.error("Unexpected control event"),void t.emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.INTERACTIVES,{message:"Unexpected control event"}))}},onContainerEvent:i,onChapterEvent:a,onExpectEvent:s,expectEventHandler:l,setManifestChapterEvents:function(e){const r=Vt(e.events);if(r){if(At(e))return;t.emit(Ft.interactives,{subjectId:e.id,subjectName:"chapter",type:Zt.actionChoice,actionType:r.action.type,payload:r.action.args}),n.add({timestamp:1/0,priority:"chapter",initiator:e.id,actionType:lt.expect,action:s.bind(null,{subjectId:e.id,subjectName:"chapter"})})}else e.events.forEach((t=>{const r=a({chapterId:e.id,action:t.action,branches:e.branches});r&&n.add({timestamp:1/0,priority:"chapter",initiator:e.id,actionType:t.action.type,action:r})}))},setManifestContainerEvents:function({container:e,branches:r,isEOV:a=!1}){const l=Vt(e.events);if(l){const r=ae(l.action,a);t.emit(Ft.interactives,{subjectId:e.id,subjectName:"container",type:Zt.actionChoice,actionType:r.type,payload:r.args}),n.add({timestamp:a?1/0:e.endTime,priority:"container",initiator:e.id,actionType:lt.expect,action:s.bind(null,{subjectId:e.id,subjectName:"container"})}),o.isExpect=!0}else for(const t of e.events)i({action:t.action,container:e,branches:r,isEOV:a})},stopExpect:()=>{o.isExpect&&(o.isExpect=!1)},state:o}},le=(t,e)=>{const n={};return t.map((t=>{if(!n[t]){const r=e.chapters.find((e=>e.id===t));if(!r)return null;const o=e.media.videos.find((t=>r.videoId===t.id));if(!o)return null;n[t]=de(o)}return n[t]})).filter(Boolean)},ce=t=>"custom"===t.type&&"payload"in t&&"vk"===t.payload.type,de=t=>{const e=(t=>{for(const e of t.variants)if(ce(e)&&"payload"in e)return e.payload.id})(t);if(!e)return null;const n=e.split("_").pop();return n?parseInt(n,10):null},ue=(t,e)=>t.reduce(((t,n)=>{const r=((t,e)=>{for(const n of t.media.videos)if(e===de(n)){for(const e of t.chapters)if(e.videoId===n.id)return e.id;return}})(e,n);return r?[...t,r]:t}),[]);var he=(0,o._)("_s"),pe=(0,o._)("_a"),fe=(0,o._)("_h"),ve=(0,o._)("_i"),me=(0,o._)("_d"),ye=(0,o._)("_n"),ge=(0,o._)("_r"),_e=(0,o._)("_o"),be=(0,o._)("_t");class we{async setManifest(t){!(0,r._)(this,ge)[ge]||!(0,r._)(this,_e)[_e]||((0,r._)(this,ve)[ve]=t,await this.getProjectHistory(),await(0,r._)(this,ge)[ge].setChapter({chapterId:this.getInitialChapterId(),pushToHistory:!1}),(0,r._)(this,fe)[fe]||((0,r._)(this,fe)[fe]=!0,(0,r._)(this,_e)[_e].emit(Ft.historyInited,{initChapterId:this.getInitialChapterId()})))}get inited(){return(0,r._)(this,fe)[fe]}async updateHistory(t,e=!0){if(!(0,r._)(this,ve)[ve])return;const n=(0,r._)(this,ve)[ve],o=t.length-(0,r._)(this,pe)[pe].maxLength,i=o>0?t.slice(o):t,a=le(i,n);if((0,r._)(this,me)[me]=a,this?.state?.history$.next(i),e&&(0,r._)(this,he)[he]&&(0,r._)(this,ye)[ye])try{await(0,r._)(this,he)[he].save((0,r._)(this,ye)[ye],a)}catch{(0,r._)(this,_e)[_e]?.emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.HISTORY,"Unable to save interactive history"))}}async goBack(){if(!this.state||!(0,r._)(this,ge)[ge])return(0,r._)(this,_e)[_e]?.emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.HISTORY,"Cannot go back because HistoryController has not been initialized"));const t=this.state.history$.getValue().slice(0,-1),e=t.pop();this.state.history$.next(t),await(0,r._)(this,ge)[ge].setChapter({chapterId:e})}async getProjectHistory(){if(!(0,r._)(this,ve)[ve]||!(0,r._)(this,ye)[ye])return;const t=(0,r._)(this,ve)[ve];let e=[this.getInitialVideoId()];if((0,r._)(this,he)[he])try{const t=await(0,r._)(this,he)[he].get((0,r._)(this,ye)[ye]);t.length&&(e=t)}catch{(0,r._)(this,_e)[_e]?.emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.HISTORY,"Error while trying to fetch data"))}const n=ue(e,t);this?.state?.history$.next(n)}getInitialChapterId(){return this.state?.history$.getValue()?.at(-1)||(0,r._)(this,ve)[ve]?.metadata.initChapterId}getInitialVideoId(){if((0,r._)(this,ve)[ve]){const t=this.getInitialChapterId();return le([t],(0,r._)(this,ve)[ve]).pop()}return null}destroy(){this.state=null,(0,r._)(this,ye)[ye]=null,(0,r._)(this,he)[he]=null,(0,r._)(this,ge)[ge]=null,(0,r._)(this,be)[be]?.unsubscribe(),(0,r._)(this,be)[be]=null,(0,r._)(this,fe)[fe]=!1,(0,r._)(this,_e)[_e]?.emit(Ft.historyDestroyed),(0,r._)(this,_e)[_e]=null}constructor({globalEventEmitter:t,videoId:e,interactiveController:n,historyApi:o,historyParams:a}){Object.defineProperty(this,he,{writable:!0,value:void 0}),Object.defineProperty(this,pe,{writable:!0,value:void 0}),Object.defineProperty(this,fe,{writable:!0,value:void 0}),Object.defineProperty(this,ve,{writable:!0,value:void 0}),Object.defineProperty(this,me,{writable:!0,value:void 0}),Object.defineProperty(this,ye,{writable:!0,value:void 0}),Object.defineProperty(this,ge,{writable:!0,value:void 0}),Object.defineProperty(this,_e,{writable:!0,value:void 0}),Object.defineProperty(this,be,{writable:!0,value:void 0}),this.state={history$:new i.ValueSubject([]),hasPrevChapter$:new i.ValueSubject(!1),prevChapter$:new i.ValueSubject(null),isInitialChapter$:new i.ValueSubject(!1)},(0,r._)(this,he)[he]=null,(0,r._)(this,fe)[fe]=!1,(0,r._)(this,ve)[ve]=null,(0,r._)(this,me)[me]=null,(0,r._)(this,ye)[ye]=null,(0,r._)(this,ge)[ge]=null,(0,r._)(this,_e)[_e]=null,(0,r._)(this,be)[be]=new i.Subscription,(0,r._)(this,ye)[ye]=e,(0,r._)(this,_e)[_e]=t,(0,r._)(this,ge)[ge]=n,(0,r._)(this,he)[he]=o,(0,r._)(this,pe)[pe]={maxLength:a?.maxLength||100},this.state?.history$&&(0,r._)(this,be)[be]&&(0,r._)(this,be)[be]?.add(this.state?.history$.subscribe((t=>{this.state?.prevChapter$.next(t.at(-2)||null),this.state?.hasPrevChapter$.next(t.length>1),this.state?.isInitialChapter$.next(this.getInitialChapterId()===(0,r._)(this,ve)[ve]?.metadata?.initChapterId)})))}}var Ce=(0,o._)("_s"),xe=(0,o._)("_a"),Ee=(0,o._)("_h");class Me{unlisten(){this.target.removeEventListener(this.type,this.listener,this.options),this.target=null,this.listener=null,this.options=!1}constructor(t,e,n,o){this.target=t,this.type=e,this.listener=n,this.options=(0,r._)(Me,Ce)[Ce](t,o),this.target.addEventListener(e,n,this.options)}}Object.defineProperty(Me,Ce,{value:function(t,e){if(void 0===e)return!1;if("boolean"==typeof e)return e;{const n=new Set(["passive","capture"]),o=Object.keys(e).filter((t=>!n.has(t)));return 0===o.length&&console.warn("Unsupported flag(s) to addEventListener: "+o.join(",")),(0,r._)(Me,Ee)[Ee](t)?e:e.capture||!1}}}),Object.defineProperty(Me,Ee,{value:function(t){let e=(0,r._)(Me,xe)[xe];if(void 0===e){e=!1;try{const n={},r={get:()=>(e=!0,!1)};Object.defineProperty(n,"passive",r),Object.defineProperty(n,"capture",r);const o=()=>{};t.addEventListener("test",o,n),t.removeEventListener("test",o,n)}catch{e=!1}(0,r._)(Me,xe)[xe]=e}return e||!1}}),Object.defineProperty(Me,xe,{writable:!0,value:void 0});class ke{release(){this.removeAll(),this.bindingMap=null}listen(t,e,n,r){if(!this.bindingMap)return;const o=new Me(t,e,n,r);this.bindingMap.push(e,o)}listenOnce(t,e,n,r){const o=r=>{this.unlisten(t,e,o),n(r)};this.listen(t,e,o,r)}unlisten(t,e,n){if(!this.bindingMap)return;const r=this.bindingMap.get(e)||[];for(const o of r)o.target===t&&(n===o.listener||!n)&&(o.unlisten(),this.bindingMap.remove(e,o))}removeAll(){if(!this.bindingMap)return;const t=this.bindingMap.getAll();for(const e of t)e.unlisten();this.bindingMap.clear()}constructor(){this.bindingMap=new re}}class Se{clear(){this.rootElement.getContext("2d")?.clearRect(0,0,this.rootElement.width,this.rootElement.height)}isImageDrawn(){const t=this.rootElement.getContext("2d")?.getImageData(0,0,this.rootElement.width,this.rootElement.height);if(!t)return!1;const e=t.data,n=e.length;for(let t=3;t<n;t+=40)if(0!==e[t])return!0;return!1}destroy(){this.rootElement.remove()}show(){this.rootElement.style.visibility="visible"}hide(){this.rootElement.style.visibility="hidden"}setCanvasImageSource(t){this.canvasImgSrc=t}draw(){this.canvasImgSrc&&this.rootElement.getContext("2d")?.drawImage(this.canvasImgSrc,0,0,this.rootElement.width,this.rootElement.height)}async updateCanvasDimensions(t,e=!1){const n=t.width+t.height;if(this._prevSizeId===n)return;let r;e&&(r=await this.save()),this.rootElement.width=t.width,this.rootElement.height=t.height,e&&r&&this.restore(r),this._prevSizeId=n}async save(){const t=this.rootElement.toDataURL("image/jpeg",1),e=new Image;return e.crossOrigin="anonymous",e.src=t,await e.decode(),e}restore(t){this.rootElement&&this.rootElement.getContext("2d")?.drawImage(t,0,0,this.rootElement.width,this.rootElement.height)}constructor(){this._prevSizeId=0,this.rootElement=document.createElement("canvas")}}class Ie{destroy(){this.hide(),this.reset(),this._callbacks=void 0,this.lastFrameCanvas.destroy(),this.rootElement.remove()}setVideoDuration(t){this.currentVideoDurationMs=t}setVideoElement(t){this.lastFrameCanvas.setCanvasImageSource(t)}setCurrentChapter(t){this.currentChapter=t}show(){this.rootElement.style.visibility="visible"}hide(){this.rootElement.style.visibility="hidden"}async updateCanvasDimensions(t=!1){this._containerTimeFrameShouldReceived||this._endTimeFrameReceived||(t=!1);const e=getComputedStyle(this.rootElement),n={width:parseInt(e.getPropertyValue("--interactive-content-width"),10),height:parseInt(e.getPropertyValue("--interactive-content-height"),10)};try{this.lastFrameCanvas.updateCanvasDimensions(n,t)}catch(t){this._onError(t)}}draw(){(this._containerTimeFrameShouldReceived||!this._containerTimeFrameShouldReceived&&!this._endTimeFrameReceived)&&this.lastFrameCanvas.draw()}isChapterEndTime(t){return this.currentVideoDurationMs&&t>=this.currentVideoDurationMs-this.endOffsetMs}isContainerTime(t){if(this.currentChapter)return this.currentChapter.containers.some((e=>e.controls?.length&&t>=(e.startTime??0)&&t<=Math.min(e.endTime??1/0,this.currentVideoDurationMs-this.endOffsetMs)))}reset(){this._endTimeFrameReceived=!1,this._containerTimeFrameShouldReceived=!1,this._shouldCallSkip=!1}_onError(t){this._callbacks?.onError?.(t)}constructor({parentElement:t,endOffsetMs:e=250,onError:n}){this.currentVideoDurationMs=1/0,this._containerTimeFrameShouldReceived=!1,this._endTimeFrameReceived=!1,this._shouldCallSkip=!1,this.onEachTick=t=>{const e=t??1e3*this.lastFrameCanvas.canvasImgSrc.currentTime,n=this.isChapterEndTime(e);if(this.isContainerTime(e))this._endTimeFrameReceived=!1,this._containerTimeFrameShouldReceived=!0,this._shouldCallSkip=!0;else if(n)this._containerTimeFrameShouldReceived=!1,this._shouldCallSkip=!1,this._endTimeFrameReceived||(this.draw(),this._endTimeFrameReceived=!0,this.show());else{if(this._shouldCallSkip)return void(this._shouldCallSkip=!1);this.reset()}},this.onSeek=()=>{this.onEachTick(),!this._containerTimeFrameShouldReceived&&!this._endTimeFrameReceived&&(this.hide(),this.lastFrameCanvas.clear())},this.rootElement=document.createElement("div"),this.rootElement.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: var(--interactive-width);\n      height: var(--interactive-height);\n      background-color: var(--black);\n      visibility: hidden;\n    ",this.lastFrameCanvas=new Se,this.endOffsetMs=e,this._callbacks={onError:n},this.lastFrameCanvas.rootElement.style.cssText="\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n    ",this.rootElement.prepend(this.lastFrameCanvas.rootElement),t.prepend(this.rootElement)}}const Ne=Object.freeze({parentElement:null,fullscreenTargetElement:null,lang:"ru",loaders:{},graph:!1,historyApi:null,historyParams:null,projectInfo:{},initSeamless:!1,lastFrame:!1,permanentTextControls:!0}),Le=Object.freeze({created:0,initiated:1,ready:2,destroyed:3});var Oe=(0,o._)("_s"),Te=(0,o._)("_a"),Ae=(0,o._)("_h"),Pe=(0,o._)("_i"),je=(0,o._)("_d"),Be=(0,o._)("_n"),Ve=(0,o._)("_r"),ze=(0,o._)("_o"),Re=(0,o._)("_t"),De=(0,o._)("_u"),Fe=(0,o._)("_m"),He=(0,o._)("_l"),Ze=(0,o._)("_y"),$e=(0,o._)("_c"),We=(0,o._)("_e"),Ye=(0,o._)("_C"),Ge=(0,o._)("_E"),Xe=(0,o._)("_g"),qe=(0,o._)("_R"),Ue=(0,o._)("_w"),Ke=(0,o._)("_I"),Qe=(0,o._)("_v"),Je=(0,o._)("_p"),tn=(0,o._)("_f"),en=(0,o._)("_S"),nn=(0,o._)("_b"),rn=(0,o._)("_T"),on=(0,o._)("_x");class an{getStatEvents(){return{click$:new i.Observable((t=>{(0,r._)(this,We)[We].on(Ft.graph,(({type:e,visibility:n})=>{"visibility"===e&&t.next(n?ct.OPEN_GRAPH:ct.CLOSE_GRAPH),"watchAgainClicked"===e&&t.next(ct.WATCH_AGAIN)})),(0,r._)(this,We)[We].on(Ft.interactives,(({type:e,subjectName:n,subjectType:r})=>{"action-choice"!==e||"control"!==n||("Button"===r&&t.next(ct.GO_NEXT_BUTTON),"Area"===r&&t.next(ct.GO_NEXT_AREA))}))})),nextMovie$:new i.Observable((t=>{(0,r._)(this,We)[We].on(Ft.playerChanged,(({config:e})=>{e?.unitedVideoId&&t.next(e.unitedVideoId)}))}))}}setPlayer(t){(0,r._)(this,Xe)[Xe](),this.options.player=t,qt.setPlayer(this.options.player),(0,r._)(this,Be)[Be]?(0,r._)(this,Be)[Be].setPlayer(this.options.player):(0,r._)(this,Be)[Be]=te(this.options.player),(0,r._)(this,ze)[ze]=se({player:this.options.player,interactiveEvents:(0,r._)(this,Be)[Be],globalEventEmitter:(0,r._)(this,We)[We],removeControllers:()=>(0,r._)(this,Je)[Je](!1)}),this.appState===Le.initiated&&((0,r._)(this,Qe)[Qe](),(0,r._)(this,tn)[tn]((0,r._)(this,Re)[Re].chapter))}async setManifest(t){(0,r._)(this,Xe)[Xe](),this.isFirstChapterFetched=!1;const e=await(0,r._)(this,Re)[Re].setManifest(t);return(0,r._)(this,He)[He]&&await(0,r._)(this,He)[He].handleManifestChange(e.manifest),await(0,r._)(this,Pe)[Pe].setManifest(e.manifest),(0,r._)(this,We)[We].emit(Ft.manifestChanged,{manifest:e.manifest}),(0,r._)(this,tn)[tn]((0,r._)(this,Re)[Re].chapter),e.manifest}setVisitedChapters(t){Array.isArray(t)&&(0,r._)(this,He)[He]?.setVisitedChapters(t)}updateGraphVideosInfo(t){Array.isArray(t)&&(0,r._)(this,He)[He]?.updateVideosInfo(t)}async setChapter({chapterId:t,pushToHistory:e=!0}={}){(0,r._)(this,Xe)[Xe](),(0,r._)(this,$e)[$e]&&this.isFirstChapterFetched&&((0,r._)(this,$e)[$e].draw(),(0,r._)(this,$e)[$e].show()),(0,i.getCurrentBrowser)().browser===i.CurrentClientBrowser.Safari&&await function(t=0){return new Promise((e=>{setTimeout((()=>{e(0)}),t)}))}(35);const n=await(t?(0,r._)(this,Re)[Re].setNext(t):(0,r._)(this,Re)[Re].setInitial()),{chapter:o,media:a,graph:s}=n;return e&&(0,r._)(this,on)[on](o.id),this.state.isInitialChapter$.next((0,r._)(this,Re)[Re].isInitialChapter()),this.state.isEndChapter$.next((0,r._)(this,Re)[Re].isEndChapter()),(0,r._)(this,He)[He]&&(0,r._)(this,He)[He].handleChapterChange(s),(0,r._)(this,$e)[$e]?.setCurrentChapter(this.getCurrentChapter().chapter),(0,r._)(this,We)[We].emit(Ft.chapterChanged,{chapter:o,media:a,graph:s}),(0,r._)(this,tn)[tn]((0,r._)(this,Re)[Re].chapter),(0,r._)(this,Fe)[Fe]=new Set,this.isFirstChapterFetched=!0,{chapter:o,media:a,graph:s}}toggleGraphView(t=!0){(0,r._)(this,He)[He]&&(t?((0,r._)(this,He)[He].show(),(0,r._)(this,De)[De].next(!1)):((0,r._)(this,He)[He].hide(),(0,r._)(this,nn)[nn]()),(0,r._)(this,We)[We].emit(Ft.graph,{type:Ht.visibility,visibility:t}))}init(){(0,r._)(this,Re)[Re].chapter&&this.options.parentElement&&this.options.player&&this.options.fullscreenTargetElement&&this.appState===Le.created&&((0,r._)(this,Oe)[Oe].resizeObserver.observe(this.options.fullscreenTargetElement),(0,r._)(this,Qe)[Qe](),this.appState=Le.initiated,(0,r._)(this,tn)[tn]((0,r._)(this,Re)[Re].chapter))}deadEndCheck(){return!((0,r._)(this,Be)[Be]?.getPreparedToExecActions()??[]).some((t=>t.actionType===lt.setNextBranch))}allControlsAreRemoved(){return!(0,r._)(this,Te)[Te].some((t=>!t.container.isRemoved))}playPrevChapter(){(0,r._)(this,Pe)[Pe]?.goBack()}setDisabledControls(t){this.state.disabledControls$.next(t)}isSupport(t=(0,r._)(this,Re)[Re].manifest){return ht(t.metadata.version)}getInitialVideoInfo(){return{videoId:(0,r._)(this,Pe)[Pe].getInitialVideoId(),chapterId:(0,r._)(this,Pe)[Pe].getInitialChapterId()}}getHistoryState(){return(0,r._)(this,Pe)[Pe].state}getIsSeekable(){return(0,r._)(this,De)[De]}getInteractiveRanges(){return((t=[])=>t.reduce(((t,e,n)=>{const r=(e?.controls??[]).filter((t=>!pt(t)));if(Tt(r)){const r=[e.startTime??0,e.endTime??1/0],o=e.id;if(n){const e=[];let n=-1/0,i=1/0,a=[];const s=[];for(let l=0;l<t.length;l++){const c=t[l];if(s.push(...c.subjects),c.range[0]<i&&(i=c.range[0]),c.range[1]>n&&(n=c.range[1]),c.range[0]<=r[0]&&c.range[1]>=r[1])return t[l].subjects.push(o),t;r[0]>=c.range[0]&&r[0]<=c.range[1]&&(e.push(l),a=a.concat(c.subjects),r[0]=c.range[0]),r[1]>=c.range[0]&&r[1]<=c.range[1]&&(e.push(l),a=a.concat(c.subjects),r[1]=c.range[1])}if(s.push(o),r[0]<=i&&r[1]>=n)return[{subjects:s,range:r}];e.length&&e.reverse().forEach((e=>{t.splice(e,1)})),t.push({subjects:a.concat([o]),range:r})}else t.push({subjects:[o],range:r})}return t}),[]).sort(((t,e)=>t.range[0]-e.range[0])))((0,r._)(this,Re)[Re].chapter?.containers)}getNextInteractiveStartTime(t){return qt.getNextInteractiveTime(t)}getChapterBranches(t){return(0,r._)(this,Re)[Re].getBranches(t)}getCurrentChapter(){return(0,r._)(this,Re)[Re].getCurrent()}getCurrentManifest(){return(0,r._)(this,Re)[Re].manifest}addFactory(t,e){this.factories.set(t.trim().toLowerCase(),e)}removeFactory(t){this.factories.delete(t.trim().toLowerCase())}on(...t){return(0,r._)(this,We)[We].on(...t),this}off(...t){return(0,r._)(this,We)[We].off(...t),this}once(...t){return(0,r._)(this,We)[We].once(...t),this}destroy(){(0,r._)(this,Je)[Je](),(0,r._)(this,Te)[Te]=void 0,this.state=void 0,(0,r._)(this,He)[He]?.destroy(),(0,r._)(this,He)[He]=void 0,(0,r._)(this,Oe)[Oe].release(),(0,r._)(this,Oe)[Oe]=void 0,(0,r._)(this,ze)[ze]=void 0,(0,r._)(this,Ve)[Ve].release(),(0,r._)(this,Ve)[Ve]=void 0,(0,r._)(this,Be)[Be].release(),(0,r._)(this,Be)[Be]=void 0,(0,r._)(this,Re)[Re].release(),(0,r._)(this,ze)[ze]=void 0,(0,r._)(this,Ae)[Ae].release(),(0,r._)(this,Ae)[Ae]=void 0,(0,r._)(this,je)[je].unsubscribe(),(0,r._)(this,je)[je]=void 0,(0,r._)(this,We)[We].reset(),(0,r._)(this,We)[We]=void 0,(0,r._)(this,$e)[$e]?.destroy(),(0,r._)(this,$e)[$e]=void 0,this.rootElement.remove(),this.rootElement=void 0,(0,r._)(this,Pe)[Pe].destroy(),(0,r._)(this,Pe)[Pe]=void 0,this.factories=void 0,this.options=void 0,this.isFirstChapterFetched=!1,this.appState=Le.destroyed}constructor(t){Object.defineProperty(this,Ye,{value:sn}),Object.defineProperty(this,Ge,{value:ln}),Object.defineProperty(this,Xe,{value:cn}),Object.defineProperty(this,Ke,{value:dn}),Object.defineProperty(this,Qe,{value:un}),Object.defineProperty(this,tn,{value:hn}),Object.defineProperty(this,en,{value:pn}),Object.defineProperty(this,nn,{value:fn}),Object.defineProperty(this,rn,{value:vn}),Object.defineProperty(this,on,{value:mn}),Object.defineProperty(this,Oe,{writable:!0,value:void 0}),Object.defineProperty(this,Te,{writable:!0,value:void 0}),Object.defineProperty(this,Ae,{writable:!0,value:void 0}),Object.defineProperty(this,Pe,{writable:!0,value:void 0}),Object.defineProperty(this,je,{writable:!0,value:void 0}),Object.defineProperty(this,Be,{writable:!0,value:void 0}),Object.defineProperty(this,Ve,{writable:!0,value:void 0}),Object.defineProperty(this,ze,{writable:!0,value:void 0}),Object.defineProperty(this,Re,{writable:!0,value:void 0}),Object.defineProperty(this,De,{writable:!0,value:void 0}),Object.defineProperty(this,Fe,{writable:!0,value:void 0}),Object.defineProperty(this,He,{writable:!0,value:void 0}),Object.defineProperty(this,Ze,{writable:!0,value:void 0}),Object.defineProperty(this,$e,{writable:!0,value:void 0}),Object.defineProperty(this,We,{writable:!0,value:void 0}),Object.defineProperty(this,qe,{writable:!0,value:void 0}),Object.defineProperty(this,Ue,{writable:!0,value:void 0}),Object.defineProperty(this,Je,{writable:!0,value:void 0}),(0,r._)(this,Oe)[Oe]=null,(0,r._)(this,Te)[Te]=null,(0,r._)(this,Ae)[Ae]=null,(0,r._)(this,Pe)[Pe]=null,(0,r._)(this,je)[je]=null,(0,r._)(this,Be)[Be]=null,(0,r._)(this,Ve)[Ve]=null,(0,r._)(this,ze)[ze]=null,(0,r._)(this,Re)[Re]=null,(0,r._)(this,De)[De]=new i.ValueSubject(!1),(0,r._)(this,Fe)[Fe]=new Set,(0,r._)(this,He)[He]=null,(0,r._)(this,Ze)[Ze]=null,(0,r._)(this,$e)[$e]=null,(0,r._)(this,We)[We]=null,this.state={prevChapter$:new i.ValueSubject(null),isInitialChapter$:new i.ValueSubject(!1),isEndChapter$:new i.ValueSubject(!1),isInteractiveExpectation$:new i.ValueSubject(!1),calledByInteractive$:new i.ValueSubject(!1),lastChapterChangeWasInitiatedByInteractive$:new i.ValueSubject(!1),disabledControls$:new i.ValueSubject(!1)},this.emitPlayerChanged=t=>{setTimeout((()=>{(0,r._)(this,We)[We].emit(Ft.playerChanged,t)}))},(0,r._)(this,qe)[qe]=()=>{(0,r._)(this,Ve)[Ve].fns.forEach((t=>t()));const t=1e3*this.options.player.info.position$.getValue(),e=((0,r._)(this,Re)[Re].chapter.containers||[]).filter((e=>e.startTime>=Math.floor(t)));for(const t of e){(0,r._)(this,Be)[Be].remove({timestamp:1/0,priority:"container",initiator:t.id});for(const e of t.controls)(0,r._)(this,Be)[Be].remove({timestamp:1/0,priority:"control",initiator:e.id});(0,r._)(this,Te)[Te].find((e=>e.container.container.id===t.id)).reset()}},(0,r._)(this,Ue)[Ue]=()=>{(0,r._)(this,Oe)[Oe].calc(),(0,r._)(this,Ve)[Ve].requestAnimation()},(0,r._)(this,Je)[Je]=(t=!0)=>{(0,r._)(this,Te)[Te].forEach((e=>{!t&&e.isPermanentText||((0,r._)(this,Ve)[Ve].removeFn(e.whilePlaying),e.destroy())}))},this.options={...Ne,...t},(0,r._)(this,Te)[Te]=[],this.factories=new Map([["choice",B]]),this.rootElement=function(){const t=document.createElement("div");return t.style.cssText="\n    position: absolute;\n    top: 0;\n    left: 0;\n  ",t}(),this.options.parentElement.append(this.rootElement),(0,r._)(this,We)[We]=new vt,(0,r._)(this,je)[je]=new i.Subscription,(0,r._)(this,Ae)[Ae]=new ke,(0,r._)(this,Pe)[Pe]=new we({interactiveController:this,globalEventEmitter:(0,r._)(this,We)[We],videoId:this.options.projectInfo?.videoId,historyApi:this.options.historyApi,params:this.options.historyParams}),this.options.lastFrame&&((0,r._)(this,$e)[$e]=new Ie({parentElement:this.options.parentElement,interactivesRootElement:this.rootElement,onError:t=>(0,r._)(this,We)[We].emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.SEAMLESS,t))})),(0,r._)(this,Ae)[Ae].listen(this.rootElement,"mousedown",(t=>t.stopPropagation())),(0,r._)(this,Ae)[Ae].listen(this.rootElement,"mouseup",(t=>t.stopPropagation())),(0,r._)(this,Re)[Re]=new Rt(this.options.loaders,(t=>(0,r._)(this,We)[We].emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.MANIFEST,t)))),(0,r._)(this,Be)[Be]=te(this.options.player),(0,r._)(this,Ve)[Ve]=new mt,(0,r._)(this,ze)[ze]=se({player:this.options.player,interactiveEvents:(0,r._)(this,Be)[Be],globalEventEmitter:(0,r._)(this,We)[We],removeControllers:(0,r._)(this,Je)[Je]}),(0,r._)(this,Oe)[Oe]=ne((()=>({player:this.options?.player,parentElement:this.options.parentElement,fns:this.options.lastFrame?[()=>{(0,r._)(this,$e)[$e].updateCanvasDimensions(!0)}]:[]}))),this.options.graph&&((0,r._)(this,He)[He]=new tt({root:this.options.parentElement,lang:this.options.lang,onOpenPreviewClick:t=>{this.setChapter({chapterId:t}),(0,r._)(this,We)[We].emit(Ft.graph,{type:Ht.watchAgainClicked,chapterId:t})},onError:t=>(0,r._)(this,We)[We].emit(Ft.errors,new ft(ft.Severity.RECOVERABLE,ft.Category.LOADERS,{message:t}))})),(0,r._)(this,Ye)[Ye](this.options.initSeamless),this.isFirstChapterFetched=!1,this.appState=Le.created}}function sn(t=!1){(0,r._)(this,We)[We].on(Ft.historyInited,(async({initChapterId:e,videosInfo:n=[]})=>{t&&await(0,r._)(this,Ge)[Ge]({initialChapter:e,videosInfo:n})})),(0,r._)(this,We)[We].on(Ft.interactives,(async t=>{if(t.type===Zt.actionExecution){if(this.state.calledByInteractive$.next(!0),this.state.lastChapterChangeWasInitiatedByInteractive$.next(!0),"change-chapter"===t.payload?.behaviour){const{chapterId:e}=t.payload;this.setChapter({chapterId:e})}if("change-manifest"===t.payload?.behaviour){const{manifestURL:e}=t.payload;this.setManifest(e)}const e="action-execution"===t.type;e&&"expect"===t.actionType?this.state.isInteractiveExpectation$.next(!0):e&&"after-expect"===t.actionType&&this.state.isInteractiveExpectation$.next(!1)}})),(0,r._)(this,We)[We].on(Ft.manifestChanged,(()=>{this.state.calledByInteractive$.next(!1),this.state.lastChapterChangeWasInitiatedByInteractive$.next(!1)}))}async function ln({source:t,videosInfo:e=[]}){(0,r._)(this,Ze)[Ze]=Xt(this);const n=document.createElement("div");(0,r._)(this,Ze)[Ze].on(Yt.activePlayerChanged,this.emitPlayerChanged);const{player:o,config:i}=await(0,r._)(this,Ze)[Ze].init({source:t,initialChapter:(0,r._)(this,Pe)[Pe].getInitialChapterId(),container:n});return this.updateGraphVideosInfo(e),{player:o,config:i}}function cn(){this.appState===Le.ready&&((0,r._)(this,Je)[Je](),(0,r._)(this,Te)[Te]=[],(0,r._)(this,Ve)[Ve].release(),(0,r._)(this,Be)[Be]?.release(),this.appState=Le.initiated,(0,r._)(this,De)[De].next(!1))}function dn(t){(!(0,r._)(this,He)[He]||(0,r._)(this,He)[He].isHidden)&&(0,r._)(this,nn)[nn]();const e=1e3*t,n=this.getInteractiveRanges().findLast((({range:t})=>e>=t[1]));if(n){const t=n.range.join("-");(0,r._)(this,Fe)[Fe].has(t)||((0,r._)(this,Fe)[Fe].add(t),(0,r._)(this,We)[We].emit(Ft.interactives,{type:Zt.rangeEnded,payload:n,visibility:!0}))}}function un(){(0,r._)(this,je)[je].unsubscribe(),(0,r._)(this,je)[je].add(this.options.player.events.started$.pipe((0,i.once)()).subscribe((0,r._)(this,Ue)[Ue])).add(this.options.player.events.playing$.subscribe((0,r._)(this,Ve)[Ve].requestAnimation)).add(this.options.player.events.willPause$.subscribe((0,r._)(this,Ve)[Ve].cancelAnimation)).add(this.options.player.info.position$.subscribe((0,r._)(this,Ke)[Ke].bind(this))).add((0,r._)(this,Re)[Re].prevChapter$.subscribe((t=>this.state.prevChapter$.next(t)))),this.options.lastFrame&&(0,r._)(this,je)[je].add(this.options.player.info.duration$.subscribe((t=>{(0,r._)(this,$e)[$e].setVideoDuration(1e3*t)}))).add(this.options.player.experimental.element$.subscribe((t=>{t&&(0,r._)(this,$e)[$e].setVideoElement(t)}))).add(this.options.player.events.firstFrame$.subscribe((()=>{(0,r._)(this,$e)[$e].reset(),setTimeout((()=>{(0,r._)(this,$e)[$e].hide(),(0,r._)(this,$e)[$e].lastFrameCanvas.clear()}),50)}))).add(this.options.player.events.seeked$.subscribe((0,r._)(this,$e)[$e].onSeek))}function hn(t){(0,r._)(this,Re)[Re].chapter&&this.appState===Le.initiated&&((0,r._)(this,ze)[ze].setManifestChapterEvents(t),(0,r._)(this,Te)[Te]=(0,r._)(this,en)[en](t),(0,r._)(this,Be)[Be].containersEventsCallState.setData(t.containers),qt.setContainers((0,r._)(this,Te)[Te].map((t=>t.container.container)).filter((t=>!zt(t.controls)))),this.options.lastFrame&&(0,r._)(this,Ve)[Ve].addFn((()=>{(0,r._)(this,$e)[$e].onEachTick(1e3*this.options.player.info.position$.getValue())}),!0),this.appState=Le.ready)}function pn(t){return t?.containers?.reduce(((t,e)=>{const n=e.type.trim().toLowerCase(),o=this.factories.get(n);if(o){const n=new Ut({player:this.options.player,container:o(e,this.rootElement),branches:(0,r._)(this,Re)[Re].chapter.branches,selectBranches:(0,r._)(this,ze)[ze],interactiveEvents:(0,r._)(this,Be)[Be],globalEventEmitter:(0,r._)(this,We)[We],ignoreContainerEvent:()=>((t,e)=>!Bt(t.events)&&e.some((({container:e})=>e.container.id!==t.id&&Bt(e.container.events)&&e.container.endTime===t.endTime&&!e.isRemoved)))(e,(0,r._)(this,Te)[Te]),permanentTextControls:this.options.permanentTextControls,disabledControls$:this.state.disabledControls$});return(0,r._)(this,Ve)[Ve].addFn(n.whilePlaying,!0),[...t,n]}return[...t]}),[])??[]}function fn(){if(this.state.isInteractiveExpectation$.getValue())return void(0,r._)(this,De)[De].next(!1);const t=(0,r._)(this,De)[De].getValue(),e=!!qt.getNextInteractiveTime();(e&&!t||!e&&t)&&(0,r._)(this,De)[De].next(!t)}function vn(){this.state.calledByInteractive$.getValue()?this.state.calledByInteractive$.next(!1):this.state.lastChapterChangeWasInitiatedByInteractive$.next(!1)}function mn(t){if((0,r._)(this,rn)[rn](),!(0,r._)(this,Pe)[Pe].inited)return;const e=this.state.lastChapterChangeWasInitiatedByInteractive$.getValue(),n=this.state.prevChapter$.getValue(),o=(n&&At(n)&&Pt(n))??!1,i=(0,r._)(this,Re)[Re].manifest.metadata.initChapterId===t,a=(0,r._)(this,Pe)[Pe].state.history$.getValue();i||o&&e?(0,r._)(this,Pe)[Pe].updateHistory([t]):a.at(-1)!==t&&(0,r._)(this,Pe)[Pe].updateHistory([...a,t])}const yn={version:"1.0.9"}}}]);try{stManager.done("dist/web/chunks/videoplayer-interactive.c61a72cb.js")}catch(t){}