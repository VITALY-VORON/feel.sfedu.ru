(()=>{"use strict";var __webpack_modules__={314869:(e,t,s)=>{s.d(t,{Icon12Like:()=>i});var i=(0,s(28178).makeIcon)("Icon12Like","like_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="like_12"><path fill-rule="evenodd" d="M6.003 2.47a4 4 0 0 0-.15-.145c-.438-.399-1.126-.827-2.053-.827C2.104 1.498.752 2.9.752 4.601c0 .842.166 1.486.682 2.19.509.694 1.354 1.443 2.692 2.507l1.231.979c.379.301.913.301 1.291 0l1.231-.979c1.338-1.064 2.184-1.813 2.693-2.507.516-.704.682-1.348.682-2.19 0-1.701-1.352-3.103-3.048-3.103-.926 0-1.615.428-2.053.827a4 4 0 0 0-.15.145" clip-rule="evenodd" /></symbol>',12,12,!1,void 0)},74106:(e,t,s)=>{s.d(t,{Icon16ChevronOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon16ChevronOutline","chevron_outline_16","0 0 12 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 16" id="chevron_outline_16"><path fill="currentColor" fill-rule="evenodd" d="M4.22 3.47a.75.75 0 0 1 1.06 0l4 4a.75.75 0 0 1 0 1.06l-4 4a.75.75 0 0 1-1.06-1.06L7.69 8 4.22 4.53a.75.75 0 0 1 0-1.06" clip-rule="evenodd" /></symbol>',12,16,!1,void 0)},530036:(e,t,s)=>{s.d(t,{Icon20MarketOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon20MarketOutline","market_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="market_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M7.25 5.75a2.75 2.75 0 0 1 5.5 0V6h-5.5zm-1.5.254V5.75a4.25 4.25 0 0 1 8.5 0v.254c1.013.014 1.62.073 2.112.323a3 3 0 0 1 1.311 1.311C18 8.28 18 9.12 18 10.8v.5c0 2.52 0 3.78-.49 4.743a4.5 4.5 0 0 1-1.967 1.967c-.963.49-2.223.49-4.743.49H9.2c-2.52 0-3.78 0-4.743-.49a4.5 4.5 0 0 1-1.967-1.967C2 15.08 2 13.82 2 11.3v-.5c0-1.68 0-2.52.327-3.162a3 3 0 0 1 1.311-1.311c.492-.25 1.1-.31 2.112-.323m-.798 1.532C5.377 7.5 5.935 7.5 6.8 7.5h6.4c.865 0 1.423.001 1.848.036.408.033.559.09.633.127a1.5 1.5 0 0 1 .656.656c.037.074.094.225.127.633.035.425.036.983.036 1.848v.5c0 1.285-.001 2.158-.056 2.833-.054.658-.151.994-.271 1.229a3 3 0 0 1-1.311 1.311c-.235.12-.57.217-1.229.27C12.958 17 12.085 17 10.8 17H9.2c-1.285 0-2.158-.001-2.833-.056-.658-.054-.994-.151-1.229-.271a3 3 0 0 1-1.311-1.311c-.12-.235-.217-.57-.27-1.229C3.5 13.458 3.5 12.585 3.5 11.3v-.5c0-.865.001-1.423.036-1.848.033-.408.09-.559.127-.633a1.5 1.5 0 0 1 .656-.656c.074-.037.225-.094.633-.127m.798 2.339a.875.875 0 1 1 1.75 0 .875.875 0 0 1-1.75 0M13.375 9a.875.875 0 1 0 0 1.75.875.875 0 0 0 0-1.75" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},203680:(e,t,s)=>{s.d(t,{Icon24Compass:()=>i});var i=(0,s(28178).makeIcon)("Icon24Compass","compass_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="compass_24"><path fill-rule="evenodd" d="M7.392 5.889 20.02 3.02a.8.8 0 0 1 .957.958l-2.88 12.636a2 2 0 0 1-1.509 1.506l-12.61 2.86a.8.8 0 0 1-.957-.958L5.885 7.397a2 2 0 0 1 1.507-1.508M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},763242:(e,t,s)=>{s.d(t,{Icon24MessageOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon24MessageOutline","message_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="message_outline_24"><path fill="currentColor" d="M7.713 18.202a.9.9 0 0 1 1-.259A9.4 9.4 0 0 0 12 18.53c4.502 0 8.1-3.085 8.1-6.815S16.502 4.9 12 4.9s-8.1 3.084-8.1 6.814c0 1.283.423 2.515 1.214 3.586a.9.9 0 0 1 .176.538c-.003.893-.376 2.179-1.114 3.915 1.654-.184 2.82-.71 3.537-1.551m-4.324 3.413c-.914.036-1.594-.943-1.209-1.795.776-1.715 1.203-2.974 1.292-3.724-.891-1.312-1.372-2.815-1.372-4.382C2.1 6.924 6.56 3.1 12 3.1s9.9 3.823 9.9 8.614-4.46 8.615-9.9 8.615c-1.157 0-2.287-.173-3.353-.506-1.21 1.116-2.975 1.703-5.258 1.792" /></symbol>',24,24,!1,void 0)},729400:(e,t,s)=>{s.d(t,{Icon24NarrativeOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon24NarrativeOutline","narrative_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="narrative_outline_24"><path fill="currentColor" d="M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 1 1-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.73 1.73 0 0 0-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119q-.39.365-.512.886c-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302q.366.39.887.512c.401.093.745.076 1.607-.14a1 1 0 1 1 .487 1.94c-1.148.288-1.805.32-2.549.147a3.73 3.73 0 0 1-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.7 3.7 0 0 1 .93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22M18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.2 4.2 0 0 1 2.036-.653zm0 2c-.63 0-1.17.228-1.67.716l-.349.34a.5.5 0 0 1-.698 0l-.35-.34c-.5-.488-1.04-.716-1.67-.716-.906 0-1.631.707-1.631 1.567 0 .993.4 1.546 2.524 3.185L16 18.875l1.012-.767c2.45-1.859 2.957-2.442 2.988-3.44l.001-.1c0-.86-.725-1.568-1.632-1.568" /></symbol>',24,24,!1,void 0)},427323:(e,t,s)=>{s.d(t,{Icon24SmileOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon24SmileOutline","smile_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="smile_outline_24"><path d="M8.438 14.297a.9.9 0 0 1 1.259.133c.013.016.196.223.53.432.383.24.97.488 1.773.488a3.3 3.3 0 0 0 1.773-.488c.191-.12.382-.26.53-.432a.9.9 0 0 1 1.4 1.132 4 4 0 0 1-.976.826A5.1 5.1 0 0 1 12 17.15a5.1 5.1 0 0 1-2.727-.762 4 4 0 0 1-.976-.826.9.9 0 0 1 .14-1.265Zm1.812-4.047a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0M15 11.5A1.25 1.25 0 1 0 15 9a1.25 1.25 0 0 0 0 2.5m-3-9.4c-5.468 0-9.9 4.432-9.9 9.9s4.432 9.9 9.9 9.9 9.9-4.432 9.9-9.9-4.432-9.9-9.9-9.9M3.9 12a8.1 8.1 0 1 1 16.2 0 8.1 8.1 0 0 1-16.2 0" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},648184:(e,t,s)=>{s.d(t,{Icon24StoryOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon24StoryOutline","story_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="story_outline_24"><path fill="currentColor" fill-rule="evenodd" d="M10.3 3h-.039C9.174 3 8.303 3 7.6 3.058c-.723.059-1.349.183-1.924.476a4.9 4.9 0 0 0-2.142 2.141c-.293.576-.418 1.202-.477 1.924C3 8.304 3 9.175 3 10.262v3.478c0 1.087 0 1.958.058 2.661.059.723.183 1.349.476 1.925a4.9 4.9 0 0 0 2.141 2.14c.576.294 1.202.419 1.924.478.704.057 1.575.057 2.662.057h3.478c1.087 0 1.958 0 2.661-.057.723-.06 1.349-.184 1.925-.477a4.9 4.9 0 0 0 2.14-2.141c.294-.576.419-1.202.478-1.925.057-.703.057-1.574.057-2.661v-3.478c0-1.087 0-1.958-.057-2.661-.06-.723-.184-1.349-.477-1.924a4.9 4.9 0 0 0-2.141-2.142c-.576-.293-1.202-.417-1.925-.476C15.697 3 14.826 3 13.74 3zM6.493 5.138c.28-.143.642-.236 1.253-.286C8.368 4.8 9.166 4.8 10.3 4.8h3.4c1.135 0 1.932 0 2.554.052.611.05.974.143 1.253.286a3.1 3.1 0 0 1 1.355 1.355c.143.28.237.642.287 1.253.05.622.051 1.42.051 2.554v3.4c0 1.135 0 1.932-.051 2.554-.05.611-.144.974-.287 1.253a3.1 3.1 0 0 1-1.355 1.355c-.28.143-.642.237-1.253.287-.622.05-1.419.051-2.554.051h-3.4c-1.135 0-1.932 0-2.554-.051-.611-.05-.974-.144-1.253-.287a3.1 3.1 0 0 1-1.355-1.355c-.143-.28-.236-.642-.286-1.253C4.8 15.632 4.8 14.835 4.8 13.7v-3.4c0-1.135 0-1.932.052-2.554.05-.611.143-.974.286-1.253a3.1 3.1 0 0 1 1.355-1.355M9.8 12a2.199 2.199 0 1 1 4.398 0A2.199 2.199 0 0 1 9.8 12M12 8.001a3.999 3.999 0 1 0 0 7.998 3.999 3.999 0 0 0 0-7.998" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},449909:(e,t,s)=>{s.d(t,{Icon24ViewOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon24ViewOutline","view_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="view_outline_24"><path d="M12 4.6c5.2 0 10.4 4.237 10.4 7.4s-5.2 7.4-10.4 7.4S1.6 15.163 1.6 12 6.8 4.6 12 4.6m0 1.8c-4.278 0-8.6 3.522-8.6 5.6s4.322 5.6 8.6 5.6 8.6-3.522 8.6-5.6-4.322-5.6-8.6-5.6m0 2.2a3.4 3.4 0 1 1 0 6.8 3.4 3.4 0 0 1 0-6.8m0 1.8a1.6 1.6 0 1 0 0 3.2 1.6 1.6 0 0 0 0-3.2" /></symbol>',24,24,!1,void 0)},738219:(e,t,s)=>{s.d(t,{Icon28Like:()=>i});var i=(0,s(28178).makeIcon)("Icon28Like","like_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="like_28"><path fill="currentColor" d="M9.026 4.88A6.526 6.526 0 0 0 2.5 11.406c0 3.613 1.445 5.421 7.493 10.126l2.78 2.16a2 2 0 0 0 2.455 0l2.779-2.16c6.048-4.705 7.493-6.513 7.493-10.126a6.526 6.526 0 0 0-6.526-6.526c-1.872 0-3.538.85-4.974 2.487C12.564 5.73 10.898 4.88 9.026 4.88" /></symbol>',28,28,!1,void 0)},668088:(e,t,s)=>{s.d(t,{Icon28LikeOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon28LikeOutline","like_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="like_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path fill="currentColor" fill-rule="nonzero" d="M9.026 4.88A6.526 6.526 0 0 0 2.5 11.406c0 3.613 1.445 5.421 7.493 10.126l2.78 2.16a2 2 0 0 0 2.455 0l2.779-2.16c6.048-4.705 7.493-6.513 7.493-10.126a6.526 6.526 0 0 0-6.526-6.526c-1.872 0-3.538.85-4.974 2.487C12.564 5.73 10.898 4.88 9.026 4.88m0 2c1.52 0 2.889.858 4.152 2.683l.205.298a.75.75 0 0 0 1.234 0l.205-.298c1.263-1.825 2.633-2.683 4.152-2.683 2.5 0 4.526 2.027 4.526 4.526 0 2.78-1.137 4.204-6.721 8.547L14 22.114l-2.779-2.161C5.637 15.61 4.5 14.187 4.5 11.406c0-2.5 2.027-4.526 4.526-4.526" /></g></symbol>',28,28,!1,void 0)},528735:(e,t,s)=>{s.d(t,{Icon36ChainOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon36ChainOutline","chain_outline_36","0 0 36 36",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 36 36" id="chain_outline_36"><path fill="currentColor" fill-rule="evenodd" d="M14.355 21.634a1.25 1.25 0 1 0 1.767-1.768c-1.55-1.549-1.49-4.193.153-5.834l6.34-6.336a4.09 4.09 0 0 1 5.78 0c1.531 1.53 1.47 3.754-.178 5.41l-1.83 1.738a1.25 1.25 0 1 0 1.721 1.812l1.843-1.75.011-.01.011-.012c2.51-2.508 2.822-6.326.189-8.957a6.59 6.59 0 0 0-9.313 0l-6.341 6.337c-2.526 2.523-2.77 6.754-.153 9.37m7.29-7.268a1.25 1.25 0 0 0-1.767 1.768c1.55 1.549 1.49 4.193-.153 5.834l-6.34 6.336a4.09 4.09 0 0 1-5.78 0c-1.531-1.53-1.47-3.754.178-5.41l1.83-1.738a1.25 1.25 0 0 0-1.721-1.812l-1.843 1.75-.011.01-.011.012c-2.51 2.508-2.822 6.326-.189 8.957a6.59 6.59 0 0 0 9.313 0l6.341-6.337c2.526-2.523 2.77-6.754.153-9.37" clip-rule="evenodd" /></symbol>',36,36,!1,void 0)},816271:(e,t,s)=>{s.d(t,{Icon56CompassOutline:()=>i});var i=(0,s(28178).makeIcon)("Icon56CompassOutline","compass_outline_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="compass_outline_56"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M36.92 21.208c.406-1.307-.82-2.534-2.127-2.128l-11.036 3.425a1.9 1.9 0 0 0-1.252 1.252L19.08 34.792c-.406 1.307.82 2.534 2.128 2.128l11.036-3.425a1.9 1.9 0 0 0 1.251-1.251zm-11.721 3.99 8.124-2.52L30.8 30.8l-8.124 2.522z" /><path d="M52 28c0 13.255-10.745 24-24 24S4 41.255 4 28 14.745 4 28 4s24 10.745 24 24m-3 0c0 11.598-9.402 21-21 21S7 39.598 7 28 16.402 7 28 7s21 9.402 21 21" /></g></symbol>',56,56,!1,void 0)},58255:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(111132);function o(e,t){e.classList?e.classList.add(t):(0,i.default)(e,t)||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}},111132:(e,t,s)=>{function i(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}s.d(t,{default:()=>i})},374277:(e,t,s)=>{function i(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function o(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=i(e.className,t):e.setAttribute("class",i(e.className&&e.className.baseVal||"",t))}s.d(t,{default:()=>o})},50486:(e,t,s)=>{s.d(t,{default:()=>i});const i={create:"StoryAvatar-module__create--yc1_j",createInCell:"StoryAvatar-module__createInCell--Huigk",discover:"StoryAvatar-module__discover--WZmdZ",discoverInCell:"StoryAvatar-module__discoverInCell--OUBfD"}},659757:(e,t,s)=>{s.d(t,{default:()=>i});const i={aside:"StoryBlock-module__aside--ypV1W",container:"StoryBlock-module__container--w7hW7"}},790666:(e,t,s)=>{s.d(t,{default:()=>i});const i={root:"StoryCard-module__root--slf7d",rootActive:"StoryCard-module__rootActive--WED5K",background:"StoryCard-module__background--nuvhw",gradient:"StoryCard-module__gradient--aO2V1",content:"StoryCard-module__content--IHAaa",name:"StoryCard-module__name--pKGtF",avatar:"StoryCard-module__avatar--x_h5j"}},418753:(e,t,s)=>{s.d(t,{default:()=>i});const i={root:"StoryCell-module__root--pNICu",name:"StoryCell-module__name--iny93",hover:"StoryCell-module__hover--WrNrr",active:"StoryCell-module__active--Gl1cR"}},310738:(e,t,s)=>{s.d(t,{default:()=>i});const i={aside:"StoryMinimizedBlock-module__aside--XCKa8",root:"StoryMinimizedBlock-module__root--YmvjV",container:"StoryMinimizedBlock-module__container--rTfiR"}},839386:(e,t,s)=>{s.d(t,{default:()=>i});const i={root:"TemplateSticker-module__root--NaXEh"}},429697:(e,t,s)=>{s.d(t,{default:()=>u});var i=s(487462),o=s(263366),r=s(894578),n=s(58255),a=s(374277),l=s(667294),d=s(696630),c=s(559391),h=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return(0,a.default)(e,t)}))},_=function(e){function t(){for(var t,s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,s){var i=t.resolveArguments(e,s),o=i[0],r=i[1];t.removeClasses(o,"exit"),t.addClass(o,r?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,s)},t.onEntering=function(e,s){var i=t.resolveArguments(e,s),o=i[0],r=i[1]?"appear":"enter";t.addClass(o,r,"active"),t.props.onEntering&&t.props.onEntering(e,s)},t.onEntered=function(e,s){var i=t.resolveArguments(e,s),o=i[0],r=i[1]?"appear":"enter";t.removeClasses(o,r),t.addClass(o,r,"done"),t.props.onEntered&&t.props.onEntered(e,s)},t.onExit=function(e){var s=t.resolveArguments(e)[0];t.removeClasses(s,"appear"),t.removeClasses(s,"enter"),t.addClass(s,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var s=t.resolveArguments(e)[0];t.addClass(s,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var s=t.resolveArguments(e)[0];t.removeClasses(s,"exit"),t.addClass(s,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,s){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,s]},t.getClassNames=function(e){var s=t.props.classNames,i="string"==typeof s,o=i?""+(i&&s?s+"-":"")+e:s[e];return{baseClassName:o,activeClassName:i?o+"-active":s[e+"Active"],doneClassName:i?o+"-done":s[e+"Done"]}},t}(0,r.default)(t,e);var s=t.prototype;return s.addClass=function(e,t,s){var i=this.getClassNames(t)[s+"ClassName"],o=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===s&&o&&(i+=" "+o),"active"===s&&e&&(0,c.forceReflow)(e),i&&(this.appliedClasses[t][s]=i,function(e,t){e&&t&&t.split(" ").forEach((function(t){return(0,n.default)(e,t)}))}(e,i))},s.removeClasses=function(e,t){var s=this.appliedClasses[t],i=s.base,o=s.active,r=s.done;this.appliedClasses[t]={},i&&h(e,i),o&&h(e,o),r&&h(e,r)},s.render=function(){var e=this.props,t=(e.classNames,(0,o.default)(e,["classNames"]));return l.createElement(d.default,(0,i.default)({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(l.Component);_.defaultProps={classNames:""},_.propTypes={};const u=_},696630:(e,t,s)=>{s.d(t,{default:()=>y});var i=s(263366),o=s(894578),r=s(667294),n=s(973935),a=s(806035),l=s(500220),d=s(559391),c="unmounted",h="exited",_="entering",u="entered",p="exiting",m=function(e){function t(t,s){var i;i=e.call(this,t,s)||this;var o,r=s&&!s.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?r?(o=h,i.appearStatus=_):o=u:o=t.unmountOnExit||t.mountOnEnter?c:h,i.state={status:o},i.nextCallback=null,i}(0,o.default)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===c?{status:h}:null};var s=t.prototype;return s.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},s.componentDidUpdate=function(e){var t=null;if(e!==this.props){var s=this.state.status;this.props.in?s!==_&&s!==u&&(t=_):s!==_&&s!==u||(t=p)}this.updateStatus(!1,t)},s.componentWillUnmount=function(){this.cancelNextCallback()},s.getTimeouts=function(){var e,t,s,i=this.props.timeout;return e=t=s=i,null!=i&&"number"!=typeof i&&(e=i.exit,t=i.enter,s=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:s}},s.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===_){if(this.props.unmountOnExit||this.props.mountOnEnter){var s=this.props.nodeRef?this.props.nodeRef.current:n.findDOMNode(this);s&&(0,d.forceReflow)(s)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===h&&this.setState({status:c})},s.performEnter=function(e){var t=this,s=this.props.enter,i=this.context?this.context.isMounting:e,o=this.props.nodeRef?[i]:[n.findDOMNode(this),i],r=o[0],l=o[1],d=this.getTimeouts(),c=i?d.appear:d.enter;!e&&!s||a.default.disabled?this.safeSetState({status:u},(function(){t.props.onEntered(r)})):(this.props.onEnter(r,l),this.safeSetState({status:_},(function(){t.props.onEntering(r,l),t.onTransitionEnd(c,(function(){t.safeSetState({status:u},(function(){t.props.onEntered(r,l)}))}))})))},s.performExit=function(){var e=this,t=this.props.exit,s=this.getTimeouts(),i=this.props.nodeRef?void 0:n.findDOMNode(this);t&&!a.default.disabled?(this.props.onExit(i),this.safeSetState({status:p},(function(){e.props.onExiting(i),e.onTransitionEnd(s.exit,(function(){e.safeSetState({status:h},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:h},(function(){e.props.onExited(i)}))},s.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},s.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},s.setNextCallback=function(e){var t=this,s=!0;return this.nextCallback=function(i){s&&(s=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){s=!1},this.nextCallback},s.onTransitionEnd=function(e,t){this.setNextCallback(t);var s=this.props.nodeRef?this.props.nodeRef.current:n.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(s&&!i){if(this.props.addEndListener){var o=this.props.nodeRef?[this.nextCallback]:[s,this.nextCallback],r=o[0],a=o[1];this.props.addEndListener(r,a)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},s.render=function(){var e=this.state.status;if(e===c)return null;var t=this.props,s=t.children,o=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,(0,i.default)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return r.createElement(l.default.Provider,{value:null},"function"==typeof s?s(e,o):r.cloneElement(r.Children.only(s),o))},t}(r.Component);function g(){}m.contextType=l.default,m.propTypes={},m.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:g,onEntering:g,onEntered:g,onExit:g,onExiting:g,onExited:g},m.UNMOUNTED=c,m.EXITED=h,m.ENTERING=_,m.ENTERED=u,m.EXITING=p;const y=m},500220:(e,t,s)=>{s.d(t,{default:()=>i});const i=s(667294).createContext(null)},806035:(e,t,s)=>{s.d(t,{default:()=>i});const i={disabled:!1}},559391:(e,t,s)=>{s.d(t,{forceReflow:()=>i});var i=function(e){return e.scrollTop}},320269:(e,t,s)=>{function i(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M9.77 5.35c.5.29.5 1.01 0 1.3L4.15 9.9a.75.75 0 0 1-1.13-.65v-6.5c0-.57.63-.94 1.13-.65z" fill="currentColor"/></svg>',name:"play_12"}}s.d(t,{getIcon12Play:()=>i})},931059:(e,t,s)=>{function i(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M12 5.54C12 2.48 9.32 0 6.01 0 2.71 0 .02 2.48.02 5.54c0 1.09.34 2.1.93 2.95 0 .95-.41 1.91-.78 2.78l-.15.35c-.07.18.06.39.24.38 1.56-.07 2.74-.53 3.35-1.39.74.3 1.55.47 2.4.47 3.3 0 5.99-2.48 5.99-5.54zM6 3.25a.5.5 0 0 0-.49.39.75.75 0 0 1-1.46-.35A2 2 0 0 1 6 1.75c1.14 0 1.97.94 1.97 2.04a2 2 0 0 1-.28 1.06c-.16.27-.38.47-.52.6-.28.26-.39.36-.43.65a.75.75 0 0 1-1.48-.2c.1-.83.57-1.26.86-1.52l.04-.04c.14-.13.2-.2.24-.26a.52.52 0 0 0 .07-.29c0-.36-.24-.54-.47-.54zm.9 5.26a.9.9 0 1 1-1.8 0 .9.9 0 0 1 1.8 0z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"question_12"}}s.d(t,{getIcon12Question:()=>i})},431925:(e,t,s)=>{function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M12 7a.9.9 0 0 1 .9.9v3.2h3.2a.9.9 0 0 1 .9.9.9.9 0 0 1-.9.9h-3.2v3.2a.9.9 0 0 1-.9.9.9.9 0 0 1-.9-.9v-3.2H7.9A.9.9 0 0 1 7 12a.9.9 0 0 1 .9-.9h3.2V7.9A.9.9 0 0 1 12 7ZM9.46 3h5.08c.95 0 1.71 0 2.33.05.64.05 1.2.16 1.73.43a4.4 4.4 0 0 1 1.92 1.92c.27.52.38 1.09.43 1.73.05.62.05 1.38.05 2.33v5.08c0 .95 0 1.71-.05 2.33-.05.64-.16 1.2-.43 1.73a4.4 4.4 0 0 1-1.92 1.92 4.5 4.5 0 0 1-1.73.43c-.62.05-1.38.05-2.33.05H9.46c-.95 0-1.71 0-2.33-.05a4.5 4.5 0 0 1-1.73-.43 4.4 4.4 0 0 1-1.92-1.92 4.5 4.5 0 0 1-.43-1.73C3 16.25 3 15.5 3 14.54V9.46c0-.95 0-1.71.05-2.33.05-.64.16-1.2.43-1.73A4.4 4.4 0 0 1 5.4 3.48a4.51 4.51 0 0 1 1.73-.43C7.75 3 8.5 3 9.46 3ZM7.27 4.84c-.52.05-.82.13-1.05.24a2.6 2.6 0 0 0-1.14 1.14c-.11.23-.2.53-.24 1.05-.04.54-.04 1.24-.04 2.23v5c0 1 0 1.69.04 2.23.05.52.13.82.24 1.05a2.6 2.6 0 0 0 1.14 1.14c.23.11.53.2 1.05.24.54.04 1.24.04 2.23.04h5c1 0 1.69 0 2.23-.04.52-.05.82-.13 1.05-.24a2.6 2.6 0 0 0 1.14-1.14c.11-.23.2-.53.24-1.05.04-.54.04-1.24.04-2.23v-5c0-1 0-1.69-.04-2.23a2.77 2.77 0 0 0-.24-1.05 2.6 2.6 0 0 0-1.14-1.14c-.23-.11-.53-.2-1.05-.24-.54-.04-1.24-.04-2.23-.04h-5c-1 0-1.69 0-2.23.04Z" clip-rule="evenodd"/></svg>',name:"add_square_outline_24"}}s.d(t,{getIcon24AddSquareOutline:()=>i})},515033:(e,t,s)=>{function i(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="user_add_outline_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_add_outline_24__user_add_outline_24"><path id="user_add_outline_24__Bounds" d="M0 0h24v24H0z"/><path d="M18.85 7.95a2.85 2.85 0 1 0-5.7 0 2.85 2.85 0 0 0 5.7 0Zm1.8 0a4.65 4.65 0 1 1-9.3 0 4.65 4.65 0 0 1 9.3 0ZM9.9 18.43c0 .77-.1.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03Zm-4-8.33h2.7a.9.9 0 1 1 0 1.8H5.9v2.7a.9.9 0 1 1-1.8 0v-2.7H1.4a.9.9 0 1 1 0-1.8h2.7V7.4a.9.9 0 1 1 1.8 0v2.7Zm2.2 8.33c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.14 2.47H10.24c-1.45 0-2.14-.74-2.14-2.47Z" id="user_add_outline_24__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"user_add_outline_24"}}s.d(t,{getIcon24UserAddOutline:()=>i})},922404:(e,t,s)=>{function i(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="user_added_outline_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_added_outline_24__user_added_outline_24"><path id="user_added_outline_24__Bounds" d="M0 0h24v24H0z"/><path d="M18.85 7.95a2.85 2.85 0 1 0-5.7 0 2.85 2.85 0 0 0 5.7 0Zm1.8 0a4.65 4.65 0 1 1-9.3 0 4.65 4.65 0 0 1 9.3 0ZM9.9 18.43c0 .77-.1.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03Zm-1.8 0c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.14 2.47H10.24c-1.45 0-2.14-.74-2.14-2.47Zm.26-9.57a.9.9 0 1 1 1.28 1.28l-5 5a.9.9 0 0 1-1.28 0l-2.5-2.5a.9.9 0 1 1 1.28-1.28L4 13.23l4.36-4.37Z" id="user_added_outline_24__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"user_added_outline_24"}}s.d(t,{getIcon24UserAddedOutline:()=>i})},558149:(e,t,s)=>{function i(){return{icon:'<svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 32a1.5 1.5 0 0 1 0-3 13 13 0 1 0-12.2-8.5 1.5 1.5 0 1 1-2.81 1.04A15.97 15.97 0 0 1 0 16a16 16 0 1 1 16 16Z" fill="currentColor"/></svg>',name:"spinner_32"}}s.d(t,{getIcon32Spinner:()=>i})},892665:(e,t,s)=>{s.d(t,{random:()=>r});var i=s(902947);const o=2147483647;function r(){try{if(window.crypto){let e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,i.intval)((0,i.rand)(0,o).toFixed(0))}},618030:(e,t,s)=>{s.d(t,{default:()=>d});var i=s(255693),o=s(43129),r=s(70689),n=s(636322),a=s(93367);function l(e,t,s){if((0,n.isObject)(t)?s=t:this._dragElClass=t,this.options=(0,n.extend)({dragThreshold:l.DRAG_THRESHOLD_DIST},s),this._contEl=(0,r.ge)(e),this._contEl){this._excludedCount=0;for(let e=0;e<this._contEl.children.length;e++)this._contEl.children[e].getAttribute("nodrag")&&this._excludedCount++;(0,a.addEvent)(this._contEl,"mousedown",this._ev_mousedown_handler=this._onMouseDown.bind(this)),(0,r.setStyle)(this._contEl,"position","relative"),this._inited=!0,this._updateScrollbar=this._initUpdaterScrollbar()}}l.AUTO_SCROLL_DY=10,l.DRAG_THRESHOLD_DIST=0,l.AUTO_SCROLL_DISTANCE_THRESHOLD=300,l.AUTO_SCROLL_GAP=300,l.prototype.destroy=function(){this._inited&&(this._inited=!1,this._deinitEvents(!0))},l.prototype._getParentDragItemEl=function(e){let t,s=e;for(;s&&(t=(0,r.domPN)(s))!==this._contEl;)s=t;return s===this._curPlaceholderEl&&(s=null),s},l.prototype._onKey=function(e){e.keyCode===a.KEY.ESC&&this.isCurrentlyDragging()&&this._onMouseUp()},l.prototype.forceFinishDrag=function(e){this.isCurrentlyDragging()?(this.onDragFinish=e,this._onMouseUp(!0)):e()},l.prototype._onMouseDown=function(e){if(this._disabled||0!=e.button||this._curDragEl||(0,r.attr)(e.target,"nodrag")||this._dragElClass&&!(0,r.domClosest)(this._dragElClass,e.target))return;let t=e.target;for(;t&&t!==window.document;){if((0,n.intval)((0,r.domData)(t,"nodrag")))return;t=(0,r.domPN)(t)}const s=this._getParentDragItemEl(e.target);if(!s||(0,r.attr)(s,"nodrag"))return;if((0,r.re)((0,r.geByClass1)("ui_gridsorter_placeholder"),this._contEl),this._contInfo=this._contInfo||{prevSize:(0,r.getSize)(this._contEl)},this._ensureGridIsActual(),this._grid.length<=1)return;const i=window.getComputedStyle(s),o=(0,r.getXY)(s);this._initial={candidateEl:s,x:e.clientX,y:e.clientY,itemMargin:{x:parseInt(i.marginLeft),y:parseInt(i.marginTop)},shift:{x:e.pageX-o[0],y:e.pageY-o[1]}},(0,a.addEvent)(document,"mousemove",this._ev_mousemove_handler=this._onMouseMove.bind(this)),(0,a.addEvent)(document,"mouseup",this._ev_mouseup_handler=this._onMouseUp.bind(this)),(0,a.addEvent)(document,"keydown",this._ev_keydown_handler=this._onKey.bind(this)),cur.cancelClick=!1,(0,a.cancelEvent)(e)},l.prototype._dist=function(e){return Math.abs(e.clientX-this._initial.x)+Math.abs(e.clientY-this._initial.y)},l.prototype._onMouseUp=function(e){const t=this._curDragEl;let s=!e;if(!0===e&&(e=void 0),this._curDragEl){this._curDragEl=null,(0,r.removeClass)(t,"ui_gridsorter_moveable_notrans"),this._curOverCell||(this._curOverCell={el:this._curPlaceholderEl,pos:(0,r.getXY)(this._curPlaceholderEl),size:(0,r.getSize)(this._curPlaceholderEl)});const i=this._curOverCell.pos,o=this._curOverCell.el,n=this._grid[this._curDragCellIndex],l=n&&n.size;(0,r.gpeByClass)("_ape_item_list",t)&&(i[0]+=20,i[1]+=20),l&&this._isShiftToLeft&&(i[1]-=l[1]-this._curOverCell.size[1]),setTimeout((()=>{if(s){for(let e=0,t=this._grid.length;e<t;e++){const t=this._grid[e];t.dirty&&this._setPos(t.el,{left:0,top:0})}this._setPos(t,this._initialCurDragPos)}else this._setPos(t,{left:i[0],top:i[1]})})),setTimeout((()=>{if((0,r.re)(this._curPlaceholderEl),(0,r.removeClass)(this._contEl,"ui_gridsorter_cont"),this.options.dragCls&&(0,r.removeClass)(t,this.options.dragCls),!this._inited)return;let e;if(s){let e=this._grid.length;for(let t=0;t<e;t++){const e=this._grid[t];e.dirty&&this._setPos(e.el,{left:null,top:null})}this._setPos(t,{left:null,top:null,width:null,height:null})}else{let s;e=this._isShiftToLeft?(0,r.domNS)(o):o,this._contEl.insertBefore(t,e);let i=-1,n=this._initial.hasInlineSize;this._setPos(t,{left:null,top:null}),n||(0,r.setStyle)(t,{width:null,height:null});let a=this._grid.length;for(let e=0;e<a;e++){const a=this._grid[e];(a.dirty||a.el===t)&&(this._setPos(a.el,{left:null,top:null}),n||(0,r.setStyle)(a.el,{width:null,height:null}),a.pos=this._calcElementPos(a.el),a.dirty=!1),a.el===t?s=e:a.el===o&&(i=e)}if(i>=0){const e=this._grid.splice(s,1);this._grid.splice(i,0,e[0])}}(0,r.removeClass)(t,"ui_gridsorter_moveable"),this._curOverCell=this._curPlaceholderEl=null,s&&this.update(),this.options.onDragFinish&&this.options.onDragFinish(t),o!==t&&!s&&this.options.onReorder&&this.options.onReorder(t,e,(0,r.domPS)(t)),this.onDragFinish&&(this.onDragFinish(),this.onDragFinish=void 0)}),210),e&&this._dist(e)>5&&((0,a.cancelEvent)(e),cur.cancelClick=!0)}this._updateScrollbar(),this._deinitEvents(),t&&this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,t),s||t&&this._overEl&&this.options.onDragDrop&&(s=this.options.onDragDrop(this._overEl,t)),this._overEl=null},l.prototype._deinitEvents=function(e){e&&(this._onMouseUp(),(0,a.removeEvent)(this._contEl,"mousedown",this._ev_mousedown_handler)),clearTimeout(this._autoScrollTO),this._autoScrollTO=!1,this._ev_mousemove_handler&&(0,a.removeEvent)(document,"mousemove",this._ev_mousemove_handler),this._ev_mouseup_handler&&(0,a.removeEvent)(document,"mouseup",this._ev_mouseup_handler),this._ev_keydown_handler&&(0,a.removeEvent)(document,"keydown",this._ev_keydown_handler)},l.prototype._setPos=function(e,t){this.options.noPosTransform||!this._hasTranslateFeauture&&!(this._hasTranslateFeauture=window.getComputedStyle(e).getPropertyValue("transform"))?(0,r.setStyle)(e,(0,n.extend)({transform:null},t)):null===t.left||null===t.top?(0,r.setStyle)(e,{transform:null,top:null,left:null}):(0,r.setStyle)(e,{transform:"translate("+t.left+"px, "+t.top+"px)",top:null,pos:null})},l.prototype._recalc=function(){const e=this._curDragEl,t=this._curOverCell.el;if(this._initGrid(),t===e){let t=this._grid.length;for(let s=0;s<t;s++){const t=this._grid[s];t.el!==e&&t.dirty&&(t.dirty=!1,this._setPos(t.el,{left:null,top:null}))}return}let s=0,i=!1,o=!1,r=this._grid.length;for(let s=0;s<r;s++){const o=this._grid[s];if(o.el===e){i=!0;break}if(o.el===t){i=!1;break}}this._isShiftToLeft=i;let n=i?0:this._grid.length-1,a=i?this._grid.length:-1,l=i?1:-1,d=[0,0];for(;n!==a;n+=l){const r=this._grid[n];if(2!==s)if(r.el!==e){if(r.el===t&&s++,1===s||2===s){let e=0,t=0;i?(e=o.pos[0]+d[0],t=o.pos[1]+d[1],d[0]+=r.size[0]-o.size[0],d[1]+=r.size[1]-o.size[1]):(d[0]+=o.size[0]-r.size[0],d[1]+=o.size[1]-r.size[1],e=o.pos[0]+d[0],t=o.pos[1]+d[1]),this._setPos(r.el,{left:e-r.pos[0],top:t-r.pos[1]}),r.dirty=!0}else r.dirty&&(this._setPos(r.el,{left:null,top:null}),r.dirty=!1);o=r}else s++,o=r;else r.dirty&&(this._setPos(r.el,{left:null,top:null}),r.dirty=!1),o=r}},l.prototype.disable=function(){this._disabled=!0},l.prototype.enable=function(){this._disabled=!1,this._initGrid(!0)},l.prototype.update=function(){this._disabled||this._initGrid(!0)},l.prototype._ensureGridIsActual=function(){this._initGrid()},l.prototype._needGridUpdate=function(){if(!this._grid)return 1;this._contInfo.prevSize=this._contInfo.prevSize||(0,r.getSize)(this._contEl);let e=0,t=this._contEl.children.length-this._excludedCount-(0,n.intval)(!!this._curPlaceholderEl);if(t!==this._grid.length)e=t>this._grid.length?2:1,this._contInfo.prevSize=(0,r.getSize)(this._contEl);else{let t=(0,r.getSize)(this._contEl),s=this._contInfo.prevSize;(Math.abs(s[0]-t[0])>5||Math.abs(s[1]-t[1])>5)&&(e=1),this._contInfo.prevSize=t}return e},l.prototype._initGrid=function(e){let t=e?1:this._needGridUpdate();if(!t)return;1===t&&(this._grid=[],this._contInfo&&(delete this._contInfo.pos,delete this._contInfo.size));let s=this._grid?this._grid[this._grid.length-1]:null;this._grid=this._grid||[];let i,o=!!s,n=this._contEl.children;if(!n.length)return;let a=this._getItemMargins();for(let e=this._curDragEl?this._grid.length:0,t=n.length;e<t;e++){let t=n[e];s&&t===s.el?o=!1:o||t===this._curPlaceholderEl||t.getAttribute("nodrag")||(i=(0,r.getSize)(t),i[0]+=a[0],i[1]+=a[1],this._grid.push({el:t,size:i,pos:this._calcElementPos(t)}))}},l.prototype._getRelativeMousePos=function(e){let t=this._getContPos(),s=this._getContShift();return{left:e.clientX-t[0]-s[0],top:e.clientY-t[1]-s[1]}},l.prototype._updateDraggablePosition=function(e){if(!this._curDragEl)return;let t=this._getRelativeMousePos(e),s=this._getItemShift(),i=this._getContShift(),o=this._getContSize(),n=t.top-this._initial.shift.y-s[1]+i[1];this.options.limitBottomMove&&(n=Math.min(n,o[1]+30)),(0,r.hasClass)(this._contEl,"_ape_item_list")&&(n+=this._contEl.scrollTop),this._setPos(this._curDragEl,{left:t.left-this._initial.shift.x-s[0]+i[0],top:n}),window.AudioPage&&window.AudioPage.onUpdateDraggablePosition&&window.AudioPage.onUpdateDraggablePosition()},l.prototype._getContShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.shift){let e=window.getComputedStyle(this._contEl);this._contInfo.shift=[parseFloat(e.paddingLeft),parseFloat(e.paddingTop)]}return this._contInfo.shift},l.prototype._getContSize=function(){return this._contInfo=this._contInfo||{},this._contInfo.size=(0,r.getSize)(this._contEl),this._contInfo.size},l.prototype._getContPos=function(){return this._contInfo=this._contInfo||{},this._contInfo.pos=(0,r.getXY)(this._contEl),this._contInfo.pos[1]-=(0,i.scrollGetY)(),this._contInfo.pos},l.prototype._getItemShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemShift){let e=window.getComputedStyle((0,r.domFC)(this._contEl));this._contInfo.itemShift=[parseFloat(e.marginLeft),parseFloat(e.marginTop)]}return this._contInfo.itemShift},l.prototype._getItemMargins=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemMargins){let e=window.getComputedStyle((0,r.domFC)(this._contEl));this._contInfo.itemMargins=[parseFloat(e.marginLeft)+parseFloat(e.marginRight),parseFloat(e.marginTop)+parseFloat(e.marginBottom)]}return this._contInfo.itemMargins},l.prototype._calcElementPos=function(e){let t=this._getContShift(),s=this._getItemShift();return[e.offsetLeft-t[0]-s[0],e.offsetTop-t[1]-s[1]]},l.prototype.isCurrentlyDragging=function(){return!!this._curDragEl},l.prototype._initUpdaterScrollbar=function(){return(0,o.throttle)((e=>{const t=this.options.wrapNode||e;let s=(0,r.data)(t,"sb");s&&s.update(!1,!0)}),500)},l.prototype._onMouseMove=function(e){const t=()=>this.options.wrapNode?this.options.wrapNode.scrollTop:(0,i.scrollGetY)(),s=e=>{this.options.wrapNode?this.options.wrapNode.scrollTop=e:(0,i.scrollToY)(e,0,!1,!0)};if(this._curDragEl){this._ensureGridIsActual(),!e&&(e={clientX:this._lastMousePos.x,clientY:this._lastMousePos.y}),this._lastMousePos={x:e.clientX,y:e.clientY},this._updateDraggablePosition(e);let o=this._getContSize(),n=this._getRelativeMousePos(e),a=!1;if((0,r.hasClass)(this._contEl,"_ape_item_list")&&(n.top+=this._contEl.scrollTop),n.left>0&&n.left<o[0]&&n.top>0&&n.top<o[1]){let e=0,t=this._grid.length-1,s=50;for(;s;){let i=e+Math.floor((t-e)/2);const o=this._grid[i];if(n.left>o.pos[0]&&n.top>o.pos[1]&&n.left<o.pos[0]+o.size[0]&&n.top<o.pos[1]+o.size[1]){a=o;break}if(e===t)break;n.top<o.pos[1]||n.left<o.pos[0]&&n.top<o.pos[1]+o.size[1]?t=t===i?t-1:i:e=e===i?e+1:i,s--}}else{let e,t,s,i=this._grid.length,o=999999;for(let r=0;r<i;r++){const i=this._grid[r];t=n.left-(i.pos[0]+i.size[0]/2),s=n.top-(i.pos[1]+i.size[1]/2);const a=t*t+s*s;o>a&&(o=a,e=i)}a=e}!a||this._curOverCell&&this._curOverCell.el===a.el||(this._curOverCell=a,this._recalc());{let o,n,a,l,d=0;if(this.options.wrapNode)o=l=this.options.wrapNode,n=(0,r.getSize)(o),a=(0,r.getXY)(o),a[1]-=(0,i.scrollGetY)(),d=e.clientY;else{let t=window,s=document.documentElement,i=document.body,o=t.innerWidth||s.clientWidth||i.clientWidth,r=t.innerHeight||s.clientHeight||i.clientHeight;l=t.bodyNode,n=[o,r],a=[0,0],d=e.clientY}let c=Math.max(20,n[1]/10),h=a[1]+c-d,_=c-(a[1]+n[1]-d);if(_>0||h>0){let e=Math.min(1,h/c),i=Math.min(1,_/c);this._autoScrollTO||(this._autoScrollTO=setTimeout((()=>{this._autoScrollTO=!1;let o=t();s(o+16*(e>0?-e:i)),o!==l.scrollTop&&(this._updateScrollbar(l),this._onMouseMove())}),20))}}if(this.options.onDragOverElClass){let t=e.target;(0,r.hasClass)(t,this.options.onDragOverElClass)||(t=(0,r.gpeByClass)(this.options.onDragOverElClass,t))?this._overEl!==t&&(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this.options.onDragEnter&&this.options.onDragEnter(t,this._curDragEl),this._overEl=t):(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this._overEl=null)}}else if(this._dist(e)>this.options.dragThreshold){this._curDragEl=this._initial.candidateEl;let t=this._grid.length;for(let e=0;e<t;e++)if(this._grid[e].el===this._curDragEl){this._curDragCellIndex=e;break}this.options.dragCls&&(0,r.addClass)(this._curDragEl,this.options.dragCls);const s=(0,r.getSize)(this._curDragEl),i=(0,r.getXY)(this._curDragEl),o=window.getComputedStyle(this._curDragEl),n=this._getContPos();this._initial.hasInlineSize=!(!this._curDragEl.style.width&&!this._curDragEl.style.height),(0,r.setStyle)(this._curDragEl,{width:s[0],height:s[1]}),this._initialCurDragPos={left:i[0]-n[0],top:i[1]-n[1]-document.body.scrollTop},this._curPlaceholderEl=(0,r.ce)("div",{className:"ui_gridsorter_placeholder"}),(0,r.setStyle)(this._curPlaceholderEl,{width:s[0]+parseFloat(o.marginLeft)+parseFloat(o.marginRight),height:s[1]+parseFloat(o.marginTop)+parseFloat(o.marginBottom)}),this._contEl.insertBefore(this._curPlaceholderEl,this._curDragEl),(0,r.addClass)(this._curDragEl,"ui_gridsorter_moveable"),(0,r.addClass)(this._curDragEl,"ui_gridsorter_moveable_notrans"),(0,r.addClass)(this._contEl,"ui_gridsorter_cont"),this._onMouseMove(e),this._updateDraggablePosition(e),this.options.onDragStart&&this.options.onDragStart(this._curDragEl)}(0,a.cancelEvent)(e)};const d=l},746556:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _web_legacy_ui_ui_actions_menu_utils__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(541590),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(93367),_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(70689),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(636322),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(255693),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(379440),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(190328);const uiActionsMenu={keyToggle:function(e,t){if(!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.checkKeyboardEvent)(t))return!1;const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);s&&uiActionsMenu.toggle(s,!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(s,"shown"))},keyboardToggle:function(e,t,s){if(!(0,_web_legacy_ui_ui_actions_menu_utils__WEBPACK_IMPORTED_MODULE_0__.isKeyboardActivationEvent)(t))return!1;const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);i&&uiActionsMenu.toggle(i,!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(i,"shown")),s?.preventKeyboardClickEvent&&t?.preventDefault?.()},toggle:function(el,s,options){const dummyMenu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(el,"dummyMenu");dummyMenu&&(el=dummyMenu),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(el,"shown",s);const onhide=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.attr)(el,"onHide");if(onhide&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(el,"shown"))try{eval(onhide)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,onhide)}if(options&&options.onToggle){const script=options.onToggle.replace("{isShow}",""+s);try{eval(script)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,script)}}},show:function(e,t,s){let i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer");i&&(clearTimeout(i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0));const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"origMenu");if(o&&(i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"hidetimer"))&&(clearTimeout(i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0)),s&&s.delay){cur.uiActionsMenuShowTimeout&&clearTimeout(cur.uiActionsMenuShowTimeout);const i=s.delay;return delete s.delay,void(cur.uiActionsMenuShowTimeout=setTimeout(uiActionsMenu.show.pbind(e,t,s),i))}if(cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout),s&&s.appendParentCls){let t,i,o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_ui_menu",e);if(o){i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(s.appendParentCls,o),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);const r=Object.entries(s.wrapAttrs||{}).reduce(((e,[t,s])=>(e.push(`${t}="${s}"`),e)),[]).join(" "),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)(`<div class="${t.className} ui_actions_menu_dummy_wrap" onmouseover="uiActionsMenu.show(this);" onmouseout="uiActionsMenu.hide(this);" ${r}></div>`);if(n.appendChild(o),i.appendChild(n),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"dummyMenu",n),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(n,"origMenu",e),e=n,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"top",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(o,"top"))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"left",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(o,"left"))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"right",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(o,"right"))),s.processHoverCls){const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(s.processHoverCls,t);(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"mouseover",_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass.pbind(i,"hover")),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"mouseout",_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass.pbind(i,"hover"))}}else e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"dummyMenu");const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"origMenu");o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_ui_menu",e),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",r),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(s.appendParentCls,o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.setStyle)(o,{display:"block"});const n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(i),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(t),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"top"),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"left"),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"right"),h={top:a[1]-n[1]+l};c?h.right=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(i)[0]+n[0]-a[0]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(t)[0]+c:h.left=a[0]-n[0]+d,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.setStyle)(o,h)}const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_ui_menu",e);if(s&&s.autopos&&r&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(e,"shown")){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"ui_actions_menu_left");const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(e)[1],i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(e)[1],o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(r)[1],n=s.dy||10,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(r)[0];(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"ui_actions_menu_top"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass)(e,"no_transition"),t+i+n+o>(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_4__.scrollGetY)()+(window.lastWindowHeight||0)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass)(e,"ui_actions_menu_top"),t-n-o<(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_4__.scrollGetY)()+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)("page_header_wrap")[1]&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"ui_actions_menu_top"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(e,"ui_actions_menu_left",a<0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"no_transition")}s&&s.hasOwnProperty("alwaysTop")&&r&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(e,"shown")&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"ui_actions_menu_top"),s.alwaysTop&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass)(e,"ui_actions_menu_top")),s&&s.scroll&&s.maxHeight&&(r.style.maxHeight=((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(s.maxHeight)||200)+"px",r.__uiScroll__||new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_6__.default(r)),uiActionsMenu.toggle(e,!0,s)},hide:function(e,t,s){cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout);let i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay");i?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay",!1):i=200;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",setTimeout((function(){uiActionsMenu.toggle(e,!1,s),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0)}),i))},hideDelay:function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay",t)}},__WEBPACK_DEFAULT_EXPORT__=uiActionsMenu},190328:(e,t,s)=>{s.r(t),s.d(t,{UiScroll:()=>c,default:()=>h});var i=s(15042),o=s(902947),r=s(636322),n=s(70689),a=s(93367),l=s(97875),d=s(565211);class c{init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(e,t,s,i){return this.removeEvents.push([e,t,s]),(0,a.addEvent)(e,t,s,void 0,void 0,i?{passive:!0}:void 0),s}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&(0,a.removeEvent)(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&(0,a.removeEvent)(document,"mousemove",this.dragHandler),(0,r.each)(this.removeEvents,(function(e,t){a.removeEvent.apply(null,t)})),this.el.overflow.parentNode==this.el.container){const e=(0,n.cf)();for(;this.el.content.firstChild;)e.appendChild(this.el.content.firstChild);this.el.container.appendChild(e)}return(0,n.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),(0,r.each)(this.removeElements,(function(e,t){(0,n.re)(t)})),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(e){if((0,r.isFunction)(e)){this.animation&&this.animation.stop();const t=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;e(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-t}return this.api}updateBelow(e){if((0,r.isFunction)(e)){this.animation&&this.animation.stop();const t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;e(),t&&this.scrollBottom(!1)}return this.api}fixBlocker(){i.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(e){this.options.native||(e&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),(0,n.setStyle)(this.el.container,"width",e?(0,n.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(e){this.disabled||this.inited&&this.emitter.emitEvent(e,[this.api])}static scrollEventDelta(e){let t=0;const s=void 0!==e.deltaMode?e.deltaMode:"MozMousePixelScroll"==e.type?0:1;return"wheel"==e.type?t=e.deltaY:void 0!==e.wheelDeltaX&&void 0!==e.wheelDeltaY?(t=1/40*-e.wheelDeltaY,i.browser.mac&&i.browser.opera&&(t*=.1)):void 0!==e.wheelDelta?t=1/40*-e.wheelDelta:e.detail&&2===e.axis&&(t=e.detail),t*(1==s?15:2==s?450:1)}isScrollEventUnused(e){return c.scrollEventDelta(e)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(e){if(!e&&this.options.preserveEdgeBelow){const t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),t&&this.scrollBottom(),this.options.stopScrollPropagation&&!e&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!e&&this.fixBlocker(),this.emitEvent("resize"))}disable(e){return this.disabled=!!e,e?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),(0,n.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(e){if(!(this.disabled||this.dragging||this.options.native))return e||(e=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),(0,a.addEvent)(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),(0,a.addEvent)(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=e.screenY,(0,a.cancelEvent)(e),this.emitEvent("dragstart"),this.api}dragstop(e){if(!this.disabled&&this.dragging&&!this.options.native){if(e||(e=window.event),this.dragging=!1,this.dragstopHandler&&(0,a.removeEvent)(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&(0,a.removeEvent)(document,"mousemove",this.dragHandler),(0,n.setStyle)(document.body,"cursor",""),(0,n.removeClass)(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);const t=(e.pageY-(0,n.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,t,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,e&&"contextmenu"!==e.type&&(0,a.cancelEvent)(e),this.emitEvent("dragstop"),this.api}}drag(e){if(this.disabled||!this.dragging||this.options.native)return;e||(e=window.event);const t=(e.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+t:this.dragScroll+t,this.dragged||(this.dragged=!0,(0,n.setStyle)(document.body,"cursor","pointer"),(0,n.addClass)(this.el.container,"ui_scroll_dragging")),(0,a.cancelEvent)(e),this.emitEvent("drag"),this.api}scroll(e,t,s){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==e&&this.update(!0),t?(t="number"!=typeof t||!isFinite(t)||t%1?300:Math.abs(t),this.animation=new l.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:l.Fx.Transitions.easeOutCubic,onStep:function(e){this.el.outer.scrollTop=e.scrollTop}.bind(this),duration:t,onComplete:(0,r.isFunction)(s)?s.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:e})):(this.el.outer.scrollTop=e,(0,r.isFunction)(s)&&s(this.api)),this.api}scrollTop(e,t,s,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll((0,r.intval)(t),s,i)}scrollBottom(e,t,s,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-(0,r.intval)(t),s,i)}scrollBy(e,t,s){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+(0,r.intval)(e),t,s)}scrollIntoView(e,t,s,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),(t=(0,d.getScrollElement)(t))&&t.compareDocumentPosition&&t.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){const e=(0,n.getXY)(t)[1],o=(0,n.getXY)(this.el.overflow)[1],a=(0,n.getSize)(t)[1];if(e<=o&&e+a>=o+this.api.data.viewportHeight||e>=o&&e+a<=o+this.api.data.viewportHeight)(0,r.isFunction)(i)&&(s?setTimeout(i.bind(this.api),0):i(this.api));else if(a>this.api.data.viewportHeight||e<o)this.scrollTop(!1,e-o+this.api.data.scrollTop-(this.options.shadows?(0,n.getSize)(this.el.shadowTop)[1]:0),s,i);else{const t=this.options.shadows?(0,n.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,e-o+this.api.data.scrollTop+a-this.api.data.viewportHeight+t,s,i)}}return this.api}update(e){let t,s;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));const i=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(e&&(t=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==t)||this.api.data.scrollTop!==i)){if(e&&(this.api.data.scrollHeight=t),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,i))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(t=Math.max(this.options.minContentHeight,this.api.data.scrollHeight),s=t<=this.api.data.viewportHeight,!s){const s=this.el.barOuter.offsetHeight;(e||this.barOuterHeight!==s)&&(this.barOuterHeight=s,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/t),this.el.barInner.style.height=this.barInnerHeight+"px"),(0,d.nextFrame)((()=>{const e=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${e}px)`}))}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!s)&&(0,n.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!s),this.shadowBottom!=(this.api.data.scrollBottom&&!s)&&(0,n.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!s)),this.unnecessary!==s&&((0,n.toggleClass)(this.el.container,"ui_scroll_unnecessary",s),this.unnecessary=s,this.options.stopScrollPropagation&&this.fixBlocker(),s&&this.barInnerHeight&&this.barOuterHeight&&(0,d.nextFrame)(function(e){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";const s=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${s}%)`}.bind(this)))}return this.emitEvent("update"),(!this.options.reversed||i>=0)&&this.more(),!0}return!1}more(){const e=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,t=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&e<=t&&this.emitEvent("more")}constructor(e,t){if(!(e=(0,d.getScrollElement)(e)))throw new Error("uiScroll container is undefined");e.__uiScroll__&&e.__uiScroll__.destroy(),this.options=(0,r.extend)({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1},t),this.options.native&&(this.options.shadows=!1),i.browser.mobile&&(this.options.stopScrollPropagation=!1),(0,o.isArray)(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,(0,r.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),(0,r.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),(0,r.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),(0,r.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),(0,r.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),(0,r.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),(0,r.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),(0,r.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),(0,r.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:e,overflow:(0,n.ce)("div",{className:"ui_scroll_overflow"}),outer:(0,n.ce)("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:(0,n.ce)("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:(0,n.ce)("div",{className:"ui_scroll_shadow_top"}),shadowBottom:(0,n.ce)("div",{className:"ui_scroll_shadow_bottom"}),content:(0,n.ce)("div",{className:"ui_scroll_content clear_fix"}),barContainer:(0,n.ce)("div",{className:"ui_scroll_bar_container"}),barOuter:(0,n.ce)("div",{className:"ui_scroll_bar_outer"}),barInner:(0,n.ce)("div",{className:"ui_scroll_bar_inner"})},(0,n.data)(this.el.container,"ui-scroll",this);const s=(0,n.cf)(),l=["ui_scroll_container"];for((0,r.each)((0,o.isArray)(this.options.theme)?this.options.theme:(0,r.trim)(this.options.theme+"").split(/\s+/),(function(e,t){t&&l.push("ui_scroll_"+t+"_theme")})),(0,n.addClass)(this.el.container,l.join(" ")),this.options.hidden&&(0,n.addClass)(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=(0,n.ce)("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),s.appendChild(this.el.overflow),this.options.native?(0,n.addClass)(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),s.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),i.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){const e=(0,d.addResizeSensor)(this.el.inner,this.resize.bind(this,!0)),t=(0,d.addResizeSensor)(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(e[0]),this.removeElements.push(t[0]),this.startResizeListening=function(){e[1](),t[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(s),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init();const h="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":i.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,h,function(e){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&(0,a.cancelEvent)(e):this.isScrollEventUnused(e)?(0,a.cancelEvent)(e):(0,a.stopEvent)(e))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),(0,r.each)(this.options.scrollElements,function(e,t){this.addEvent(t,h,function(e){this.disabled||this.unnecessary||(this.scrollBy(c.scrollEventDelta(e)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(e)||(0,a.cancelEvent)(e))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(e){this.released=!1,this.noMore=!0;const t=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(e){(0,a.removeEvent)(document,"mouseup contextmenu touchend pointerup",t),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,(0,n.addClass)(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||(0,n.removeClass)(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}}c.addResizeSensor=d.addResizeSensor;const h=c},565211:(e,t,s)=>{s.d(t,{addResizeSensor:()=>h,getScrollElement:()=>c,nextFrame:()=>d});var i=s(636322),o=s(70689),r=s(15042);let n;const a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1)),l=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function d(e){n&&l(n),n=a(e)}function c(e){return(0,i.isString)(e)&&"_"===e[0]?(0,o.geByClass1)(e):(0,o.ge)(e)}function h(e,t){if((e=c(e))&&(0,i.isFunction)(t)){if(r.browser.msie9||r.browser.opera&&r.browser.version<13){let s=!1,n=!1;const a=(0,o.ce)("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){n=!0,s&&l()}});function l(){if(!a.contentDocument)return setTimeout(l,100);a.contentDocument.defaultView.removeEventListener("resize",t),a.contentDocument.defaultView.addEventListener("resize",t),t()}return e.appendChild(a),e.__resizeSensor__=[a,function(){s=!0,n&&l()}]}{const d=(0,o.ce)("div",{className:"ui_scroll_resize_sensor"}),h=(0,o.ce)("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),_=(0,o.ce)("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),u=(0,o.ce)("div"),p=(0,o.ce)("div");let m=null;return h.appendChild(u),_.appendChild(p),d.appendChild(h),d.appendChild(_),e.appendChild(d),e.__resizeSensor__=[d,h.onscroll=_.onscroll=function(){const s=(e.offsetWidth||1e4)+10,i=(e.offsetHeight||1e4)+10;u.style.width=s+"px",u.style.height=i+"px",h.scrollLeft=s,h.scrollTop=i,_.scrollLeft=s,_.scrollTop=i,m!==(m=s+" "+i)&&t()}]}}}},72399:(e,t,s)=>{s.d(t,{addDelegateEvent:()=>a,removeDelegateEvent:()=>l});var i=s(70689),o=s(93367);let r=new window.Map;function n(e){let t=r.get(e.currentTarget);if(!t)return;let s,o=t[e.type];if(o)for(let t=0;t<o.length;t++){let r,[n,a]=o[t];if((0,i.hasClass)(e.target,n)?r=a(e,e.target):(s=(0,i.gpeByClass)(n,e.target,e.currentTarget))&&(r=a(e,s)),!1===r)break}}function a(e,t,s,i,a){let l=r.get(e);l||(r.set(e,{}),l=r.get(e));let d=t.split(" ");for(let t=0;t<d.length;t++){let r=d[t];l[r]||(l[r]=[],a?(0,o.addEvent)(e,r,n,!1,!1,a):(0,o.addEvent)(e,r,n)),l[r].push([s,i])}}function l(e,t,s,i){let a=r.get(e);if(!a)return;t.split(" ").forEach((t=>{a[t]&&(a[t]=a[t].filter((e=>e[0]!==s||e[1]!==i)),0===a[t].length&&(0,o.removeEvent)(e,t,n))}));0===Object.keys(a).map((e=>a[e].length)).reduce(((e,t)=>e+t))&&r.delete(e)}},131978:(e,t,s)=>{s.d(t,{createScroll:()=>d,getNativeOption:()=>r});var i=s(646952),o=s(255693);function r(e,t){return document.body[e]||document.documentElement[e]}class n{update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return r("scrollTop",this.el);!function(e,t,s){"scrollTop"===e&&window.scrollTo(0,t)}("scrollTop",e,this.el)}contHeight(){return r("scrollHeight")}smoothScroll(e){(0,o.scrollToY)(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();let t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){let t=Date.now();const s=()=>{Date.now()-t<500&&this.scrollBottom(e),window.removeEventListener("scroll",s)};window.addEventListener("scroll",s),this.scrollBottom(e)}onScroll(e){let t=this.scrollTop(),s=t-this.prevScroll,i=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-s,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&i-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){(0,i.destroyModule)(this.module)}constructor(e,t){this.el=e,this.opts=t,this.module=(0,i.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}}class a{update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){let t=Date.now();this.scroll.emitter.addOnceListener("resize",(()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)})),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{const s=this.scrollTop(),i=this.prevTop-s;this.prevTop=s,t.scrollChange&&t.scrollChange(s),t.onScroll&&t.onScroll(i,this)}})}}class l{update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}constructor(e,t){this.el=e}}function d(e,t){return t.noScroll?new l(e):t.nativeScroll?new n(e,t):new a(e,t)}},701890:(e,t,s)=>{s.d(t,{EVENT_REPLY_FIELD_IS_NFT_INDEX:()=>a,EVENT_REPLY_FIELD_IS_POST_AUTHOR_INDEX:()=>l,MIN_NFT_IMAGE_SIZE:()=>o,REPLY_IMAGE_DEFAULT_SIZE:()=>r,REPLY_IMAGE_SMALL_SIZE:()=>n,VISIBILITY_ACCESS_OPTIONS:()=>i});const i={PUBLIC:0,ONLY_FRIENDS:1,ONLY_BEST_FRIENDS:2},o=29,r=34,n=24,a=16,l=17},436753:(e,t,s)=>{s.d(t,{Atom:()=>i});class i{set(e,{notify:t=!0}={}){t&&this.base.notify(this.key)}getKey(){return`${this.base.options.storeName}-${this.key}`}constructor({key:e,base:t}){this.key=e,this.base=t}}},227897:(e,t,s)=>{s.d(t,{Store:()=>i});class i{subscribe(e,t){const s=this.getListeners(t);return s.add(e),()=>{s.delete(e)}}notify(e,t){this.getListeners(t).forEach((t=>{t(e)}))}refresh(){try{localStorage.setItem(this.key,""),localStorage.removeItem(this.key)}catch{}}destroy(){this.listeners.clear(),this.syncListeners.clear(),i.instances.delete(this.key)}get key(){const{dbName:e,storeName:t,version:s}=this.options;return`${e}-v${s}-${t}`}getListeners(e){return e?this.syncListeners:this.listeners}constructor(e){this.listeners=new Set,this.syncListeners=new Set,this.options=e,i.instances.set(this.key,this)}}i.instances=new Map,window.addEventListener("storage",(({key:e,newValue:t})=>{if(!e||null===t)return;const s=i.instances.get(e);s?.notify()}))},289581:(e,t,s)=>{s.d(t,{SyncAtom:()=>r,SyncAtomType:()=>i});var i,o=s(436753);!function(e){e.OBJECT="object",e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.STRING_NUMBER="string_number"}(i||(i={}));class r extends o.Atom{get(){const e=this.getKey();try{let t=localStorage.getItem(e);if(!t)return null;switch(this.type){case i.OBJECT:try{t=JSON.parse(t)}catch{return null}break;case i.NUMBER:t=Number(t)||0;break;case i.STRING_NUMBER:t=Number(t)||t;break;case i.BOOLEAN:t=Boolean(Number(t))}return t}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}set(e,t){const s=this.getKey();let o;switch(this.type){case i.OBJECT:o=JSON.stringify(e);break;case i.BOOLEAN:o=String(Number(e));break;default:o=String(e)}try{localStorage.setItem(s,o)}catch(t){console.log(`${s}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}delete(){const e=this.getKey();try{delete this.cache,localStorage.removeItem(e)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}getKey(){return`${this.base.key}-${this.key}`}constructor(e){super(e);const{base:t,type:s}=e;this.base=t,this.type=s}}},307614:(e,t,s)=>{s.d(t,{createSyncStore:()=>n});var i=s(227897),o=s(289581);class r extends i.Store{createAtom(e,t){return new o.SyncAtom({key:e,type:t,base:this})}constructor(e){super(e)}}function n(e){return new r(e)}},222192:(e,t,s)=>{s.d(t,{nativeStickerTypeGuard:()=>o,situationalTemplateTypeGuard:()=>r,stickerContainerTypeGuard:()=>i});const i=e=>e.some((e=>"native"===e.sticker_type||"renderable"===e.sticker_type)),o=e=>"native"===e?.sticker_type&&"situational_template"===e?.sticker?.action_type,r=e=>"situational_template"===e?.action_type},4483:(e,t,s)=>{s.d(t,{useUniqId:()=>r});var i=s(667294),o=s(659397);function r(){return`:r${(0,i.useRef)((0,o.getRandomString)(6)).current}:`}},643060:(e,t,s)=>{s.d(t,{stickersEmojiKeyboard:()=>i});const i=(0,s(798116).createDomain)()},536253:(e,t,s)=>{s.d(t,{$userEnv:()=>r,setUserEnv:()=>o});var i=s(643060);const o=i.stickersEmojiKeyboard.createEvent(),r=i.stickersEmojiKeyboard.createStore({}).on(o,((e,t)=>t))},635528:(e,t,s)=>{s.d(t,{ABUSE_MODULE:()=>n,GROUP_INFO_MODULE:()=>o,SPAMFEED_MODULE:()=>r,USER_INFO_MODULE:()=>i});const i="user_personal_card",o="group_personal_card",r="sf",n="abuse"},196086:(e,t,s)=>{s.d(t,{mapDecorationConfigToStyles:()=>i});s(747767),s(659397),s(465451),s(797235);function i(e){const t={};if(e?.border){const{type:s,angle:i=0,colors:o=[],positions:r=[]}=e.border;let n="",a="";switch(s){case"solid":case"linear":for(let e=0;e<o.length;e++){const t=r[e]?100*r[e]+"%":"";a+=`, #${o[e]} ${t}`}n=`linear-gradient(${i}deg ${a})`;break;case"radial":for(let e=0;e<o.length;e++){const t=r[e]?100*r[e]+"%":"";a+=`${e?", ":""}#${o[e]} ${t}`}n=`radial-gradient(${a})`;break;case"conic":for(let e=0;e<o.length;e++){const t=r[e]?360*r[e]+"deg":"";a+=`, #${o[e]} ${t}`}n=`conic-gradient(from ${i}deg ${a})`}n&&(t.borderStyle=n)}return e?.text&&e.text?.color&&(t.textStyle={color:`#${e.text?.color}`}),t}},11660:(e,t,s)=>{s.d(t,{drawRoundedImage:()=>o,getCoverSize:()=>n,getCroppedImage:()=>a,getZeroFrameFromGif:()=>l,roundRect:()=>r});var i=s(433830);const o=(e,t,s,i,o,r,n,a,l,d,c)=>{const h=a||i,_=l||o,u=d||r||t.naturalWidth,p=c||n||t.naturalHeight;e.beginPath(),e.arc(h+s,_+s,s,Math.PI,Math.PI+Math.PI/2),e.lineTo(h+u-s,_),e.arc(h+u-s,_+s,s,Math.PI+Math.PI/2,2*Math.PI),e.lineTo(h+u,_+p-s),e.arc(h+u-s,_+p-s,s,2*Math.PI,Math.PI/2),e.lineTo(h+s,_+p),e.arc(h+s,_+p-s,s,Math.PI/2,Math.PI),e.closePath(),e.save(),e.clip(),e.drawImage(t,i,o,r,n,a,l,d,c),e.restore()},r=(e,t,s,i,o,r)=>{let n={};if("number"==typeof r)n={tl:r,tr:r,br:r,bl:r};else{const e={tl:0,tr:0,br:0,bl:0};for(let t in e)n[t]=n[t]||e[t]}e.save(),e.beginPath(),e.moveTo(t+n.tl,s),e.lineTo(t+i-n.tr,s),e.quadraticCurveTo(t+i,s,t+i,s+n.tr),e.lineTo(t+i,s+o-n.br),e.quadraticCurveTo(t+i,s+o,t+i-n.br,s+o),e.lineTo(t+n.bl,s+o),e.quadraticCurveTo(t,s+o,t,s+o-n.bl),e.lineTo(t,s+n.tl),e.quadraticCurveTo(t,s,t+n.tl,s),e.closePath(),e.restore()},n=(e,t,s,i,o,r)=>{const n=e/t;let a,l;return n>s/i?(a=i,l=i*n):(l=s,a=s/n),{width:l,height:a,offsetLeft:(s-l)*(o=void 0===o?.5:o),offsetTop:(i-a)*(r=void 0===r?.5:r)}};function a(e,t,s,o,r,n=0){return new Promise(((a,l)=>{("string"==typeof e?(0,i.loadImage)(e):Promise.resolve(e)).then((e=>{const d=document.createElement("canvas");d.width=90===n||270===n?e.naturalHeight:e.naturalWidth,d.height=90===n||270===n?e.naturalWidth:e.naturalHeight;const c=d.getContext("2d");if(!c)return void a(e);c.fillStyle="#fff",c.fillRect(0,0,c.canvas.width,c.canvas.height),n?(c.translate(d.width/2,d.height/2),c.rotate(n*Math.PI/180),c.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2)):c.drawImage(e,0,0);const h=c.getImageData(t,s,o,r),_=document.createElement("canvas");_.width=o,_.height=r;const u=_.getContext("2d");if(u)return u.putImageData(h,0,0),(0,i.loadImage)(_.toDataURL("image/jpeg",1)).then(a).catch(l);a(e)})).catch(l)}))}const l=(e,t,s)=>new Promise((o=>{"image/gif"!==e.type&&o({file:e,image:t,imageUrl:s});let r=document.createElement("canvas"),n=r.getContext("2d");if(!n)return o({file:e,image:t,imageUrl:s});r.width=t.width,r.height=t.height,n.drawImage(t,0,0),r.toBlob((r=>{if(null===r)return void o({file:e,image:t,imageUrl:s});const n=URL.createObjectURL(r);(0,i.loadImage)(s).then((e=>{o({file:r,image:e,imageUrl:n})})).catch((i=>{console.log(i),o({file:e,image:t,imageUrl:s})}))}))}))},380526:(e,t,s)=>{s.d(t,{KEY:()=>i,checkEvent:()=>r,isMainClick:()=>o,preventLinkOpening:()=>n});const i={LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:8,TAB:9,RETURN:13,ENTER:13,ESC:27,PAGEUP:33,PAGEDOWN:34,SPACE:32,CTRL:17,ALT:18,SHIFT:16,META_LEFT:91,META_RIGHT:93};function o(e){return!("click"!==e.type&&"mousedown"!==e.type&&"mouseup"!==e.type||0!==e.button||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)}function r(e){return!!(e&&e instanceof MouseEvent)&&!o(e)}const n=e=>new Promise((t=>{o(e instanceof MouseEvent?e:e.nativeEvent)&&(e.stopPropagation(),e.preventDefault(),t())}))},600149:(e,t,s)=>{s.d(t,{swapObject:()=>i});const i=e=>{const t={};return Object.keys(e).forEach((s=>{t[e[s]]=s})),t}},464522:(e,t,s)=>{var i;s.d(t,{StoryStatsEvent:()=>i}),function(e){e.MarkAdvertiser="mark_advertiser",e.EditAdvertiserMark="edit_advertiser_mark",e.OpenAdvertiser="open_advertiser_information",e.CopyERID="copy_ERID",e.OpenNarrativeStories="narrative_open_stories",e.OpenNarrative="narrative_open",e.NarrativeOther="narrative_other",e.GoToAuthor="go_to_author",e.MusicAdded="music_added",e.PlayNext="play_next",e.ClickToUnlike="click_to_unlike",e.ClickToLike="click_to_like",e.GoToNextAuthor="go_to_next_author",e.GoToPreviousAuthor="go_to_previous_author",e.CloseAutoByTime="close_auto_by_time",e.GoToNextStoryAuto="go_to_next_story_auto_by_time",e.GoToSettings="go_to_settings",e.OpenEmptyFeedback="open_empty_feedback",e.OpenRepliesList="open_replies_list",e.OpenAdvancedStatistic="open_advanced_statistic",e.CommentTap="comment_tap",e.Delete="delete",e.PauseLongTap="pause_long_tap",e.ResumeRelease="resume_release",e.ClickOnClickableSticker="click_on_clickable_sticker",e.CloseSwipeDown="close_swipe_down",e.GoToPreviouseStory="go_to_previous_story",e.GoToNextStoryTap="go_to_next_story_tap",e.LinkClick="link_click",e.CommentSend="comment_send",e.MarkNotInterested="mark_not_interested",e.OpenParentStory="open_parent_story",e.HidePrivacyBlock="hide_privacy_block",e.CloseTap="close_tap",e.ClickOnBadge="click_on_badge",e.QuestionReplyPublish="question_reply_publish",e.QuestionReply="question_reply",e.QuestionReplyAnonymous="question_reply_anonymous",e.QuestionDelete="question_delete",e.QuestionSendMesage="question_send_message",e.QuestionShowAll="question_show_all"}(i||(i={}))},605460:(e,t,s)=>{function i(e,t=","){return e&&e.length?e.reduce(((e,s)=>{const i="rawId"in s?s.rawId:`${s.owner_id}_${s.id}`;return i&&(e+=`${e.length?t:""}${i}`),e}),""):""}s.d(t,{joinNarrativeRawIds:()=>i})},877734:(e,t,s)=>{s.d(t,{isDebugEnabled:()=>r});var i=s(180937);let o;const r=()=>(void 0!==o||(o=!!i.ls.get("reactions.debug_enabled")),o)},926595:(e,t,s)=>{s.d(t,{reactionLogError:()=>r});var i=s(65718);const o="reactions";function r({error:e,reportError:t=!1}){t&&(0,i.logError)(e,{environment:o}),console.error(e)}},697616:(e,t,s)=>{s.d(t,{DEFAULT_CACHE:()=>l,ORDER_ERRORS:()=>c,ORDER_ITEM_ERRORS:()=>h,SAMPLE_RECIPIENT_ID:()=>d,STICKER_ANIMATION:()=>a,STICKER_IMAGE:()=>n,STICKER_PACK_ICON:()=>o,STICKER_PACK_THUMB:()=>r});var i=s(205801);const o={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},r={"102_png":{id:"102.png",width:102,height:102,theme:i.Theme.LIGHT},"51_png":{id:"51.png",width:51,height:51,theme:i.Theme.LIGHT},"68_png":{id:"68.png",width:68,height:68,theme:i.Theme.LIGHT},"34_png":{id:"34.png",width:34,height:34,theme:i.Theme.LIGHT},"60_png":{id:"60.png",width:60,height:60,theme:i.Theme.LIGHT},"30_png":{id:"30.png",width:30,height:30,theme:i.Theme.LIGHT},"102b_png":{id:"102b.png",width:102,height:102,theme:i.Theme.DARK},"51b_png":{id:"51b.png",width:51,height:51,theme:i.Theme.DARK},"68b_png":{id:"68b.png",width:68,height:68,theme:i.Theme.DARK},"34b_png":{id:"34b.png",width:34,height:34,theme:i.Theme.DARK},"60b_png":{id:"60b.png",width:60,height:60,theme:i.Theme.DARK},"30b_png":{id:"30b.png",width:30,height:30,theme:i.Theme.DARK},"44_png":{id:"44.png",width:44,height:44},"22_png":{id:"22.png",width:22,height:22}},n={"64_png":{id:"64.png",width:64,height:64,theme:i.Theme.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:i.Theme.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:i.Theme.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:i.Theme.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:i.Theme.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:i.Theme.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:i.Theme.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:i.Theme.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:i.Theme.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:i.Theme.DARK}},a={[i.Theme.LIGHT]:"animation.json",[i.Theme.DARK]:"animation.b.json"},l={products:(0,i.createProductsMap)([]),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map},d=-1;var c,h;!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(c||(c={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(h||(h={}))},205801:(e,t,s)=>{var i;s.d(t,{ProductsByType:()=>_,Theme:()=>i,UserProductStateKey:()=>a,createProductsMap:()=>n,imageSizeCache:()=>r,imageSizesIndex:()=>o,isBasePack:()=>l,isPackProduct:()=>c,isStyleProduct:()=>d}),function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(i||(i={}));const o=Symbol(),r=Symbol(),n=e=>new Map(e);var a;!function(e){e.IsNew="is_new"}(a||(a={}));const l=e=>void 0!==e.sticker_ids,d=e=>void 0!==e.base_id,c=e=>l(e)&&!d(e);var h;!function(e){e.Pack="pack",e.Style="style"}(h||(h={}));class _{add(e){e&&(c(e)?this.pack.add(e):d(e)&&this.style.add(e))}getPack(){return this.pack.values().next().value}getStyles(){return Array.from(this.style.values())}getCount(){return this.pack.size+this.style.size}constructor(e=[]){this.pack=new Set,this.style=new Set,e.forEach((e=>this.add(e)))}}},681482:(e,t,s)=>{s.d(t,{STICKERS_CONFDATA_KEY:()=>i,isNewStickerPicker:()=>r,isPromoVmojiCounterEnabled:()=>a,isUGCStickersEnabled:()=>n});var i,o=s(977053);function r(){return(0,o.partConfigEnabled)("new_sticker_picker")}function n(){return(0,o.partConfigEnabled)("stickers.ugc")}function a(){return(0,o.partConfigEnabled)("vmoji.promo.avatar_suggestion.promo_counter")}!function(e){e.UGC="stickers.ugc",e.PROMO_VMOJI_COUNTER="vmoji.promo.avatar_suggestion.promo_counter",e.NEW_STICKER_PICKER="new_sticker_picker"}(i||(i={}))},563313:(e,t,s)=>{s.d(t,{getStickerAnimationUrl:()=>c,getStickerImageUrl:()=>d,getStickerPackIconUrl:()=>h,isSampleOrderItem:()=>_,logStickersError:()=>u});var i=s(205801),o=s(697616),r=s(65718);const n=(e,t,s,o=i.Theme.DEFAULT)=>{const r=window.devicePixelRatio,n=[t*=r,s*=r,o].toString();let a=e[i.imageSizeCache];if(a&&a.has(n)){const e=a.get(n);if(e)return e}a||(a=new Map,e[i.imageSizeCache]=a);const l=(e=>{let t=e[i.imageSizesIndex];return t||(t=Object.values(e).sort(((e,t)=>e.width-t.width||e.height-t.height)),e[i.imageSizesIndex]=t),t})(e).filter((e=>!e.theme||e.theme===o)),d=l.find((e=>e.width>=t&&e.height>=s))||l[l.length-1];return a.set(n,d),d},a=(e,t,s=i.Theme.DEFAULT)=>n(o.STICKER_IMAGE,e,t,s),l=(e,t)=>e.image.base_url+"/"+t.id+(e.image.version?`?${e.image.version}`:"");function d(e,t,s,o=i.Theme.DEFAULT){if(e.render?.images){const{images:i}=e.render;let r;i.sort(((e,t)=>e.width-t.width||e.height-t.height));for(const e of i)if(e.width>=t&&e.height>=s){if(e.theme===o)return e.url;r=e}if(r)return r.url}return l(e,a(t,s,o))}const c=(e,t=i.Theme.DEFAULT)=>e.animation?e.animation.base_url+"/"+o.STICKER_ANIMATION[t]+(e.animation.version?`?${e.animation.version}`:""):"",h=(e,t,s,r=i.Theme.DEFAULT)=>((e,t)=>e.icon.base_url+"/"+t.id+(e.thumb.version?`?${e.thumb.version}`:""))(e,((e,t,s=i.Theme.DEFAULT)=>n(o.STICKER_PACK_ICON,e,t,s))(t,s,r)),_=e=>e.recipient_id===o.SAMPLE_RECIPIENT_ID,u=e=>{(0,r.logError)(new Error(`Stickers: ${e}`),{environment:"stickers"})}},236202:(e,t,s)=>{s.d(t,{POPUP_STICKER_CLASS:()=>r,POPUP_STICKER_ICON_CLASS:()=>n,POPUP_STICKER_ICON_CLASS_ANIMATED:()=>a,POPUP_STICKER_ICON_CLASS_ROTATED:()=>l,POPUP_STICKER_WRAPPER_CLASS:()=>i,POPUP_STICKER_WRAPPER_CLASS_ANIMATION_IS_PLAYING:()=>o,STICKER_CLASS:()=>d,StickersSettingsApiMethods:()=>c});const i="popupStickerWrapper",o="popupStickerWrapperAnimationIsPlaying",r="popupSticker",n="popupStickerIcon",a="popupStickerIconAnimated",l="popupStickerIconRotated",d="stickerImageWrapper",c={getSettings:"stickers.getSettings",setPopupSettings:"stickers.setPopupSettings"}},887903:(e,t,s)=>{s.d(t,{logStoriesError:()=>r});var i=s(322953),o=s(802130);const r=(0,i.createSentryLogger)({debugPrefix:"[Stories]",catchNetworkError:()=>((0,o.statlogsValueEvent)("stories_api_web_errors","network error"),!0)})},396371:(e,t,s)=>{s.d(t,{fetchList:()=>S,parseExtra:()=>k});var i=s(134064),o=s(846701),r=s(683849),n=s(76306),a=s(433830),l=s(605460);const d=/^feed$/,c=/^discover$/,h=/(-?\d+)_(\d+)/,_=/^owner_feed(-?\d+)/,u=/^replies(-?\d+)_(\d+)/,p=/^narrative(-?\d+)_(\d+)$/,m=/^narratives(-?\d+)$/,g=/^recommended_narratives$/,y=/^archive(?:(-?\d+)_)?([0-9]+)/,v=/^search_([\w|-]+)/,w=/^place(\d+)/;function S(e,t){let s=e.match(d);if(s)return(0,o.apiStoriesGetWithPrefetch)({fields:(0,n.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,a.isMvk)()),nextFrom:t?.next_from||"",response:t})));if(s=e.match(c),s)return(0,o.apiStoriesGetDiscover)({count:t?.count,track_code:t?.trackCode,start_from:t?.startFrom,fields:(0,n.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,a.isMvk)()),nextFrom:t?.next_from||""})));if(s=e.match(_),s){const t=Number(s[1]);return t?(0,o.apiStoriesGet)({owner_id:t,fields:(0,n.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,a.isMvk)()),nextFrom:t?.next_from||""}))):Promise.reject("empty ownerId")}if(s=e.match(u),s){const t=Number(s[1]),r=Number(s[2]);return t&&r?(0,o.apiStoriesGetReplies)({owner_id:t,story_id:r,fields:(0,n.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,a.isMvk)()),nextFrom:t?.next_from||""}))):Promise.reject("ownerId or storyId is empty")}if(s=e.match(p),s){const t=Number(s[1]),i=Number(s[2]);if(!t||!i)return Promise.reject("ownerId or narrativeId is empty");return f(e,`${t}_${i}`)}if(s=e.match(m),s){const i=Number(s[1]);if(!i)return Promise.reject("ownerId is empty");let o=t?.narrativeRawIds;return o?.length?f(e,o):(0,r.apiNarrativesGetFromOwner)({owner_id:i,with_empty:0,limit:15}).then((t=>(o=(0,l.joinNarrativeRawIds)(t?.items),o?.length?f(e,o):Promise.reject("narrativeRawIds is empty"))))}if(s=e.match(g),s){let s=t?.narrativeRawIds;return s?.length?f(e,s):(0,r.apiNarrativesGetFeedBlock)().then((t=>(s=(0,l.joinNarrativeRawIds)(t?.block?.narratives),s?.length?f(e,s):Promise.reject("narrativeRawIds is empty"))))}if(s=e.match(y),s){const t=Number(s[1]),r=Number(s[2]);return t?(0,o.apiStoriesGetArchive)({date:r,fields:(0,n.getStoryOwnerFields)(),extended:1,owner_id:t}).then((t=>({list:(0,i.transformStoriesToLegacy)(t,e,(0,a.isMvk)())}))):Promise.reject("ownerId is empty")}if(s=e.match(h),s){const r=Number(s[1]),l=Number(s[2]);if(!r||!l)return Promise.reject("ownerId or storyId is empty");const d=t?.context;if("all"===d||"new"===d)return(0,o.apiStoriesGet)({fields:(0,n.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,a.isMvk)())})));{const s={stories:`${r}_${l}`,with_context:"owner"===d?1:0,fields:(0,n.getStoryOwnerFields)(),extended:1};return t?.access_hash&&(s.access_hash=t?.access_hash),(0,o.apiStoriesGetById)(s).then((t=>({list:(0,i.transformStoriesToLegacy)(t,e,(0,a.isMvk)())})))}}if(s=e.match(v),s){const r=s[1],l=t?.situationalSuggestId;if(!r&&void 0===l)return Promise.reject("rawQuery or suggest id is empty");let d="";if(r){const e=r.replaceAll("-","+").replaceAll("_","/");d=(0,o.decodeBase64)(e)}return(0,o.apiStoriesSearch)({q:d,count:100,situational_suggest_id:l,fields:(0,n.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,a.isMvk)())})))}if(s=e.match(w),s){const t=Number(s[1]);return t?(0,o.apiStoriesSearch)({place_id:t,count:100,fields:(0,n.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformStoryGetApiResponseToLegacyFormat)(t,e,(0,a.isMvk)())}))):Promise.reject("place id is empty")}return Promise.reject("unknown list")}function f(e="",t=""){return(0,r.apiNarrativesGetById)({narratives:t,fields:(0,n.getStoryOwnerFields)(),extended:1}).then((t=>({list:(0,i.transformNarrativeGetApiResponseToLegacyFormat)(t,e,(0,a.isMvk)())})))}function k(e){const t={},s=String(e).split(";");for(let e of s){const[s,i]=e.split(":");s&&i&&(t[s]=i)}return t}},204565:(e,t,s)=>{s.d(t,{UploadPhoto:()=>i.UploadPhoto});var i=s(192893)},529108:(e,t,s)=>{var i,o,r;s.d(t,{OwnerAvatarEditorModes:()=>r,OwnerAvatarEditorPhotoTypes:()=>o,UploadPhotoErrorCodes:()=>i}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UPLOAD=1]="UPLOAD",e[e.NOT_ALLOWED_EXTENSION=2]="NOT_ALLOWED_EXTENSION",e[e.IMAGE_TOO_SMALL=3]="IMAGE_TOO_SMALL",e[e.IMAGE_TOO_BIG=4]="IMAGE_TOO_BIG",e[e.BAD_ASPECT_RATIO=5]="BAD_ASPECT_RATIO"}(i||(i={})),function(e){e.UPLOADED="uploaded",e.EXISTED="existed"}(o||(o={})),function(e){e[e.UPLOAD=1]="UPLOAD",e[e.SELECT=2]="SELECT",e[e.EDIT=3]="EDIT",e[e.NFT=4]="NFT",e[e.NFT_EDIT=5]="NFT_EDIT"}(r||(r={}))},192893:(e,t,s)=>{s.d(t,{UploadPhoto:()=>r});var i=s(529108),o=s(620209);class r{validateSizes(e){const{lang:t,constraints:s}=this.config;if(s){const{maxWidth:o,minWidth:r,maxHeight:n,minHeight:a,maxAspectRatio:l,minAspectRatio:d}=s,[c,h]=e,_=c/h;if(c>o||h>n){const e=(t[`error_${i.UploadPhotoErrorCodes.IMAGE_TOO_BIG}`]||"").replace("{width}",String(o)).replace("{height}",String(n));return{code:i.UploadPhotoErrorCodes.IMAGE_TOO_BIG,text:e}}if(c<r||h<a){const e=(t[`error_${i.UploadPhotoErrorCodes.IMAGE_TOO_SMALL}`]||"").replace("{width}",String(r)).replace("{height}",String(a));return{code:i.UploadPhotoErrorCodes.IMAGE_TOO_SMALL,text:e}}if(d&&d>_)return{code:i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO,text:t[`error_${i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO}`]};if(l&&_>l)return{code:i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO,text:t[`error_${i.UploadPhotoErrorCodes.BAD_ASPECT_RATIO}`]}}return null}validate(e,t=!0){const{constraints:s,allowedTypes:r=[],lang:n}=this.config;let a=r.some((t=>"*"===t||t===e.type));return a||e.type||t||(a=!0),a?s&&t?(0,o.getImageSizeByBlob)(e).then((e=>{const t=this.validateSizes(e);return t?Promise.reject(t):Promise.resolve(null)})).catch((function(e){return e&&e.text&&e.code?Promise.reject(e):Promise.reject({code:i.UploadPhotoErrorCodes.UNKNOWN,text:n[`error_${i.UploadPhotoErrorCodes.UNKNOWN}`]})})):Promise.resolve(null):Promise.reject({code:i.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION,text:n[`error_${i.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION}`]})}upload({file:e,uploadURL:t=this.config.url,fieldName:s="file1",validateSizes:o=!0}){return this.validate(e,o).then((()=>new Promise(((o,r)=>{const n=new XMLHttpRequest,a=new FormData;a.append(s,e),n.open("POST",t,!0),n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE&&200===n.status){let e;try{n.responseText&&(e=JSON.parse(n.responseText))}catch(e){r({code:i.UploadPhotoErrorCodes.UNKNOWN,text:this.config.lang[`error_${i.UploadPhotoErrorCodes.UNKNOWN}`]})}o(e)}},n.onerror=()=>{r({code:i.UploadPhotoErrorCodes.UPLOAD,text:this.config.lang[`error_${i.UploadPhotoErrorCodes.UPLOAD}`]})},n.upload.onprogress=e=>{this.progressCallback&&this.progressCallback(e.loaded,e.total)},n.send(a)}))))}constructor(e,t){this.config={allowedTypes:["*"],...e},this.progressCallback=t}}},620209:(e,t,s)=>{function i(e){return t=URL.createObjectURL(e),new Promise((function(e,s){const i=new Image;i.onload=function(){const t=Number(i.height),s=Number(i.width);e([s,t])},i.onerror=function(){s()},i.onabort=function(){s()},i.src=t}));var t}s.d(t,{getImageSizeByBlob:()=>i})},629866:(e,t,s)=>{s.d(t,{getAPIErrorMessage:()=>o,isRequestAbortError:()=>r});var i=s(471828);const o=e=>e.error_text||e.error_msg||i.getLang("global_unknown_error"),r=e=>e instanceof DOMException&&(20===e.code||"AbortError"===e.name)},78839:(e,t,s)=>{s.d(t,{storyPublisherInitAsync:()=>o});var i=s(251087);function o(e){(function(e){const t=!0,s=(0,i.showBoxLoader)();return e.then((e=>t&&(0,i.isBoxLoadingCancelled)(s)?r:((0,i.isBoxLoadingCancelled)(s)||(0,i.hideBoxLoader)(),e)),(e=>((0,i.hideBoxLoader)(),Promise.reject(e))))})(window.stManager.add([window.jsc("web/story_publisher.js")])).then((t=>{(function(e){return e===r})(t)||window.StoryPublisher.init(...e)}))}const r="showBoxLoaderForPromise cancelled"},708030:(e,t,s)=>{s.d(t,{StrikeForbidObjectForm:()=>w});var i,o=s(785893),r=s(667294),n=s(471828),a=s(563318),l=s(441430),d=s(467607),c=s(247747),h=s(451879),_=s(416218),u=s(86894),p=s(180937),m=s(251087),g=s(977053),y=s(232954);!function(e){e[e.Video=1]="Video",e[e.Photo=2]="Photo",e[e.Wall=3]="Wall",e[e.Market=4]="Market",e[e.Doc=5]="Doc",e[e.CommentPhoto=6]="CommentPhoto",e[e.CommentVideo=7]="CommentVideo",e[e.CommentWall=8]="CommentWall",e[e.CommentMarket=9]="CommentMarket",e[e.CommentTopic=10]="CommentTopic",e[e.Story=11]="Story",e[e.VideoShort=12]="VideoShort",e[e.VideoLive=13]="VideoLive"}(i||(i={}));const v="strike_system.php";class w extends r.Component{submit(){if(""!==this.state.comment||10!==this.state.selectedReason)if(""!==this.state.link_to_ticket||!(0,g.partConfigEnabled)("strike_system_delete_with_reason_support")||(0,g.partConfigEnabled)("strike_system_delete_with_reason"))if(0!=this.state.selectedReason){if(this.setState({isLoading:!0}),!this.state.for_copyright_holders_empty){const e={act:"object_delete",owner_id:this.props.objectOwnerId,object_id:this.props.objectId,object_type:this.props.objectType,reason_id:this.state.selectedReason,claim_id:10===this.state.selectedReason?this.state.claimId:0,link_to_ticket:this.state.link_to_ticket,dmca_comment:this.state.comment,only_withdrawal:10===this.state.selectedReason&&0!==this.state.claimId&&this.state.only_withdrawal_checked?1:0,strike:this.state.strike_community_checked?1:0};switch(this.props.objectType){case 7:const e=document.getElementById("post"+this.props.objectOwnerId+"video_"+this.props.objectId+"mv");e&&e.setAttribute("data-action","delete");break;case 10:const t=document.getElementById("post"+this.props.objectOwnerId+"_"+this.props.objectId);window.cur.topicMyDeleted[this.props.objectOwnerId+"_"+this.props.objectId]=1,t&&t.classList.add("bp_loading")}window.ajax.post(v,e,{onDone:(e,t)=>{if(e){switch(this.props.objectType){case 12:case 13:case 1:if((0,g.partConfigEnabled)("video_playlist_page_redesign")){const e={videoId:this.props.objectId,ownerId:this.props.objectOwnerId};window.dispatchEvent(new CustomEvent("video_deleted",{detail:e}))}const e=document.getElementById("mv_info");if(null!=e){e.classList.contains("mv_info_invisible")||e.classList.add("mv_info_invisible");const s=document.getElementById("mv_warning");null!=s&&(s.innerHTML=t,s.style.display="block");const i=document.getElementById("mv_publish");null!=i&&(i.style.display="none")}break;case 2:if(window.Photoview&&window.cur){const e=window.cur,s=window.Photoview,i=e.pvListId,o=e.pvIndex,r=e.pvData[i][o];s.toggleTopInfoPanel(n.getLang("photo_deleted"),t),r.deleted=[e.pvTagInfoText.innerHTML,e.pvTagInfoButtons.innerHTML],s.toggleDeletedState(!0),s.updatePhotoDimensions()}break;case 3:if(window.Wall){const e=window.Wall,s=this.props.objectOwnerId+"_"+this.props.objectId;e.postShowDeletedMessage(s,t)}break;case 4:window.WkView.hide?.(),(0,y.dispatchItemDeleteEvent)(),(0,m.showDoneBox)(n.getLang("market_item_deleted"));break;case 6:const s=window.Photoview,i=document.getElementById("post"+this.props.objectOwnerId+"photo_"+this.props.objectId);s.commDone(i,t,!0,"");break;case 8:if(window.Wall){const e=window.Wall,s=this.props.objectOwnerId+"_"+this.props.objectId;e.postShowDeletedMessage(s,t)}break;case 7:window.Videoview.commActionDone(this.props.objectOwnerId+"_"+this.props.objectId,"mv",t,!0,"");break;case 9:const o=window.Market,r=document.getElementById("post"+this.props.objectOwnerId+"market_"+this.props.objectId);o.commDone({node:r,text:t,del:!0,script:""});break;case 10:const a=document.getElementById("post"+this.props.objectOwnerId+"_"+this.props.objectId);if(a){a.classList.remove("bp_loading"),a.classList.add("bp_deleted");const e=a.querySelector(".bp_deleted_text");e&&(e.innerHTML=t)}break;case 11:const l=this.props.story;l?.removeStoryWithReason()}(0,m.showDoneBox)(this.state.successText),this.props.onClose()}else switch(t){case"error_not_owner_for_ticket":this.setState({not_owner_for_ticket:!0});break;case"error_incorrect_link":this.setState({error_incorrect_link:!0})}},onFail:()=>((0,m.showDoneBox)(n.getLang("global_error")),!1),showProgress:()=>this.setState({isLoading:!0}),hideProgress:()=>this.setState({isLoading:!1})})}}else(0,m.showDoneBox)("error");else this.setState({link_to_ticket_empty:!0});else this.setState({for_copyright_holders_empty:!0})}close(){this.props.onClose()}changeReason(e){p.ls.set("strike_del_reason",e),this.setState({selectedReason:e})}getDmcaTitle(){const e={act:"get_dmca_title",claim_id:this.state.claimId};window.ajax.post(v,e,{onDone:e=>{this.setState({comment:e})},onFail:()=>((0,m.showDoneBox)(n.getLang("global_error")),!1),showProgress:()=>this.setState({isLoading:!0}),hideProgress:()=>this.setState({isLoading:!1})})}componentDidMount(){window.ajax.post(v,{act:"get_reasons"},{onDone:e=>{this.setState({reasons:e.reasons});const t=p.ls.get("strike_del_reason"),s=p.ls.get("strike_system_only_withdrawal");this.setState({only_withdrawal_checked:s}),window.nav?.objLoc?.claim&&(this.setState({claimId:window.nav.objLoc.claim}),this.getDmcaTitle()),0!==this.state.claimId&&-1!==this.state.reasons.findIndex((e=>10===e.key))?this.setState({selectedReason:10}):this.setState({selectedReason:t})},onFail:()=>((0,m.showDoneBox)("error"),!1),showProgress:()=>this.setState({isLoading:!0}),hideProgress:()=>this.setState({isLoading:!1})})}render(){const e=this.state.reasons,t=0!==this.state.claimId&&10===this.state.selectedReason&&1===this.props.objectType,s=10===this.state.selectedReason,i=(0,g.partConfigEnabled)("strike_system_delete_with_reason_support");return(0,o.jsx)(a.ModalBoxFast,{header:n.getLang("reports_strike_system_delete_with_reason"),onClose:this.props.onClose,closeAriaLabel:"Закрыть",actionButtons:[(0,o.jsx)(l.Button,{size:"m",mode:"secondary",onClick:this.close,loading:this.state.isLoading,children:n.getLang("reports_strike_system_button_cancel")},"0"),(0,o.jsx)(l.Button,{size:"m",mode:"primary",onClick:this.submit,loading:this.state.isLoading,children:n.getLang("reports_strike_system_button_delete")},"1")],children:(0,o.jsxs)(u.FormLayout,{children:[(0,o.jsx)(d.FormItem,{top:n.getLang("reports_strike_system_label_select_reason"),children:e.map((e=>(0,o.jsx)(c.Radio,{checked:this.state.selectedReason===e.key,name:"reason",value:e.key,onChange:()=>{this.changeReason(e.key)},children:e.label},e.key)))}),i&&(0,o.jsx)(d.FormItem,{top:n.getLang("reports_strike_system_for_support_agent_label"),id:"for_support_agent",status:this.state.link_to_ticket_empty||this.state.not_owner_for_ticket||this.state.error_incorrect_link?"error":"default",bottom:this.state.link_to_ticket_empty?n.getLang("reports_strike_system_for_support_agent_error"):this.state.not_owner_for_ticket?n.getLang("reports_strike_system_for_support_agent_not_owner_error"):this.state.error_incorrect_link?n.getLang("reports_strike_system_error_incorrect_link"):"",children:(0,o.jsx)(u.Input,{id:"link_to_ticket",type:"text",placeholder:"https://vk.com/helpdesk?act=show&id=XXXXXXX",value:this.state.link_to_ticket,onChange:e=>{this.setState({link_to_ticket:e.target.value}),this.state.link_to_ticket_empty&&this.setState({link_to_ticket_empty:!1}),this.state.not_owner_for_ticket&&this.setState({not_owner_for_ticket:!1})}})}),s&&(0,o.jsx)(d.FormItem,{top:n.getLang("reports_strike_system_strike_textarea_label"),id:"for_copyright_holders",status:this.state.for_copyright_holders_empty?"error":"default",bottom:this.state.for_copyright_holders_empty?n.getLang("reports_strike_system_strike_textarea_error"):"",children:(0,o.jsx)(h.Textarea,{id:"txt_for_copyright_holders",value:this.state.comment,onChange:e=>{this.setState({comment:e.target.value}),this.state.for_copyright_holders_empty&&this.setState({for_copyright_holders_empty:!1})}})}),(0,o.jsxs)(d.FormItem,{bottom:n.getLang("reports_strike_system_strike_checkbox_desc"),children:[t&&(0,o.jsx)(_.Checkbox,{name:"only_withdrawal",defaultChecked:this.state.only_withdrawal_checked,onChange:e=>{this.setState({only_withdrawal_checked:e.target.checked}),p.ls.set("strike_system_only_withdrawal",e.target.checked)},children:"Только изьятие"}),(0,o.jsx)(_.Checkbox,{name:"strike_community",defaultChecked:this.state.strike_community_checked,onChange:e=>{this.setState({strike_community_checked:e.target.checked}),p.ls.set("strike_system_strike_community",e.target.checked)},children:n.getLang("reports_strike_system_strike_checkbox")})]})]})})}constructor(e){super(e),this.props=e;const t=p.ls.get("strike_system_strike_community");this.state={successText:"Успешно",reasons:[],selectedReason:0,claimId:0,comment:"",isLoading:!1,for_copyright_holders_empty:!1,link_to_ticket:"",link_to_ticket_empty:!1,error_incorrect_link:!1,not_owner_for_ticket:!1,only_withdrawal_checked:!1,strike_community_checked:null!==t&&t},this.submit=this.submit.bind(this),this.close=this.close.bind(this),this.changeReason=this.changeReason.bind(this),this.getDmcaTitle=this.getDmcaTitle.bind(this)}}},696085:(e,t,s)=>{var i;s.d(t,{MARKET_BASE_URL:()=>l,MARKET_ITEM_CREATE_EVENT:()=>r,MARKET_ITEM_DELETE_EVENT:()=>o,MARKET_ITEM_UPDATE_EVENT:()=>n,MarketType:()=>i,RUSSIA_ID:()=>a}),function(e){e[e.Disabled=0]="Disabled",e[e.Base=1]="Base",e[e.Pro=2]="Pro"}(i||(i={}));const o="MarketItemDelete",r="MarketItemCreate",n="MarketItemUpdate",a=1,l="/market"},232954:(e,t,s)=>{s.d(t,{dispatchItemDeleteEvent:()=>o});var i=s(696085);const o=e=>{window.dispatchEvent(new CustomEvent(i.MARKET_ITEM_DELETE_EVENT,{detail:e}))}},603057:(e,t,s)=>{s.d(t,{logViewMarketItemInStories:()=>n});var i=s(65855),o=s(726983),r=s(621808);function n(e){const t=new URL(`${document.location.origin}${e}`).searchParams.get("w");if(t){const[e,s]=t.slice(8).split("_");i.viewAnalytics.logMarketItemView({view:{start_view:"0",end_view:"0"},screen:(0,o.getStatScreen)(),ref_source:r.RefSource.STORIES,params:{item_id:Number(s),owner_id:Number(e),search_query_id:0,item_idx:0}})}}},620445:(e,t,s)=>{s.d(t,{FILTER_MAX_PRICE:()=>n,GROUP_HEADER_QUERY_PARAM:()=>l,INPUT_REQUEST_DEBOUNCE:()=>a,MARKET_CATALOG_SCREEN_DEFAULT:()=>i,MARKET_LEFT_MENU_SCREEN:()=>o,MARKET_SEARCH_QUERY_ID:()=>r});const i="marketplace",o="market",r="market_search_query_id",n=5e9,a=1e3,l="with_group_header"},553885:(e,t,s)=>{s.d(t,{constructProductLink:()=>n});var i=s(595815),o=s(620445),r=s(977053);function n({baseUrl:e,screen:t,refSource:s,refScreen:n,itemId:a,ownerId:l,externalId:d,ref:c,type:h,withGroupHeader:_}){const u=new URLSearchParams;if(!(0,r.partConfigEnabled)("web_market_item_page")){const e=(0,i.joinRawId)({itemId:a,ownerId:l,externalId:d});u.set("w",`product${e}`)}return s&&u.set("ref_source",s),n&&u.set("ref_screen",n),c&&u.set("ref",c),t&&u.set("screen",t),h&&u.set("type",h),_&&u.set(o.GROUP_HEADER_QUERY_PARAM,"1"),(0,r.partConfigEnabled)("web_market_item_page")?`${window.location.origin}/market/product/${l}-${a}${u.toString()?`?${u.toString()}`:""}`:`${e}?${u.toString()}`}},685424:(e,t,s)=>{var i=s(802130),o=s(430798);window.vk?.pe?.static_manager_dynamic_imports&&window.vk?.stDomain&&(s.p=window.vk.stDomain+"/dist/"),window.Stories=o.Stories;try{window.stManager.done(window.jsc("web/stories.js"))}catch(e){}requestIdleCallback((()=>{try{(0,i.statlogsValueEvent)("entries_requests",1,"stories","web")}catch{}}),{timeout:5e3})},505369:(e,t,s)=>{s.d(t,{AVATAR_SIZES:()=>_,COMMON_FRIENDS_IMAGE_STATUS_INDEX:()=>a,FOLLOWERS_SECTION_NAME:()=>h,FRIENDS_IMAGE_STATUS_INDEX:()=>n,FRIENDS_LIMIT_PER_PAGE:()=>u,FRIENDS_LIST_FRIEND_IS_NFT_INDEX:()=>l,FRIENDS_LIST_FRIEND_OPTIONS_INDEX:()=>i,FRIENDS_REQUESTS_FRIEND_IS_NFT_INDEX:()=>d,FRIENDS_REQUESTS_TO_SUBSCRIBERS_CLASSES:()=>p,FRIENDS_SECTIONS:()=>m,FRIENDS_STATUS_NOT_FRIENDS:()=>o,FRIENDS_STATUS_REQUEST_FROM_USER:()=>r,PHONEBOOK_SECTION_NAME:()=>c});const i=13,o=0,r=1,n=9,a=8,l=14,d=11,c="phonebook",h="followers",_={normal:80,small:48},u=2e3,p={ROOT:"friends_requests_to_subscribers",DESCRIPTION_STEP:"friends_requests_to_subscribers_description_step",DONE_STEP:"friends_requests_to_subscribers_done_step"};var m;!function(e){e.ALL="all",e.ALL_REQUESTS="all_requests",e.OUT_REQUESTS="out_requests",e.REQUESTS="requests",e.CLEANUP="cleanup"}(m||(m={}))},890623:(e,t,s)=>{s.d(t,{FRIENDS_LIST_LOADING_MARK_START:()=>o,FRIENDS_LIST_LOADING_STATLOG:()=>a,FRIENDS_LOAD_MORE_MARK_START:()=>n,FRIENDS_OUT_REQUESTS_LOADING_MARK_START:()=>r,FriendsListLoadingType:()=>c,sendLoadingStats:()=>_,trackEndWithMarkName:()=>d,trackStartWithMarkName:()=>l});var i=s(762003);const o="FRIENDS_LIST_LOADING_MARK_START",r="FRIENDS_OUT_REQUESTS_LOADING_MARK_START",n="FRIENDS_LOAD_MORE_MARK_START",a="friends_list_loading";function l(e){window.cur.friendsPerformanceMarks||(window.cur.friendsPerformanceMarks={}),window.cur.friendsPerformanceMarks[e]=performance.now()}function d(e){return{duration:performance.now()-+window.cur.friendsPerformanceMarks[e]}}var c;!function(e){e.INIT_BLOCKING="init_blocking",e.INIT_PARALLEL="init_parallel",e.OUT_REQUESTS_BLOCKING="out_requests_blocking",e.LOAD_MORE="load_more"}(c||(c={}));const h=()=>({isSameUser:window.vk?.id===window.cur?.oid?"true":"false"});function _(e,t,s){const o={...s,...h()};(0,i.statlogsValueEvent)(e,t,o)}},944313:(e,t,s)=>{s.d(t,{FriendsListLoadingMode:()=>i,fillFriendsListWithDataFromServer:()=>g,isFriendsLoadingBugfixEnabled:()=>p,removeUnseenStories:()=>u});var i,o=s(143066),r=s(368076),n=s(558149),a=s(977053),l=s(505369),d=s(636322),c=s(851782),h=s(890623),_=s(468727);function u(e){window.cur&&window.cur.hasUnseenStories&&delete window.cur.hasUnseenStories[e];const t=document.querySelectorAll(".friends_photo_stories_unseen"+e);for(const s of t)s.classList.remove("friends_photo_stories_unseen","friends_photo_stories_unseen"+e),s.closest(".friends_photo")?.removeAttribute("onclick");(0,_.sharedSeenStories)().addSeenStories(e),(0,o.removeRichAvatarOutlineAtNode)(document.body,String(e),"stories_unseen")}function p(e=!1){return(0,a.partConfigEnabled)("friends_list_loading_bugfix")&&e}function m(e){return(t=0,s=e,Array.from(Array(s).keys()).map((e=>e+t))).map((e=>{return t={queryParams:{id:window.cur.oid??0,gid:window.cur.gid??0,sort:window.nav.objLoc.sort,platform_id:window.nav.objLoc.platform_id,section:window.cur.section,chunk_index:e,chunk_size:l.FRIENDS_LIMIT_PER_PAGE}},new Promise(((e,s)=>{c.ajax.post("al_friends.php",{act:"load_friends_silent",...t.queryParams},{onDone:(t,s,i)=>{e({friendsData:t,occupations:s,filters:i})},onFail:(e,t)=>{s({error:e,status:t})},local:1})}));var t}));var t,s}function g(e){const{showMore:t,filter:s,indexAll:i}=e.friendsMethods,o=function(e){const{icon:t}=(0,n.getIcon32Spinner)(),s=document.createElement("div");s.classList.add("friends_wide_loading");const i=(0,r.createElementFromHTML)(t);return i&&(s.append(i),e?.append(s)),()=>{s.remove()}}(document.querySelector("#list_content"));var a,c;let _=m((a=[window.cur.allFriendsCount,window.cur.allRequestsCount,window.cur.requestsCount,window.cur.followersCount],c=l.FRIENDS_LIMIT_PER_PAGE,Math.ceil(Math.max(...a)/c)));!function(){for(let e in window.cur.friendsList)window.cur.friendsList.hasOwnProperty(e)&&(window.cur.friendsList[e]=[])}(),Promise.allSettled(_).then((e=>{o(),window.cur.silent=!1;const r=[];let n=200,a="",l="false";for(let o of e){if("rejected"===o.status){n=o.reason?.status??"unknown",a=o.reason?.error?.message??"",l="true";continue}const{friendsData:e,occupations:c,filters:h}=o.value;if(e){window.cur.occupations=(0,d.extend)(window.cur.occupations||{},c);for(let t in e)e.hasOwnProperty(t)&&(window.cur.friendsList[t]=Array.isArray(window.cur.friendsList[t])?window.cur.friendsList[t].concat(e[t]):e[t]);i((function(){"list"==window.cur.section.substr(0,4)&&(window.cur.friendsList[window.cur.section]=Array.isArray(window.cur.friendsList[window.cur.section])?window.cur.friendsList[window.cur.section].concat(s(window.cur.friendsList.all,window.cur.section)):s(window.cur.friendsList.all,window.cur.section)),(window.cur.onSilentLoad||t)()})),h.cities&&r.push(h.cities)}}const c=r.flat().reduce(((e,t)=>{const s=function(e){if("string"==typeof e)return e;return`${e[0]}_${e[1]}`}(t);return e[s]||(e[s]=t),e}),{});!function(e){window.stManager.add(["ui_controls.js","ui_controls.css"],(function(){if(window.cur.cityFilter.setData(e),window.cur.cityFilterOpened){const e=document.getElementById("friends_fltr_progress");e&&(e.style.display="none"),window.cur.cityFilter.showDefaultList()}}))}(Object.values(c));const _=(0,h.trackEndWithMarkName)(h.FRIENDS_LIST_LOADING_MARK_START);(0,h.sendLoadingStats)(h.FRIENDS_LIST_LOADING_STATLOG,_.duration,{allFriendsListCount:window.cur.allFriendsCount,fansCount:window.cur.allRequestsCount,requestsCount:window.cur.requestsCount,followersCount:window.cur.followersCount,outRequestsCount:window.cur.outRequestsCount,mode:"silent",httpStatus:n,section:window.cur.curList,errorMessage:a,loadingType:h.FriendsListLoadingType.INIT_PARALLEL,userId:window.vk.id,hasError:l})}))}!function(e){e.SILENT="silent",e.DEFAULT="default"}(i||(i={}))},468727:(e,t,s)=>{s.d(t,{sharedSeenStories:()=>a});var i=s(288824),o=s(798116);const r=(0,o.createEvent)(),n=(0,o.createStore)(new Set).on(r,((e,t)=>{const s=new Set(e);return s.add(t),s})),a=(0,i.makeSharedState)("seen-stories",(()=>({addSeenStories:r,$seenStories:n})),{version:0})},541590:(e,t,s)=>{s.d(t,{isKeyboardActivationEvent:()=>o});var i=s(93367);const o=e=>!!(window.KeyboardEvent&&e instanceof window.KeyboardEvent)&&(!(e.ctrlKey||e.altKey||e.metaKey)&&!![i.KEY.ENTER,i.KEY.SPACE].includes(e.keyCode))},646952:(e,t,s)=>{s.d(t,{createModule:()=>n,createMutations:()=>r,destroyModule:()=>a});var i=s(72399),o=s(93367);function r(e){return{callMutations(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations(...t){if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e(...t)}}}function n(e){const t={_registeredHandlers:[]};return e.handlers(((...e)=>function(e,t,s,i){(0,o.addEvent)(t,s,i),e._registeredHandlers.push({handlerType:"bind",elem:t,types:s,handler:i})}(t,...e)),((...e)=>function(e,t,s,o,r,n){(0,i.addDelegateEvent)(t,s,o,r,n),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:s,selector:o,handler:r})}(t,...e))),t}function a(e){e._registeredHandlers.forEach((e=>{const{handlerType:t,elem:s,types:r,handler:n}=e;"delegate"===t?(0,i.removeDelegateEvent)(s,r,e.selector,n):(0,o.removeEvent)(s,r,n)})),e._registeredHandlers=[]}},473422:(e,t,s)=>{s.d(t,{Scroll:()=>n});var i=s(785893),o=s(554434),r=s(131978);const n=({children:e,...t})=>(0,i.jsx)(o.ScrollContext.Provider,{value:{createScroll:r.createScroll},children:(0,i.jsx)(o.Scroll,{...t,children:e})});n.defaultProps={isNative:!1,isShadows:!1,neverHide:!1}},402986:(e,t,s)=>{s.d(t,{checkPostLen:()=>u,getPostAvatarString:()=>p,removeUnseenStories:()=>h,showPostponePostWithVideoInfo:()=>m});var i=s(70689),o=s(636322),r=s(226059),n=s(471828),a=s(534691),l=s(143066),d=s(848009),c=s(701890);function h(e){if(_(document,e),window.wkcur?.pageReplaced)for(let t of window.wkcur.pageReplaced)_(t[0],e)}function _(e,t){const s=e.querySelectorAll(".reply_image_stories_unseen"+t);for(const e of s)e.classList.remove("reply_image_stories_unseen","reply_image_stories_unseen"+t),(0,a.replyUserImageLinkClosest)(e)?.removeAttribute("onclick");(0,l.removeRichAvatarOutlineAtNode)(e,String(t),"stories_unseen");const i=e.querySelectorAll(".post_image_stories_unseen"+t);for(const e of i)e.classList.remove("post_image_stories_unseen","post_image_stories_unseen"+t),e.closest(".post_image, ._post_image")?.removeAttribute("onclick")}function u(e,t,s,a){if(!e)return;const l=window.cur.options?.max_post_full_length;if(!l)return!0;const d=(0,i.ge)(e);if(!d)return;let c=(0,o.trim)(window.Emoji.val(d)).replace(/\n\n\n+/g,"\n\n");if(d.lastLen===c.length&&!a)return d.lastLen<=l;const h=d.lastLen=c.length;if(t=(0,i.ge)(t),h>l-100){const e=h>l;if(t&&(e?(s&&(r.FlatButton.isFlatButton(s)?r.FlatButton.setDisabled(s,!0):(0,i.toggleClass)(s,"button_disabled",!0)),t.innerHTML=n.getLang("text_exceeds_symbol_limit",h-l),(0,i.toggleClass)(t,"post_field_warning_red",!0)):t.innerHTML=n.getLang("text_N_symbols_remain",l-h),(0,i.show)(t)),e)return!1}else t&&(0,i.hide)(t);return t&&(0,i.toggleClass)(t,"post_field_warning_red",!1),s&&(r.FlatButton.isFlatButton(s)?r.FlatButton.setDisabled(s,!1):(0,i.toggleClass)(s,"button_disabled",!1)),!0}const p=(e,t,s=c.REPLY_IMAGE_DEFAULT_SIZE,i=!1,o,r="")=>{const n=[t,"_post_field_image"];return o&&n.push(o),(0,d.renderAvatarToString)(e,s,null,n,null,void 0,!1,void 0,r,!(s<c.MIN_NFT_IMAGE_SIZE)&&i)},m=(e,t,s)=>{const i=document.querySelector(`#${e}`);if(!i)return;let o="",r="";const a=s.filter((e=>"video"===e[0])),l=Number(a.reduceRight(((e,t)=>t[t.length-1]?.publish_date||e),0));if(l)if(t){if(1===a.length&&t===l||0===a.length)return void(i.innerHTML="");a.length>1?(o=n.getLang("wall_post_with_video_different_dates_title"),r=n.getLang("wall_post_with_video_different_dates_info")):t>l?(o=n.getLang("wall_post_with_video_later_title"),r=(0,n.langDate)(1e3*l,n.getLang("wall_post_with_video_later_info"),0,n.getLang("months_of"))):t<l&&(o=n.getLang("wall_post_with_video_earlier_title"),r=(0,n.langDate)(1e3*t,n.getLang("wall_post_with_video_earlier_info"),0,n.getLang("months_of")))}else a.length>1?(o=n.getLang("wall_post_with_video_different_dates_title"),r=n.getLang("wall_post_with_video_different_dates_info")):1===a.length&&(o=n.getLang("wall_post_with_video_publish_together_title"));i.innerHTML=o?`\n      <div class="BannerInfo BannerInfo--warn BannerInfo--hasIcon BannerInfo--noHorizontalMargin BannerInfo--noTopMargin">\n        <div class="media_info_title">${o}</div>\n        ${r?`<div class="media_info_desc">${r}</div>`:""}\n      </div>`:""}},688731:(e,t,s)=>{s.d(t,{ENABLED_IN_POST_REPLY:()=>o,isDebugEnabled:()=>i.isDebugEnabled});var i=s(877734);const o=!1},69703:(e,t,s)=>{s.d(t,{reactionLogError:()=>r});var i=s(926595),o=s(423842);const r=({error:e})=>{const t=(0,o.getReactionConfig)(),s=t?.reportJsErrors??!1;(0,i.reactionLogError)({error:e,reportError:s})}},423842:(e,t,s)=>{s.d(t,{getReactionConfig:()=>p,getReactionSet:()=>_,storageAddSets:()=>h,storageSetConfig:()=>u});var i=s(288824),o=s(659397),r=s(654200),n=s(69703),a=s(863218),l=s(688731);const d=(0,i.makeSharedState)("reactions-storage",(()=>new Map),{version:0}),c=(0,i.makeSharedState)("reactions-config",(()=>({config:void 0})),{version:0}),h=e=>{(0,l.isDebugEnabled)()&&console.log(e),Object.entries(e).forEach((([e,t])=>{const s=(0,r.validateReactionSetPayloaditems)(t,e);if(s)return void(0,n.reactionLogError)({error:s.error});const i=t.map((e=>({...e,title:(0,o.decodeHTMLEntities)(e.title)})));d().set(e,(0,r.prepareReactionMenuSet)(e,i,{imageMenuSize:a.SIZE_96,imagePreviewSize:a.SIZE_32,imageStoryPanelSize:a.SIZE_128,imageStoryPreviewSize:a.SIZE_40}))}))},_=e=>{const t=d().get(e);if(t)return t;{const t=new Error(`Reaction set not found: ${e}`);(0,n.reactionLogError)({error:t})}},u=e=>{(0,l.isDebugEnabled)()&&console.log(e);const t=(0,r.parseReactionMenuConfig)(e);t?c().config=t:console.warn("Reactions: invalid menu config passed",e)},p=()=>{const e=c()?.config;return e}},207563:(e,t,s)=>{s.d(t,{removeUnseenStories:()=>n,showMiniAppTooltip:()=>a});var i=s(143066),o=s(977053),r=s(585703);function n(e){const t=document.querySelectorAll(".search_item_img_stories_unseen"+e);for(const s of t)s.classList.remove("search_item_img_stories_unseen","search_item_img_stories_unseen"+e),s.closest(".search_item_img_link")?.removeAttribute("onclick");(0,o.partConfigEnabled)("avatar_component_refactor_web")&&(0,i.removeRichAvatarOutlineAtNode)(document.body,String(e),"stories_unseen")}const a=async({el:e,isForList:t})=>{if(!e)return;await window.stManager.add(["tooltips.css","apps_search.css"]);let s=e,i=e?.dataset?.appId;const o=e.closest("[data-app-id]");!i&&o&&(i=o?.dataset.appId),t&&o&&(s=o);const n=s,a=n?.tt&&n?.tt?.container?n?.tt?.container:null;a&&"none"===a?.style?.display&&(a.classList.remove("tt_left"),a.classList.remove("tt_right"),a.classList.remove("GlobalAppsCardTooltipWrapper--up"));let l,d="left",c=-100,h="",_=!1;const u=document.documentElement.clientWidth,p=document.documentElement.clientHeight,m=e.getBoundingClientRect();m.left>u-520?(d="right",l=365):l=-m.width-10,m.top>p-400&&(c=-50,h="GlobalAppsCardTooltipWrapper--up",a&&a.classList.add(h));let g=[l,c];t&&(d="top",_=void 0,g=[-20,0]),(0,r.showTooltip)(s,{url:"al_apps.php",params:{act:"mini_app_card_tooltip",app_id:i},className:`GlobalAppsCardTooltipWrapper ${h}`,hasover:!0,ajaxdt:200,showdt:300,hidedt:300,shift:g,center:_,dir:d})}},827655:(e,t,s)=>{s.d(t,{POPUP_STICKER_HINT_ICON_CLASS:()=>o,POPUP_STICKER_ICON:()=>i,POPUP_TQ_CLICK_RUN_ANIMATION:()=>r,TQ_DATA_MESSAGE_ID:()=>a,TQ_DATA_OBJECT_LAYERS_KEY:()=>n});const i=(0,s(320269).getIcon12Play)().icon,o="popupStickerHinticon",r="Stickers/run_popup_animation",n="stickerLayers",a="stickerMessageId"},74813:(e,t,s)=>{s.d(t,{initNewStickerPicker:()=>l,isStickerPickerOpen:()=>n.isStickerPickerOpen,setUserEnvForStickerPicker:()=>d});var i=s(536253),o=s(681482),r=s(982721),n=s(157554);let a=0;const l=async()=>{if(a++,!(a>3))try{const{StickerPickerViewer:e}=await Promise.all([s.e(213),s.e(2067),s.e(20795),s.e(71610),s.e(36834),s.e(89334),s.e(73084),s.e(78192),s.e(40928),s.e(39386),s.e(4545),s.e(68346)]).then(s.bind(s,107595));window.StickerPickerViewer=new e}catch{setTimeout((()=>{l()}),3e3)}},d=()=>{(0,i.setUserEnv)({[o.STICKERS_CONFDATA_KEY.UGC]:(0,o.isUGCStickersEnabled)(),[o.STICKERS_CONFDATA_KEY.PROMO_VMOJI_COUNTER]:(0,o.isPromoVmojiCounterEnabled)(),"stickers.popup":(0,r.isPopUpStickersEnabled)()})}},163917:(e,t,s)=>{s.d(t,{IS_OPEN_BODY_SELECTOR:()=>i});const i="StickerPickerIsOpen"},157554:(e,t,s)=>{s.d(t,{isStickerPickerOpen:()=>o});var i=s(163917);const o=()=>window.document.body.classList.contains(i.IS_OPEN_BODY_SELECTOR)},379867:(e,t,s)=>{s.d(t,{checkStopActionOnEventOnSticker:()=>_,checkStopActionOnEventOnStickerPopupIcon:()=>h,previewSticker:()=>a,showPackByClickOnSticker:()=>l,wrapSticker:()=>c});var i,o=s(669390),r=s(681482),n=s(236202);!function(e){e.MESSAGE="message"}(i||(i={}));const a=e=>window.Emoji.previewSticker(e,!1,{sticker_referrer:"message"}),l=(e,t)=>{(0,r.isNewStickerPicker)()?window.StickerPickerViewer?.api.getPack({productId:e}).then((s=>{Boolean(s?.product?.active)?window.StickerPickerViewer?.showPack(e,t):a(e)})).catch((()=>{a(e)})):window.Emoji.getStickerPack(e).then((s=>{Boolean(s&&s[window.Emoji.PACK_FIELD_IS_ACTIVE])?window.Emoji.showPackInKeyboard(e,t):a(e)}))},d=e=>`stickerSize${e}`,c=({stickerHtml:e,stickerWrapperClass:t="",icon:s,iconClass:i,size:r,iconTqAttrs:n})=>{const a=s?`<div class="${o.STICKER_ICON_CLASS} ${i}" ${n}>${s}</div>`:"";return`\n  <div class="${[o.STICKER_ROW_CLASS,t,d(r)].join(" ")}">\n    ${e}\n    ${a}\n  </div>  \n`},h=e=>{const t=e?.target;return!!t?.closest("."+n.POPUP_STICKER_ICON_CLASS)},_=e=>{const t=e?.target;return!!t?.closest("."+o.STICKER_ROW_CLASS)||(!!t?.closest("."+n.POPUP_STICKER_WRAPPER_CLASS)||!!h(e))}},669390:(e,t,s)=>{var i;s.d(t,{REGULAR_SIZES:()=>r,SIZE_512:()=>o,STICKER_ICON_CLASS:()=>a,STICKER_ROW_CLASS:()=>n,StickerSize:()=>i}),function(e){e[e.SMALL=128]="SMALL",e[e.MIDDLE=168]="MIDDLE",e[e.BIG=208]="BIG"}(i||(i={}));const o=512,r=[64,128,256,352,o],n="stickerRow",a="stickerIcon"},969412:(e,t,s)=>{s.d(t,{findClosestStickerSize:()=>v,getBoxLayerWrap:()=>_,getLangCode:()=>y,getPurchaseResult:()=>m,hideLoader:()=>p,showLoader:()=>u,updateStickersFromQueue:()=>g});var i=s(877926),o=s(471828),r=s(2190),n=s(70689),a=s(251087),l=s(205801),d=s(669390),c=s(563313);function h(){return document.querySelector("#box_loader")}function _(){return document.querySelector("#box_layer_wrap")}function u(){const e=h();(0,a.refreshBoxLoaderCoords)(),(0,n.show)(e),(0,n.show)(_())}function p(){(0,n.hide)(h())}function m(e){const t=new l.ProductsByType(e.items.filter((e=>!e.error)).map((e=>e.product))),s=t.getPack(),r=t.getStyles();if(s)return r.length?(0,i.langStr)(o.getLang("purchases_stickers_purchase_result_pack_and_styles",r.length),"pack_title",s.title,"n",r.length):(0,i.langStr)(o.getLang("purchases_stickers_purchase_result_pack"),"title",s.title);if(r.length)switch(r.length){case 1:return(0,i.langStr)(o.getLang("purchases_stickers_purchase_result_1_style"),"title",r[0].title);case 2:return(0,i.langStr)(o.getLang("purchases_stickers_purchase_result_2_styles"),"title1",r[0].title,"title2",r[1].title);case 3:return(0,i.langStr)(o.getLang("purchases_stickers_purchase_result_3_styles"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);case 4:return(0,i.langStr)(o.getLang("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);default:const e=r.length-3;return(0,i.langStr)(o.getLang("purchases_stickers_purchase_result_3_styles_and_n_more",e),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title,"n",e)}return null}function g(e){!function(e){const t=r.colorScheme.isDarkScheme()?"data-src-dark":"data-src-light";e.querySelectorAll(`.sticker_img[${t}]`).forEach((e=>{const s=e.getAttribute(t);s&&(e.src=s)}))}(e)}const y=()=>window.vk.lang||"ru",v=e=>e>d.SIZE_512?((0,c.logStickersError)("Нет размера стикера больше 512px"),d.SIZE_512):d.REGULAR_SIZES.find((t=>t>=e))},449614:(e,t,s)=>{s.d(t,{situationalSuggestsGetById:()=>o});var i=s(166695);const o=e=>(0,i.api)("situationalSuggests.getById",{theme_ids:`${e.join(",")}`})},639986:(e,t,s)=>{s.d(t,{AppsMetaStory:()=>c});var i=s(785893),o=s(973935),r=s(271325),n=s(797235),a=s(471828),l=s(124252),d=s(265794);class c extends r.MetaStory{update(){o.render((0,i.jsx)(l.MetaStory,{metaStoryInfo:(0,i.jsx)(d.MetaStoryInfo,{url:this.app.url,icon:this.app.photoUrl,header:this.app.name,urlText:a.getLang("stories_go_to_app")}),list:this.block.grouped,listName:n.StoryListName.apps,isPaused:this.isPaused.bind(this),onLongTap:this.options.onLongTap,onScroll:this.onScroll,pause:this.options.pause,play:this.options.play,playNextStory:this.options.playNextStory,playPrevStory:this.options.playPrevStory}),this.wrapper)}constructor(e,t){if(super(e,t),!this.block.app)throw new Error("There is not an app info");this.app=this.block.app}}},636529:(e,t,s)=>{s.d(t,{BaseStory:()=>i});class i{play(){this.paused=!1,this.isLoaded()&&this.options.onPlay()}pause(){this.paused=!0,this.options.onPause()}isPaused(){return this.paused}isLoaded(){return this.loaded}onStartLoading(){this.options.onLoadingStart?.()}canPlay(){if(this.options.onLoadingEnd?.(),this.loaded=!0,this.startTs=Date.now(),!this.isPaused()){if("visible"!==document.visibilityState)return;this.play()}}constructor(e){this.paused=!0,this.loaded=!1,this.startTs=0,this.failed=!1,this.options=e}}},98385:(e,t,s)=>{s.d(t,{loadStoryBlocksChunk:()=>o});var i=s(659397);function o(){return(0,i.asyncImportLoader)((()=>Promise.all([s.e(213),s.e(83737),s.e(2067),s.e(20795),s.e(57451),s.e(5038),s.e(95040),s.e(69488),s.e(67498),s.e(24328),s.e(378),s.e(72491)]).then(s.bind(s,331313))),3)}},962681:(e,t,s)=>{s.d(t,{StoryAvatar:()=>u});var i=s(785893),o=s(311429),r=s(659397),n=s(50486),a=s(36193),l=s(523087),d=s(203680),c=s(528735),h=s(754972),_=s(434816);const u=({type:e="simple",decoration:t,seen:s=!1,nft:u=!1,src:p,size:m})=>{const g=(0,h.useStoryCellContext)(),y=(0,_.useStoryCardContext)();return(0,i.jsxs)(o.RichAvatar,{className:(0,r.classNames)("discover"===e&&n.default.discover,"discover"===e&&g&&n.default.discoverInCell,"create"===e&&n.default.create,"create"===e&&g&&n.default.createInCell),size:m,src:p,nft:u,children:["simple"===e&&(0,i.jsx)(i.Fragment,{children:s?(0,i.jsx)(o.RichAvatar.Outline,{appearance:"gray"}):t?.borderStyle?(0,i.jsx)(o.RichAvatar.Outline,{gradient:t.borderStyle}):(0,i.jsx)(o.RichAvatar.Outline,{appearance:"accent"})}),"create"===e&&(0,i.jsxs)(i.Fragment,{children:[y&&(0,i.jsx)(a.Icon20Add,{}),g&&(0,i.jsx)(l.Icon36Add,{})]}),"discover"===e&&(0,i.jsxs)(i.Fragment,{children:[y&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.RichAvatar.Outline,{appearance:s?"gray":"contrast"}),(0,i.jsx)(d.Icon24Compass,{})]}),g&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.RichAvatar.Outline,{appearance:s?"gray":"purple"}),(0,i.jsx)(c.Icon36ChainOutline,{})]})]}),"live"===e&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.RichAvatar.Outline,{appearance:"negative"}),(0,i.jsx)(o.RichAvatar.BadgeWithPreset,{placement:"bottom-center",preset:"live-outline"})]})]})}},690218:(e,t,s)=>{s.d(t,{StoryAvatar:()=>i.StoryAvatar});var i=s(962681)},174281:(e,t,s)=>{s.d(t,{StoryBlock:()=>C});var i=s(785893),o=s(780891),r=s(806660),n=s(249779),a=s(733552),l=s(282788),d=s(471828),c=s(313301),h=s(659397),_=s(515395),u=s(774229),p=s(747767),m=s(196086),g=s(659757),y=s(667294),v=s(380526),w=s(700897),S=s(78839),f=s(580146),k=s(194690),b=s(116573),E=s(465451);const C=({list:e,listName:t,viewer:s,onMouseEnter:C,aside:L,withSkeleton:T=!0,withCreateButton:x=!1})=>{const I=(0,y.useRef)(null),M=(0,y.useCallback)((e=>`${t}_${e}`),[t]),B=(0,y.useCallback)((e=>document.getElementById(M(e))),[t,M]);if((0,k.useScrollStoryToCenter)({containerRef:I,getStoryElement:B}),(0,k.useResetScroll)({containerRef:I}),e.isFailed())return null;if((e.isLoading()||s?.isLoading())&&T)return(0,i.jsx)(b.StoryBlockSkeleton,{});if(!x&&!e.data?.items?.length)return null;return(0,i.jsx)(o.AppRootProvider,{children:(0,i.jsxs)(r.Group,{header:(0,i.jsx)(n.Header,{size:"medium",aside:L&&(0,i.jsx)("span",{className:g.default.aside,children:L}),children:d.getLang("news_stories_title")}),className:g.default.container,separator:"hide",onMouseEnter:C,children:[(0,i.jsx)(a.Spacing,{size:4}),(0,i.jsxs)(r.Group.ExpandedContent,{children:[(0,i.jsx)(l.Grid,{columns:"dynamic",spacing:6,children:(0,i.jsxs)(l.Grid.HorizontalScroll,{padding:"base",arrowSize:"m",scrollOnAnyWheel:!0,getRef:I,children:[x&&s?.data&&(0,i.jsx)(l.Grid.Item,{children:(0,i.jsx)(c.StoryCard,{onClick:()=>{(0,S.storyPublisherInitAsync)([{entrypoint:"stories_feed"}])},preview:s.data.photo_200_orig,name:d.getLang("stories_add_title"),type:"create"})},"create"),e.data?.items?.map(((s,o)=>{const r=(0,_.getFirstStoryForRendering)(s),n=(0,_.getStoryPreview)(r),a=(0,p.findOwnerById)(r?.owner_id,e.data?.profiles,e.data?.groups),d=(0,E.getOwnerHref)(a),g=String(s.id||o);return(0,i.jsx)(l.Grid.Item,{children:(0,i.jsx)(c.StoryCard,{id:M(g),preview:n,avatar:(0,h.isRetina)()?a?.photo_100:a?.photo_50,name:s.name,type:(0,_.getStoryCardType)(s),seen:!(0,f.isBlockItemHasUnseenStories)(s),decoration:s.decoration_config?(0,m.mapDecorationConfigToStyles)(s.decoration_config):void 0,onClick:e=>{(0,v.preventLinkOpening)(e).then((()=>{s.id&&(0,w.showStory)(`${s.id}/${t}`,{fromEl:e.target,getStoryElement:B})}))},href:d,isNFT:(0,u.checkOwnerIsNFT)(a)})},g)}))]})}),(0,i.jsx)(a.Spacing,{size:12})]})]})})}},582e3:(e,t,s)=>{s.d(t,{StoryBlock:()=>i.StoryBlock});var i=s(174281)},515395:(e,t,s)=>{s.d(t,{getFirstStoryForRendering:()=>r,getStoryCardType:()=>o,getStoryPreview:()=>n});var i=s(659397);function o(e){return"discover"===e.type?"discover":"live_active"===e.type?"live":"simple"}function r(e){let t=e.stories?.find((e=>!e.seen)),s=t||e.stories?.[0];if(!s&&e.grouped?.length){for(let s=0;s<e.grouped.length;s++){const i=e.grouped[s],o=i.stories?.find((e=>!e.seen));if(o){t=o;break}}s=t||e.grouped[0]?.stories?.[0]}return s}function n(e){let t="";return e?.photo?t=(0,i.getPhotoSize)(e.photo.sizes||[],94*window.devicePixelRatio)?.url||"":e?.video&&(t=(0,i.getPhotoSize)(e.video.first_frame||[],94*window.devicePixelRatio)?.url||""),t}},116573:(e,t,s)=>{s.d(t,{StoryBlockSkeleton:()=>a});var i=s(785893),o=(s(667294),s(126466)),r=s(351157),n=s(581762);const a=({className:e})=>(0,i.jsxs)("div",{className:(0,o.classNames)("StoryBlockSkeleton",e),children:[(0,i.jsx)("div",{className:"StoryBlockSkeleton__title",children:(0,i.jsx)(r.Skeleton,{width:74,height:16,borderRadius:4})}),(0,i.jsxs)("div",{className:"StoryBlockSkeleton__stories",children:[(0,i.jsx)(n.StoryCardSkeleton,{className:"StoryBlockSkeleton__story"}),(0,i.jsx)(n.StoryCardSkeleton,{className:"StoryBlockSkeleton__story"}),(0,i.jsx)(n.StoryCardSkeleton,{className:"StoryBlockSkeleton__story"}),(0,i.jsx)(n.StoryCardSkeleton,{className:"StoryBlockSkeleton__story"}),(0,i.jsx)(n.StoryCardSkeleton,{className:"StoryBlockSkeleton__story"}),(0,i.jsx)(n.StoryCardSkeleton,{className:"StoryBlockSkeleton__story"})]})]})},313301:(e,t,s)=>{s.d(t,{StoryCard:()=>h});var i=s(785893),o=s(86894),r=s(693573),n=s(387010),a=s(790666),l=s(690218),d=s(592225),c=s(434816);const h=({type:e="simple",decoration:t,seen:s=!1,isNFT:h=!1,avatar:_,preview:u,name:p,id:m,...g})=>(0,i.jsx)(o.Tappable,{className:a.default.root,id:m,activeMode:a.default.rootActive,...g,children:(0,i.jsx)(c.StoryCardContextProvider,{value:!0,children:(0,i.jsxs)(r.AppearanceProvider,{value:"dark",children:[(0,i.jsx)(n.ImageBase,{src:u,className:a.default.background,heightSize:"100%",widthSize:"100%",objectFit:"cover",loading:"lazy"}),(0,i.jsx)(o.Gradient,{className:a.default.gradient,mode:"default"}),(0,i.jsxs)("div",{className:a.default.content,children:[(0,i.jsx)("div",{className:a.default.avatar,children:(0,i.jsx)(l.StoryAvatar,{type:e,size:36,decoration:t,src:_,seen:s,nft:h})}),(0,i.jsx)("div",{className:a.default.name,children:(0,i.jsx)(d.StoryName,{type:e,seen:s,decoration:t,name:p})})]})]})})})},434816:(e,t,s)=>{s.d(t,{StoryCardContextProvider:()=>r,useStoryCardContext:()=>n});var i=s(667294);const o=(0,i.createContext)(!1),r=o.Provider,n=()=>(0,i.useContext)(o)},581762:(e,t,s)=>{s.d(t,{StoryCardSkeleton:()=>n});var i=s(785893),o=(s(667294),s(351157)),r=s(126466);const n=({className:e})=>{const t=(0,i.jsxs)("div",{className:"StoryCardSkeleton__content",children:[(0,i.jsx)(o.Skeleton,{className:"StoryCardSkeleton__circle",width:36,height:36,circle:!0}),(0,i.jsx)(o.Skeleton,{className:"StoryCardSkeleton__name",width:56,height:8,borderRadius:3})]});return(0,i.jsx)(o.Skeleton,{height:167,width:94,className:(0,r.classNames)("StoryCardSkeleton",e),borderRadius:8,children:t})}},461854:(e,t,s)=>{s.d(t,{StoryCell:()=>h});var i=s(785893),o=s(130593),r=s(685994),n=s(690218),a=s(418753),l=s(592225),d=s(754972);const c={simple:{seen:(0,o.getColorClass)("color_text_secondary"),unseen:(0,o.getColorClass)("color_text_accent")},discover:{seen:(0,o.getColorClass)("color_text_secondary"),unseen:(0,o.getColorClass)("color_accent_purple")},create:{seen:(0,o.getColorClass)("color_text_secondary"),unseen:(0,o.getColorClass)("color_text_secondary")},live:{seen:(0,o.getColorClass)("color_accent_red"),unseen:(0,o.getColorClass)("color_accent_red")}},h=({type:e="simple",decoration:t,seen:s=!1,nft:o=!1,src:h,name:_,...u})=>(0,i.jsx)(d.StoryCellContextProvider,{value:!0,children:(0,i.jsx)(r.HorizontalCell,{header:(0,i.jsx)(l.StoryName,{className:a.default.name,type:e,seen:s,decoration:t,name:_,classNameColorMap:c}),size:"m",className:a.default.root,hoverMode:a.default.hover,activeMode:a.default.active,...u,children:(0,i.jsx)(n.StoryAvatar,{size:72,type:e,decoration:t,seen:s,src:h,nft:o})})})},754972:(e,t,s)=>{s.d(t,{StoryCellContextProvider:()=>r,useStoryCellContext:()=>n});var i=s(667294);const o=(0,i.createContext)(!1),r=o.Provider,n=()=>(0,i.useContext)(o)},986240:(e,t,s)=>{s.d(t,{StoryCellSkeleton:()=>n});var i=s(785893),o=(s(667294),s(351157)),r=s(126466);const n=({className:e})=>(0,i.jsxs)("div",{className:(0,r.classNames)("StoryCellSkeleton",e),children:[(0,i.jsx)(o.Skeleton,{className:"StoryCellSkeleton__circle",width:80,height:80,circle:!0,children:(0,i.jsx)(o.Skeleton,{className:"StoryCellSkeleton__circle",width:76,height:76,circle:!0,children:(0,i.jsx)(o.Skeleton,{className:"StoryCellSkeleton__circle",width:72,height:72,circle:!0})})}),(0,i.jsx)("div",{className:"StoryCellSkeleton__name",children:(0,i.jsx)(o.Skeleton,{width:68,height:8,borderRadius:3})})]})},559266:(e,t,s)=>{s.d(t,{StoryMinimizedBlock:()=>C});var i=s(785893),o=s(780891),r=s(806660),n=s(249779),a=s(733552),l=s(471828),d=s(659397),c=s(988653),h=s(774229),_=s(747767),u=s(196086),p=s(310738),m=s(667294),g=s(380526),y=s(700897),v=s(78839),w=s(580146),S=s(461854),f=s(86894),k=s(733680),b=s(194690),E=s(465451);const C=({list:e,listName:t,onMouseEnter:s,aside:C,withSkeleton:L=!0,withCreateButton:T=!1})=>{const x=(0,m.useRef)(null),I=(0,m.useCallback)((e=>`${t}_${e}`),[t]),M=(0,m.useCallback)((e=>document.getElementById(I(e))),[t,I]);(0,b.useScrollStoryToCenter)({containerRef:x,getStoryElement:M}),(0,b.useResetScroll)({containerRef:x});if(e.isLoading()&&L)return(0,i.jsx)(k.StoryMinimizedBlockSkeleton,{});if(!T&&!e.data?.items?.length)return null;return(0,i.jsx)(o.AppRootProvider,{children:(0,i.jsxs)(r.Group,{header:(0,i.jsx)(n.Header,{size:"medium",aside:C&&(0,i.jsx)("span",{className:p.default.aside,children:C}),children:l.getLang("news_stories_title")}),className:p.default.root,separator:"hide",onMouseEnter:s,children:[(0,i.jsx)(a.Spacing,{size:8}),(0,i.jsx)(r.Group.ExpandedContent,{children:(0,i.jsx)(f.HorizontalScroll,{arrowSize:"m",scrollOnAnyWheel:!0,getRef:x,children:(0,i.jsxs)("div",{className:p.default.container,children:[T&&(0,i.jsx)(S.StoryCell,{onClick:()=>{(0,v.storyPublisherInitAsync)([{entrypoint:"stories_feed"}])},name:l.getLang("stories_add_title"),type:"create"},"create"),e.data?.items?.map(((s,o)=>{const r=(0,c.getFirstStoryForRendering)(s),n=(0,_.findOwnerById)(r?.owner_id||s.owner_id,e.data?.profiles,e.data?.groups),a=(0,E.getOwnerHref)(n),l=String(s.id||o);let p="";return p=(0,d.isRetina)()?n?.photo_200||n?.photo_100||n?.photo_50:n?.photo_100||n?.photo_50,(0,i.jsx)(S.StoryCell,{id:I(l),src:p,name:s.name,type:(0,c.getStoryCardType)(s),seen:!(0,w.isBlockItemHasUnseenStories)(s),decoration:s.decoration_config?(0,u.mapDecorationConfigToStyles)(s.decoration_config):void 0,onClick:e=>{(0,g.preventLinkOpening)(e).then((()=>{s.id&&(0,y.showStory)(`${s.id}/${t}`,{fromEl:e.target,getStoryElement:M})}))},href:a,nft:(0,h.checkOwnerIsNFT)(n)},l)}))]})})})]})})}},789890:(e,t,s)=>{s.d(t,{StoryMinimizedBlock:()=>i.StoryMinimizedBlock});var i=s(559266)},733680:(e,t,s)=>{s.d(t,{StoryMinimizedBlockSkeleton:()=>a});var i=s(785893),o=(s(667294),s(351157)),r=s(126466),n=s(986240);const a=({className:e})=>(0,i.jsxs)("div",{className:(0,r.classNames)("StoryMinimizedBlockSkeleton",e),children:[(0,i.jsx)("div",{className:"StoryMinimizedBlockSkeleton__title",children:(0,i.jsx)(o.Skeleton,{width:74,height:16,borderRadius:4})}),(0,i.jsxs)("div",{className:"StoryMinimizedBlockSkeleton__stories",children:[(0,i.jsx)(n.StoryCellSkeleton,{className:"StoryMinimizedBlockSkeleton__story"}),(0,i.jsx)(n.StoryCellSkeleton,{className:"StoryMinimizedBlockSkeleton__story"}),(0,i.jsx)(n.StoryCellSkeleton,{className:"StoryMinimizedBlockSkeleton__story"}),(0,i.jsx)(n.StoryCellSkeleton,{className:"StoryMinimizedBlockSkeleton__story"}),(0,i.jsx)(n.StoryCellSkeleton,{className:"StoryMinimizedBlockSkeleton__story"}),(0,i.jsx)(n.StoryCellSkeleton,{className:"StoryMinimizedBlockSkeleton__story"})]})]})},453136:(e,t,s)=>{s.d(t,{StoryName:()=>h});var i=s(785893),o=s(130593),r=s(242864),n=s(990460),a=s(86894),l=s(754972),d=s(659397);const c={simple:{seen:(0,o.getColorClass)("color_text_contrast"),unseen:(0,o.getColorClass)("color_text_link_tint")},discover:{seen:(0,o.getColorClass)("color_text_secondary"),unseen:(0,o.getColorClass)("color_text_contrast")},create:{seen:(0,o.getColorClass)("color_text_contrast"),unseen:(0,o.getColorClass)("color_text_contrast")},live:{seen:(0,o.getColorClass)("color_accent_red"),unseen:(0,o.getColorClass)("color_accent_red")}},h=({type:e="simple",seen:t,name:s,decoration:o,className:h,classNameColorMap:_=c})=>{const u=(0,l.useStoryCellContext)();let p,m;return o?.textStyle?t?p=_.simple.seen:m={...o.textStyle}:p=t?_[e]?.seen:_[e]?.unseen,u?(0,i.jsx)(r.TextClamp,{lines:1,TypographyComponent:a.Footnote,weight:2,level:"1",className:(0,d.classNames)(p,h),style:m,children:s}):(0,i.jsx)(r.TextClamp,{lines:1,TypographyComponent:n.Caption,level:"1",className:(0,d.classNames)(p,h),style:m,children:s})}},592225:(e,t,s)=>{s.d(t,{StoryName:()=>i.StoryName});var i=s(453136)},963852:(e,t,s)=>{var i;s.d(t,{StoryBlockCustomEvent:()=>i}),function(e){e.BLOCK_SCROLL_TO_CENTER="block_scroll_to_center",e.BLOCK_RESET_SCROLL="block_reset_scroll"}(i||(i={}))},194690:(e,t,s)=>{s.d(t,{useResetScroll:()=>i.useResetScroll,useScrollStoryToCenter:()=>o.useScrollStoryToCenter});var i=s(437375),o=s(615045)},437375:(e,t,s)=>{s.d(t,{useResetScroll:()=>r});var i=s(667294),o=s(963852);const r=({containerRef:e})=>{(0,i.useEffect)((()=>{const t=()=>{const t=e.current;t&&(t.scrollLeft=0)};return window.addEventListener(o.StoryBlockCustomEvent.BLOCK_RESET_SCROLL,t),()=>{window.removeEventListener(o.StoryBlockCustomEvent.BLOCK_RESET_SCROLL,t)}}),[])}},615045:(e,t,s)=>{s.d(t,{useScrollStoryToCenter:()=>r});var i=s(667294),o=s(963852);const r=({containerRef:e,getStoryElement:t})=>{(0,i.useEffect)((()=>{const s=s=>{const{blockItemId:i}=s.detail,o=t(i),r=e.current;r&&o&&(r.scrollLeft=o.offsetLeft+o.offsetWidth/2-r.offsetWidth/2)};return window.addEventListener(o.StoryBlockCustomEvent.BLOCK_SCROLL_TO_CENTER,s),()=>{window.removeEventListener(o.StoryBlockCustomEvent.BLOCK_SCROLL_TO_CENTER,s)}}),[])}},988653:(e,t,s)=>{s.d(t,{getFirstStoryForRendering:()=>o,getStoryCardType:()=>i});s(659397);function i(e){return"discover"===e.type?"discover":"live_active"===e.type?"live":"simple"}function o(e){let t=e.stories?.find((e=>!e.seen)),s=t||e.stories?.[0];if(!s&&e.grouped?.length){for(let s=0;s<e.grouped.length;s++){const i=e.grouped[s],o=i.stories?.find((e=>!e.seen));if(o){t=o;break}}s=t||e.grouped[0]?.stories?.[0]}return s}},461694:(e,t,s)=>{s.d(t,{BaseStoryBlockController:()=>l});var i=s(100809),o=s(973935),r=s(963852),n=s(595815),a=s(580146);class l{init(){this.initiated=!0,this.addCustomEvents(),this.processList(),this.isListLoaded()?this.render():this.isListLoading()||(this.loadList(),this.isContainerEmpty()&&this.render())}isContainerEmpty(){return!this.container.childNodes.length}buildBlockMap(){this.list.data&&(this.blocksById={},this.list.data.items.forEach(((e,t)=>{this.blocksById[e.id||t]={block:e},e.grouped?.forEach((s=>{this.blocksById[s.id||t]={block:s,parentBlock:e}}))})))}addCustomEvents(){this.listeners=[[i.StoryCustomEventName.STORIES_SEEN,this.onStoriesSeen.bind(this)],[i.StoryCustomEventName.CLOSE_LAYER,this.onStoryViewerLayerClose.bind(this)],[i.StoryCustomEventName.LIST_MODIFIED,this.onListModifiedOutside.bind(this)]],this.listeners.forEach((([e,t])=>{window.addEventListener(e,t)}))}removeCustomEvents(){this.listeners.forEach((([e,t])=>{window.removeEventListener(e,t)}))}onStoriesSeen(e){const t=e.detail;let s=!1;t.forEach((e=>{const t=e.storyRawIdSet,i=this.blocksById[e.blockId]?.block,o=this.blocksById[e.blockId]?.parentBlock;if(i&&(0,a.isBlockItemHasUnseenStories)(i)){let e=!1;if(i.stories?.forEach((i=>{i.seen||(t.has((0,n.joinRawId)({ownerId:i.owner_id,itemId:i.id}))?(i.seen=1,s=!0):e=!0)})),i.grouped?.forEach((t=>{(0,a.isBlockItemHasUnseenStories)(t)&&(e=!0)})),e!==i.has_unseen&&(i.has_unseen=e,o)){let e=!1;o.grouped?.forEach((t=>{(0,a.isBlockItemHasUnseenStories)(t)&&(e=!0)})),e!==o.has_unseen&&(o.has_unseen=e)}}})),s&&this.render()}onListModifiedOutside(e){e.detail.listName===this.listName&&this.loadList()}onStoryViewerLayerClose(e){window.dispatchEvent(new CustomEvent(r.StoryBlockCustomEvent.BLOCK_SCROLL_TO_CENTER,{detail:{blockItemId:e.detail.currentBlockId}}))}processList(){this.buildBlockMap()}onListChanged(){this.processList(),this.isInitiated()&&this.render()}isInitiated(){return this.initiated}destroy(){this.initiated&&(this.initiated=!1,this.removeCustomEvents(),o.unmountComponentAtNode(this.container))}constructor(e){this.blocksById={},this.listeners=[],this.initiated=!1,this.container=e}}},780306:(e,t,s)=>{s.d(t,{StoryFeedBlockController:()=>S});var i=s(785893),o=s(973935),r=s(800856),n=s(921174),a=s(797235),l=s(959302),d=s(426491),c=s(582e3),h=s(930606),_=s(137302),u=s(887903),p=s(722180),m=s(471828),g=s(580146),y=s(963852),v=s(789890),w=s(259844);class S extends h.BaseStoryBlockController{isSearchFeedModeActive(){return Boolean(this.query&&(this.searchFeed.isLoaded()||this.searchFeed.isFailed()))}isSearchFeedListLoading(){return this.searchFeed.isLoading()}isFeedModeActive(){return!this.isSearchFeedModeActive()}isListLoaded(){return this.isFeedModeActive()?this.feed.isLoaded():this.searchFeed.isLoaded()}isListLoading(){return this.isFeedModeActive()?this.feed.isLoading():this.searchFeed.isLoading()}isListEmpty(){return!this.list.data}isFeedListEmpty(){return!this.feed.getList().data}addCustomEvents(){super.addCustomEvents();const e=[[_.StoryRequestCustomEventName.FEED_LOADED,this.onFeedListLoaded.bind(this)],[_.StoryRequestCustomEventName.FEED_FAILED,this.onFeedListFailed.bind(this)],[_.StoryRequestCustomEventName.SEARCH_FEED_LOADED,this.onSearchFeedListLoaded.bind(this)],[_.StoryRequestCustomEventName.SEARCH_FEED_FAILED,this.onSearchFeedListFailed.bind(this)],[_.StoryRequestCustomEventName.DISCOVER_LOADED,this.onDiscoverListLoaded.bind(this)]];e.forEach((([e,t])=>{window.addEventListener(e,t)})),this.listeners.push(...e)}setList(e){this.list=e,this.onListChanged(),this.isMinimizedFeedActive||this.resetScroll()}processList(){super.processList(),this.list.data&&(this.hasEmptyDiscover=Boolean(this.list.data.items.find((e=>"discover"===e.type)))),this.isListLoaded()&&this.isStoryViewerListEmpty()&&(this.isFeedModeActive()?this.feed.isMinimized()||this.feed.prepareListForStoryViewer():this.searchFeed.prepareListForStoryViewer())}isStoryViewerListEmpty(){return!(0,w.getStoryList)(this.listName)}onFeedListLoaded(){this.isFeedModeActive()&&this.setList(this.feed.getList())}onFeedListFailed(){this.isFeedModeActive()&&this.render()}onSearchFeedListLoaded(){this.isSearchFeedModeActive()&&this.setList(this.searchFeed.getList())}onSearchFeedListFailed(){this.isSearchFeedModeActive()&&this.render()}onDiscoverListLoaded(){const e=(0,n.getStoryDiscoverDataManager)().getList();if(e.data&&this.list.data){const t=this.list.data.items.find((e=>"discover"===e.type));if(t){t.grouped=e.data.items;let s=t.has_unseen;s||t.grouped?.forEach((e=>{(0,g.isBlockItemHasUnseenStories)(e)&&(s=!0)})),t.has_unseen=s,this.onListChanged()}}}loadList(){if(this.cancelLoadSearchFeedRequest(),this.query){const e=this.query;(0,d.loadSearchFeed)(e).catch((t=>{console.error(t),(0,u.logStoriesError)({error:t,additionalText:"could not fetch search list",extra:{query:e}})}))}else(0,d.loadStoryBlockFeedData)().catch((e=>{console.error(e),(0,u.logStoriesError)({error:e,additionalText:"could not fetch feed list"})}))}prepareListForViewer(){this.feed.prepareListForStoryViewer()}setQuery(e){if(e!==this.query){if(this.query=e,!this.isInitiated())return void this.setList(this.query?this.searchFeed.getList():this.feed.getList());this.query?this.loadList():(this.isFeedListEmpty()?this.loadList():this.prepareListForViewer(),this.setList(this.feed.getList()))}}setMinimized(e){if(this.isMinimizedFeedActive===e)return;if(this.query)return;this.isMinimizedFeedActive=e;!e&&this.feed.isMinimized()&&(this.feed.setMinimized(!1),this.isInitiated()&&this.loadList()),this.isInitiated()&&this.render()}cancelLoadSearchFeedRequest(){this.searchFeed.abort()}cancelLoadFeedRequest(){this.feed.abort()}resetScroll(){window.dispatchEvent(new CustomEvent(y.StoryBlockCustomEvent.BLOCK_RESET_SCROLL))}needShowSkeleton(){return!(this.isMinimizedFeedActive&&this.feed.isLoading()&&!this.feed.isMinimized())}render(){this.isListEmpty()&&this.isSearchFeedListLoading()||(this.isMinimizedFeedActive?o.render((0,i.jsx)(v.StoryMinimizedBlock,{list:this.list,listName:this.listName,aside:(0,i.jsx)(r.Link,{onClick:p.showStoryBlackList,children:m.getLang("stories_settings")}),onMouseEnter:this.onMouseEnter,withCreateButton:this.isFeedModeActive(),withSkeleton:this.needShowSkeleton()}),this.container):o.render((0,i.jsx)(c.StoryBlock,{list:this.list,listName:this.listName,viewer:this.viewer,aside:(0,i.jsx)(r.Link,{onClick:p.showStoryBlackList,children:m.getLang("stories_settings")}),onMouseEnter:this.onMouseEnter,withCreateButton:this.isFeedModeActive(),withSkeleton:this.needShowSkeleton()}),this.container))}destroy(){super.destroy(),this.query="",this.cancelLoadFeedRequest(),this.cancelLoadSearchFeedRequest()}constructor(e){super(e),this.listName=a.StoryListName.feed,this.isDiscoverPending=!1,this.hasEmptyDiscover=!1,this.isMinimizedFeedActive=!1,this.query="",this.onMouseEnter=()=>{if(this.isMinimizedFeedActive&&!this.feed.isLoading()&&this.feed.isMinimized())return this.feed.setMinimized(!1),void this.loadList();if(!this.hasEmptyDiscover)return;(0,n.getStoryDiscoverDataManager)().getList().data||this.isDiscoverPending||(this.isDiscoverPending=!0,(0,l.preloadDiscoverList)().then((()=>{this.hasEmptyDiscover=!1})).finally((()=>{this.isDiscoverPending=!1})))},this.feed=(0,n.getStoryFeedDataManager)(),this.searchFeed=(0,n.getStorySearchFeedDataManager)(),this.list=this.feed.getList(),this.viewer=this.feed.getViewer()}}},930606:(e,t,s)=>{s.d(t,{BaseStoryBlockController:()=>i.BaseStoryBlockController,StoryFeedBlockController:()=>o.StoryFeedBlockController});var i=s(461694),o=s(780306)},520823:(e,t,s)=>{s.d(t,{StoryDiscoverDataManager:()=>n});var i=s(137302),o=s(797235),r=s(259844);class n{fetch(e,t){return this.promise||(this.promise=this.discover.fetch({startFrom:t,trackCode:e}).then((e=>(this.prepareResponseForStoryViewer(e),(0,i.dispatchDiscoverLoadedEvent)(),e))).finally((()=>{delete this.promise}))),this.promise}prepareResponseForStoryViewer(e){const t=(0,r.getStoryList)(o.StoryListName.feed);if(t){const s=t.find((e=>e.type===o.StoryBlockType.discover));if(s){const t=(0,r.transformApiStoryList)(o.StoryListName.discover,e);s.grouped=[...s.grouped||[],...t],s.next_from=e?.next_from||""}(0,r.setStoryList)(o.StoryListName.feed,t)}}getList(){return this.discover}isLoading(){return this.discover.isLoading()}isLoaded(){return this.discover.isLoaded()}abort(){this.discover.isLoading()&&this.discover.abort()}reset(){this.discover.reset()}constructor(){this.discover=new i.StoryDiscoverRequestStore}}},258781:(e,t,s)=>{s.d(t,{StoryFeedDataManager:()=>a});var i=s(137302),o=s(629866),r=s(797235),n=s(259844);class a{fetch(e=!0){return this.promise||(this.promise=Promise.all([this.feed.fetch(),this.isMinimized()?Promise.resolve():this.viewer.fetch()]).then((t=>(e&&!this.isMinimized()&&this.prepareListForStoryViewer(),(0,i.dispatchFeedLoadedEvent)(),t))).catch((e=>{throw e?.error&&(0,o.isRequestAbortError)(e.error)||(0,i.dispatchFeedFailedEvent)(),e})).finally((()=>{delete this.promise}))),this.promise}prepareListForStoryViewer(){if(this.isMinimized())return;const e=this.feed.data;e&&(0,n.setApiStoryList)(this.listName,e)}getList(){return this.feed}getViewer(){return this.viewer}isLoading(){return Boolean([this.feed,this.viewer].filter((e=>e?.isLoading())).length)}isLoaded(){return this.isMinimized()?this.feed.isLoaded():[this.feed,this.viewer].every((e=>e?.isLoaded()))}setMinimized(e){this.feed.setMinimized(e)}isMinimized(){return this.feed.isMinimized()}abort(){this.feed.isLoading()&&this.feed.abort(),this.viewer.isLoading()&&this.viewer.abort(),delete this.promise}reset(){this.viewer.reset(),this.feed.reset()}constructor(){this.listName=r.StoryListName.feed,this.viewer=new i.ViewerRequestStore,this.feed=new i.StoryFeedRequestStore}}},305407:(e,t,s)=>{s.d(t,{StorySearchFeedDataManager:()=>a});var i=s(137302),o=s(629866),r=s(259844),n=s(797235);class a{fetch(e){return this.promise||(this.promise=this.searchFeed.fetch({query:e}).then((e=>(this.prepareListForStoryViewer(),(0,i.dispatchSearchFeedLoadedEvent)(),e))).catch((e=>{throw e?.error&&(0,o.isRequestAbortError)(e.error)||(0,i.dispatchFeedFailedEvent)(),e})).finally((()=>{delete this.promise}))),this.promise}prepareListForStoryViewer(){const e=this.searchFeed.data;e&&(0,r.setApiStoryList)(this.listName,e)}getList(){return this.searchFeed}isLoading(){return this.searchFeed.isLoading()}isLoaded(){return this.searchFeed.isLoaded()}isFailed(){return this.searchFeed.isFailed()}abort(){this.searchFeed.isLoading()&&this.searchFeed.abort()}reset(){this.searchFeed.reset()}constructor(){this.listName=n.StoryListName.feed,this.searchFeed=new i.StorySearchFeedRequestStore}}},979201:(e,t,s)=>{s.d(t,{StoryDiscoverDataManager:()=>r.StoryDiscoverDataManager,StoryFeedDataManager:()=>i.StoryFeedDataManager,StorySearchFeedDataManager:()=>o.StorySearchFeedDataManager});var i=s(258781),o=s(305407),r=s(520823)},331313:(e,t,s)=>{s.r(t),s.d(t,{BaseStoryBlockController:()=>i.BaseStoryBlockController,StoryFeedBlockController:()=>i.StoryFeedBlockController,cleanStoryFeedStore:()=>o.cleanStoryFeedStore,ensureStoryFeedStore:()=>o.ensureStoryFeedStore,getStoryDiscoverDataManager:()=>o.getStoryDiscoverDataManager,getStoryFeedDataManager:()=>o.getStoryFeedDataManager,getStorySearchFeedDataManager:()=>o.getStorySearchFeedDataManager,loadDiscover:()=>r.loadDiscover,loadSearchFeed:()=>r.loadSearchFeed,loadStoryBlockFeedData:()=>r.loadStoryBlockFeedData,loadStoryBlocksChunk:()=>n.loadStoryBlocksChunk});var i=s(930606),o=s(921174),r=s(426491),n=s(98385)},426491:(e,t,s)=>{s.d(t,{loadDiscover:()=>r,loadSearchFeed:()=>n,loadStoryBlockFeedData:()=>o});var i=s(921174);function o(){return(0,i.getStoryFeedDataManager)().fetch()}function r(e,t){return(0,i.getStoryDiscoverDataManager)().fetch(e,t)}function n(e){return(0,i.getStorySearchFeedDataManager)().fetch(e)}},609660:(e,t,s)=>{s.d(t,{BaseStoryRequestStore:()=>o});var i=s(629866);class o{fetch(e){return this.promise||(this.status="loading",this.controller=new AbortController,this.promise=this.request({params:e,fetchOptions:{signal:this.controller.signal}}),this.promise.then((e=>this.onSuccess(e)),(e=>this.onFail(e))).finally((()=>{delete this.promise}))),this.promise}onSuccess(e){return this.data=e,this.status="loaded",e}onFail(e){e?.error&&(0,i.isRequestAbortError)(e.error)||(this.status="failed")}isLoading(){return"loading"===this.status}isLoaded(){return"loaded"===this.status}isFailed(){return"failed"===this.status}abort(){this.controller&&(this.controller.abort(),this.status=this.data?"loaded":"initial",delete this.promise)}reset(){this.abort(),this.data=null,this.status="initial"}}},917326:(e,t,s)=>{s(609660)},86049:(e,t,s)=>{s.d(t,{StoryDiscoverRequestStore:()=>n});var i=s(166695),o=s(609660),r=s(76306);class n extends o.BaseStoryRequestStore{request({params:{trackCode:e,startFrom:t},fetchOptions:s}){return t&&(this.isMoreLoading=!0),(0,i.api)("stories.getDiscover",{count:15,track_code:e,start_from:t,fields:(0,r.getStoryOwnerFields)(),extended:1},{},s)}onSuccess(e){return this.data&&this.isMoreLoading?this.data={...this.data,items:[...this.data.items||[],...e.items||[]],profiles:[...this.data.profiles||[],...e.profiles||[]],groups:[...this.data.groups||[],...e.groups||[]],next_from:e.next_from}:this.data=e,this.status="loaded",this.isMoreLoading=!1,e}onFail(e){super.onFail(e),this.isMoreLoading=!1}constructor(...e){super(...e),this.isMoreLoading=!1}}},523523:(e,t,s)=>{s.d(t,{StoryFeedRequestStore:()=>n});var i=s(166695),o=s(609660),r=s(76306);class n extends o.BaseStoryRequestStore{isMinimized(){return this.minimized}setMinimized(e){this.minimized=e}request({fetchOptions:e}){return(0,i.api)("stories.get",{fields:(0,r.getStoryOwnerFields)(),minimized:this.minimized?1:0,extended:1},{},e)}constructor(...e){super(...e),this.minimized=!1}}},407606:(e,t,s)=>{s.d(t,{StorySearchFeedRequestStore:()=>n});var i=s(166695),o=s(609660),r=s(76306);class n extends o.BaseStoryRequestStore{request({params:{query:e},fetchOptions:t}){return(0,i.api)("stories.search",{q:e,count:100,fields:(0,r.getStoryOwnerFields)(),extended:1},{},t)}}},190267:(e,t,s)=>{s.d(t,{ViewerRequestStore:()=>r});var i=s(166695),o=s(609660);class r extends o.BaseStoryRequestStore{request({fetchOptions:e}){return(0,i.api)("users.get",{fields:["photo_50","photo_100","photo_200","photo_200_orig"].join(",")},{},e).then((e=>e[0]))}}},507953:(e,t,s)=>{var i;function o(){setTimeout((()=>{window.dispatchEvent(new CustomEvent("feed_loaded"))}))}function r(){setTimeout((()=>{window.dispatchEvent(new CustomEvent("feed_failed"))}))}function n(){setTimeout((()=>{window.dispatchEvent(new CustomEvent("discover_loaded"))}))}function a(){setTimeout((()=>{window.dispatchEvent(new CustomEvent("search_feed_loaded"))}))}s.d(t,{StoryRequestCustomEventName:()=>i,dispatchDiscoverLoadedEvent:()=>n,dispatchFeedFailedEvent:()=>r,dispatchFeedLoadedEvent:()=>o,dispatchSearchFeedLoadedEvent:()=>a}),function(e){e.FEED_LOADED="feed_loaded",e.FEED_FAILED="feed_failed",e.DISCOVER_LOADED="discover_loaded",e.SEARCH_FEED_LOADED="search_feed_loaded",e.SEARCH_FEED_FAILED="search_feed_failed"}(i||(i={}))},137302:(e,t,s)=>{s.d(t,{StoryDiscoverRequestStore:()=>r.StoryDiscoverRequestStore,StoryFeedRequestStore:()=>i.StoryFeedRequestStore,StoryRequestCustomEventName:()=>a.StoryRequestCustomEventName,StorySearchFeedRequestStore:()=>n.StorySearchFeedRequestStore,ViewerRequestStore:()=>o.ViewerRequestStore,dispatchDiscoverLoadedEvent:()=>a.dispatchDiscoverLoadedEvent,dispatchFeedFailedEvent:()=>a.dispatchFeedFailedEvent,dispatchFeedLoadedEvent:()=>a.dispatchFeedLoadedEvent,dispatchSearchFeedLoadedEvent:()=>a.dispatchSearchFeedLoadedEvent});s(917326);var i=s(523523),o=s(190267),r=s(86049),n=s(407606),a=s(507953)},921174:(e,t,s)=>{s.d(t,{cleanStoryFeedStore:()=>l,ensureStoryFeedStore:()=>a,getStoryDiscoverDataManager:()=>h,getStoryFeedDataManager:()=>d,getStorySearchFeedDataManager:()=>c});var i=s(288824),o=s(979201);const r=()=>({block:null,lists:{news:new o.StoryFeedDataManager,search:new o.StorySearchFeedDataManager,discover:new o.StoryDiscoverDataManager}}),n=(0,i.makeSharedState)("story_feed_store",(()=>{const e={data:r(),clear:()=>{e.data=r()}};return e}),{version:1}),a=()=>n().data;function l(){d().reset(),h().reset(),c().reset(),n().clear()}function d(){return a().lists.news}function c(){return a().lists.search}function h(){return a().lists.discover}},580146:(e,t,s)=>{function i(e){if(!e)return!1;if(void 0!==e.has_unseen)return e.has_unseen;let t=e.stories?.some((e=>!e.seen));return!!t||(t=e.grouped?.some((e=>i(e))),Boolean(t))}s.d(t,{isBlockItemHasUnseenStories:()=>i})},539884:(e,t,s)=>{s.d(t,{ActionsButton:()=>g});var i=s(785893),o=s(667294),r=s(471828),n=s(198448),a=s(464522),l=s(746556),d=s(636322),c=s(674368),h=s(251087),_=s(432483),u=s(797235),p=s(659397),m=s(879692);const g=({story:e})=>{if(!e.getCurStoryData())return null;const t=function(e){const t=e.getCurStoryData(),s=e.getCurrentNarrative(),i=e.layer.listName,o=[];if(!t)return o;const{raw_id:l,can_hide_reply:_,report_hash:g,can_remove:y,can_delete_with_reason:v,isAds:w,canMarkNotInterested:S,can_manage:f}=t,{can_blacklist:k}=e.data,[b,E]=l.split("_").map((e=>(0,d.intval)(e)));s?.canEdit&&o.push({label:r.getLang("stories_narrative_edit_button"),onClick:()=>e.sendNarrativeEditButtonDidPress(),dataTestId:"story_header_menu_action_edit_narrative"});b===window.vk.id||!k||s||w||o.push({label:r.getLang("stories_add_blacklist_button"),onClick:()=>e.addToBlacklist(),dataTestId:"story_header_menu_action_add_blacklist"});S&&o.push({label:r.getLang("stories_mark_not_interested"),onClick:t=>{const s=new MouseEvent("mouseout",{bubbles:!0});t.nativeEvent.target?.dispatchEvent(s),e.markNotInterested()},dataTestId:"story_header_menu_action_mark_not_interested"});_&&o.push({label:r.getLang("stories_hide_reply_button"),onClick:()=>e.hideReply(),dataTestId:"story_header_menu_action_hide_reply"});s&&(o.push({label:s.isBookmarked?r.getLang("stories_narrative_remove_bookmark_button"):r.getLang("stories_narrative_add_bookmark_button"),onClick:()=>e.sendNarrativeBookmarkButtonDidPress(),dataTestId:"story_header_menu_action_bookmark"}),o.push({label:r.getLang("stories_narrative_copy_link"),onClick:()=>{const e=`${location.protocol}//${location.host}/narrative${b}_${s.id}_${E}`;(0,c.copyToClipboard)(e),(0,h.showDoneBox)(r.getLang("stories_narrative_copy_link_done"))},dataTestId:"story_header_menu_action_copy_link"}));(g||!f&&(0,m.isApiForVKCOMViewerEnabled)())&&o.push({label:r.getLang("stories_report"),onClick:()=>e.report(),dataTestId:"story_header_menu_action_report"});b===window.vk.id||s||o.push({label:r.getLang("stories_settings"),onClick:()=>window.Stories.showBlackList(),dataTestId:"story_header_menu_action_open_settings"});if(t.is_authors_ads&&(t.advertiser_info_url&&o.push({label:r.getLang("global_ads_wall_post_advertiser_details"),onClick:()=>{e.layer.sendProductAnalyticEvents(a.StoryStatsEvent.OpenAdvertiser),window.open(t.advertiser_info_url,"_blank")}}),t.ad_marker)){const s=(0,p.decodeHTMLEntities)(t.ad_marker||""),i=`ERID: ${s}`;o.push({label:i,onClick:(0,n.debounce)((t=>{const o=t.target;o&&(e.layer.sendProductAnalyticEvents(a.StoryStatsEvent.CopyERID),s&&navigator.clipboard.writeText(s).then((()=>{o.textContent=r.getLang("global_ads_wall_post_ord_erid_copied"),setTimeout((()=>{o.textContent=i}),1e3)})))}),1e3,!0)})}y&&s&&o.push({red:!0,label:r.getLang("stories_remove_from_narrative"),onClick:()=>e.removeStoryFromNarrative(),dataTestId:"story_header_menu_action_remove_from_narrative"});y&&o.push({red:!0,label:s?r.getLang("global_narrative_delete"):r.getLang("global_delete"),onClick:()=>s?e.removeNarrativeBox():e.removeStoryBox(),dataTestId:"story_header_menu_action_delete"});v&&o.push({red:!0,label:r.getLang("reports_strike_system_delete_with_reason"),onClick:()=>e.removeStoryWithReasonBox()});i===u.StoryListName.discover&&o.push({red:!0,label:r.getLang("stories_hide_discover"),onClick:()=>e.hideDiscover(),dataTestId:"story_header_menu_action_hide_discover"});return o}(e);if(0===t.length)return null;let s,g=(0,o.createRef)();return(0,i.jsxs)("div",{className:"ui_actions_menu_wrap _ui_menu_wrap ui_actions_menu_bottom",onMouseEnter:t=>{clearTimeout(s),e.pauseStory(),l.default.show(g.current,t)},onMouseLeave:()=>{l.default.hide(g.current),clearTimeout(s),s=setTimeout((()=>e.autoResumeStory()),300)},ref:g,children:[(0,i.jsx)("div",{className:"ui_actions_menu _ui_menu",children:t.map((({label:e,onClick:t,red:s,disable:o,dataTestId:r})=>(0,i.jsx)("div",{className:(0,p.classNames)("StoryMenuItem ui_actions_menu_item",{"StoryMenuItem--red":s,"StoryMenuItem--disable":o}),onClick:t,"data-testid":r,children:e},e)))}),(0,i.jsx)(_.Icon24MoreHorizontal,{})]})}},423301:(e,t,s)=>{s.d(t,{DynamicStickerItem:()=>u});var i=s(785893),o=s(797235),r=s(251087),n=s(78839),a=s(449614),l=s(659397),d=s(222192),c=s(879692),h=s(596533),_=s(763111);const u=({sticker:e,originalWidth:t,originalHeight:s,widthViewBox:u,heightViewBox:p,onMouseDownHandle:m,onMouseUpHandle:g,sendNavigationStatEvents:y})=>{const v=()=>{if(e.type===o.DynamicStickersTypes.situationalTemplate)y("click_on_clickable_sticker",!0,{clickable_sticker:{id:e.id,id_value:e.situationalThemeId,type:"situational_template"}}),(async e=>{const t=(e,t)=>{console.error(e,t),(0,r.hideBoxLoader)()};if((0,l.isFunction)(window.layers?.fullhide)){window.layers.fullhide({noLoc:!0}),(0,r.showBoxLoader)(),(0,r.boxRefreshCoords)(window.boxLoader);try{const s=await(0,a.situationalSuggestsGetById)([e.situationalThemeId]),i=s?.items?.[0]?.story_box;if((0,l.isString)(i))try{const s=JSON.parse(i);if((0,l.isArray)(s?.stickers)&&(0,d.stickerContainerTypeGuard)(s.stickers)){const i=s.stickers.map((t=>"native"===t?.sticker_type&&"situational_template"===t?.sticker?.action_type?{...t,sticker:{...t.sticker,action:{count:e.situationalRepliedUsers?.count||0,users:e.situationalRepliedAvatars}}}:t));try{(0,n.storyPublisherInitAsync)([{entrypoint:_.navigationStat.getModule(),...s,photoUrl:s.url,stickers:i,serviceInfo:{situational_suggest_id:e.situationalThemeId}},()=>{},()=>{window.Stories.initializeLastSeenStories()},()=>{(0,r.hideBoxLoader)()}])}catch(e){t("story.tsx publisher init error",e)}}}catch(e){t("story.tsx could not parse storybox",e)}else t("story.tsx storyBox is undefined")}catch(e){t("story.tsx data error",e)}}else console.error("story.tsx layers is broken")})(e)},w=e=>{g(e,(()=>v()))};return e.type===o.DynamicStickersTypes.situationalTemplate&&(0,c.isStickerTemplateEnabled)()?(0,i.jsx)(h.TemplateSticker,{sticker:e,originalWidth:t,originalHeight:s,widthViewBox:u,heightViewBox:p,onMouseUpHandle:w,onMouseDownHandle:m}):null}},374823:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(785893),o=s(659397),r=s(238812);const n=({title:e,additionalTitle:t,needSeparator:s=!0,className:n,children:a})=>(0,i.jsxs)("div",{className:(0,o.classNames)("FeedbackBaseBlock",n,{"FeedbackSeparator FeedbackSeparator--top":s}),children:[(0,i.jsx)(r.default,{title:e,additionalTitle:t}),a]})},529e3:(e,t,s)=>{s.d(t,{default:()=>n});var i=s(785893),o=s(322617),r=s(374823);const n=({poll:e})=>(0,i.jsx)(r.default,{className:"FeedbackPollBlock",title:e.title,children:(0,i.jsx)("div",{className:"FeedbackPollBlock__poll",children:(0,i.jsx)(o.default,{poll:e.data})})})},837539:(e,t,s)=>{s.d(t,{default:()=>h});var i=s(785893),o=s(667294),r=s(471828),n=s(528233),a=s(374823),l=s(70689),d=s(846701),c=s(879692);class h extends o.Component{render(){const{questions:e}=this.props,{scrollBlockPosition:t}=this.state,{items:s=[]}=e,o=r.getLang("stories_questions_title_N",s?.length);return(0,i.jsx)(a.default,{className:"FeedbackQuestionsBlock",title:o,children:(0,i.jsx)("div",{className:"FeedbackQuestionsBlock__questions",children:(0,i.jsx)("div",{className:"FeedbackQuestionsBlock__wrapper",ref:this.scrollElement,children:(0,i.jsxs)("div",{className:"FeedbackQuestionsBlock__items",style:{transform:`translateX(-${t}px)`},ref:this.positionElement,children:[(0,i.jsx)("div",{className:"FeedbackQuestionsBlock__gap"}),s.map(((e,t)=>(0,i.jsx)(n.default,{question:e,storyUrl:this.props.storyUrl,showMessage:this.props.showMessage,removeQuestion:this.removeQuestion},t))),(0,i.jsx)("div",{className:"FeedbackQuestionsBlock__gap"})]})})})})}constructor(e){super(e),this.componentDidMount=()=>{const{current:e}=this.scrollElement;e&&e.addEventListener("wheel",this.questionsMouseWheel)},this.componentWillUnmount=()=>{const{current:e}=this.positionElement;e&&e.removeEventListener("wheel",this.questionsMouseWheel)},this.questionsMouseWheel=e=>{e.preventDefault(),this.props.questions.items.length<=1||this.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},this.setPosition=e=>{const{current:t}=this.positionElement;if(!t)return;const{scrollBlockPosition:s}=this.state,[i]=(0,l.getSize)(t),o=Math.max(0,Math.min(s+e,t.scrollWidth-i));this.setState({scrollBlockPosition:o})},this.removeQuestion=e=>{const{storyOwnerId:t,storyId:s,id:i,removeHash:o}=e;(0,c.isActsToApiFirstForVKCOMViewerEnabled)()?d.storiesService.deleteQuestionFx({story_id:s,question_id:i,owner_id:t}).then((()=>{this.props.sendNavigationStatEvents("question_delete",!0,{question_id:i}),this.props.onQuestionRemove(i),this.props.questions.items.length&&this.setPosition(0)})):window.ajax.post("al_stories.php",{act:"remove_question",story_owner_id:t,story_id:s,question_id:i,remove_hash:o},{onDone:()=>{this.props.sendNavigationStatEvents("question_delete",!0,{question_id:i}),this.props.onQuestionRemove(i),this.props.questions.items.length&&this.setPosition(0)}})},this.state={scrollBlockPosition:0},this.scrollElement=(0,o.createRef)(),this.positionElement=(0,o.createRef)()}}},425984:(e,t,s)=>{s.d(t,{default:()=>l});var i=s(785893),o=s(374823),r=s(2541),n=s(441430),a=s(471828);const l=({replies:e,showMore:t})=>{const{list:s}=e,l=Boolean(e.moreRepliesCount);return(0,i.jsxs)(o.default,{className:"FeedbackRepliesBlock",title:e.title,additionalTitle:e.additionalTitle,children:[(0,i.jsx)("div",{className:"FeedbackRepliesBlock__replies",children:s?.map((t=>(0,i.jsx)(r.default,{storyPack:t,listName:e.listName,source:e.source},t.author?.id)))}),l&&(0,i.jsx)("div",{className:"FeedbackRepliesBlock__showMore",children:(0,i.jsx)(n.Button,{size:"m",mode:"tertiary",onClick:t,children:(0,a.langNumeric)(e.moreRepliesCount||0,a.getLang("stories_replies_more_button","raw"))})})]})}},922140:(e,t,s)=>{s.d(t,{default:()=>d});var i=s(785893),o=s(129807),r=s(374823),n=s(471828),a=s(533566),l=s(354943);const d=({stats:e,extendedStats:t,onExtendedStatsPreviewClick:s,onSettingsBtnClick:d,onPrivacyHintHide:c})=>(0,i.jsxs)(r.default,{className:"FeedbackStatsBlock",title:e.title,children:[t&&(0,i.jsxs)("div",{className:"FeedbackStatsBlock__extendedStatsPreview FeedbackSeparator FeedbackSeparator--top",onClick:s,role:"button",children:[(0,i.jsx)(o.default,{appearance:"preview",title:n.getLang("stories_detailed_stats"),subtitle:t.preview}),(0,i.jsx)("div",{className:"FeedbackStatsBlock__chevron",children:(0,i.jsx)(l.Icon24ChevronCompactRight,{})})]}),e.showPrivacyHint&&(0,i.jsxs)("div",{className:"FeedbackStatsBlock__privacyHint FeedbackSeparator FeedbackSeparator--top",children:[n.getLang("stories_privacy_feedback_hint"),(0,i.jsxs)("div",{className:"FeedbackStatsBlock__links",children:[(0,i.jsx)(a.default,{href:"/settings?act=privacy",onClick:d,children:n.getLang("stories_go_to_settings")}),(0,i.jsx)("span",{className:"dvd"}),(0,i.jsx)(a.default,{onClick:c,children:n.getLang("global_hide_notify")})]})]}),e.showEmptyStatsPrivacyHint&&(0,i.jsxs)("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyHint",children:[(0,i.jsx)("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyIcon"}),(0,i.jsx)("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyText",children:n.getLang("stories_privacy_empty_views_hint")}),(0,i.jsx)("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyLink",children:(0,i.jsx)(a.default,{href:"/settings?act=privacy",onClick:d,children:n.getLang("stories_go_to_settings")})})]})]})},238812:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(785893),o=s(779027);const r=({title:e,additionalTitle:t})=>(0,i.jsxs)("div",{className:"FeedbackTitle",children:[(0,i.jsx)(o.default,{children:e}),t&&(0,i.jsx)(o.default,{className:"FeedbackTitle__additional",children:t})]})},360236:(e,t,s)=>{s.d(t,{default:()=>C});var i=s(785893),o=s(667294),r=s(113788),n=s(129807),a=s(837539),l=s(374823),d=s(922140),c=s(425984),h=s(529e3),_=s(34799),u=s(198448),p=s(159663),m=s(471828),g=s(659397),y=s(315954),v=s(624879),w=s(846701),S=s(879692),f=s(887903),k=s(293622),b=s(397631);class E extends o.Component{render(){const{feedback:e,showMessage:t,sendNavigationStatEvents:s,storyImageUrl:u,showMoreReplies:p,needShowEmptyStats:w,className:S,reactionSet:f}=this.props,{isViewersLoading:k,extendedStatsActive:b}=this.state,E=e?.stats,C=E?.extendedStats,L=e?.replies,T=e?.poll,x=e?.questions,I=e?.viewers;return(0,i.jsx)("div",{className:(0,g.classNames)("FeedbackTooltip",S,{"FeedbackTooltip--empty":w}),onClick:e=>e.stopPropagation(),children:(0,i.jsxs)("div",{className:"FeedbackTooltip__wrapper",children:[(0,i.jsx)("div",{className:"FeedbackTooltip__close",onClick:this.close,children:(0,i.jsx)(y.Icon24Cancel,{})}),!e&&(0,i.jsx)("div",{className:"FeedbackTooltip__spinner",children:(0,i.jsx)(r.Spinner,{size:"medium"})}),e&&(0,i.jsxs)(o.Fragment,{children:[!b&&(0,i.jsx)("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef,children:(0,i.jsxs)("div",{className:"FeedbackTooltip__content",children:[E&&(0,i.jsx)(d.default,{stats:E,extendedStats:C,onExtendedStatsPreviewClick:this.onExtendedStatsPreviewClick,onSettingsBtnClick:this.onSettingsBtnClick,onPrivacyHintHide:this.onPrivacyHintHide}),L&&(0,i.jsx)(c.default,{replies:L,showMore:p}),T&&(0,i.jsx)(h.default,{poll:T}),x&&(0,i.jsx)(a.default,{showMessage:t,storyUrl:u,questions:x,sendNavigationStatEvents:s,onQuestionRemove:this.onQuestionRemove}),I&&(0,i.jsx)(_.default,{viewers:I,reactionSet:f,isLoading:k,needSeparator:!e.questions}),Boolean(I?.nextFrom)&&(0,i.jsx)("div",{className:"FeedbackTooltip__sentinel",ref:this.viewsSentinelRef})]})}),C&&b&&(0,i.jsxs)(o.Fragment,{children:[(0,i.jsxs)("div",{className:"FeedbackTooltip__header FeedbackSeparator FeedbackSeparator--bottom",children:[(0,i.jsxs)("div",{className:"FeedbackTooltip__back",onClick:this.onBackBtnClick,children:[(0,i.jsx)("div",{className:"FeedbackTooltip__backIcon",children:(0,i.jsx)(v.Icon24ChevronCompactLeft,{})}),m.getLang("global_back")]}),m.getLang("stories_detailed_stats")]}),(0,i.jsx)("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef,children:(0,i.jsxs)("div",{className:"FeedbackTooltip__content",children:[C.achievement&&(0,i.jsx)("div",{className:"FeedbackTooltip__achievement",children:(0,i.jsx)(n.default,{appearance:"achievement",title:C.achievement,subtitle:C.achievementSubtitle})}),C.categories.map(((e,t)=>(0,i.jsx)(l.default,{title:e.title,children:(0,i.jsx)("div",{className:"FeedbackTooltip__lines",children:e.lines.map(((e,t)=>(0,i.jsxs)("div",{className:"FeedbackTooltip__line",children:[(0,i.jsx)("div",{className:"FeedbackStatName",children:(0,g.decodeHTMLEntities)(e.name)}),(0,i.jsx)("div",{className:"FeedbackStatCounter",dangerouslySetInnerHTML:{__html:e.counter}})]},t)))})},t)))]})})]})]})]})})}componentDidMount(){const{feedback:e,storyRawId:t,pollId:s,onFetchFeedbackData:i,needShowEmptyStats:o}=this.props,{ownerId:r,itemId:n}=(0,b.splitRawId)(t);if(this.mounted=!0,e)return this.observeTitleChanges(),void this.observeViewerScrollIfNeeded();(0,S.isApiForVKCOMViewerEnabled)()?(0,w.fetchFeedbackFx)({ownerId:r,storyId:n,pollId:s}).then((e=>{if(this.mounted)try{const s=(0,k.transformFeedback)(e,t,o);i(s)}catch(e){console.error(e),(0,f.logStoriesError)({error:e,additionalText:"could not transform feedback data",extra:{ownerId:r,storyId:n}})}})).catch((()=>{(0,p.showFastBox)(m.getLang("global_error"),m.getLang("global_unknown_error")),this.close()})):window.ajax.post("al_stories.php",{act:"get_feedback",story_raw:t},{onDone:e=>{this.mounted&&i(e)},onFail:()=>((0,p.showFastBox)(m.getLang("global_error"),m.getLang("global_unknown_error")),this.close(),!0)})}componentDidUpdate(e,t){!e.feedback&&this.props.feedback&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded()),!t.extendedStatsActive&&this.state.extendedStatsActive?this.observeTitleChanges():t.extendedStatsActive&&!this.state.extendedStatsActive&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded())}componentWillUnmount(){this.unObserveTitleChanges(),this.unObserveViewerScroll(),this.mounted=!1}loadViewers(){const{storyRawId:e,feedback:t,onFetchViewers:s}=this.props,{isViewersLoading:i}=this.state,{ownerId:o,itemId:r}=(0,b.splitRawId)(e);if(!i&&t?.viewers?.nextFrom){if(this.setState({isViewersLoading:!0}),(0,S.isApiForVKCOMViewerEnabled)()){const e=(0,w.getStoryFeedbackLoadParams)(o,r);return void w.storiesService.getViewersFx({...e[w.StoryFeedbackLoadMethods.getViewers],start_from:t.viewers.nextFrom}).then((e=>{const t=(0,k.transformViewersResponse)(e);t&&s(t),this.setState({isViewersLoading:!1})})).catch((()=>{(0,p.showFastBox)(m.getLang("global_error"),m.getLang("global_unknown_error")),this.setState({isViewersLoading:!1})}))}window.ajax.post("al_stories.php",{act:"get_viewers",story_raw:e,offset:t.viewers.nextFrom},{onDone:e=>{s(e),this.setState({isViewersLoading:!1})},onFail:()=>((0,p.showFastBox)(m.getLang("global_error"),m.getLang("global_unknown_error")),this.setState({isViewersLoading:!1}),!0)})}}observeViewerScrollIfNeeded(){const{feedback:e}=this.props;if(e?.viewers?.nextFrom){const e=this.scrollContainerRef.current,t=this.viewsSentinelRef.current;if(!t)return;this.viewsObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&this.loadViewers()}))}),{threshold:[0,1],root:e,rootMargin:"0px 0px 336px 0px"}),this.viewsObserver.observe(t)}}unObserveViewerScroll(){this.viewsObserver&&this.viewsObserver.disconnect()}observeTitleChanges(){const e=this.scrollContainerRef.current;e&&(this.updateTitles(),this.onScrollHandler=(0,u.debounce)((()=>{!this.titles.some(((e,t)=>{if(e.offsetTop)return e===this.activeHeader||this.setActiveHeader(e),!0;if(this.titles[t+1]){const s=this.titles[t+1],i=this.titles[t+1].parentElement,o=i&&i.offsetHeight;return!!o&&(s.offsetTop+s.offsetHeight===o&&(e===this.activeHeader||this.setActiveHeader(e),!0))}return!1}))&&this.activeHeader&&(this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=null)}),5),e.addEventListener("scroll",this.onScrollHandler))}updateTitles(){const e=this.scrollContainerRef.current;e&&(this.titles=Array.from(e.querySelectorAll(".FeedbackTitle")),this.titles.reverse())}unObserveTitleChanges(){this.scrollContainerRef.current&&this.onScrollHandler&&this.scrollContainerRef.current.removeEventListener("scroll",this.onScrollHandler),this.onScrollHandler=null,this.titles=[]}setActiveHeader(e){this.activeHeader&&this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=e,e.classList.add("FeedbackTitle--active")}constructor(e){super(e),this.onQuestionRemove=e=>{this.props.onQuestionRemove(e)},this.close=()=>{this.props.toggleFeedbackTooltip(!1)},this.onSettingsBtnClick=()=>{this.props.sendNavigationStatEvents("go_to_settings")},this.onPrivacyHintHide=()=>{this.props.onPrivacyHintHide()},this.onExtendedStatsPreviewClick=()=>{const{sendNavigationStatEvents:e}=this.props;this.unObserveViewerScroll(),this.unObserveTitleChanges(),this.setState({extendedStatsActive:!0}),e("open_advanced_statistic")},this.onBackBtnClick=()=>{this.unObserveTitleChanges(),this.setState({extendedStatsActive:!1})},this.state={isViewersLoading:!1,extendedStatsActive:!1},this.mounted=!1,this.scrollContainerRef=(0,o.createRef)(),this.viewsSentinelRef=(0,o.createRef)(),this.titles=[],this.viewsObserver=null,this.activeHeader=null,this.onScrollHandler=null}}const C=E},34799:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(785893),o=s(233412),r=s(113788),n=s(374823);const a=({viewers:e,isLoading:t=!1,needSeparator:s=!0,reactionSet:a})=>(0,i.jsxs)(n.default,{className:"FeedbackViewersBlock",title:e.title,needSeparator:s,children:[e.hiddenReason&&(0,i.jsx)("span",{className:"FeedbackViewersBlock__hiddenReason",children:e.hiddenReason}),(0,i.jsx)("div",{className:"FeedbackViewersBlock__items",children:e.items.map(((e,t)=>(0,i.jsx)(o.default,{user:e,reactionSet:a},t)))}),t&&(0,i.jsx)("div",{className:"FeedbackViewersBlock__spinner",children:(0,i.jsx)(r.Spinner,{size:"small"})})]})},129807:(e,t,s)=>{s.d(t,{default:()=>r});var i=s(785893),o=s(659397);const r=({title:e,subtitle:t,appearance:s="preview"})=>(0,i.jsxs)("div",{className:`InfoAside InfoAside--${s}`,children:[(0,i.jsx)("div",{className:"InfoAside__image"}),(0,i.jsxs)("div",{className:"InfoAside__description",children:[(0,i.jsx)("span",{className:"InfoAside__title",children:(0,o.decodeHTMLEntities)(e)}),(0,i.jsx)("span",{className:"InfoAside__subtitle",children:(0,o.decodeHTMLEntities)(t)})]})]})},322617:(e,t,s)=>{s.d(t,{default:()=>h});var i=s(785893),o=s(471828),r=s(128907),n=s(30655),a=s(659397),l=s(797235);function d(e){let t="";if(e.type===l.StoryPollBackgroundType.photo)t=`#${e.backgroundColor}`;else if(e.type===l.StoryPollBackgroundType.gradient){t=`linear-gradient(${e.angle-90}deg, ${e.points.map((e=>`#${e.color} ${Math.round(100*e.position)}%`)).join(", ")})`}return t}function c(e){const{ownerId:t,pollId:s,needShowResults:i}=e;i?(0,n.showWiki)({w:`poll${t}_${s}`},!1,void 0,{customRef:"story"}):(0,r.showPollBox)(s,{ref:"story",className:"story_poll"})}const h=({poll:e})=>{const t=function(e){const{background:t}=e;return(0,i.jsx)("div",{className:"PollSnippet__background",style:{background:d(t)},children:t.type===l.StoryPollBackgroundType.photo&&(0,i.jsx)("div",{className:"PollSnippet__photo",style:{backgroundImage:`url(${t.photoUrl})`}})})}(e);return(0,i.jsxs)("div",{className:(0,a.classNames)("PollSnippet",{"PollSnippet--default":e.background.type===l.StoryPollBackgroundType.default}),children:[t,(0,i.jsx)("div",{className:"PollSnippet__question",children:(0,a.decodeHTMLEntities)(e.question)}),(0,i.jsx)("div",{className:"PollSnippet__countVoters",children:(0,a.decodeHTMLEntities)(e.votersCountText)}),(0,i.jsx)("div",{className:"PollSnippet__showResult",onClick:c.bind(null,e),children:o.getLang("stories_voting_show_result")})]})}},528233:(e,t,s)=>{s.d(t,{default:()=>w});var i=s(785893),o=s(667294),r=s(762759),n=s(441430),a=s(598955),l=s(471828),d=s(659397),c=s(636322),h=s(93367),_=s(977584),u=s(492496),p=s(846701),m=s(45412),g=s(892665),y=s(879692),v=s(86894);class w extends o.Component{constructor(e){super(e),this.componentDidMount=()=>{const e=this.questionTextEl.current;e&&this.adjustQuestionTextSize(e)},this.componentDidUpdate=()=>{this.replyTextareaEl.current&&this.replyTextareaEl.current.focus()},this.render=()=>{const{isOpenReplyModal:e,replyText:t}=this.state,{question:s,storyUrl:o}=this.props,{author:a,canAnswer:c,text:h}=s,_=(0,d.decodeHTMLEntities)(h),u=(0,d.classNames)("StoryQuestion__title",{"StoryQuestion__title--free":!c});return(0,i.jsxs)("div",{className:"StoryQuestion",children:[(0,i.jsxs)("div",{className:"StoryQuestion__content",children:[this.renderAuthor(),(0,i.jsx)("span",{className:u,title:_,ref:this.questionTextEl,children:_})]}),(0,i.jsx)("div",{className:"StoryQuestion__controls",children:c&&(0,i.jsx)(n.Button,{mode:s.isPublished?"secondary":"primary",size:"s",stretched:!0,onClick:this.openReplyModal,children:l.getLang("stories_question_reply")})}),e&&(0,i.jsx)(r.Modal,{title:l.getLang("stories_question_reply_box_title").replace("{name}",(0,d.decodeHTMLEntities)(a.nameDat)),actionButtons:this.getReplyModalActions(),className:"StoryQuestion__replyModal",onClose:this.closeReplyModal,appearance:"blue",children:(0,i.jsxs)("div",{className:"StoryQuestion__inner",children:[(0,i.jsx)("textarea",{ref:this.replyTextareaEl,className:"StoryQuestion__textarea",placeholder:l.getLang("stories_question_reply_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:t}),(0,i.jsx)("img",{srcSet:o,className:"StoryQuestion__image"})]})})]})},this.renderAuthor=()=>{const{id:e,isAnonymous:t,author:s}=this.props.question,o="StoryQuestion__author",r=(0,d.decodeHTMLEntities)(s.name);return(0,i.jsxs)("div",{className:"StoryQuestion__header",children:[t&&(0,i.jsx)("span",{className:o,children:r}),!t&&(0,i.jsx)("a",{href:s.link,className:o,onClick:()=>window.cur.storyLayer.sendNavigationStatEvents("question_go_to_author",!0,{questionId:e}),children:r}),(0,i.jsx)(a.default,{position:"b",align:"right",trigger:"hover",data:this.getActions(),children:(0,i.jsx)("span",{className:"StoryQuestion__actions",children:(0,i.jsx)(u.Icon20Dropdown,{})})})]})},this.getActions=()=>{const{question:e}=this.props,{isAuthorBan:t}=this.state,s=[{text:l.getLang("stories_question_delete"),onClick:()=>this.props.removeQuestion(e)}];return e.canBlocked&&(t?s.push({text:l.getLang("stories_question_author_unban"),onClick:this.unbanAuthor}):s.push({text:l.getLang("stories_question_author_ban"),onClick:this.banAuthor}),s.push({text:l.getLang("stories_question_author_report"),onClick:this.showReportForm})),s},this.adjustQuestionTextSize=e=>{if(e.scrollHeight>e.offsetHeight){const t=getComputedStyle(e),s=parseInt(t.fontSize)-.5,i=s+2.5,o=Math.floor(parseInt(t.height)/i);s>10&&(e.setAttribute("style",`font-size: ${s}px; line-height: ${i}px; -webkit-line-clamp: ${o};`),setTimeout((()=>{this.adjustQuestionTextSize(e)}),0))}},this.getReplyModalActions=()=>{const{isReplyButtonLoading:e,replyText:t}=this.state;return(0,i.jsxs)(v.ButtonGroup,{children:[(0,i.jsx)(n.Button,{size:"m",mode:"tertiary",onClick:this.closeReplyModal,children:l.getLang("global_cancel")}),(0,i.jsx)(n.Button,{size:"m",mode:"primary",loading:e,disabled:!(0,c.trim)(t),onClick:this.sendReply,children:l.getLang("stories_question_reply_send")})]})},this.openReplyModal=()=>{this.setState({isOpenReplyModal:!0})},this.closeReplyModal=()=>{this.setState({isOpenReplyModal:!1})},this.handleChange=e=>{this.setState({replyText:e.target.value})},this.handleKeyDown=e=>{const{replyText:t}=this.state;(0,c.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==h.KEY.RETURN&&this.sendReply()},this.resetReplyText=()=>{this.setState({replyText:""})},this.sendReply=()=>{const{replyText:e}=this.state,{question:t,showMessage:s}=this.props,{text:i,id:o,ownerId:r,storyOwnerId:n,storyId:a,sendHash:d}=t,h=`${e}\n\n🗣 ${(0,c.unclean)(i)}`;if((0,y.isActsToApiFirstForVKCOMViewerEnabled)()){const e=`story${n}_${a}`;this.setState({isReplyButtonLoading:!0}),(0,m.apiMessagesSend)({user_id:r,entrypoint:"stories_comment",attachment:e,random_id:(0,g.random)(),message:h}).then((()=>{this.closeReplyModal(),this.resetReplyText(),s(l.getLang("stories_answer_sent")),window.cur.storyLayer.sendNavigationStatEvents("question_send_message",!0,{questionId:o})})).catch((e=>{this.closeReplyModal(),this.resetReplyText(),s(e?.error?.error_text||e?.error?.error_msg||l.getLang("global_error"))})).finally((()=>{this.setState({isReplyButtonLoading:!1})}))}else{const e=`story:${n}_${a}`;window.ajax.post("al_im.php",{act:"a_send",msg:h,hash:d,media:e,to:r,entrypoint:"stories_comment"},{onDone:()=>{this.closeReplyModal(),this.resetReplyText(),s(l.getLang("stories_answer_sent")),window.cur.storyLayer.sendNavigationStatEvents("question_send_message",!0,{questionId:o})},onFail:e=>(this.closeReplyModal(),this.resetReplyText(),s(e),!0),showProgress:()=>this.setState({isReplyButtonLoading:!0}),hideProgress:()=>this.setState({isReplyButtonLoading:!1})})}},this.banAuthor=()=>{const{question:e,showMessage:t}=this.props,{storyOwnerId:s,storyId:i,id:o,isAnonymous:r,banHash:n}=e;(0,y.isActsToApiFirstForVKCOMViewerEnabled)()?p.storiesService.banQuestionAuthorFx({owner_id:s,story_id:i,question_id:o}).then((()=>{this.setState({isAuthorBan:!0}),t(l.getLang("stories_question_author_blocked"));let e="question_ban_author";r&&(e="question_ban_anonymous_author"),window.cur.storyLayer.sendNavigationStatEvents(e,!0,{questionId:o})})).catch((e=>{t(e?.error?.error_text||e?.error?.error_msg||l.getLang("global_error"))})):window.ajax.post("al_stories.php",{act:"ban_author_question",story_owner_id:s,story_id:i,question_id:o,ban_hash:n},{onDone:()=>{this.setState({isAuthorBan:!0}),t(l.getLang("stories_question_author_blocked"));let e="question_ban_author";r&&(e="question_ban_anonymous_author"),window.cur.storyLayer.sendNavigationStatEvents(e,!0,{questionId:o})},onFail:e=>(t(e),!0)})},this.unbanAuthor=()=>{const{question:e,showMessage:t}=this.props,{storyOwnerId:s,storyId:i,id:o,banHash:r}=e;(0,y.isActsToApiFirstForVKCOMViewerEnabled)()?p.storiesService.unbanQuestionAuthorFx({owner_id:s,story_id:i,question_id:o}).then((()=>{this.setState({isAuthorBan:!1}),t(l.getLang("stories_question_author_unblocked"))})).catch((e=>{t(e?.error?.error_text||e?.error?.error_msg||l.getLang("global_error"))})):window.ajax.post("al_stories.php",{act:"unban_author_question",story_owner_id:s,story_id:i,question_id:o,ban_hash:r},{onDone:()=>{this.setState({isAuthorBan:!1}),t(l.getLang("stories_question_author_unblocked"))},onFail:e=>(t(e),!0)})},this.showReportForm=()=>{(0,_.showReportForm)("story_question",this.props.question.ownerId,this.props.question.id,(()=>this.props.showMessage(l.getLang("stories_report_sent"))))},this.state={isAuthorBan:e.question.isOwnerBlocked,replyText:"",isOpenReplyModal:!1,isReplyButtonLoading:!1,isReportButtonLoading:!1,selectReasons:0},this.replyTextareaEl=(0,o.createRef)(),this.questionTextEl=(0,o.createRef)()}}},2541:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(785893),o=s(700897),r=s(659397);function n(e){return e.items.some((e=>e.unread))}const a=({storyPack:e,listName:t,source:s})=>(0,i.jsxs)("a",{href:e.author.href,className:(0,r.classNames)("StoryReply",{"StoryReply--new":n(e)}),onClick:i=>{i.metaKey||i.ctrlKey||((0,o.showStory)(`${e.author.id}/${t}`,{fromEl:i.target,source:s}),i.preventDefault())},role:"button",children:[(0,i.jsx)("div",{className:"StoryReply__avatar",children:(0,i.jsx)("div",{className:"StoryReply__image",style:{backgroundImage:`url(${e.author.photo})`}})}),(0,i.jsx)("div",{className:"StoryReply__caption",children:(0,r.decodeHTMLEntities)(e.author.firstName)})]})},233412:(e,t,s)=>{s.d(t,{default:()=>h});var i=s(785893),o=s(659397),r=s(654200),n=s(977053),a=s(311429),l=s(242864),d=s(19024),c=s(314869);const h=({user:e,reactionSet:t})=>{const s=(0,o.decodeHTMLEntities)(e.name),h=(0,n.partConfigEnabled)("avatar_component_refactor_web");let _;return t&&null!=e.reaction_id&&(_=(0,r.getReaction)(t,e.reaction_id)?.imageStoryPreviewURL),(0,i.jsxs)("a",{href:e.url,className:"Viewer",role:"button",children:[h&&(0,i.jsxs)(a.RichAvatar,{src:e.photoUrl,nft:Boolean(e.nft),size:40,children:[Boolean(_)&&(0,i.jsx)(a.RichAvatar.Badge,{children:(0,i.jsx)("div",{className:"Viewer__reaction",style:{backgroundImage:`url(${_})`}})}),e.isLiked&&!_&&(0,i.jsx)(a.RichAvatar.Badge,{children:(0,i.jsx)("span",{className:"Viewer__like",children:(0,i.jsx)(c.Icon12Like,{})})})]}),!h&&(0,i.jsxs)("div",{className:(0,o.classNames)("Viewer__avatar",{"Viewer__avatar--isLiked":e.isLiked&&!_}),title:s,children:[(0,i.jsx)("img",{className:"Viewer__img",src:e.photoUrl,alt:s}),Boolean(_)&&(0,i.jsx)("div",{className:"Viewer__reaction",style:{backgroundImage:`url(${_})`}})]}),(0,i.jsxs)("div",{className:"Viewer__name",children:[(0,i.jsx)(l.TextClamp,{lines:1,children:s}),e.isVerified&&(0,i.jsx)(d.default,{verifiedText:s,className:"Viewer__verified"})]})]})}},124252:(e,t,s)=>{s.d(t,{MetaStory:()=>h});var i=s(785893),o=s(667294),r=s(902947),n=s(36703),a=s(659397),l=s(670811),d=s(937891),c=s(13602);class h extends o.Component{render(){const{metaStoryInfo:e,list:t,listName:s,source:o}=this.props,{isScrolling:r}=this.state,n=!t||!t.length;return(0,i.jsxs)("div",{className:"MetaStory",children:[(0,i.jsx)("div",{className:"MetaStory__infoWrapper",style:{paddingBottom:"286px"},ref:this.infoRef,children:(0,i.jsx)("div",{className:"MetaStory__info",children:e})}),(0,i.jsx)("div",{className:(0,a.classNames)("MetaStory__pane",{"MetaStory__pane--scrolling":r}),children:(0,i.jsxs)(c.default,{className:(0,a.classNames)("MetaStory__container",{"MetaStory__container--isEmpty":n}),hasMore:this.hasMore(),loadMore:this.loadMore,onScroll:this.onScroll,threshold:500,spinnerColor:"#fff",children:[(0,i.jsxs)("div",{className:"MetaStory__navigation",onMouseDown:this.onClickableAreaMouseDown,onMouseUp:this.onClickableAreaMouseUp,onContextMenu:this.onClickableAreaMouseUp,children:[(0,i.jsx)("div",{className:"MetaStory__navigationArea MetaStory__navigationArea--back"}),(0,i.jsx)("div",{className:"MetaStory__navigationArea MetaStory__navigationArea--next"})]}),(0,i.jsxs)("div",{className:"MetaStory__grid",style:{minHeight:"calc(100% - 286px"},children:[t&&t.map((e=>(0,i.jsx)(l.MetaStoryItemPreview,{block:e,list:t,listName:s,source:o},e.id))),n&&[...Array(9)].map(((e,t)=>(0,i.jsx)(d.MetaStoryItemPreviewSkeleton,{},t)))]})]})})]})}componentWillUnmount(){clearTimeout(this.longTapTimer)}hasMore(){return!!this.props.hasMore&&this.props.hasMore()}constructor(e){super(e),this.infoRef=(0,o.createRef)(),this.onScroll=e=>{if(this.infoRef.current){const t=e.currentTarget,s=Boolean(t.scrollTop),i=s?Math.min(t.scrollTop/286,1):0;this.props.onTopScrolled?.(i>=1),this.props.onScroll(s),this.setState({isScrolling:s}),s?this.props.pause():this.props.play();const o=.6,r=s?Math.max(o-i,0):1;this.infoRef.current.style.opacity=`${r}`}},this.onClickableAreaMouseDown=()=>{this.downTs=(0,r.vkNow)(),this.longTapTimer=setTimeout(this.props.onLongTap,n.LONG_PRESS_DELAY_MS)},this.onClickableAreaMouseUp=e=>{clearTimeout(this.longTapTimer);const t=e.target,s=!((0,r.vkNow)()-this.downTs<n.LONG_PRESS_DELAY_MS);if(t.classList.contains("MetaStory__navigationArea--back")&&!s)return this.props.playPrevStory();s?this.props.isPaused()&&this.props.play(!1,!!this.downTs):this.props.playNextStory()},this.loadMore=()=>this.props.loadMore?this.props.loadMore():Promise.resolve(),this.state={isScrolling:!1}}}},265794:(e,t,s)=>{s.d(t,{MetaStoryInfo:()=>r});var i=s(785893),o=s(659397);const r=({header:e,subheader:t,url:s,urlText:r,icon:n})=>{const a=(0,i.jsxs)(i.Fragment,{children:[n&&"string"==typeof n&&(0,i.jsx)("div",{className:"MetaStoryInfo__icon",style:{backgroundImage:`url(${n})`}}),n&&"object"==typeof n&&(0,i.jsx)("div",{className:"MetaStoryInfo__icon MetaStoryInfo__icon--inline",children:n}),(0,i.jsx)("div",{className:"MetaStoryInfo__header",children:(0,o.decodeHTMLEntities)(e)}),t&&(0,i.jsx)("div",{className:"MetaStoryInfo__subheader",children:(0,o.decodeHTMLEntities)(t)}),s&&r&&(0,i.jsx)("div",{className:"MetaStoryInfo__pseudoLink",children:r})]});return s?(0,i.jsx)("a",{href:s,className:"MetaStoryInfo",target:"_blank",children:a}):(0,i.jsx)("div",{className:"MetaStoryInfo",children:a})}},670811:(e,t,s)=>{s.d(t,{MetaStoryItemPreview:()=>c});var i=s(785893),o=s(667294),r=s(659397),n=s(959302),a=s(797235),l=s(977053),d=s(311429);class c extends o.Component{render(){const{block:e,className:t}=this.props,{isFullImageLoadedMap:s}=this.state;let o=this.getCurrentStory(),n=o.unread,c="",h=Boolean(e.author?.nft),_=o.type===a.StoryType.LIVE;const u=(0,l.partConfigEnabled)("avatar_component_refactor_web");let p;return _?p="negative":n&&(p="accent"),c=s[o.raw_id]||!o.preview_url?o.small_preview:o.preview_url,(0,i.jsx)("span",{className:(0,r.classNames)("MetaStoryItemPreview",{"MetaStoryItemPreview--live":_},"MetaStoryItemPreviewLayout",t),onClick:this.onClick,children:e.author&&(0,i.jsxs)("div",{className:"MetaStoryItemPreview__inner",children:[(0,i.jsx)("img",{src:c,className:"MetaStoryItemPreview__image",alt:"",loading:"lazy"}),u&&(0,i.jsx)(d.RichAvatar,{className:"MetaStoryItemPreview__avatar",src:e.author.photo,href:e.author.href,target:"_blank",nft:h,size:28,children:p&&(0,i.jsx)(d.RichAvatar.Outline,{appearance:p})}),!u&&(0,i.jsx)("a",{href:e.author.href,className:(0,r.classNames)("MetaStoryItemPreview__author",{"MetaStoryItemPreview__author--unread":n}),style:{backgroundImage:`url('${e.author.photo}')`}}),(0,i.jsx)("span",{className:"MetaStoryItemPreview__title",children:(0,r.decodeHTMLEntities)(e.author.name)})]})})}componentDidMount(){this.isMount=!0,this.loadCurrentStoryPreviewIfNeeded()}componentDidUpdate(){this.loadCurrentStoryPreviewIfNeeded()}loadCurrentStoryPreviewIfNeeded(){const e=this.getCurrentStory();if(e.raw_id===this.currentStoryRawId)return;if(this.currentStoryRawId=e.raw_id,this.state.isFullImageLoadedMap[e.raw_id])return;const t=new Image;t.src=e.small_preview,t.onload=()=>this.onImageLoad(e.raw_id)}getCurrentStory(){const{block:e}=this.props;let t=e.items.find((e=>e.unread));return t||(t=e.items[0]),t}constructor(e){super(e),this.isMount=!1,this.currentStoryRawId="",this.onClick=e=>{const{source:t}=this.props;window.Stories.show(`${(0,n.getStoryBlockKey)(this.props.block)}/${this.props.listName}`,{fromEl:e.target,source:t},this.props.list)},this.onImageLoad=e=>{const{isFullImageLoadedMap:t}=this.state;this.isMount&&(t[e]||this.setState({isFullImageLoadedMap:{...t,[e]:!0}}))},this.state={isFullImageLoadedMap:{}}}}},937891:(e,t,s)=>{s.d(t,{MetaStoryItemPreviewSkeleton:()=>o});var i=s(785893);const o=()=>(0,i.jsx)("div",{className:"MetaStoryItemPreviewSkeleton MetaStoryItemPreviewLayout",children:(0,i.jsxs)("div",{className:"MetaStoryItemPreviewSkeleton__inner",children:[(0,i.jsx)("div",{className:"MetaStoryItemPreviewSkeleton__author"}),(0,i.jsx)("div",{className:"MetaStoryItemPreviewSkeleton__title"})]})})},406946:(e,t,s)=>{s.d(t,{ReactionsPanel:()=>n});var i=s(785893),o=s(659397),r=s(801767);const n=({className:e,stickers:t,onStickerClick:s,title:n})=>{const a=e=>{r.StickersAnimation.loadAndPlaySticker(e.currentTarget)};return(0,i.jsx)("div",{className:(0,o.classNames)("ReactionsPanel",e),children:(0,i.jsxs)("div",{className:"ReactionsPanel__container",children:[Boolean(n)&&(0,i.jsx)("div",{className:"ReactionsPanel__title",children:n}),(0,i.jsx)("div",{className:"ReactionsPanel__items",children:t.map(((e,t)=>((e,t)=>{const r=e.animationUrl?"sticker_img":"";return(0,i.jsx)("div",{className:"ReactionsPanel__item","data-pack-id":e.packId,"data-sticker-id":e.id,"data-uniq-id":e.uniqId,"data-animation-path":e.animationUrl,"data-animation-class":"ReactionsPanel__itemAnimation",onMouseDown:()=>s(e.id,t),onMouseEnter:a,children:(0,i.jsx)("div",{className:(0,o.classNames)("ReactionsPanel__itemImage",r),style:{backgroundImage:`url(${e.imageUrl})`}})},e.id)})(e,t)))})]})})}},213263:(e,t,s)=>{s.d(t,{StickerItem:()=>E});var i=s(785893),o=s(667294),r=s(530036),n=s(797235),a=s(659397),l=s(471828),d=s(700897),c=s(30655),h=s(954314),_=s(847441),u=s(159663),p=s(600149),m=s(180937),g=s(603057),y=s(977053),v=s(184132),w=s(205907),S=s(397631),f=s(553885),k=s(621808),b=s(385023);class E extends o.Component{constructor(e){super(e),this.myMusicService=(0,w.ensureMyMusicService)(),this.componentDidMount=()=>{const e=(0,y.partConfigEnabled)("add_audio_to_effector_web"),{sticker:t,story:s}=this.props;t.audioRestriction&&s.data.needMute&&s.video&&(s.video.muted=!0),this.playlist.on(this,_.events.ADDED,(()=>{this.props.showMessage(l.getLang("stories_audio_added")),this.props.playStory()})),this.playlist.on(this,_.events.REMOVED,(()=>{this.props.showMessage(l.getLang("stories_audio_deleted")),this.props.playStory()})),t.type===n.StickerTypes.marketItem&&(0,g.logViewMarketItemInStories)(t.link),e&&this.myMusicService.$identitiesMap.watch((e=>{this.myMusicIdentitiesMap=e}))},this.componentWillUnmount=()=>{this.playlist.off(this)},this.render=()=>{const{story:e,sticker:t,originalWidth:s,originalHeight:r,widthViewBox:l,heightViewBox:d}=this.props,{needMute:c}=e.data,{audioRestriction:h}=t,_=(0,p.swapObject)(n.StickerTypes),u=m.ls.get("story_show_clickable_zones"),g=(0,a.classNames)("StorySticker",{"StorySticker--clickableZones":u}),y=e=>this.props.onMouseUpHandle(e,(()=>this.handleClick(e))),v=(0,b.getStickerStyle)({sticker:t,originalWidth:s,originalHeight:r,widthViewBox:l,heightViewBox:d});return(0,i.jsxs)(o.Fragment,{children:[(0,i.jsx)("div",{ref:this.stickerRef,"data-type":_[t.type],className:g,style:v,onMouseDown:e=>this.props.onMouseDownHandle(e),onMouseUp:y,onContextMenu:y}),h&&c&&this.renderRestriction()]})},this.renderRestriction=()=>{const{audioRestriction:e}=this.props.sticker;return e?(0,i.jsx)("div",{className:"StoryRestriction",children:(0,i.jsxs)("div",{className:"StoryRestriction__inner",children:[(0,i.jsx)("span",{className:"StoryRestriction__title",children:e.title}),e.buttonUrl&&(0,i.jsx)("a",{className:"StoryRestriction__link",href:e.buttonUrl,children:e.buttonText})]})}):null},this.getStickerStyle=()=>{const{sticker:e,originalWidth:t,originalHeight:s,widthViewBox:i,heightViewBox:o}=this.props,{top:r,left:n,width:a,height:l,rotate:d}=e;let c=i,h=o;return o/i>1.77?c=t*o/s:h=s*i/t,{top:r*h-(h-o)/2,left:n*c-(c-i)/2,width:a*c,height:l*h,transform:`rotate(${d}deg)`}},this.handleClick=e=>{const{sticker:t}=this.props;switch(t.type){case n.StickerTypes.hashtag:this.handleClickHashtag(e);break;case n.StickerTypes.mention:this.handleClickMention(e);break;case n.StickerTypes.question:this.handleClickQuestion();break;case n.StickerTypes.place:this.handleClickPlace(e);break;case n.StickerTypes.music:this.handleClickMusic(e);break;case n.StickerTypes.marketItem:this.handleClickMarketItem(e);break;case n.StickerTypes.storyReply:this.handleClickStoryReply(e);break;case n.StickerTypes.owner:this.handleClickOwner(e);break;case n.StickerTypes.link:this.handleClickLink(e);break;case n.StickerTypes.post:this.handleClickPost(e);break;case n.StickerTypes.poll:this.handleClickPoll();break;case n.StickerTypes.app:this.handleClickApp();break;case n.StickerTypes.sticker:this.handleClickSticker(e);break;case n.StickerTypes.situationalTheme:this.handleClickStickerSituationalTheme();break;case n.StickerTypes.playlist:this.handleClickPlaylist(e);break;case n.StickerTypes.videoButton:this.handleClickVideo(e)}},this.handleClickHashtag=e=>{const{hashtag:t}=this.props.sticker,s=t.replace("#","%23"),o=l.getLang("stories_show_hashtag_link"),r="hashtag",n=(0,i.jsx)("a",{href:`/feed?q=${s}&section=search`,onClick:()=>this.onClickToTooltip(r),target:"_blank",className:"StoriesTooltip__link",children:o});this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:r}})},this.handleClickMention=e=>{const{mentionedOwnerHref:t,mentionedText:s,mentionedPhotoUrl:o}=this.props.sticker,r="mention",n=(0,i.jsx)("a",{href:t,onClick:()=>this.onClickToTooltip(r),target:"_blank",className:"StoriesTooltip__link StoriesTooltip__link--mention",children:(0,i.jsxs)("div",{className:"StoriesTooltipMention",children:[(0,i.jsx)("div",{className:"StoriesTooltipMention__avatar",style:{backgroundImage:`url(${o})`}}),(0,i.jsx)("span",{className:"StoriesTooltipMention__text",children:(0,a.decodeHTMLEntities)(s)})]})});this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:r}})},this.handleClickQuestion=()=>{this.props.showQuestionModal(),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"question"}})},this.handleClickPlace=e=>{const{sticker:t,list:s}=this.props,{placeId:o}=t,r=l.getLang("stories_go_to_place"),n="place";if(window.layerQueue.count()||s.includes("archive")){const t="/feed?section=search&w=place"+o,s=(0,i.jsx)("a",{href:`${t}`,onClick:()=>this.onClickToTooltip(n),target:"_blank",className:"StoriesTooltip__link",children:r});this.props.toggleTooltip(e,s)}else{const t=()=>{this.onClickToTooltip(n),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),(0,c.showWiki)({w:"place"+o})},s=(0,i.jsx)("div",{className:"StoriesTooltip__link",onClick:t,children:r});this.props.toggleTooltip(e,s)}this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:t.id,type:n}})},this.handleClickMusic=e=>{const t=(0,y.partConfigEnabled)("add_audio_to_effector_web"),{story:s,sticker:o}=this.props,{needMute:r}=s.data,{audioId:n,audioData:a,audioRestriction:d}=o;if(d)return void(r||h.AudioUtils.showAudioRestriction(JSON.parse(a),{onShow:()=>{this.props.pauseStory()},onHide:()=>{this.props.playStory()}}));let c=!1;if(t)c=n in this.myMusicIdentitiesMap;else{c="added"===(h.AudioUtils.getAddRestoreInfo()[n]||{}).state}const _=c?l.getLang("stories_audio_delete"):l.getLang("stories_audio_add"),u=(0,i.jsxs)("ul",{className:"StoriesTooltipActions _audio_row","data-audio":a,children:[(0,i.jsx)("li",{className:"StoriesTooltipActions__item",onClick:this.addAudio,children:_}),(0,i.jsx)("li",{className:"StoriesTooltipActions__item",onClick:this.setNext,children:l.getLang("stories_audio_next_audio")})]});this.props.toggleTooltip(e,u,"b"),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.id,type:"music"}})},this.handleClickPlaylist=e=>{const{playlistOwnerId:t,playlistId:s,playlistCreatorId:o,playlistFollowed:r}=this.props.sticker,n=window.vk.id===o,a=`${t}_${s}`,d=h.AudioUtils.getPlaylistAddRestoreInfo()[a]||{},c=d.state?"followed"===d.state:r,_=c?l.getLang("stories_playlist_unfollow"):l.getLang("stories_playlist_follow"),u=c?this.unfollowPlaylist:this.followPlaylist,p=(0,i.jsxs)("ul",{className:"StoriesTooltipActions",children:[!n&&(0,i.jsx)("li",{className:"StoriesTooltipActions__item",onClick:u,children:_}),(0,i.jsx)("li",{className:"StoriesTooltipActions__item",onClick:this.setNextPlaylist,children:l.getLang("stories_playlist_next")})]});this.props.toggleTooltip(e,p,"b"),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}})},this.handleClickMarketItem=e=>{const{photoUrl:t,link:s,isRestricted:o}=this.props.sticker,n="market_item",a=new URL(`${document.location.origin}${s}`).searchParams,d=a.get("w")?"&ref=stories":"",c=a.get("w")?"&refScreen=stories":"",{ownerId:h,itemId:_}=(0,S.splitRawId)(a.get("w")?.replace("product","")??"");let p=`${s}${d}${c}`;(0,y.partConfigEnabled)(h&&_&&"web_market_item_page")&&(p=(0,f.constructProductLink)({baseUrl:"",itemId:_,ownerId:h,refSource:k.RefSource.STORIES,ref:"stories"}));const m=o?{onClick:()=>{(0,u.showFastBox)(l.getLang("stories_market_access_error_title"),l.getLang("stories_market_access_error_text")),this.onClickToTooltip(n)}}:{onClick:()=>this.onClickToTooltip(n),href:p},g=(0,i.jsxs)("a",{...m,target:"_blank",className:"StoriesTooltip__link",children:[t&&!o?(0,i.jsx)("img",{className:"StoriesTooltip__marketItemThumb",src:t,alt:""}):(0,i.jsx)("div",{className:"StoriesTooltip__marketItemThumb StoriesTooltip__marketItemThumb--stub",children:(0,i.jsx)(r.Icon20MarketOutline,{})}),(0,i.jsx)("span",{className:"StoriesTooltip__marketItemText",children:l.getLang("stories_go_to_market_item")})]});this.props.toggleTooltip(e,g),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:n}})},this.handleClickStoryReply=e=>{const{sticker:t}=this.props,{ownerId:s,storyId:o,isExpired:r}=t,n="story_reply";if(r)return void this.handleClickOwner(e);const a=(0,i.jsx)("a",{className:"StoriesTooltip__link",onClick:()=>{const e=`${s}_${o}`;(0,d.showStory)(`story${e}/${e}/context:owner`),this.onClickToTooltip(n)},children:l.getLang("stories_go_to_story")});this.props.toggleTooltip(e,a),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:t.id,type:n}})},this.handleClickOwner=e=>{const{ownerId:t,link:s}=this.props.sticker,o=v.Ranges.isUserIdTransitional(t)?l.getLang("stories_go_to_profile"):l.getLang("stories_go_to_group"),r=(0,i.jsx)("a",{href:s,target:"_blank",className:"StoriesTooltip__link",children:o});this.props.toggleTooltip(e,r)},this.handleClickLink=e=>{const{link:t,tooltipText:s}=this.props.sticker,o="link",r=(0,i.jsx)("a",{href:t,onClick:()=>this.onClickToTooltip(o),target:"_blank",className:"StoriesTooltip__link",children:s});this.props.toggleTooltip(e,r),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:o}})},this.handleClickPost=e=>{const{postOwnerId:t,postId:s}=this.props.sticker,o=l.getLang("stories_go_to_post"),r="post",n=(0,i.jsx)("a",{href:`/wall${t}_${s}`,onClick:()=>this.onClickToTooltip(r),target:"_blank",className:"StoriesTooltip__link",children:o});this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:r}})},this.handleClickPoll=()=>{const{pollId:e}=this.props.sticker;this.props.pauseStory();let t={act:"get_layout",voting_id:e,ref:"story",for_box:!0},s={containerClass:"story_poll",params:{hideButtons:!0,width:510,onDestroy:()=>{this.props.playStory()}}};(0,u.showBox)("al_voting.php",t,s),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"poll"}})},this.handleClickApp=()=>{this.props.markAppNotificationsSeen(this.props.sticker),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"app"}})},this.handleClickStickerSituationalTheme=()=>{const{situationalAppId:e,situationalThemeId:t}=this.props.sticker;window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),this.props.pauseStory(),(0,c.showWiki)({w:`app${e}#${t}`}),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"situational_theme"}})},this.addAudio=e=>{const t=e.target;h.AudioUtils.toggleAddAudio(t,null,(()=>{this.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:this.props.sticker.id,type:"music"}})})),this.props.hideTooltip()},this.followPlaylist=e=>{const{playlistOwnerId:t,playlistId:s,playlistFollowHash:i}=this.props.sticker;h.AudioUtils.followPlaylist(e.target,t,s,i);const o=`${t}_${s}`;h.AudioUtils.getPlaylistAddRestoreInfo()[o]={state:"followed"},this.props.playStory(),this.props.hideTooltip(),this.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}})},this.unfollowPlaylist=e=>{const{playlistOwnerId:t,playlistId:s,playlistFollowHash:i}=this.props.sticker;h.AudioUtils.followPlaylist(e.target,t,s,i);const o=`${t}_${s}`;h.AudioUtils.getPlaylistAddRestoreInfo()[o]={state:"unfollowed"},this.props.playStory(),this.props.hideTooltip()},this.handleClickSticker=e=>{const{stickerPackId:t,tooltipText:s}=this.props.sticker,o=(0,i.jsx)("span",{onClick:this.onClickToStickerTooltip.bind(this,t),className:"StoriesTooltip__link",children:s});this.props.toggleTooltip(e,o),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"sticker"}})},this.onClickToStickerTooltip=(e,t)=>{window.Emoji.previewSticker(e,this,!1,t),this.onClickToTooltip("sticker")},this.setNext=e=>{const t=JSON.parse(this.props.sticker.audioData||"{}"),s=h.AudioUtils.audioTupleToAudioObject(t);this.playlist.setNext(e.currentTarget.parentNode,s,t),this.props.story.data.isMusicCover||this.playlist.pause(),this.props.hideTooltip(),this.props.playStory(),this.props.sendNavigationStatEvents("play_next",!0,{clickable_sticker:{id:this.props.sticker.id,type:"music"}})},this.setNextPlaylist=()=>{const{playlistOwnerId:e,playlistId:t,playlistAccessHash:s}=this.props.sticker;this.playlist.setNextPlaylist(e,t,s),this.props.story.data.isMusicCover||this.playlist.pause(),this.props.hideTooltip(),this.props.playStory(),this.props.sendNavigationStatEvents("play_next",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}})},this.onClickToTooltip=e=>{this.props.sendNavigationStatEvents("click_to_tooltip",!0,{clickable_sticker:{id:this.props.sticker.id,type:e}})},this.handleClickVideo=e=>{const{videoOwnerId:t,videoId:s,videoType:o,tooltipText:r}=this.props.sticker,n=`/${o}${t}_${s}`,a="video";if("clip"===o){const t=(0,i.jsx)("a",{href:n,onClick:()=>this.onClickToTooltip(a),target:"_blank",className:"StoriesTooltip__link",children:r});this.props.toggleTooltip(e,t),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:a}})}},this.stickerRef=(0,o.createRef)(),this.playlist=(0,c.getAudioPlayer)()}}},441113:(e,t,s)=>{s.d(t,{StickerTooltip:()=>a});var i=s(785893),o=s(667294),r=s(659397),n=s(973935);const a=({clientX:e=0,clientY:t=0,position:s="t",layerEl:a,children:l})=>{const d=(0,r.classNames)("StoriesTooltip",`StoriesTooltip--${s}`);return(0,i.jsx)(o.Fragment,{children:n.createPortal((0,i.jsx)("div",{className:d,style:{top:t,left:e},children:l}),a)})}},265912:(e,t,s)=>{s.d(t,{StoryBottom:()=>F});var i,o=s(785893),r=s(30655),n=s(797235),a=s(667294),l=s(190706),d=s(406946),c=s(36703),h=s(109281),_=s(863818),u=s(449147),p=s(700897),m=s(70689),g=s(93367),y=s(471828),v=s(585703),w=s(636322),S=s(65718),f=s(659397),k=s(74106),b=s(898366),E=s(611695),C=s(729400),L=s(738219),T=s(668088),x=s(763242),I=s(427323),M=s(52373),B=s(46885),A=s(429697),N=s(423842),P=s(360236),R=s(681482),D=s(879692);!function(e){e[e.STEP_LEFT=0]="STEP_LEFT",e[e.STEP_RIGHT=1]="STEP_RIGHT",e[e.STEP_PAUSE=2]="STEP_PAUSE"}(i||(i={}));class F extends a.Component{componentDidMount(){this.emojiInit(),this.isMount=!0,requestAnimationFrame((()=>{this.startLinkArrowAnimation()}))}componentWillUnmount(){this.isMount=!1,this.emojiId&&(window.Emoji.destroy(this.emojiId),delete this.emojiId)}componentDidUpdate(e,t){const{isMessageFormExpanded:s,isMessageFormFocused:i}=this.state;this.emojiInit(),!t.isMessageFormExpanded&&s?(window.Emoji.focus(this.refs.messageInput),this.pauseLinkArrowAnimation()):t.isMessageFormExpanded&&!s&&this.startLinkArrowAnimation(),t.isMessageFormFocused!==i&&this.setState({isMessageFormFocusAnimating:!0})}render(){const{story:e}=this.props,t=this.props.story.getCurStoryData(),{isMessageFormExpanded:s}=this.state;if(!e.story||!t)return"";const{isFeedbackTooltipShow:i,toggleFeedbackTooltip:r,onFetchFeedbackData:a,onFetchViewers:d,onQuestionRemove:c,feedback:h,showMoreReplies:_,onPrivacyHintHide:u}=e,{needShowEmptyStats:p,small_preview:m,canLike:g,canAddToNarrative:y,reaction_set_id:v}=t,w=e.getRawId(),S=e.showMessage.bind(e),k=e.layer.sendNavigationStatEvents.bind(e.layer),b=e.getSticker(n.StickerTypes.poll);let E;return null!=v&&(E=(0,D.isApiForVKCOMViewerEnabled)()?e.data.reaction_set?.find((e=>e.id===v)):(0,N.getReactionSet)(v)),(0,o.jsxs)("div",{className:"StoryBottom",children:[(0,o.jsx)(A.default,{in:!s,classNames:{enter:"StoryBottom__panels--enter",enterActive:"StoryBottom__panels--enterActive",exitActive:"StoryBottom__panels--exitActive",exit:"StoryBottom__panels--exit"},addEndListener:(e,t)=>{e.addEventListener("transitionend",(e=>{e.target===e.currentTarget&&t()}),!1)},unmountOnExit:!0,children:(0,o.jsxs)("div",{className:"StoryBottom__panels",children:[g&&(0,o.jsx)("div",{className:"StoryBottom__floor StoryBottom__floor--2",children:this.renderLike()}),(0,o.jsxs)("div",{className:"StoryBottom__floor StoryBottom__floor--1",children:[(0,o.jsx)(l.ViewsButton,{className:"StoryViewerBottomControl StoryViewerBottomControl--feedback",story:e}),this.renderLink(),this.renderMessageButton(),y&&this.renderAddToNarrativeBtn(),this.renderShare()]})]})}),this.renderMessageForm(),(0,o.jsx)(A.default,{in:i,timeout:200,classNames:{enter:"FeedbackTooltipTransitionWrapper--enter",enterActive:"FeedbackTooltipTransitionWrapper--enterActive",exit:"FeedbackTooltipTransitionWrapper--exit",exitActive:"FeedbackTooltipTransitionWrapper--exitActive"},unmountOnExit:!0,children:(0,o.jsx)(P.default,{className:"StoryBottom__feedback",feedback:h,pollId:b?.pollId,reactionSet:E,storyRawId:w,storyImageUrl:m,toggleFeedbackTooltip:r,onFetchFeedbackData:a,onFetchViewers:d,showMessage:S,sendNavigationStatEvents:k,onQuestionRemove:c,showMoreReplies:_,onPrivacyHintHide:u,needShowEmptyStats:p})}),!this.isActiveLive()&&(0,o.jsx)("div",{className:(0,f.classNames)("StoryBottom__overlay",{"StoryBottom__overlay--shown":this.needShowOverlay()}),onTransitionEnd:this.onOverlayTransitionEnd})]})}needRenderMessageFormAsFocused(){return this.state.isMessageFormFocused||this.state.isMessageFormFocusAnimating}needShowOverlay(){return this.state.isMessageFormFocused}renderLink(){const e=this.props.story,t=this.props.story.getCurStoryData();if(!t){return void(e.isActiveMetaStory()||(0,S.logError)(new Error("Fail: _renderLink"),{environment:"stories"}))}const{linkArrowAnimationStep:s}=this.state,{link:i}=t;if(!(0,w.isObject)(i))return;let r=(0,f.decodeHTMLEntities)(i.url),n="stories_link";if(i.object_type&&(n+=` story_link_object_${i.object_type}`),this.state.linkObjectAudioPlaying&&(n+=" story_link_object_audio_playing"),t.isProfileQuestion){const e=new URL(r);e.searchParams.set("ref","story"),r=e.toString()}return(0,o.jsx)("div",{className:"StoryLinkButton stories_link_wrap StoryViewerBottomControl StoryViewerButton StoryViewerButton--wide StoryViewerButton--dark StoryViewerButton--link",onMouseEnter:this.pauseLinkArrowAnimation,onMouseLeave:this.onLinkArrowMouseLeave,children:(0,o.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",className:n,href:r,title:i.text,onClick:e=>{this.linkDidPress(e,i)},onTransitionEnd:this.onLinkArrowTransitionEnd,"data-testid":"story_link_button",children:[(0,o.jsx)("span",{className:"stories_link__inner",dangerouslySetInnerHTML:{__html:i.text}}),!this.state.linkObjectAudioPlaying&&(0,o.jsx)(k.Icon16ChevronOutline,{className:(0,f.classNames)("StoryLinkButton__icon",{"StoryLinkButton__icon--right":1===s})})]})})}renderShare(){const{story:e}=this.props,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,S.logError)(new Error("Fail: _renderShare"),{environment:"stories"}),""}const{can_share:s}=t;return s?(0,o.jsx)("div",{className:"StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl",onMouseEnter:e=>(0,v.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:y.getLang("stories_share")}),onClick:this._shareButtonDidPress.bind(this),"data-testid":"story_share_button",children:(0,o.jsx)(b.Icon24ShareOutline,{className:"StoryViewerButton__icon"})}):""}renderAddToNarrativeBtn(){const e=this.props.story,t=this.props.story.getCurStoryData(),s=this.props.story.getCurrentNarrative();if(!t){return e.isActiveMetaStory()||(0,S.logError)(new Error("Fail: renderAddToNarrativeBtn"),{environment:"stories"}),null}return s?null:(0,o.jsxs)("div",{className:"StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl",onMouseEnter:e=>(0,v.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:y.getLang("stories_add_to_narrative")}),onClick:this.addToNarrativePress,ref:this.addToNarrativeRef,"data-testid":"story_add_to_narrative",children:[t.isPartOfNarrative&&(0,o.jsx)(E.Icon24NarrativeActiveOutline,{className:"StoryViewerButton__icon"}),!t.isPartOfNarrative&&(0,o.jsx)(C.Icon24NarrativeOutline,{className:"StoryViewerButton__icon"})]})}renderLike(){const e=this.props.story,t=this.props.story.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,S.logError)(new Error("Fail: _renderLike"),{environment:"stories"}),""}const{isLiked:s}=t,{isMessageFormExpanded:i,needAnimateLikeButton:r,isStickerPanelShow:n}=this.state,a=!(n||this._canMessage()&&i);return(0,o.jsx)(A.default,{in:a,timeout:200,classNames:{enter:"StoryButtonLike--enter",enterActive:"StoryButtonLike--enterActive",exitActive:"StoryButtonLike--exitActive",exit:"StoryButtonLike--exit"},unmountOnExit:!0,children:(0,o.jsx)(B.default,{className:"StoryViewerTooltip",text:y.getLang("stories_like"),position:"t",delay:180,marginTop:-8,children:(0,o.jsxs)("div",{className:(0,f.classNames)("StoryButtonLike StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl",{"StoryButtonLike--liked":s,"StoryButtonLike--animation":r,"StoryViewerButton--big":!0}),onClick:this._likeButtonDidPress.bind(this),onAnimationEnd:this.onLikeAnimationEnd,"data-testid":"story_like_button",children:[s&&(0,o.jsx)(L.Icon28Like,{className:"StoryButtonLike__icon"}),!s&&(0,o.jsx)(T.Icon28LikeOutline,{className:"StoryButtonLike__icon"})]})})})}_canMessage(){const e=this.props.story,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,S.logError)(new Error("Fail: _canMessage"),{environment:"stories"}),!1}const{can_comment:s}=t;return s&&!e.isLiveEnded()}hasLink(){const e=this.props.story,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,S.logError)(new Error("Fail: hasLink"),{environment:"stories"}),!1}return(0,w.isObject)(t.link)}renderMessageButton(){if(this._canMessage())return this.hasLink()?(0,o.jsx)(B.default,{className:"StoryViewerTooltip",text:y.getLang("stories_write_message"),position:"t",marginTop:-8,children:(0,o.jsx)("button",{className:"StoryViewerBottomControl StoryViewerButton StoryViewerButton--dark StoryViewerButton--round",onClick:this.onMessageButtonClick,"data-testid":"story_message_link_button",children:(0,o.jsx)("div",{className:"StoryViewerButton__icon",children:(0,o.jsx)(x.Icon24MessageOutline,{})})})}):(0,o.jsx)("button",{className:"StoryViewerBottomControl StoryViewerButton StoryViewerButton--message StoryViewerButton--wide StoryViewerButton--dark",onClick:this.onMessageButtonClick,"data-testid":"story_message_button",children:(0,o.jsx)("span",{className:"StoryViewerButton__text",children:y.getLang("stories_answer_placeholder")})})}renderMessageForm(){const{isMessageFormFocused:e,isMessageFormExpanded:t,panelStickers:s}=this.state,i=this.needRenderMessageFormAsFocused();if(!this._canMessage())return;let r=(0,o.jsx)("div",{className:(0,f.classNames)("StorySendForm stories_send_form _emoji_field_wrap emoji_rpointer",{"StorySendForm--focus":e,"StorySendForm--expanded":t}),ref:"sendForm","data-testid":"story_send_form",children:(0,o.jsxs)("div",{className:"StorySendForm__wrapper",children:[(0,o.jsx)("div",{className:"StorySendForm__background"}),(0,o.jsxs)("div",{className:"StorySendForm__in",children:[(0,o.jsx)("div",{className:"stories_send_form_text_wrap",children:(0,o.jsx)("div",{contentEditable:!0,ref:"messageInput",className:"stories_send_form_text",placeholder:y.getLang("stories_answer_placeholder"),onFocus:this._sendFormDidFocus.bind(this),onBlur:this._sendFormDidBlur.bind(this),onInput:this._checkReactionsPanel.bind(this)})}),(0,o.jsx)("div",{className:"stories_send_form_helper",ref:"smileWrapper",onMouseDown:this.onSendFormButtonsMouseDown,children:(0,o.jsxs)("div",{className:(0,f.classNames)("stories_send_form_buttons _emoji_wrap",{shown:this.state.isMessageFormFocused||this.state.messageFormHasText}),children:[(0,o.jsx)("div",{"data-testid":"story-bottom-emoji-smile",ref:"smileButton",className:"stories_send_form_button smile _emoji_btn emoji_smile",onMouseEnter:e=>{window.Emoji.clearSizeCached(this.refs.smileButton),window.Emoji.show(this.refs.smileButton,e.nativeEvent)},onMouseLeave:e=>window.Emoji.hide(this.refs.smileButton,e.nativeEvent),onMouseDown:e=>(0,g.cancelEvent)(e.nativeEvent),children:(0,o.jsx)(I.Icon24SmileOutline,{})}),(0,o.jsx)("div",{className:(0,f.classNames)("stories_send_form_button send",{active:this.state.messageFormHasText}),onClick:this._onSendMessageButtonCLick.bind(this),"data-testid":"story_message_send",children:(0,o.jsx)(M.Icon24Send,{})})]})})]})]})});const n=y.getLang("stories_fast_answer"),a=(0,o.jsx)(A.default,{in:this.state.isStickerPanelShow&&s.length>0,timeout:200,classNames:{enter:"StoryBottom__stickerPanel--enter",enterActive:"StoryBottom__stickerPanel--enterActive",exitActive:"StoryBottom__stickerPanel--exitActive",exit:"StoryBottom__stickerPanel--exit"},unmountOnExit:!0,children:(0,o.jsx)(d.ReactionsPanel,{className:"StoryBottom__stickerPanel",stickers:s,title:n,onStickerClick:this.onPanelStickerClick})});return(0,o.jsx)(A.default,{in:t,classNames:{enter:"StoryBottom__messageForm--enter",enterActive:"StoryBottom__messageForm--enterActive",exitActive:"StoryBottom__messageForm--exitActive",exit:"StoryBottom__messageForm--exit"},onExited:this.onSendFormExited,addEndListener:(e,t)=>{e.addEventListener("transitionend",(e=>{e.target===e.currentTarget&&t()}),!1)},unmountOnExit:!0,children:(0,o.jsxs)("div",{className:(0,f.classNames)("StoryBottom__messageForm",{"StoryBottom__messageForm--focused":i}),children:[a,r]})})}isActiveLive(){return this.props.story.isActiveLive()}isStickerPanelAvailable(){return!this.isActiveLive()}onChangeStickerPanelVisibility(e=!1){this.isStickerPanelAvailable()&&this.setState({isStickerPanelShow:e})}_checkLoadedStickers(){return this.getPanelStickers().length>=c.EMOJI_REACTIONS_ARR.length}_sendFormDidFocus(){const{story:e}=this.props;this.setState({isMessageFormFocused:!0}),this.isStickerPanelAvailable()&&this._checkReactionsPanel(),e.onSendFormFocus(),e.layer.sendNavigationStatEvents("comment_tap")}_sendFormDidBlur(){this.props.story.onSendFormBlur(),this.setState({isMessageFormFocused:!1}),this.isStickerPanelAvailable()&&this._hideReactionPanel(),!this.getMessageText()&&this._canMessage()&&this.toggleMessageForm(!1),this._emojiDidKeyAction()}_emojiDidKeyAction(){const e=this.getMessageText();this.setState({messageFormHasText:e.length>0}),this.refs.messageInput?.check()}getMessageText(){return(0,w.trim)(window.Emoji.editableVal(this.refs.messageInput))}_hideReactionPanel(){this.onChangeStickerPanelVisibility(!1)}_showReactionPanel(){this.onChangeStickerPanelVisibility(!0)}_checkReactionsPanel(){if(!this.isStickerPanelAvailable())return;this.props.story.getSendText().length?this._hideReactionPanel():this._showReactionPanel()}_shareButtonDidPress(){this.props.story.shareBox()}_likeButtonDidPress(){this.setState({needAnimateLikeButton:!0}),this.props.story.toggleLikeStory()}updatePanelStickers(){this.isMount&&(this.setState({panelStickers:this.getPanelStickers()}),this.preloadStickerImages())}preloadStickers(e){const t=(0,w.isRetina)()?"256b":"128b";window.Emoji.emojiPreloadMore({sizes:{[t]:!0}},e)}preloadStickerImages(){const{panelStickers:e}=this.state;e.forEach((e=>{(new Image).src=e.imageUrl}))}getPanelStickers(){const e=[];if(window.stickersKeywords&&window.Emoji.stickersById){const t=window.Emoji.stickersById,s=(0,w.isRetina)()?"256b":"128b",i={};c.EMOJI_REACTIONS_ARR.forEach((o=>{const r=window.stickersKeywords[(0,h.emojiRemoveSkinToneModifiers)(window.Emoji.codeToChr(o.code))],n=r&&window.Emoji.sortStickersHints(r);let a={};n&&n.every((e=>!(e>0&&t[e]&&t[e].sticker&&!i[e])||(a=t[e].sticker,!1))),a[6]&&a[6][s]&&(e.push({id:a[0],packId:0,uniqId:(0,w.irand)(0,1e5),imageUrl:a[6][s],animationUrl:a[3]}),i[a[0]]=!0)}))}return e}_hideStickerHints(){const e=(0,m.geByClass1)("_sticker_hints",(0,m.domPN)(this.refs.messageInput));e&&"number"==typeof this.emojiId&&window.Emoji.stickersHintsHide(e,window.Emoji.opts[this.emojiId],100)}_onSendMessageButtonCLick(){this._sendMessage()}_sendMessage(e=[],t={},s={}){const i=e.length;this._hideStickerHints(),this.props.story.onAnswerSend((()=>{this._emojiDidKeyAction(),i&&this.updatePanelStickers(),this._canMessage()&&this.state.isMessageFormExpanded&&this.toggleMessageForm(!1)}),e,t,s)}constructor(e){super(e),this.isMount=!1,this.onOverlayTransitionEnd=e=>{e.target===e.currentTarget&&this.state.isMessageFormFocusAnimating&&this.setState({isMessageFormFocusAnimating:!1})},this.onMessageButtonClick=()=>{this.toggleMessageForm(!0)},this.onSendFormButtonsMouseDown=e=>{this._canMessage()&&!this.getMessageText()&&e.preventDefault()},this.onPanelStickerClick=(e,t)=>{this._sendMessage([["sticker",e,""]],{sticker_referrer:"story_reaction"},{reactionName:c.EMOJI_REACTIONS_ARR[t].name})},this.emojiInit=()=>{if(!this.emojiId&&this.refs.messageInput){const e=this.isStickerPanelAvailable();if(this.emojiId=window.Emoji.init(this.refs.messageInput,{ttDiff:29,ref:"stories",ttWrap:this.refs.smileWrapper,checkEditable:()=>{this.props.story.isActiveLive()&&_.VideoChat.checkTextLen(this.refs.messageInput)},noStickers:!e,noStickersStore:!e,onSend:()=>this._sendMessage(),onStickerSend:(e,t,s)=>{this._sendMessage([["sticker",e,s]],{sticker_referrer:t}),this._canMessage()&&this.state.isMessageFormExpanded&&this.toggleMessageForm(!1)},forceUp:!0,controlsCont:this.refs.sendForm,onKeyAction:()=>this._emojiDidKeyAction(),onEmojiAdded:()=>this._emojiDidKeyAction(),onStoreHide:()=>{this.updatePanelStickers(),this.props.story.autoResumeStory()}}),(0,g.addEvent)(this.refs.smileButton,"click",g.cancelEvent),(0,u.placeholderInit)(this.refs.messageInput,{editable:!0}),this._checkLoadedStickers())this.preloadStickerImages();else{const e=(0,w.isRetina)()?"256b":"128b";window.Emoji.emojiLoadMore(this.emojiId,{sizes:{[e]:!0}},(()=>{this.updatePanelStickers()}))}}else this.emojiId&&!this.refs.messageInput&&this.destroyEmoji();this._canMessage()&&!this._checkLoadedStickers()&&this.preloadStickers((()=>{this.updatePanelStickers()}))},this.onSendFormExited=()=>{this.destroyEmoji()},this.destroyEmoji=()=>{(0,g.removeEvent)(this.refs.smileButton,"click",g.cancelEvent),this.emojiId&&(window.Emoji.destroy(this.emojiId),delete this.emojiId)},this.toggleMessageForm=(e=!0)=>{this.state.isMessageFormExpanded!==e&&((0,R.isNewStickerPicker)()&&!e&&window.StickerPickerViewer?.destroy(),this.setState({isMessageFormExpanded:e}))},this.addToNarrativePress=()=>{this.props.story.onAddToNarrativeBtnClick()},this.onLikeAnimationEnd=()=>{this.setState({needAnimateLikeButton:!1})},this.linkDidPress=(e,t)=>{if(!t)return;const{story:s}=this.props,i=t.object_type,o=t.object,n=t.url.match(/\/narrative(-?\d+)_(\d+)/);if(n){e.preventDefault();const[,t,i]=n;t&&i&&(s.pauseStory(),(0,p.showNarrative)(t,i,0,"",{fromEl:s.wrapEl,source:"narrative_story"}))}else s.layer.sendNavigationStatEvents("link_click"),s.sendStatEvent("url_view");if("audio"===i)this.state.linkObjectAudioPlaying?((0,r.getAudioPlayer)().pause(),this.setState({story:{...this.state.story,audioPlaying:!1}}),window.cur.storyLayer.resumeLayer()):((0,r.getAudioPlayer)().playAudio(o),this.setState({story:{...this.state.story,audioPlaying:!0}}),window.cur.storyLayer.pauseLayer()),this.setState({linkObjectAudioPlaying:!this.state.linkObjectAudioPlaying}),e.preventDefault()},this.startLinkArrowAnimation=()=>{this.isMount&&this.setState({linkArrowAnimationStep:1})},this.pauseLinkArrowAnimation=()=>{this.setState({linkArrowAnimationStep:2})},this.onLinkArrowTransitionEnd=()=>{const{linkArrowAnimationStep:e}=this.state;1!==e?0!==e||this.setState({linkArrowAnimationStep:1}):this.setState({linkArrowAnimationStep:0})},this.onLinkArrowMouseLeave=()=>{const{isMessageFormExpanded:e}=this.state;e||this.startLinkArrowAnimation()},this.emojiId=!1,this.state={story:e.story,messageFormHasText:!1,isMessageFormFocused:!1,linkObjectAudioPlaying:!1,isStickerPanelShow:!1,panelStickers:this.getPanelStickers(),isMessageFormExpanded:!1,needAnimateLikeButton:!1,linkArrowAnimationStep:0},this.addToNarrativeRef=(0,a.createRef)()}}},799767:(e,t,s)=>{s.d(t,{StoryStickers:()=>k});var i=s(785893),o=s(667294),r=s(213263),n=s(441113),a=s(762759),l=s(441430),d=s(823649),c=s(36703),h=s(70689),_=s(471828),u=s(636322),p=s(659397),m=s(585703),g=s(93367),y=s(184132),v=s(846701),w=s(879692),S=s(86894),f=s(423301);class k extends o.Component{constructor(e){super(e),this.componentDidMount=()=>{window.addEventListener("resize",this.handleResize)},this.componentWillUnmount=()=>{window.removeEventListener("resize",this.handleResize)},this.componentDidUpdate=()=>{this.askTextarea.current&&this.askTextarea.current.focus()},this.onDisableAreaMouseDown=e=>{this.props.onMouseDownHandle(e.target)},this.onDisableAreaMouseUp=(e,t=(()=>{}))=>{this.props.onMouseUpHandle(e.target,t)},this.render=()=>{const{story:e,storyData:t,author:s,layerEl:o,showMessage:l,playStory:d,pauseStory:h,list:u,sendNavigationStatEvents:m,markAppNotificationsSeen:g}=this.props,{clickable_stickers:y}=t,{stickers:v,original_width:w,original_height:S}=y,{widthViewBox:k,heightViewBox:b,showTooltip:E,position:C,tooltipContent:L,showQuestionModal:T,clientX:x,clientY:I}=this.state,M=v.filter((e=>c.dynamicStickerIds.includes(e.type)))||[],B=v?.filter((e=>c.staticStickerIds.includes(e.type)))||[];return(0,i.jsxs)("div",{className:"StoryStickers",children:[(0,i.jsx)("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--left",onMouseDown:this.onDisableAreaMouseDown,onMouseUp:this.onDisableAreaMouseUp,onContextMenu:this.onDisableAreaMouseUp}),(0,i.jsx)("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--right",onMouseDown:this.onDisableAreaMouseDown,onMouseUp:this.onDisableAreaMouseUp,onContextMenu:this.onDisableAreaMouseUp}),!!B.length&&B.map(((t,s)=>(0,i.jsx)(r.StickerItem,{story:e,sticker:t,originalWidth:w,originalHeight:S,widthViewBox:k,heightViewBox:b,toggleTooltip:this.toggleTooltip,sendNavigationStatEvents:m,hideTooltip:this.hideTooltip,showQuestionModal:this.showQuestionModal,markAppNotificationsSeen:g,showMessage:l,playStory:d,pauseStory:h,list:u,onMouseDownHandle:this.onDisableAreaMouseDown,onMouseUpHandle:this.onDisableAreaMouseUp},s))),!!M.length&&M.map(((e,t)=>(0,i.jsx)(f.DynamicStickerItem,{sticker:e,originalWidth:w,originalHeight:S,widthViewBox:k,heightViewBox:b,onMouseDownHandle:this.onDisableAreaMouseDown,onMouseUpHandle:this.onDisableAreaMouseUp,sendNavigationStatEvents:m},t))),E&&(0,i.jsx)(n.StickerTooltip,{clientX:x,clientY:I,layerEl:o,position:C,children:L}),T&&(0,i.jsx)(a.Modal,{title:_.getLang("stories_question_ask_box_title").replace("{name}",(0,p.decodeHTMLEntities)(s.name_get)),actionButtons:this.getQuestionModalActions(),className:"StoryQuestionAskForm",onClose:this.closeQuestionModal,appearance:"blue",children:(0,i.jsx)("div",{className:"StoryQuestionAskForm__inner",children:(0,i.jsx)("textarea",{ref:this.askTextarea,className:"StoryQuestionAskForm__textarea",maxLength:80,placeholder:_.getLang("stories_question_ask_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown})})})]})},this.handleResize=()=>{const[e,t]=(0,h.getSize)(this.props.el);this.setState({widthViewBox:e,heightViewBox:t,showTooltip:!1})},this.toggleTooltip=(e,t,s="t")=>{e.preventDefault(),e.stopPropagation();const{clientX:i,clientY:o}=e,{pauseStory:r,playStory:n,hideFeedbackTooltip:a,sendNavigationStatEvents:l}=this.props;a(),this.setState({showTooltip:!this.state.showTooltip,tooltipContent:t,clientX:i,clientY:o,position:s}),setTimeout((()=>{this.state.showTooltip?(l("click_on_clickable_sticker"),r()):n()}),0)},this.hideTooltip=()=>{this.setState({showTooltip:!1})},this.isShownTooltip=()=>this.state.showTooltip||this.state.showQuestionModal,this.showQuestionModal=()=>{const{storyData:e,showMessage:t,pauseStory:s,onModalShownChange:i}=this.props,{can_ask:o}=e;if(!o)return t(_.getLang("stories_question_forbidden"));this.setState({showQuestionModal:!0}),this.hideTooltip(),i(!0),s()},this.closeQuestionModal=()=>{const{playStory:e,onModalShownChange:t}=this.props;this.setState({showQuestionModal:!1}),t(!1),e()},this.handleChange=e=>{this.setState({questionText:e.target.value})},this.handleKeyDown=e=>{const{questionText:t}=this.state;(0,u.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==g.KEY.RETURN&&this.sendQuestion()},this.resetAskText=()=>{this.setState({questionText:""})},this.getQuestionModalActions=()=>{const{storyData:e}=this.props,{can_ask_anonymous:t}=e,{isQuestionButtonLoading:s,questionText:o}=this.state,r=[{value:c.QUESTION_SELECT_MODE.AUTHOR_ONLY,label:_.getLang("stories_question_select_author_only")},{value:c.QUESTION_SELECT_MODE.PUBLIC,label:_.getLang("stories_question_select_public")}];return t&&r.splice(1,0,{value:c.QUESTION_SELECT_MODE.ANONYMOUS,label:_.getLang("stories_question_select_anonymous")}),(0,i.jsxs)("div",{className:"StoryQuestionAskForm__footer",children:[(0,i.jsx)("div",{className:"StoryQuestionAskForm__cell StoryQuestionAskForm__cell--select",children:(0,i.jsx)(d.default,{value:this.state.selected,options:r,onChange:this.onSelectChange,onShow:this.onSelectShow,onHide:this.onSelectHide})}),(0,i.jsx)("div",{className:"StoryQuestionAskForm__cell",children:(0,i.jsxs)(S.ButtonGroup,{stretched:!0,children:[(0,i.jsx)(l.Button,{size:"m",mode:"tertiary",onClick:this.closeQuestionModal,children:_.getLang("global_cancel")}),(0,i.jsx)(l.Button,{size:"m",mode:"primary",loading:s,disabled:!(0,u.trim)(o),onClick:this.sendQuestion,children:_.getLang("stories_question_reply_send")})]})})]})},this.onSelectChange=e=>{this.setState({selected:Number(e.selected.value)})},this.onSelectShow=()=>{const{storyData:e,author:t}=this.props,{can_ask_anonymous:s}=e,i=document.querySelector(".StoryQuestionAskForm__cell--select");if(!i)return;const o=s?_.getLang("stories_question_about_user_tooltip"):_.getLang("stories_question_about_user_tooltip_without_anon"),r=s?_.getLang("stories_question_about_group_tooltip"):_.getLang("stories_question_about_group_tooltip_without_anon");let n="";n=y.Ranges.isUserId(t.id)?o.replace(/{name}/g,(0,p.decodeHTMLEntities)(t.firstName)):r,(0,m.showTooltip)(i,{text:n,width:350,slideX:15,className:"",nohide:!0,asrtl:!0,shift:[350,-15],dir:"left",showdt:1e3})},this.onSelectHide=()=>{const e=document.querySelector(".StoryQuestionAskForm__cell--select");e&&e.tt&&e.tt.destroy()},this.sendQuestion=()=>{const{questionText:e}=this.state,{showMessage:t,storyData:s,author:i,sendNavigationStatEvents:o}=this.props,{raw_id:r,askQuestionHash:n}=s,[a,l]=r.split("_");let d=!1,h=!1;this.state.selected===c.QUESTION_SELECT_MODE.PUBLIC?d=!0:this.state.selected===c.QUESTION_SELECT_MODE.ANONYMOUS&&(h=!0),(0,w.isActsToApiFirstForVKCOMViewerEnabled)()?(this.setState({isQuestionButtonLoading:!0}),v.storiesService.askQuestionFx({owner_id:Number(a),story_id:Number(l),question:e,is_anonymous:h?1:0,with_mention:d?1:0}).then((()=>{switch(this.closeQuestionModal(),this.resetAskText(),t(_.getLang("stories_question_sent").replace("{name}",i.first_name_ins)),this.state.selected){case c.QUESTION_SELECT_MODE.PUBLIC:o("question_reply_publish");break;case c.QUESTION_SELECT_MODE.AUTHOR_ONLY:o("question_reply");break;case c.QUESTION_SELECT_MODE.ANONYMOUS:o("question_reply_anonymous")}})).catch((e=>{this.closeQuestionModal(),this.resetAskText(),t(e)})).finally((()=>{this.setState({isQuestionButtonLoading:!1})}))):window.ajax.post("al_stories.php",{act:"ask_question",story_owner_id:a,story_id:l,question_text:e,is_anonymous:+h,with_mention:+d,hash:n},{onDone:()=>{switch(this.closeQuestionModal(),this.resetAskText(),t(_.getLang("stories_question_sent").replace("{name}",i.first_name_ins)),this.state.selected){case c.QUESTION_SELECT_MODE.PUBLIC:o("question_reply_publish");break;case c.QUESTION_SELECT_MODE.AUTHOR_ONLY:o("question_reply");break;case c.QUESTION_SELECT_MODE.ANONYMOUS:o("question_reply_anonymous")}},onFail:e=>(this.closeQuestionModal(),this.resetAskText(),t(e),!0),showProgress:()=>this.setState({isQuestionButtonLoading:!0}),hideProgress:()=>this.setState({isQuestionButtonLoading:!1})})};const[t,s]=(0,h.getSize)(this.props.el);this.askTextarea=(0,o.createRef)(),this.state={widthViewBox:t,heightViewBox:s,clientX:0,clientY:0,showTooltip:!1,tooltipContent:"",position:"t",showQuestionModal:!1,isQuestionButtonLoading:!1,selected:c.QUESTION_SELECT_MODE.AUTHOR_ONLY,questionText:""}}}},596533:(e,t,s)=>{s.d(t,{StickerTemplateSelectorStory:()=>d,TemplateSticker:()=>c});var i=s(785893),o=s(385023),r=s(839386),n=s(454724),a=s(471828),l=s(659397);const d="StickerTemplateSelectorStory",c=({sticker:e,originalWidth:t,originalHeight:s,widthViewBox:c,heightViewBox:h,onMouseUpHandle:_,onMouseDownHandle:u})=>{const{top:p}=(0,o.getStickerStyle)({sticker:e,originalWidth:t,originalHeight:s,widthViewBox:c,heightViewBox:h}),m=e.situationalRepliedAvatars?.map((e=>e.photo_100))||void 0;return(0,i.jsx)("div",{className:(0,l.classNames)(r.default.root,d),style:{top:p},onMouseDown:u,onMouseUp:_,onContextMenu:_,children:(0,i.jsx)(n.UsersStackWithCaption,{count:e.situationalRepliedUsers?.count,photos:m,caption:a.getLang("stories_sticker_template"),stopButtonPropagation:!1})})}},190706:(e,t,s)=>{s.d(t,{ViewsButton:()=>a});var i=s(785893),o=s(648184),r=s(449909),n=s(659397);const a=({story:e,className:t=""})=>{const s=e.getReplies(),a=e.getViews()||"",l=e.getCurStoryData();if(!l)return null;const{can_manage:d,isNewQuestions:c,needShowEmptyStats:h,replies_new_counter:_}=l,u=Boolean(d&&(a||h)),p=Boolean(!d&&s),m=h||c||Boolean(d&&_),g=e.isActiveLive(),{isFeedbackTooltipShow:y,toggleFeedbackTooltip:v}=e;if(g||!a&&!s&&!h)return null;const w=e.layer.sendNavigationStatEvents.bind(e.layer);let S="StoryViewerButton StoryViewerButton--feedback StoryViewerButton--dark";return y&&(S+=" StoryViewerButton--hover"),(0,i.jsx)("div",{className:(0,n.classNames)("StoryViewerButtonWrapper",t),children:(0,i.jsxs)("div",{className:S,onClick:e=>{v(),h&&w("open_empty_feedback"),e.stopPropagation()},"data-testid":"story_viewers_button",children:[p&&(0,i.jsxs)("div",{className:"StoryButtonFeedbackLabel StoryButtonFeedbackLabel--replies",children:[(0,i.jsx)(o.Icon24StoryOutline,{}),(0,i.jsx)("span",{className:"StoryButtonFeedbackLabel__text",children:s})]}),u&&(0,i.jsxs)("div",{className:"StoryButtonFeedbackLabel StoryButtonFeedbackLabel--views",children:[(0,i.jsx)(r.Icon24ViewOutline,{}),Boolean(a)&&(0,i.jsx)("span",{className:"StoryButtonFeedbackLabel__text",children:a})]}),m&&(0,i.jsx)("span",{className:"StoryButtonBadge StoryButtonBadge--blue"})]})})}},385023:(e,t,s)=>{s.d(t,{getStickerStyle:()=>i});const i=({sticker:e,originalWidth:t,originalHeight:s,widthViewBox:i,heightViewBox:o})=>{const{top:r,left:n,width:a,height:l,rotate:d}=e;let c=i,h=o;return o/i>1.77?c=t*o/s:h=s*i/t,{top:r*h-(h-o)/2,left:n*c-(c-i)/2,width:a*c,height:l*h,transform:`rotate(${d}deg)`}}},100809:(e,t,s)=>{var i;function o(e){setTimeout((()=>{window.dispatchEvent(new CustomEvent("stories_seen",{detail:e}))}))}function r(e){setTimeout((()=>{window.dispatchEvent(new CustomEvent("list_modified",{detail:e}))}))}function n(e,t=!1){const s=()=>{window.dispatchEvent(new CustomEvent("close_layer",{detail:e}))};t?setTimeout(s):s()}s.d(t,{StoryCustomEventName:()=>i,dispatchCloseLayerEvent:()=>n,dispatchListModifiedEvent:()=>r,dispatchStoriesSeenEvent:()=>o}),function(e){e.STORIES_SEEN="stories_seen",e.CLOSE_LAYER="close_layer",e.LIST_MODIFIED="list_modified"}(i||(i={}))},484519:(e,t,s)=>{s.d(t,{DiscoverMetaStory:()=>m});var i=s(785893),o=s(973935),r=s(124252),n=s(265794),a=s(471828),l=s(797235),d=s(271325),c=s(816271),h=s(959302),_=s(65718),u=s(879692),p=s(331313);class m extends d.MetaStory{update(){if(this.isDestroyed)return;Boolean(this.block.grouped?.length)||(0,h.preloadDiscoverList)().then((()=>{this.update()})).catch((e=>{console.error(e),(0,_.logError)(new Error("Error with getDiscoverList in DiscoverMetaStory"+(e?`: ${e}`:"")))})),o.render((0,i.jsx)(r.MetaStory,{metaStoryInfo:(0,i.jsx)(n.MetaStoryInfo,{icon:(0,i.jsx)("div",{className:"MetaStoryInfo__discoverIcon",children:(0,i.jsx)(c.Icon56CompassOutline,{})}),header:a.getLang("stories_interesting_stories"),subheader:a.getLang("stories_interesting_stories_description")}),list:this.block.grouped,listName:l.StoryListName.discover,source:l.StorySource.DISCOVER,isPaused:this.isPaused.bind(this),onLongTap:this.options.onLongTap,onScroll:this.onScroll,hasMore:this.hasMore,loadMore:this.loadMore,pause:this.options.pause,play:this.options.play,playNextStory:this.options.playNextStory,playPrevStory:this.options.playPrevStory,onTopScrolled:this.options.toggleMetaStoryTitle}),this.wrapper)}constructor(...e){super(...e),this.viewEventType="discover_feed_view",this.hasMore=()=>Boolean(this.block.next_from),this.loadMore=()=>this.hasMore()?(0,u.isApiForVKCOMViewerEnabled)()?(0,p.loadDiscover)(this.block.track_code,this.block.next_from).then((()=>{this.update()})):(0,h.fetchDiscover)(this.block.next_from,this.block.track_code,!1).then((([e,t])=>{this.block.grouped=[...this.block.grouped||[],...e],this.block.next_from=t,this.update()})):Promise.resolve()}}},954398:(e,t,s)=>{s.d(t,{StoryLayer:()=>R});var i=s(797235),o=s(251087),r=s(411374),n=s(242642),a=s(116147),l=s(451432),d=s(959302),c=s(584391),h=s(977053),_=s(464522),u=s(635528),p=s(36703),m=s(372292),g=s(846701),y=s(802130),v=s(541762),w=s(30655),S=s(636322),f=s(471828),k=s(93367),b=s(255693),E=s(379440),C=s(70689),L=s(65718),T=s(402986),x=s(944313),I=s(207563),M=s(271325),B=s(610691),A=s(396371),N=s(879692),P=s(100809);class R{_init(e,t,s,o,r,n,a){if(o||(o=e?s?`${e}${s}`:n.find((t=>t?.author?.id===e))?.id||"":n[0]?.id||""),!o)throw this.destroy(),new Error("blockKey is undefined");this.blockKey=o,e&&t&&(this.startStoryRaw=`${e}_${t}`),this.listName=r,this.renderedStoryList=n,this.storyList=n,this.extra=(0,A.parseExtra)(a),this.extraRaw=a||"",this.hasUnloadedDiscover=Boolean(n.find((e=>e.type===i.StoryBlockType.discover&&!e.grouped?.length))),this.initStories().catch((e=>{(0,E.debugLog)(e)}))}initStories(){return new Promise((e=>{this.renderedStoryBlockKeys=this.renderedStoryList.map((e=>this.getBlockKey(e)));let t=!1;const s=this.renderedStoryBlockKeys.indexOf(this.blockKey);if(s>-1){const e=this.renderedStoryList[s];t=this.isBlockUnread(e)}if(this.extra)switch(this.extra.context){case"new":t=!0;break;case"all":t=!1}if(t&&"replies"===this.listName.substr(0,7)&&(t=!1),t){const e=[];for(let t=0;t<this.renderedStoryList.length;t++){const s=this.renderedStoryList[t];(s&&this.isBlockUnread(s)||0===t&&this._hasContext("new"))&&e.push(s)}e.length&&(this.renderedStoryList=e,this.renderedStoryBlockKeys=this.renderedStoryList.map((e=>this.getBlockKey(e))))}this.renderedStories={};const{activeStory:i}=this._renderStories();this.scrollToStory(i,!0),1===this.renderedStoryList.length&&(0,C.addClass)(this.stories,"one_story"),this._startFirstStory(i,this.extra.story_id),(0,C.addClass)(this.stories,"inited"),e()}))}getBlockKey(e){return e?.author?.id&&e?.narrative?.id?`${e.author.id}narrative${e.narrative?.id}`:`${e.id}`}isBlockUnread(e){let t=!1;return e.items[e.items.length-1]&&(t=e.items[e.items.length-1]?.unread),e.grouped?.length?t||(t=e.grouped.some((e=>e.items[e.items.length-1]?.unread))):e.type===i.StoryBlockType.discover&&(t=!0),t}_renderStories(){const e=[];for(let t=0;t<this.renderedStoryList.length;t++)this.renderedStoryList[t]&&e.push(this.renderedStoryList[t]);const t=this._getScreenStoriesCount(),s=this._getCurStoryPos(e.map((e=>this.getBlockKey(e)))),i=Math.floor(t/2),o=e.slice(Math.max(0,s-i)).slice(0,t),r=o.map((e=>this.getBlockKey(e)));for(const e in this.renderedStories){if(!this.renderedStories.hasOwnProperty(e))continue;const t=this.renderedStories[e];r.includes(e)||(t.story.destroy(),delete this.renderedStories[e])}let a=null;if(o.map(((e,t)=>{const s=this.getBlockKey(e);if(this.renderedStories[s])return;const o=this.renderedStoryBlockKeys.indexOf(s),r=new n.Story(e,{id:t,layer:this,onSelect:this._onSelectStory.bind(this),onStoriesEnd:this._onStoriesEnd.bind(this,o),playPrevOwner:this._playPrevOwner.bind(this,o),onPlayStory:this._onPlayStory.bind(this,o),onSeen:this._readStories.bind(this),onVideoPlay:this._onVideoPlay.bind(this),restoreAudioPlay:this._restoreAudioPlay.bind(this),onStartStory:this._onStartStory.bind(this),removeCurrentList:()=>window.Stories.removeList(this.listName),onStoryBlockRemoved:(e,t)=>this.onStoryBlockRemoved(o,e,t),afterNarrativeRemoved:this.options?.afterNarrativeRemoved,afterNarrativeEdited:this.options?.afterNarrativeEdited});t<=i&&this.stories.children[t]?this.stories.insertBefore(r.render(),this.stories.children[t]):this.stories.appendChild(r.render()),this.renderedStories[s]={story:r,index:o},s===this.blockKey&&(a=r)})),!a){const e=r[0];a=this.renderedStories[e].story}return{activeStory:a}}_sendOpeningEvents(){if(!this._source)return;let e;switch(this._source){case"narrative_story":e=_.StoryStatsEvent.OpenNarrativeStories;break;case"narrative_snippet":case"narrative_link":e=_.StoryStatsEvent.OpenNarrative;break;case"narrative_recommendations":e=_.StoryStatsEvent.NarrativeOther}if(e&&this.sendNavigationStatEvents(e,!1),"narrative_fave"===this._source){const e=this.activeStory.getCurrentNarrative();if(e){const{ownerId:t,id:s}=e;(0,y.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:t,item_id:s,time:(0,r.getServerTime)()})}}}_destroyStories(){for(const e in this.renderedStories){if(!this.renderedStories.hasOwnProperty(e))continue;this.renderedStories[e].story.destroy()}}destroy(){clearTimeout(this.timer),clearTimeout(this.animationTimer),this._destroyStories(),this._onVideoEnd(),(0,k.removeEvent)(this.volumeControl),(0,k.removeEvent)(this.layerEl),delete this.activeStory,delete this.volumeControl,delete this.renderedStories;try{this.layerEl&&document.body.removeChild(this.layerEl)}catch(e){}delete window.cur.storyLayer}getList(){return`story${this.activeStory.getRawId()}/${this.listName}${this.extraRaw?`/${this.extraRaw}`:""}`}getStoryRaw(){return!!this.activeStory&&this.activeStory.getRawId()}initDOM(){this.layerEl=(0,C.ce)("div",{className:"stories_layer"});const e=(0,C.ce)("div",{className:"stories_layer_cont"});this.layerEl.appendChild(e),e.appendChild(this._renderBackButton()),e.appendChild(this._renderVolumeControl()),this._updateVolumeButton(),this.stories=(0,C.ce)("div",{id:"stories_list",className:"stories_list"}),e.appendChild(this.stories),e.appendChild((0,C.ce)("div",{className:"stories_layer_close"})),(0,k.addEvent)(this.layerEl,"click",this._onLayerClick.bind(this)),document.body.appendChild(this.layerEl)}show(){window.onBodyResize()}hide(e){(0,C.addClass)(this.layerEl,"stories_layer_hiding"),this.hideAllLayers||a.layerHide(),this._source&&this._source.startsWith("narrative")&&this.sendNavigationStatEvents("narrative_close",!1),this.activeStory&&(this.activeStory.pauseStory(),this.activeStory.hideTooltip(),this.activeStory.isActiveLive()&&this.sendNavigationStatEvents("live_player_close",!1),this._readStoriesIfNeeded(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.listName)),(0,P.dispatchCloseLayerEvent)({currentBlockId:this.getBlockKey(this.activeStory.data)}),!0!==e&&this.activeStory?this.animateStory("minimize").then((()=>this.doHide())).catch((()=>{(0,E.debugLog)("error animate story")})):this.doHide(e),(0,C.removeClass)(this.layerEl,"shown")}doHide(e){this.destroy(),e||a.removeLayer(),window.wkcur&&window.wkcur.shown&&window.WkView.restoreLayer({}),"group_stories"===this.listName&&window.Stories.groupStoriesBlockUpdate(),this.listName.startsWith("archive")&&window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition(),(0,v.clear)()}back(){this.hideAllLayers=!1;const e=(0,m.getCancelStack)(),t=e[e.length-1];t&&"stories_form_focus"===t.name&&(0,m.cancelStackPop)(),this.hide(!1)}_getScreenStoriesCount(){return 2*Math.floor(window.innerWidth/(window.innerHeight*l.STORY_HORIZONTAL_RATIO))+1}_getCurStoryPos(e){return(e||this.renderedStoryBlockKeys).indexOf(this.blockKey)}_startFirstStory(e,t){this.activeStory=e,(0,C.addClass)(e.getWrap(),"active"),this.scrollToStory(),t||(t=this._hasContext("new")?t:this.startStoryRaw),e.indexToStoryById(t),this._startActiveStory(),setTimeout((()=>{(0,C.addClass)(this.stories,"animated"),this.inited=!0,"open"===this.extra.replies&&this.activeStory.showFeedbackTooltip()}))}_markReadRestStories(e){e.hasMetaStory()?this.onMetaStoryViewEnd(e):(this._markReadStoriesInRange(e,e.index,e.getFullItemsLength()),this._updateBadge(e))}onMetaStoryViewEnd(e){if(!e.data.grouped)return;const t=[],s=[];for(let t of e.data.items)t.unread=!1,s.push(t.raw_id);const i=this.getBlockKey(e.data),o=(0,C.ge)("feed_story_"+i);t.push({blockId:i,storyRawIdSet:new Set(s)});let r=[];for(let s of e.data.grouped)if(s){for(let e of s.items)e.unread=!1,r.push(e.raw_id);t.push({blockId:this.getBlockKey(s),storyRawIdSet:new Set(r)}),s.author&&((0,B.markSeenStoriesInProfile)(s.author.id),(0,T.removeUnseenStories)(s.author.id),(0,x.removeUnseenStories)(s.author.id),(0,I.removeUnseenStories)(s.author.id))}this.markStoriesSkipped(r),e.data.has_unseen=!1,this.updateMetaStoryItems(),(0,C.removeClass)(o,"story_feed_new_item"),(0,P.dispatchStoriesSeenEvent)(t)}markStoriesSkipped(e){if((0,N.isActsToApi2ForVKCOMViewerEnabled)()){const t=e.map((e=>{const[t,s]=(0,g.splitStoryRawId)(e);return{owner_id:t,story_id:s}}));g.storiesService.fireMarkSkipped({stories:JSON.stringify(t)})}else window.ajax.post("al_stories.php",{act:"mark_skipped",stories:e.join(","),hash:this.storiesReadHash})}_onSelectStory(e){let t;this.activeStory&&(t=this.activeStory.getWrap(),this.activeStory.stop()),e.id-this.activeStory.id>0&&this._markReadRestStories(this.activeStory),this.activeStory=e,e.indexToUnread(),e.isActiveLive()||e.fillTimeLine(),this.blockKey=this.getBlockKey(e.data),clearTimeout(this.timer),(0,C.addClass)(this.stories,"animated"),this.timer=setTimeout((()=>{(0,C.removeClass)(t,"active"),(0,C.addClass)(e.getWrap(),"active"),this.scrollToStory(),this.timer=setTimeout((()=>{this.activeStory&&e.id!==this.activeStory.id||!this.activeStory||(e.indexToUnread(),this._startActiveStory(),this._renderStories(),this.scrollToStory(e,!0))}),200)}),0)}_startActiveStory(){const{activeStory:e}=this;e.markAsActive(),e.playStory(!0)}_onStartStory(){this.updateLocation()}updateLocation(){const{activeStory:e,listName:t}=this;if(!e)return;const s=this.activeStory.getCurStoryData(),i=this.activeStory.getCurrentNarrative(),o=this.activeStory.isActiveMetaStory();if(!s&&!o)return void(0,L.logError)(new Error("Fail: _onStartStory"),{environment:"stories"});const r=window.nav.objLoc;if(s){if(r.w=`story${e.getRawId()}`,t.match(/^-?(\d+)_(\d+)$/)||(r.w+="/"+t),t.match(/^narrative[s]?-?\d+(_\d+)?/)){const{raw_id:e}=s,[,t]=e.split("_");r.w=`narrative${i?.rawId}_${t}`}}else delete r.w;window.nav.setLoc(window.nav.toStr(r))}scrollToStory(e,t){const s=this._getScrollLeft(e);t?((0,C.removeClass)(this.stories,"animated"),this._setScrollLeft(s)):this.inited&&(0,C.addClass)(this.stories,"animated"),setTimeout((()=>{this._setScrollLeft(s)}))}_setScrollLeft(e){(0,C.setStyle)(this.stories,"transform",`translateX(${Math.round(e)}px) translateZ(0)`)}_getScrollLeft(e){return e=e||this.activeStory,window.innerWidth/2-e.getOffsetLeft()}_onStoriesEnd(e,t){let s=-1;for(let t=e+1;t<this.renderedStoryList.length;t++){if(this.renderedStoryList[t]){s=t;break}}const i=this._getStoryBlockByIndex(s);if(this.activeStory.isActiveMetaStory()&&this.onMetaStoryViewEnd(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.listName),s>-1&&i)t&&this.sendNavigationStatEvents("go_to_next_story_auto_by_time"),this._onSelectStory(i);else{const e=(0,m.getCancelStack)(),s=e[e.length-1];s&&"stories_form_focus"===s.name&&(0,m.cancelStackPop)(),(0,m.cancelStackPop)({byTimer:t})}}preloadDiscoverIfNeeded(){if(!this.hasUnloadedDiscover)return;if(d.isDiscoverLoading())return;if(!this.activeStory)return;const e=this.getBlockKey(this.activeStory.data);if(!this.renderedStories[e])return;let t=this.renderedStories[e].index,s=Math.min(t+3,this.renderedStoryBlockKeys.length-1);for(let e=t+1;e<=s;e++)if(this.renderedStoryList[e]?.type===i.StoryBlockType.discover)return this.renderedStoryList[e].grouped?.length?void(this.hasUnloadedDiscover=!1):void d.preloadDiscoverList().then((()=>{this.hasUnloadedDiscover=!1})).catch((e=>{console.error(e),(0,L.logError)(new Error("Error with getDiscoverList in preloadDiscoverIfNeeded"+(e?`: ${e}`:"")))}))}_playPrevOwner(e){let t=-1;for(let s=e-1;s>=0;s--){if(this.renderedStoryList[s]){t=s;break}}const s=this._getStoryBlockByIndex(t);t>-1&&s?this._onSelectStory(s):(0,m.cancelStackPop)()}_markReadStoriesInRange(e,t,s){const i=e.data.items,o=[],r=new Set;for(let e=t;e<s;e++){const t=i[e];t.unread&&(t.unread=!1,r.add(t.raw_id))}o.push({blockId:this.getBlockKey(e.data),storyRawIdSet:r}),e.data.grouped?.length&&s>=e.getFullItemsLength()&&(e.data.grouped.forEach((e=>{const t=new Set;e.items.forEach((e=>{e.unread=!1,t.add(e.raw_id)})),o.push({blockId:this.getBlockKey(e),storyRawIdSet:t})})),e.data.has_unseen=!1),(0,P.dispatchStoriesSeenEvent)(o)}_markReadPrevStories(e){this._markReadStoriesInRange(e,0,e.index)}_updateBadge(e){const t=(0,C.ge)("feed_story_"+this.getBlockKey(e.data)),s=(0,C.geByClass1)("_stories_feed_item_replies",t);if(e.hasUnloadedMetaStory())return;const i=e.data.items||[],o=i[e.index]||{};o.unread=!1;const r=new Set;o.raw_id&&r.add(o.raw_id);let n=!0;i.forEach((e=>{e.unread&&(n=!1)})),n&&e.data.grouped?.length&&(n=e.data.grouped.every((e=>e&&e.items.every((e=>!e?.unread))))),(0,C.val)(s,""),n&&((0,C.removeClass)(t,"story_feed_new_item"),(0,C.removeClass)(t,"story_feed_new_item_promo"),e.data.author&&((0,B.markSeenStoriesInProfile)(e.data.author.id),(0,T.removeUnseenStories)(e.data.author.id),(0,x.removeUnseenStories)(e.data.author.id),(0,I.removeUnseenStories)(e.data.author.id))),(0,P.dispatchStoriesSeenEvent)([{blockId:this.getBlockKey(e.data),storyRawIdSet:r}])}_onPlayStory(e){const t=this._getStoryBlockByIndex(e);t&&(this.storiesReadHash=t.getReadHash(),t.isActiveMetaStory()||t.isActiveStoryOneTime()||(this._readStories(t),this._markReadPrevStories(t)),this._updateBadge(t));const s=this._getStoryBlockByIndex(e+1);s&&(t&&0===t.getIndex()&&this.preloadDiscoverIfNeeded(),s.preloadNextStory(s.getIndex()))}_getStoryBlockByIndex(e){const t=this.renderedStoryList[e];if(!t)return!1;const s=this.getBlockKey(t);return this.renderedStories[s].story}onStoryBlockRemoved(e,t,s){const i=this.renderedStoryList[e],o=this.getBlockKey(i),r=this.storyList.findIndex((e=>e&&o===this.getBlockKey(e)));delete this.renderedStoryList[e],delete this.storyList[r],!t&&this._onStoriesEnd(e),window.Stories.updateFeedStories(void 0,{cb:s})}onVisibilityChange(){"visible"===document.visibilityState?window.cur.storyLayer&&window.cur.storyLayer.playStory():window.cur.storyLayer&&window.cur.storyLayer.pauseStory()}onResize(){this.activeStory&&window.cur.storyLayer.scrollToStory(this.activeStory,!0)}pauseStory(e){this.activeStory&&this.activeStory.pauseStory(e)}playStory(e=!1){this.activeStory&&this.activeStory.autoResumeStory(e)}_onLayerClick(e){const t=(0,C.hasClass)(e.target,"stories_layer_close");if((0,C.hasClass)(e.target,"stories_layer_cont")||t){if(this.renderedStoryBlockKeys.length-1===this._getCurStoryPos()&&!t){const e=[];for(let t of this.activeStory.data.items)e.push(t.raw_id),t.unread=!1;(0,P.dispatchStoriesSeenEvent)([{blockId:this.getBlockKey(this.activeStory.data),storyRawIdSet:new Set(e)}]),this.markStoriesSkipped(e),this._markReadRestStories(this.activeStory)}(0,m.cancelStackPop)({isCloseBtnClick:t})}}_checkKeyEvents(e){return!((0,C.attr)(e.target,"contenteditable")||(0,S.inArray)(e.target.tagName,["INPUT","TEXTAREA"])||(0,o.curBox)())}onKeyDown(e){if(window.cur.storiesKeyDown)window.cur.storyLayer&&window.cur.storyLayer._checkKeyEvents(e)&&(0,k.cancelEvent)(e);else if(window.cur.storiesKeyDown=e.keyCode!==k.KEY.ESC,[k.KEY.PAGEDOWN,k.KEY.PAGEUP].includes(e.keyCode))(0,k.cancelEvent)(e);else if(window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)){switch(e.keyCode){case k.KEY.LEFT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.prevStory();break;case k.KEY.RIGHT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory();break;case k.KEY.SPACE:(0,k.cancelEvent)(e);const t=window.cur.storyLayer.activeStory;t.isSpaceLongTabAvailable()&&(window.cur.storiesKeyDownLong=setTimeout(t.longTapHandle.bind(t),p.LONG_PRESS_DELAY_MS))}window.cur.storiesKeyDownTs=(0,S.vkNow)()}}onKeyUp(e){window.cur.storiesKeyDown=!1,clearTimeout(window.cur.storiesKeyDownLong),window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)&&e.keyCode===k.KEY.SPACE&&((0,k.cancelEvent)(e),(0,S.vkNow)()-window.cur.storiesKeyDownTs>p.LONG_PRESS_DELAY_MS?window.cur.storyLayer.playStory(!0):(this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory()))}nextStory(){this.activeStory&&this.activeStory.nextStory()}prevStory(){this.activeStory&&this.activeStory.prevStory()}changeStory(e){this.activeStory&&this.activeStory.changeStory(e)}_readStoriesIfNeeded(e){e.isActiveStoryOneTime()&&this._readStories(e)}_readStories(e){if(!e)return;const t=e.getOwnerId(),s=e.getStoryId(),i=e.getRawId(),o=e.getCurrentNarrative();if(!i||!e.isLoaded())return;let r=e.getTrackCode(),n=0;e.isActiveStoryOneTime()&&(n=Math.max(Math.round(e.getStoryProgressPercent()),1)),r||(r=""),g.storiesService.markSeenFx({owner_id:t,story_id:s,track_code:r,source:this._getSource(),narrative_id:o?.id,progress:n,all:0}).catch((e=>{(0,L.logError)(new Error(`error mark seen story: ${e?.error?.error_msg}`))}))}_getSource(){return[u.USER_INFO_MODULE,u.GROUP_INFO_MODULE,p.STORIES_MANAGE_MODULE,u.SPAMFEED_MODULE,u.ABUSE_MODULE,p.ADMIN_STORY_VIEW_MODULE].includes(window.cur.module)?window.cur.module:this._source?this._source:"list"}sendNavigationStatEvents(e,t=!0,s={}){const i=this.activeStory;if(!i)return;const o=this.getStoryRaw()||i.getCurStoryData()?.raw_id,r=this._getSource();t&&this.sendProductAnalyticEvents(e,s),this._updateLastStoryOpenAction(e),(0,g.saveNavigationStatEvent)({storyRawId:o,source:r,action:e})}sendProductAnalyticEvents(e,t={}){const s=this.activeStory;if(!s)return;const o=s.isActiveMetaStory(),r=this.getStoryRaw()||s.getCurStoryData()?.raw_id;if(!r&&!o)return void(0,L.logError)(new Error("sendProductAnalyticEvents: storyRawId is undefined"),{environment:"stories"});let n=0,a=0,l=0;if(r){const e=r.split("_");n=Number(e[0]),a=Number(e[1])}const _=s.getIndex(),u=s.getFullItemsLength()-_,{story:p}=s,m=this._getSource(),g=s.getCurrentNarrative();if(!e||!s)return;if(!(o||p&&n&&a))return;this.listName===i.StoryListName.apps&&(l=1);const v={event_type:e,story_owner_id:n,story_id:a,time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),volume:100*d.getVolume(),view_entry_point:m,stories_author_before:_,stories_author_after:u,nav_screen:window.cur.module,view_event_timeline_position:p.getCurrentTime(),story_type:o?"group_feed":"",is_grouped:l,track_code:s.getTrackCode()};if("discover"===this.listName&&"view_story"===e){const e=this.storyList.findIndex((e=>e.id===this.blockKey));Object.assign(v,{story_index:e})}g&&Object.assign(v,{narrative_id:g.id,narrative_owner_id:g.ownerId}),Object.assign(v,t),(0,h.partConfigEnabled)("web_stats_transport_story_view")?(0,c.saveStoryViewStats)(v):(0,y.statlogsValueEvent)("story_product_analytics",v)}_updateLastStoryOpenAction(e){switch(e){case"go_to_next_story_tap":case"go_to_next_story_click":case"go_to_next_story_auto_by_time":this.viewerSource="next_story";break;case"go_to_previous_story":this.viewerSource="previous_story";break;case"go_to_next_author":this.viewerSource="next_author";break;case"go_to_previous_author":this.viewerSource="previous_author"}}_initViewerSource(){const e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=window.cur.section;break;default:this.viewerSource=e}}sendViewerStartTime(e,t){const s=this.viewerSource;(0,g.saveViewerStartTime)({storyRawId:e,source:s,time:t})}_onVideoPlay(){const e=this.activeStory.getCurStoryData();if(!e)return void(0,L.logError)(new Error("Fail: _onVideoPlay"),{environment:"stories"});const{noSound:t}=e;t||(window.Notifier.lcSend("stories_video_start"),window.getAudioPlayer().isPlaying()&&((0,w.getAudioPlayer)().pauseByChangeChannel(),this.needAudioReset=!0))}_onVideoEnd(){this._restoreAudioPlay()}_restoreAudioPlay(){window.Notifier.lcSend("stories_video_end"),this.needAudioReset&&(window.getAudioPlayer().play(),delete this.needAudioReset)}_renderBackButton(){return this.backButton=(0,C.se)(`<div class="stories_back_button_wrap">\n  <div class="stories_back_button">\n    <div class="stories_back_button_icon"></div>\n    <div class="stories_back_button_text">${f.getLang("global_back")}</div>\n  </div>\n</div>`),(0,k.addEvent)(this.backButton,"click",(()=>{(0,m.cancelStackPop)()})),this.backButton}showBackButton(){(0,C.show)(this.backButton),this.hideAllLayers=!0,(0,C.addClass)(this.layerEl,"with_back_button")}getAnimateFromElem(){if(!this.hideAllLayers){const e=this.getBlockKey(this.activeStory.data);if((0,C.hasClass)(this.animateFromEl,"stories_feed_reply_item")){const t=(0,C.domQuery)("#feed_story_"+e,(0,C.domPN)(this.animateFromEl))[0];if(t)return t}else if("feed"===window.cur.module&&!(0,C.isVisible)(this.backButton)){if(this.options.getStoryElement){const t=this.options.getStoryElement(e);if(t)return t}const t=(0,C.ge)("feed_story_"+e);if(t)return window.Stories.feedScrollToOwner(e),t}}return this.animateFromEl}animateStory(e,t){return new Promise((s=>{if("expand"===e&&!t||"minimize"===e&&(!this.animateFromEl||!document.body.contains(this.animateFromEl)))return(0,C.setStyle)("stories_layers_background","opacity",1),s();this.pauseStory(),(0,C.addClass)(this.layerEl,"animation"),(0,C.removeClass)(this.stories,"animated");let i="expand"===e?t:this.getAnimateFromElem();if(this.hideAllLayers&&"minimize"===e){const e=a.getFirstLayer();i=e.getAnimateFromElem(),a.slicePrevLayers(),a.layerHide()}(0,C.removeClass)(i,"stories_feed_item_ava_animate");let[o,r]=(0,C.getXY)(i);const n=(0,C.getSize)(i),d=window.innerHeight,c=Math.min(l.STORY_MAX_WIDTH,Math.max(l.STORY_MAX_HEIGHT,d*l.STORY_HORIZONTAL_RATIO)),h=c*l.STORY_VERTICAL_RATIO,_=Math.max(0,(d-h)/2),u=Math.max(0,(window.innerWidth-c)/2);o=u-o+c/2-n[0]/2+Number((0,b.scrollGetX)()),r=_-r+h/2-n[1]/2+Number((0,b.scrollGetY)()),o=-o,r=-r;let p={};"expand"===e&&(p.transform=`translate(${o}px, ${r}px) scale(0)`,this.animateFromEl=t),(0,C.setStyle)(this.activeStory.wrapEl,p),"minimize"===e&&(0,C.setStyle)(i,"transform","scale(0)"),this.animationTimer=setTimeout((()=>{(0,C.addClass)(this.stories,"animated"),(0,C.addClass)(i,"stories_feed_item_ava_animate"),this.animationTimer=setTimeout((()=>{"expand"===e?((0,C.setStyle)("stories_layers_background","opacity",1),(0,C.setStyle)(this.activeStory.wrapEl,"transform","translate(0, 0) scale(1)")):((0,C.setStyle)(this.activeStory.wrapEl,"transform",`translate(${o}px, ${r}px) scale(0.01)`),(0,C.setStyle)(i,"transform","scale(1)")),this.animationTimer=setTimeout((()=>{s(),"expand"===e?((0,C.setStyle)(this.activeStory.wrapEl,"transform",""),(0,C.removeClass)(this.layerEl,"animation"),(0,C.removeClass)(this.stories,"animated"),this.playStory(),a.layerShown()):((0,C.removeClass)(i,"stories_feed_item_ava_animate"),(0,C.setStyle)(i,"transform",""))}),330)}),30)}),30)}))}pauseLayer(){this.pauseStory(),(0,C.addClass)(this.layerEl,"paused")}resumeLayer(){this._updateVolumeButton(),this.activeStory.volumeUpdate(),this.activeStory&&(this.updateLocation(),window.cur.storyLayer.activeStory.isActiveMetaStory()&&this.updateMetaStoryItems(),this.activeStory.isFeedbackTooltipShow&&this.activeStory.updateBottom(),this.playStory(),(0,C.removeClass)(this.layerEl,"paused"))}updateMetaStoryItems(){if(!window.cur.storyLayer?.activeStory?.isActiveMetaStory())return;if(!(this.activeStory.story instanceof M.MetaStory))return;const e=this.activeStory.story.getList();if(!e||!e.length||e.every((e=>!e)))return window.cur.storyLayer.activeStory.remove(),this.hideAllLayers=!0,void this.hide();this.activeStory.updateMetaStory()}setLayerVisibility(e){(0,C.toggle)(this.layerEl,e)}_renderVolumeControl(){return this.volumeControl=(0,C.se)('<div class="stories_volume_control" data-testid="stories_volume_control">\n  <div class="stories_volume_control_slide_wrap">\n    <div class="stories_volume_control_slide">\n      <div class="stories_volume_control_slide_indicator"></div>\n    </div>\n  </div>\n</div>'),(0,k.addEvent)((0,C.geByClass1)("stories_volume_control_slide_wrap",this.volumeControl),"mousedown",this._volumeControlOnMouseDown.bind(this)),(0,k.addEvent)(this.volumeControl,"mousedown",this._volumeControlOnClick.bind(this)),this.volumeControlContainer=(0,C.ce)("div",{className:"stories_volume_control_container"}),this.volumeControlContainer.appendChild(this.volumeControl),this.volumeControlContainer}_volumeControlOnMouseDown(e){(0,C.addClass)(this.volumeControlContainer,"changing");const t=(0,C.geByClass1)("stories_volume_control_slide",this.volumeControl),s=(0,C.geByClass1)("stories_volume_control_slide_indicator",t),[i]=(0,C.getXY)(t),[o]=(0,C.getSize)(t),r=e=>{const t=Math.max(0,Math.min(e.pageX-i,o))/o*100;(0,C.setStyle)(s,"width",`${t}%`),d.setVolume(t/100),this.activeStory.volumeUpdate()},n=()=>{(0,k.removeEvent)(window,"mousemove",r),(0,k.removeEvent)(window,"mouseup",n),this._updateVolumeButton(),(0,C.removeClass)(this.volumeControlContainer,"changing")};(0,k.addEvent)(window,"mousemove",r),(0,k.addEvent)(window,"mouseup",n),r(e)}_updateVolumeButton(){let e=100*d.getVolume();(0,C.toggleClass)(this.volumeControl,"low",e>0&&e<50),(0,C.toggleClass)(this.volumeControl,"high",e>=50);const t=(0,C.geByClass1)("stories_volume_control_slide_indicator",this.volumeControl);(0,C.setStyle)(t,"width",`${e}%`)}_volumeControlOnClick(e){if((0,C.hasClass)(e.target,"stories_volume_control_slide_wrap")||(0,C.hasClass)(this.volumeControlContainer,"changing"))return;let t=d.getVolume();t=t?0:1,d.setVolume(t),this._updateVolumeButton(),this.activeStory.volumeUpdate()}onReplyDeleted(e){this.activeStory&&this.activeStory.onReplyDeleted(e)}_hasContext(e){return this.extra&&this.extra.context&&this.extra.context===e}constructor(e=0,t=0,s="",i="",o,r,n,a){this.hasUnloadedDiscover=!1,this.options={},this.options=a;try{window.Videoview&&window.Videoview.togglePlay(!1)}catch(e){}this.initDOM(),this.show(),this._init(e,t,s,i,o,r,n),(0,C.addClass)(this.layerEl,"shown"),this._source=a.source,this._initViewerSource(),this._sendOpeningEvents()}}},392379:(e,t,s)=>{s.d(t,{default:()=>_});var i=s(961462),o=s(959302),r=s(45398),n=s(471828),a=s(70689),l=s(610691),d=s(184132),c=s(879692),h=s(166695);class _ extends i.MediaStory{render(){this.onStartLoading(),this.el=(0,a.ce)("div",{className:"stories_live"});const e=(0,a.ce)("div",{className:"stories_live_player"},{height:"100%",width:"100%"});return this.el.appendChild(e),this.chatEl=(0,a.se)('\n      <div class="stories_live_chat">\n        <div class="mv_chat_messages_wrap">\n          <div class="mv_chat_messages"></div>\n        </div>\n        <div class="mv_chat_stickers_wrap"></div>\n      </div>\n    '),this.el.appendChild(this.chatEl),window.mvcur&&window.mvcur.player&&window.Videoview.hide(!1,!0),setTimeout((()=>{(0,r.showInlineVideo)(this.videoRaw,"",{autoplay:1,module:"story",onLoaded:()=>{this._onPlayerInited()}},!1,e)})),this.el}destroy(){super.destroy(),this._resetTimer(),window.mvcur={},this.player&&(this.player.destroy(),window.VideoChat?.destroy()),window.cur.storyLayer.sendNavigationStatEvents("live_player_close",!1),delete this.el}getContainer(){return this.el||this.render()}onLiveEnded(){this.liveEnded=!0,(0,a.hide)((0,a.geByClass1)("_error_msg",(0,a.geByClass1)("videoplayer_error")));let e=d.Ranges.isGroupId(this.mvData.oid)?n.getLang("stories_live_ended_desc_club"):(0,n.langSex)(this.mvData.author_sex,n.getLang("stories_live_ended_desc_user","raw"));e=e.replace("{name}",this.mvData.md_author);const t=d.Ranges.isGroupId(this.mvData.oid)?n.getLang("stories_live_ended_open_club"):n.getLang("stories_live_ended_open_user");(0,a.hide)(this.chatEl),(0,a.hide)((0,a.domByClass)(this.player.ui.thumb,"videoplayer_big_play_btn"));const s=window.cur.storyLayer.renderedStoryBlockKeys.length>1;this.el.appendChild((0,a.se)(`\n    <div class="stories_live_end">\n      <div class="stories_live_end_author_photo" style="background-image: url(${this.mvData.author_photo})"></div>\n      <div class="stories_live_end_title">${n.getLang("stories_live_ended_title")}</div>\n      <div class="stories_live_end_desc">${e}</div>\n      <a href="${this.mvData.author_href}" class="stories_live_end_open_owner">${t}</a>\n      <div class="stories_live_end_timer" onclick="cur.storyLayer.nextStory()" style="${s?"":"display: none;"}">\n        <canvas class="_timer_canvas" width="100" height="100"></canvas>\n        <div class="stories_live_end_timer_text">${n.getLang("stories_live_ended_watch_next")}</div>\n      </div>\n    </div>\n    `)),s&&setTimeout((()=>{this._startTimer()})),(0,l.markLiveInStoriesFinished)(this.data.owner_id)}pause(){}play(){this.player&&!this.liveEnded&&(super.play(),this.player&&this.player.play())}sendMessage(e,t){e.length>window.mvcur.maxChatReplyLength||((0,c.isActsToApi2ForVKCOMViewerEnabled)()?(0,h.api)("video.createComment",{owner_id:this.data.video.owner_id,video_id:this.data.video.video_id,message:e}).catch((e=>{console.error(e)})):window.ajax.post("al_video.php?act=post_comment",{comment:e,video:this.videoRaw,hash:this.mvData.hash,videoviewer_chat:1}),window.cur.storyLayer.activeStory.onAnswerSent(t))}volumeUpdate(){this.player.setVolume(o.getVolume())}canPlay(){super.canPlay(),(0,a.setStyle)(this.el,"opacity",1)}async _onPlayerInited(){if(this.canPlay(),this.player=window.cur.videoInlinePlayer,this.play(),window.cur.storyLayer.sendNavigationStatEvents("live_player_show",!1),window.browser.safari&&this.player.toggleMute(!0,!1),this.mvData=window.Videoview.getMvData(),window.mvcur={chatMode:!0,maxChatReplyLength:this.mvData.maxChatReplyLength,mvData:this.mvData,mvShown:!0,queueKey:this.mvData.queue_params.key,qversion:this.mvData.qversion},window.VideoChat)window.VideoChat.init(this.chatEl,{scrollHidden:!0});else{const{VideoChat:e}=await Promise.resolve().then(s.bind(s,863818));window.VideoChat=e,e.init(this.chatEl,{scrollHidden:!0})}window.Videoview.queueCheckUpdates(this.mvData.queue_params)}_startTimer(){if(!window.CanvasRenderingContext2D)return;const e=(0,a.domByClass)(this.el,"_timer_canvas"),t=e.getContext("2d");t.lineWidth=6,t.lineCap="round",t.strokeStyle="#fff";const s=Date.now(),i=()=>{const e=(Date.now()-s)/5e3;e<1?(t.clearRect(0,0,100,100),t.beginPath(),t.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*e),t.stroke(),this._nextTO=setTimeout(i,16)):window.cur.storyLayer.nextStory()};(0,a.show)(e),this.timerInProgress=!0,i()}_resetTimer(){window.CanvasRenderingContext2D&&(clearTimeout(this._nextTO),this.timerInProgress=!1,(0,a.hide)((0,a.domByClass)(this.el,"_timer_canvas")))}setCurrentTime(){}getCurrentTime(){return 0}getDuration(){return 0}constructor(e,t,s){super(e,t),this.wrapEl=s,this.videoRaw=`${this.data.video.owner_id}_${this.data.video.video_id}`}}},517778:(e,t,s)=>{s.d(t,{default:()=>u,loadMedia:()=>_});var i=s(70689);const o={},r={},n=[];let a,l=!1,d=!1;function c(e,t,s){const i=r[e];if(i)for(let e=0;e<i.length;e++){const o=i[e];t?o.resolve(s):o.reject(),i.splice(e,1),e--}}function h(e){l&&l.postMessage({cmd:"load",url:e})}function _(e){return l||(l=new Worker(new URL(self.location.origin+"/dist/"+s.u(34808),s.b)),l.onmessage=e=>{const t=e.data;switch(t.type){case"loaded":o[t.url]=t.data,c(t.url,!0,t.data);break;case"error":c(t.url,!1);break;case"inited":d=!0;for(let e=0;e<n.length;e++)h(n[e])}}),new Promise(((t,s)=>{if(e||t(""),o[e])return t(o[e]);const i=function(e){return e.match(/\.mp4/)?"video":e.match(/\.(png|jpg|jpeg|gif)/)||e.match(/\.mycdn\.me\/getVideoPreview/)?"image":void 0}(e);switch(i){case"video":case"image":r[e]||(r[e]=[]);const i=0===r[e].length;if(r[e].push({resolve:t,reject:s}),!i)return;d?h(e):n.push(e);break;default:window.vk.dev&&console.error("wrong media url")}}))}function u(e,t){return a||function(){const e=function(e){try{if(e.contentDocument)return e.contentDocument;if(e.contentWindow&&e.contentWindow.document)return e.contentWindow.document}catch(e){}return!1}(window.utilsNode.appendChild(document.createElement("iframe")));a=e&&e.body?e.body:window.utilsNode.appendChild((0,i.ce)("div",{},{display:"none"}))}(),"video"===t||e.match(/\.mp4/)?function(e){return new Promise(((t,s)=>{const o=(0,i.ce)("video",{});o.oncanplay=()=>{t(),(0,i.re)(o)},o.onerror=()=>{s(),(0,i.re)(o)},a.appendChild(o),o.src=e}))}(e):function(e){return new Promise(((t,s)=>{const o=new Image;o.onload=()=>{t(),(0,i.re)(o)},o.onerror=()=>{s(),(0,i.re)(o)},a.appendChild(o),o.src=e}))}(e)}},961462:(e,t,s)=>{s.d(t,{MediaStory:()=>o});var i=s(636529);class o extends i.BaseStory{destroy(){clearTimeout(this.longLoadingTimer)}getId(){return this.data.raw_id}getTrackCode(){return this.data.track_code}getDate(){return this.data.date}getViews(){return this.data.views}getReplies(){return this.data.replies}setViews(e){this.data.views=e}setReplies(e){this.data.repliesCountText=e}isOneTime(){return this.data.isOneTime&&this.data.authorId!==window.vk.id}onStartLoading(){this.longLoadingTimer=setTimeout((()=>{this.isLoaded()||this.options.onLongLoading?.()}),1e3),super.onStartLoading()}canPlay(){clearTimeout(this.longLoadingTimer),this.data.seenProgress&&this.isOneTime()&&this.setCurrentTime(+(this.data.seenProgress*this.getDuration()/100).toFixed(1)),super.canPlay()}_loadingError(){this._error("load")}_isFailed(){return this.failed}_error(e){clearTimeout(this.longLoadingTimer),this.options.onError?.(e)}constructor(e,t,s){super(t),this.longTapInfoWrapper=()=>{window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.longTapHandle()},this.data=e;const{is_expired:i,is_deleted:o,is_private:r,isOneTimeSeen:n}=e;i?this._error("expired"):o?s?this._error("deleted-narrative"):this._error("deleted"):n?this._error("isOneTimeSeen"):r&&(s?this._error("private-narrative"):this._error("private")),(i||o||r||n)&&(this.failed=!0)}}},271325:(e,t,s)=>{s.d(t,{MetaStory:()=>n});var i=s(152259),o=s(636529),r=s(973935);class n extends o.BaseStory{getCurrentTime(){return Date.now()-this.startTs||0}getDuration(){return i.STORY_DURATION}play(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),super.play()}pause(){this.isPaused()||(super.pause(),this.pauseTime=this.getCurrentTime())}setCurrentTime(e=0){this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)}render(){return this.canPlay(),this.wrapper=document.createElement("div"),this.wrapper.classList.add("MetaStoryWrapper"),this.update(),this.wrapper}canPlay(){setTimeout((()=>{super.canPlay(),window.cur.storyLayer.sendNavigationStatEvents(this.viewEventType,!0)}))}getList(){return this.block.grouped}destroy(){r.unmountComponentAtNode(this.wrapper),this.isDestroyed=!0,this.wrapper.remove()}constructor(e,t){super(t),this.pauseTime=0,this.isDestroyed=!1,this.viewEventType="group_feed_view",this.isPausedByMetaScroll=!1,this.onScroll=e=>{this.isPausedByMetaScroll=e},this.block=e}}},293622:(e,t,s)=>{s.d(t,{transformFeedback:()=>d,transformViewersResponse:()=>_});var i=s(846701),o=s(134064),r=s(471828),n=s(108538),a=s(465451),l=s(397631);function d([e,t,s,i,o,r],n,a=!1){return{stats:c(o,a),replies:h(t,n),viewers:_(e,r),questions:u(s,n),poll:p(i)}}function c(e,t=!1){if(!e)return;const s={title:r.getLang("stories_feedback_stats_title")};if(t)s.showEmptyStatsPrivacyHint=!0;else{const t=(0,o.transformDetailedStatsData)(e);t&&(s.extendedStats=t),e.need_privacy_block&&(s.showPrivacyHint=!0)}return s}function h(e,t){if(!e?.count)return;const s=`replies${t}`,n=e.items.length,a=e.items.reduce(((e,t)=>e+(t.stories?.length||0)),0);let l="",d="";a>=i.STORIES_MAX_COUNT_REPLIES?l=r.getLang("stories_replies_count_title",i.STORIES_MAX_COUNT_REPLIES):(l=r.getLang("stories_replies_title",a),n!==a&&(d=r.getLang("stories_replies_title_authors",n)));const c={title:l,list:(0,o.transformStoryGetApiResponseToLegacyFormat)(e,s,!1),listName:s,source:"replies_list"};return d&&(c.additionalTitle=d),c}function _(e,t){if(!e?.count)return;const s=e.count;let i=r.getLang("stories_views_title",s,!0);const o=t?.likes?.count||0;if(o){i=`${r.getLang("stories_feedback_reactions_title",o,!0)} · ${i}`}return{title:i,nextFrom:e.next_from,hiddenReason:e.hidden_reason,viewsTotalCountText:(0,n.formatCount)(s),items:(l=e,l.items.map((e=>({name:(0,a.getOwnerFullName)(e.user),url:(0,a.getOwnerHref)(e.user),photoUrl:e.user?.photo_100||e.user?.photo_200||e.user?.photo_50||"",isLiked:e.is_liked,reaction_id:e.reaction_id??void 0,nft:e.user?.is_nft,isVerified:Boolean(e.user?.verified)}))))};var l}function u(e,t){if(!e?.count)return;const{ownerId:s,itemId:i}=(0,l.splitRawId)(t);return{title:r.getLang("stories_questions_title"),items:(0,o.transformStoryQuestions)(e.items,e.profiles,s,i)}}function p(e){if(!e)return;const t=(0,o.transformPoll)(e);return t?{title:r.getLang("voting_voting"),data:t}:void 0}},530066:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(152259),o=s(517778),r=s(961462),n=s(70689);class a extends r.MediaStory{render(){if(this.onStartLoading(),this.photo)return this.photo;const{photo_url:e}=this.data;return this.photo=document.createElement("div"),this.photo.setAttribute("class","stories_photo"),this._isFailed()||(0,o.loadMedia)(e).then((e=>{this.photo&&((0,n.setStyle)(this.photo,"backgroundImage",`url('${e}')`),this.canPlay())})).catch((()=>{this._loadingError()})),this.photo}getContainer(){return this.photo||this.render()}destroy(){super.destroy(),delete this.photo}play(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),super.play()}pause(){this.isPaused()||(super.pause(),this.pauseTime=this.getCurrentTime())}setCurrentTime(e=0){this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)}getCurrentTime(){return Date.now()-this.startTs||0}getDuration(){return i.STORY_DURATION}canPlay(){super.canPlay(),window.cur.storyLayer.sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0}),(0,n.setStyle)(this.photo,"opacity",1)}constructor(e,t,s){super(e,t,s),this.pauseTime=0}}},430798:(e,t,s)=>{s.d(t,{Stories:()=>x});var i=s(797235),o=s(954398),r=s(517778),n=s(116147),a=s(70689),l=s(791377),d=s(93367),c=s(274851),h=s(471828),_=s(636322),u=s(251087),p=s(159663),m=s(488844),g=s(65718),y=s(959302),v=s(618418),w=s(879692),S=s(396371),f=s(887903),k=s(846701),b=s(100809),E=s(722180),C=s(331313),L=s(259844);const T={},x={show(e,t={},s){x._setLastShownStoryRaw(e),x.getPreparedList(e,s,t).then((({ownerId:e,storyId:s,uniqKey:i,blockKey:r,listName:a,list:l,extra:d})=>{n.isOpeningLocked()||(n.checkAndPrepareBoxQueue(t),n.addLayer(new o.StoryLayer(e,s,i,r,a,l,d,t),t))})).catch((e=>{console.error(e),(0,g.logError)(e),(0,p.showFastBox)(h.getLang("global_error"),h.getLang("global_unknown_error"))}))},initializeLastSeenStories(){x._lastShownStoryRaw&&x.show(x._lastShownStoryRaw)},_lastShownStoryRaw:"",_setLastShownStoryRaw(e){x._lastShownStoryRaw=e},_getUnreadStory(e,t){e=(0,_.intval)(e);let s=!1;for(let i=0;i<t.length;i++)if(t[i].author.id===e){const e=t[i].items;for(let t=0;t<e.length;t++)if(e[t].unread){s=e[t];break}s||(s=e[0]);break}return s},getPreparedList(e,t,s){return new Promise(((o,r)=>{let[n,a,l,d,c,h]=this.parseList(e);if((0,w.isApiForVKCOMViewerEnabled)()&&!c&&n&&a&&(c=`${n}_${a}`),!n&&!d&&!c)return void r(`Can not find a correct block key or list name in: ${e}`);let p={ownerId:(0,_.intval)(n),storyId:(0,_.intval)(a),uniqKey:l||"",blockKey:d||"",listName:c,extra:h,list:[]};if(!t)switch(c){case i.StoryListName.feed:if(!(t=(0,L.getStoryList)(c))&&(0,w.isMinimizedStoryFeedBlockEnabled)()){const e=(0,C.getStoryFeedDataManager)();return e.isMinimized()&&(e.abort(),e.setMinimized(!1)),(0,u.showBoxLoader)(),void(0,C.loadStoryBlockFeedData)().then((()=>{const e=(0,L.getStoryList)(c);e?(p.list=e,o(p)):r()})).finally((()=>{(0,u.hideBoxLoader)()}))}break;case i.StoryListName.discover:if(!(t=(0,L.getStoryList)(c))){let e;const s=(0,L.getStoryList)(i.StoryListName.feed);if(s&&(e=s.find((e=>e.type===i.StoryBlockType.discover)),e?.grouped&&(t=e.grouped)),!t)return void(0,y.preloadDiscoverList)(!0).then((e=>{p.list=e,o(p)})).catch(r)}break;case i.StoryListName.apps:{const e=e=>{const t=e.find((e=>e.type===i.StoryBlockType.appGroupedStories));t?.grouped?(p.list=t?.grouped,o(p)):r()},t=(0,L.getStoryList)(i.StoryListName.feed);return void(t?e(t):x.fetchList(i.StoryListName.feed,n,h,s).then(e).catch(r))}default:t=(0,L.getStoryList)(c)}t?(p.list=t,o(p)):x.fetchList(c,n,h,s).then((e=>{e&&(p.list=e,o(p))})).catch(r)}))},setList(e,t){window.cur[`stories_list_${e}`]=t},fetchList(e,t,s,i){const o=i?.trackCode;if((0,w.isApiForVKCOMViewerEnabled)()){const t=s?(0,S.parseExtra)(s):{};return o&&(t.trackCode=o),i?.narrativeRawIds&&(t.narrativeRawIds=i.narrativeRawIds),(0,u.showBoxLoader)(),(0,S.fetchList)(e,t).then((({list:t})=>(x.setList(e,t),t))).catch((t=>{console.error(t),(0,f.logStoriesError)({error:t,additionalText:"could not fetch list",extra:{listName:e}})})).finally((()=>{(0,u.hideBoxLoader)()}))}return new Promise(((i,r)=>{window.ajax.post("al_stories.php",{act:"get_list",list:e,owner_id:t,extra:s,track_code:o},{loader:!0,onDone(t){x.setList(e,t),i(t)},onFail:e=>(r(e),!0)})}))},removeList(e){delete window.cur[`stories_list_${e}`]},parseList(e){e.match(/story/)&&(e=decodeURIComponent(e));const t=e.match(/^(?:story)?(?:(-?\d+)(?:_(\d+))?(?:&([a-z0-9]+))?|([a-z0-9]+))?(?:\/([a-z0-9_\-]+))?(?:\/([a-z0-9_:;\-]+))?$/i);if(!t)return[];const[,s,i,o,r,n,a]=t;return[s,i,o,r,n,a]},initFeed(e="stories_feed_items_container"){"string"==typeof e&&(e=(0,a.ge)(e));let t=(0,a.geByClass1)("stories_feed_items",e),s=(0,a.attr)(t,"id");x.updateFeedArrows(s);const i=()=>{(0,d.addEvent)(e,"wheel",this.feedMouseWheel)},o=()=>{(0,d.removeEvent)(e,"wheel",this.feedMouseWheel)};(0,d.addEvent)(e,"mouseenter",i),(0,d.addEvent)(e,"mouseleave",o),(0,v.pushNavDestroy)((()=>{(0,d.removeEvent)(e,"wheel",this.feedMouseWheel),(0,d.removeEvent)(e,"mouseenter",i),(0,d.removeEvent)(e,"mouseleave",o)}))},feedNext(e){let t=(0,a.ge)("stories_feed_wrap");return e&&(t=(0,a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("next",null,t)},feedPrev(e){let t=(0,a.ge)("stories_feed_wrap");return e&&(t=(0,a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("prev",null,t)},feedPaging(e,t,s){s||(s=(0,a.ge)("stories_feed_wrap"));let i=(0,a.geByClass1)("stories_feed_items",s),o=(0,a.attr)(i,"id"),r=`${o}_position`,n=T[r]||0;const l=(0,a.getSize)(s)[0];if((0,_.isNumeric)(e))n+=Number(e);else{const t=l-100;"next"===e?n+=t:n-=t}T[r]=Math.max(0,Math.min(n,i.scrollWidth-l)),t?(0,a.removeClass)(i,"animated"):(0,a.addClass)(i,"animated"),(0,a.setStyle)(i,"transform",`translateX(-${T[r]}px)`),x.updateFeedArrows(o)},feedScrollToOwner(e){const t=(0,a.ge)(`feed_story_${e}`);if(!t)return;const s=(0,a.domClosest)("stories_feed_items",t),i=s.offsetWidth,o=`${(0,a.attr)(s,"id")}_position`,r=t.offsetWidth,n=t.offsetLeft,l=(0,a.domClosest)("stories_feed_wrap",s);T[o]=n-i+i/2+r/2,x.feedPaging(0,!0,l)},updateFeedStories(e,t,s="stories_feed_items"){if((0,w.isApiForVKCOMViewerEnabled)())return void(0,b.dispatchListModifiedEvent)({listName:i.StoryListName.feed});let o=(0,a.ge)(s),r=(0,a.domClosest)("stories_feed_wrap",o);if(e=e||"news",!o)return;if(!(0,_.inArray)(e,["news","search"]))return void(0,a.hide)(r);const n=(e,i)=>{t&&t.cb&&t.cb(),this.setList("feed",i),window.cur.storyLayer&&window.cur.storyLayer.updateMetaStoryItems();const o=(0,a.ge)(s);o&&(e?((0,a.setStyle)(o,"transform","translateX(0px)"),(0,a.val)(o,e),o.children.length<6?(0,a.addClass)(r,"stories_feed_not_nav_buttons"):(0,a.removeClass)(r,"stories_feed_not_nav_buttons"),T[s+"_position"]=0,x.updateFeedArrows(s),(0,a.show)(r)):(0,a.hide)(r))};if(t&&t.stories){const{section:e,q:s,stories:i}=t,{html:o,js:l}=i,d=Array.isArray(l)?l:[];return"search"!==e||s&&d.length?void n(o,l):void(0,a.hide)(r)}window.ajax.post("al_stories.php",{act:"feed_stories"},{onDone:n})},feedMouseWheel(e){const t=(0,a.domClosest)("stories_feed_wrap",e.target);if((0,a.hasClass)(t,"stories_feed_not_nav_buttons"))return;(0,d.cancelEvent)(e);const s=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;x.feedPaging(s,!0,t)},updateFeedArrows(e="stories_feed_items"){let t=(0,a.ge)(e),s=e+"_position";if(!t)return;T[s]||(T[s]=0);const i=(0,a.geByClass1)("stories_feed_wrap").offsetWidth,o=t.scrollWidth-i,r=(0,a.geByClass1)("stories_feed_arrow_left",(0,a.domPN)(t)),n=(0,a.geByClass1)("stories_feed_arrow_right",(0,a.domPN)(t));0===T[s]?(0,a.addClass)(r,"disabled"):(0,a.removeClass)(r,"disabled"),T[s]===o||o<=0?(0,a.addClass)(n,"disabled"):(0,a.removeClass)(n,"disabled")},showBlackList(){(0,E.showStoryBlackList)()},blackListItemClick(e,t){(0,d.cancelEvent)(t);const s=(0,_.intval)((0,a.attr)(e,"data-id"));window.cur.storiesBlackListShown[s]?(delete window.cur.storiesBlackListShown[s],(0,a.removeClass)(e,"olist_item_wrap_on")):(window.cur.storiesBlackListShown[s]=1,(0,a.addClass)(e,"olist_item_wrap_on"))},saveBlackList(e){const t=Object.keys(window.cur.storiesBlackListShown);0!==t.length?(0,w.isActsToApiFirstForVKCOMViewerEnabled)()?((0,m.lockButton)(e),k.storiesService.unbanOwnerFx({owners_ids:t.join(",")}).then((()=>{x.updateFeedStories(),(0,u.curBox)()?.hide()})).finally((()=>{(0,m.unlockButton)(e)}))):window.ajax.post("al_stories.php",{act:"save_blacklist",hash:window.cur.storiesBlackList.hash,list:t.join(",")},{onDone(){x.updateFeedStories(),(0,u.curBox)()?.hide()},showProgress:()=>(0,m.lockButton)(e),hideProgress:()=>(0,m.unlockButton)(e)}):(0,u.curBox)()?.hide()},blacklistUpdateUsers(e){const t=e;if(e=(0,_.trim)(e).toLowerCase(),window.cur.storiesBlacklistLastQ===e)return;window.cur.storiesBlacklistLastQ=e;const s=e?window.cur.storiesIndexer.search(e):window.cur.storiesBlackList.users,i=[];if(e)for(let t=0;t<e.length;t++)i.push(e.substr(t,1));const o=new RegExp(i.join(".*?"),"i");let r="";for(let t=0;t<s.length;t++){const i=s[t],n=e?i.name.replace(o,(e=>`<em>${e}</em>`)):i.name;r+=window.cur.storiesBlackList.tpl.replace(/\{id\}/g,i.id).replace("{photo}",i.photo).replace("{name}",n).replace("{href}",i.href).replace("{class_name}",window.cur.storiesBlackListShown[i.id]?" olist_item_wrap_on":"")}r||(r=`<div class="no_rows">${h.getLang("global_search_not_found").replace("{search}",(0,_.clean)(t))}</div>`),(0,a.val)((0,a.geByClass1)("olist","stories_black_list_result"),r)},blackListInit(e){window.cur.storiesBlackListShown={},window.cur.storiesBlackList=e,(0,u.curBox)()?.setOptions({width:450,bodyStyle:"padding: 0px",onClean:function(){this.storyLayer&&this.storyLayer.playStory(),window.cur.storiesBlackListScroll&&window.cur.storiesBlackListScroll.destroy()}}).removeButtons(),window.cur.storiesBlackList.users.length?(window.cur.storiesBlacklistLastQ=!1,window.cur.storiesIndexer=new c.vkIndexer(window.cur.storiesBlackList.users,(e=>e.name),(()=>{x.blacklistUpdateUsers("")})),l.default.init("stories_blacklist"),l.default.focus("stories_blacklist"),(0,u.curBox)()?.addButton(h.getLang("global_save"),this.saveBlackList).addButton(h.getLang("global_cancel"),void 0,"no")):(0,u.curBox)()?.addButton(h.getLang("global_close"))},preloadUrl(e){(0,r.loadMedia)(e).catch((e=>{(0,g.logError)(e)}))},groupStoriesBlockUpdate(){const e=(0,L.getStoryList)("group_stories"),t=e&&e[0]&&e[0].items;if(!t)return;let s=0;for(let e=0;e<t.length;e++){t[e].unread&&s++}const i=(0,a.geByClass1)("stories_groups_block_stories_wrap"),o=(0,a.geByClass1)("stories_groups_block_stories_button",i);(0,a.toggleClass)(i,"has_unread",s>0),(0,a.toggleClass)(i,"has_stories",t.length>0),(0,a.toggleClass)(o,"has_stories",t.length>0);const r=(0,_.clone)(window.cur.storiesPreviews);let n=r.splice(r.length-s,3);n.length<3&&(n=n.concat(r.slice(0,3-n.length))),n.reverse();let l="";for(let e=n.length-1;e>=0;e--)l+=window.cur.storiesPreviewsRowHtml.replace("{url}",n[e]);(0,a.val)((0,a.geByClass1)("stories_groups_block_stories_rows",i),l)},isLiveShown(e){if(!window.cur.storyLayer||!window.cur.storyLayer.activeStory||!window.cur.storyLayer.activeStory.isActiveLive())return!1;return window.cur.storyLayer.activeStory.story.videoRaw===e},activeLiveEnded(e){window.cur.storyLayer.activeStory.onLiveEnded(e)},updateLiveViewersCount(e){const t=e?h.getLang("stories_live_N_watching",e,!0):"";window.cur.storyLayer.activeStory.updateLiveViewersCount(t)},updatePagePhotosModule:()=>new Promise(((e,t)=>{window.ajax.post("al_profile.php",{act:"get_page_photos_module"},{onDone:t=>{const{Stories:s}=window;(0,a.val)("page_photos_module",t),t||(0,a.hide)("profile_photos_module"),s?.removeList("profile"),e()},onFail:()=>(t(),!0)})}))}},451432:(e,t,s)=>{s.d(t,{STORY_HORIZONTAL_RATIO:()=>i,STORY_MAX_HEIGHT:()=>n,STORY_MAX_WIDTH:()=>r,STORY_VERTICAL_RATIO:()=>o});const i=.563,o=1.78,r=540,n=320},116147:(e,t,s)=>{s.d(t,{addLayer:()=>c,checkAndPrepareBoxQueue:()=>S,getFirstLayer:()=>m,getPrevLayer:()=>g,hideAllLayers:()=>p,isOpeningLocked:()=>f,layerHide:()=>u,layerShown:()=>_,onReplyDeleted:()=>v,removeLayer:()=>h,slicePrevLayers:()=>y});var i=s(372292),o=s(93367),r=s(70689),n=s(251087);let a=[],l=!1;const d={visibilitychange:()=>{window.cur.storyLayer&&window.cur.storyLayer.onVisibilityChange()},resize:()=>{window.cur.storyLayer&&window.cur.storyLayer.onResize()},keydown:e=>{window.cur.storyLayer&&window.cur.storyLayer.onKeyDown(e)},keyup:e=>{window.cur.storyLayer&&window.cur.storyLayer.onKeyUp(e)}};function c(e,t){window.cur.storyLayer&&window.cur.storyLayer.pauseLayer(),(0,r.ge)("stories_layers_background")||(document.body.appendChild((0,r.ce)("div",{id:"stories_layers_background",className:"stories_layers_background"})),window.layerQueue.hide(),window.layerQueue.push(),window.layers.fullhide=p,(0,o.addEvent)(window,"visibilitychange",d.visibilitychange,void 0,void 0,!0),(0,o.addEvent)(window,"resize",d.resize),(0,o.addEvent)(document,"keydown",d.keydown),(0,o.addEvent)(document,"keyup",d.keyup)),window.cur.storyLayer=e,l=!0,e.animateStory("expand",t.fromEl).catch((()=>{})).finally((()=>{l=!1})),a.push(e),(0,r.addClass)(document.body,"stories_layer_shown"),(0,i.cancelStackPush)(`stories_layer_close${a.length}`,((t={})=>{t.byTimer?e.sendNavigationStatEvents("close_auto_by_time"):e.sendNavigationStatEvents("close_tap"),a.length>1&&!t.isCloseBtnClick?e.back():(e.hideAllLayers=t.isCloseBtnClick,e.hide(!1))}))}function h(){a.pop(),window.cur.storyLayer=a[a.length-1],window.cur.storyLayer?window.cur.storyLayer.resumeLayer():(p(!0),window.layerQueue.pop(),window.cur.storiesCashedBoxQueueData&&((0,n.restoreBoxQueue)(window.cur.storiesCashedBoxQueueData),function(){const e=w();e&&(e.forceHide=!1,e._show(!0,!1,!0))}(),delete window.cur.storiesCashedBoxQueueData))}function _(){a.length>1&&(a[a.length-2].setLayerVisibility(!1),a[a.length-1].showBackButton())}function u(){a.length>1?a[a.length-2].setLayerVisibility(!0):(0,r.setStyle)("stories_layers_background","opacity",0)}function p(e=!1){const{noLoc:t}="object"==typeof e?e:{noLoc:e};for(let e=0;e<a.length;e++)a[e].hide(!0);if(window.layers.fullhide=!1,(0,r.removeClass)(document.body,"stories_layer_shown"),(0,r.re)("stories_layers_background"),(0,o.removeEvent)(window,"visibilitychange",d.visibilitychange),(0,o.removeEvent)(window,"resize",d.resize),(0,o.removeEvent)(document,"keydown",d.keydown),(0,o.removeEvent)(document,"keyup",d.keyup),t){const e=window.nav.objLoc;delete e.w,window.nav.setLoc(e)}window.cur.needUpdateFeedStories&&window.Stories.updateFeedStories(),a=[]}function m(){return a[0]}function g(){return a[a.length-2]}function y(){for(let e=a.length-2;e>=0;e--)a[e].doHide(!0);a.splice(0,a.length-1)}function v(e){for(let t=0;t<a.length;t++)a[t].onReplyDeleted(e)}function w(){if(!window._message_boxes?.length)return null;const e=window._message_boxes.filter(Boolean);return e.length?e[e.length-1]:null}function S(e){(0,n.curBox)()&&(e.fromEl=null,function(){const e=w();e&&(e._hide(!1,!0,!0),e.forceHide=!0)}(),window.cur.storiesCashedBoxQueueData=(0,n.getAndCleanBoxQueueData)())}function f(){return l}window.LayersX=a},959302:(e,t,s)=>{s.d(t,{createUserStackMaskIfNeeded:()=>w,fetchDiscover:()=>g,getGroupStoryManageRemoveData:()=>S,getStoryBlockKey:()=>v,getVolume:()=>u,isDiscoverLoading:()=>y,preloadDiscoverList:()=>m,setVolume:()=>p});var i=s(797235),o=s(70689),r=s(618418),n=s(879692),a=s(396371),l=s(251087),d=s(36703),c=s(471828),h=s(331313),_=s(259844);function u(){const e=window.ls.get("video_volume");return"number"==typeof e?Math.min(1,Math.max(0,e)):1}function p(e){window.ls.set("video_volume",e)}function m(e=!1){if(window.cur.storiesDiscoverFetchingPromise)return window.cur.storiesDiscoverFetchingPromise;let t,s;const o=(0,_.getStoryList)(i.StoryListName.feed);return o&&(s=o.find((e=>e.type===i.StoryBlockType.discover)),s&&(t=s.track_code)),(0,n.isApiForVKCOMViewerEnabled)()?(e&&(0,l.showBoxLoader)(),window.cur.storiesDiscoverFetchingPromise=(0,h.loadDiscover)(t).then((()=>{let e;const t=(0,_.getStoryList)(i.StoryListName.feed);if(t){const s=t.find((e=>e.type===i.StoryBlockType.discover));s?.grouped&&(e=s?.grouped)}return e||Promise.reject(new Error("empty discover list"))})).finally((()=>{e&&(0,l.hideBoxLoader)(),delete window.cur.storiesDiscoverFetchingPromise})),window.cur.storiesDiscoverFetchingPromise):(window.cur.storiesDiscoverFetchingPromise=g("",t,e).then((([e,t])=>(s&&(s.grouped=e,s.next_from=t),e))).finally((()=>{delete window.cur.storiesDiscoverFetchingPromise})),window.cur.storiesDiscoverFetchingPromise)}function g(e="",t="",s=!1,o=15){if((0,n.isApiForVKCOMViewerEnabled)()){const r={count:o,startFrom:e,trackCode:t};return s&&(0,l.showBoxLoader)(),(0,a.fetchList)(i.StoryListName.discover,r).then((({list:e,nextFrom:t})=>[e,t])).finally((()=>{s&&(0,l.hideBoxLoader)()}))}return new Promise(((i,r)=>{window.ajax.post("al_stories.php",{act:"get_discover",start_from:e,count:o,track_code:t},{loader:s,onDone:(e,t)=>{i([e,t])},onFail:e=>(r(e),!0)})}))}function y(){return Boolean(window.cur.storiesDiscoverFetchingPromise)}function v(e){return e?.author?.id&&e?.narrative?.id?`${e.author.id}narrative${e.narrative?.id}`:`${e.id}`}function w(){const e="users_stack_stories_mask";let t=document.getElementById(e);t||(t=(0,o.se)(`\n        <svg width="0" height="0">\n          <defs>\n            <clipPath id="${e}">\n              <path transform="translate(1.5 0)" d="M1.20772 8C1.20772 6.32671 0.768742 4.75626 0 3.39821C1.44342 1.34278 3.8277 0 6.52463 0C10.9293 0 14.5 3.58172 14.5 8C14.5 12.4183 10.9293 16 6.52463 16C3.8277 16 1.44342 14.6572 0 12.6018C0.768742 11.2437 1.20772 9.6733 1.20772 8Z"></path>\n            </clipPath>\n          </defs>  \n        </svg>  \n      `),t&&(document.body.appendChild(t),(0,r.pushNavDestroy)((()=>{t?.remove()}))))}function S(e){if(e&&e.can_manage&&window.cur.module===d.STORIES_MANAGE_MODULE){const t=Math.floor(Date.now()/1e3);return{rawId:e.raw_id,deleter:window.vk.id,deletionDate:t,deletionDateString:(0,c.getSmDate)(t)}}}},242642:(e,t,s)=>{s.d(t,{Story:()=>we});var i=s(785893),o=s(797235),r=s(667294),n=s(973935),a=s(509793),l=s(595815),d=s(517778),c=s(116147),h=s(799767),_=s(265912),u=s(392379),p=s(578526),m=s(530066),g=s(541762),y=s(34467),v=s(598015),w=s(36703),S=s(70689),f=s(798485),k=s(977070),b=s(372292),E=s(488844),C=s(93367),L=s(636322),T=s(877926),x=s(159663),I=s(251087),M=s(585703),B=s(808265),A=s(43129),N=s(330),P=s(30655),R=s(65718),D=s(370878),F=s(977053),O=s(399565),j=s(520597),U=s(977584),H=s(961462),V=s(271325),K=s(639986),q=s(484519),$=s(931059),W=s(515033),z=s(431925),G=s(922404),Q=s(539884),Y=s(959302),X=s(166695),Z=s(893682),J=s(780891),ee=s(152827),te=s(819477),se=s(130593),ie=s(311429),oe=s(618418),re=s(184132),ne=s(673407),ae=s(471828),le=s(902947),de=s(846701),ce=s(879692),he=s(45412),_e=s(892665),ue=s(195365),pe=s(100809),me=s(708030),ge=s(284658),ye=s(259844),ve=s(596533);class we{destroy(){this._destroyStory();const e=this.wrapEl.querySelector(".stories_author_avatar");e&&n.unmountComponentAtNode(e),(0,C.removeEvent)((0,S.geByClass1)("stories_item_cont",this.contWrap)),(0,C.removeEvent)(this.shareButton),delete this.shareButton,(0,C.removeEvent)(this.followBtn),delete this.followBtn,(0,C.removeEvent)(this.answersEl),delete this.answersEl,clearTimeout(this.showMessageTimer);const t=(0,S.geByClass)("stories_time_line",this.timeLineEl);for(let e=0;e<t.length;e++)(0,C.removeEvent)(t[e]);(0,C.removeEvent)(this.viewsButton),(0,C.removeEvent)((0,S.geByClass1)("stories_link",this.wrapEl)),delete this.contWrap,delete this.backButton,delete this.descEl,delete this.timeLineEl,delete this.authorButtons,delete this.inlineLoader,this.wrapEl&&this.wrapEl.parentNode&&this.wrapEl.parentNode.removeChild(this.wrapEl),delete this.wrapEl,(0,g.clear)()}_destroyTimeLine(){const e=(0,S.geByClass)("stories_time_line",this.timeLineEl);for(let t=0;t<e.length;t++)(0,C.removeEvent)(e[t])}getOwnerId(){return this.data?.author?.id}getIndex(){return this.index}getRawId(){return this.story instanceof H.MediaStory&&this.story?this.story.getId():""}getStoryId(){const e=this.getRawId();return Number(e?.split("_")?.[1])||0}getTrackCode(){if(this.story instanceof H.MediaStory)return this.story?this.story.getTrackCode():""}getReadHash(){return this.data.read_hash}getItems(){return this.data.items}getItemsLength(){return this.getItems().length}getFullItemsLength(){return this.getItems().length+(this.hasMetaStory()?1:0)}render(){this.wrapEl=(0,S.ce)("div",{className:"stories_item"}),this.contWrap=(0,S.ce)("div",{className:"stories_item_cont_wrap"}),this.contStickers=(0,S.ce)("div",{className:"stories_item_cont_sticker"}),this.contWrap.appendChild(this.contStickers),this.wrapEl.appendChild(this.contWrap);const e=(0,S.ce)("div",{className:"stories_item_cont"});return(0,C.addEvent)(e,"mousedown",(e=>{this._onMouseDownHandle(e.target)})),(0,C.addEvent)(e,"mouseup contextmenu",(e=>{this._onMouseUpHandle(e.target)})),this.contWrap.appendChild(e),this.contWrap.appendChild(this.renderHeader()),this.storySendFormOverlay=(0,S.ce)("div",{className:"stories_bottom_overlay"}),this.storySendFormOverlay.appendChild((0,S.ce)("div",{className:"stories_bottom_wrap"})),this.contWrap.appendChild(this.storySendFormOverlay),this.contWrap.appendChild(this._renderPreview()),this.indexToUnread(),window.cur.noStoriesBack||(this.backButton=(0,S.ce)("div",{className:"stories_item_back"}),e.appendChild(this.backButton)),this.inlineLoader=e.appendChild((0,S.ce)("div",{className:"stories_inline_loader",innerHTML:(0,N.getProgressHtml)()})),this.contWrap.appendChild((0,S.ce)("div",{className:"stories_play_button video_thumb_play",onclick:()=>{this.story&&this.story.play()}})),this.isActiveLive()?(0,S.addClass)(this.wrapEl,"live"):this.data.type!==o.StoryBlockType.discover&&this._initTimeLine(),(0,S.toggleClass)(this.wrapEl,"multi_stories",this.data.items.length>1),this.wrapEl}updateMetaStory(){this.isActiveMetaStory()&&this.story instanceof V.MetaStory&&this.story.update()}resetNewRepliesCounterIfNeeded(){if(this.feedback?.replies?.listName){const e=this.getCurStoryData();if(e?.replies_new_counter){const t=(0,ye.getStoryList)(this.feedback.replies.listName);if(t){Boolean(t.find((e=>e.items.find((e=>e.unread)))))||(e.replies_new_counter=0)}}}}_canForceDeleteStories(){return this.data.moder_remove_hash&&!this.data.items[0].is_deleted}_initTimeLine(){this.timeLineEl&&(this._destroyTimeLine(),(0,S.re)(this.timeLineEl)),this.storiesHeader.appendChild(this._renderTimeLine())}_isActionsShown(){const e=(0,S.domClosest)("_ui_menu_wrap",this.wrapEl);return(0,S.hasClass)(e,"shown")}_renderPreview(){return(0,S.se)('<div class="stories_preview"></div>')}_renderMessage(e){return(0,S.se)(`<div class="stories_message">\n  <div class="stories_message_text">${e}</div>\n</div>`)}showMessage(e){(0,S.re)((0,S.geByClass1)("stories_message",this.contWrap));const t=this._renderMessage(e);return this.contWrap.appendChild(t),clearTimeout(this.showMessageTimer),new Promise((e=>{this.showMessageTimer=setTimeout((()=>{this.contWrap.removeChild(t),e()}),3e3)}))}_setPreview(e,t){const{index:s}=this,i=this.data.items[s];if(!i)return;this.renderAvatar();const{preview_url:o}=i;o!==this.curPreviewUrl&&o&&(e=e||(0,S.geByClass1)("stories_preview",this.contWrap),(0,d.loadMedia)(o).then((i=>{s===this.index&&o!==this.curPreviewUrl&&(this.curPreviewUrl=o,(0,S.setStyle)(e,"backgroundImage","url("+i+")")),(0,S.setStyle)(e,"opacity",1),t&&setTimeout(t,0)})).catch((e=>{(0,R.logError)(e)})))}renderHeader(){if(this.storiesHeader=document.createElement("div"),this.storiesHeader.classList.add("stories_header"),this.storiesHeaderContent=document.createElement("div"),this.storiesHeaderContent.classList.add("stories_header_content"),this.storiesHeader.appendChild(this.storiesHeaderContent),this.data.type===o.StoryBlockType.discover){const e=(0,S.se)(`<span class="MetaStoryBlockTitle">${ae.getLang("stories_block_discover")}</span>`);this.storiesHeaderContent.appendChild(e)}if(!this.data.author)return this.storiesHeader;const{href:e,name:t,verify:s}=this.data.author,i=this.getCurStoryData(),r=this.getCurrentNarrative();let n,a,l="_self",d="";this.layer.listName.includes("place")&&(l="_blank"),n=this.data.is_narrative?r?.coverUrl:this.data.author.photo;let c=`<a href="${e}" target="${l}" class="stories_author_avatar" data-testid="story_author_avatar"></a>`;d=r&&i?`<div class="StoryInfo__title"><span>${r.title}</span></div>`:`<a class="StoryInfo__title StoryInfo__title--author" href="${e}" target="${l}">${t}${s||""}</a>`,a=this.getHeaderBottomHtml();const h=`\n      <div class="stories_author_cont">\n        ${c}\n        <div class="StoryInfo">\n          <div class="StoryInfo__top">\n            ${d}\n          </div>\n          <div class="StoryInfo__subtitle">${a}</div>\n        </div>\n      </div>`,_=(0,S.se)(`\n      <div class="stories_author_cont_wrap">\n        <div class="stories_author_inner">${h}</div>\n        <div class="stories_author_buttons"></div>\n       </div>\n    `);return this.avatarWrap=_.querySelector(".stories_author_avatar"),this.avatarPhoto=n,(0,C.addEvent)(_,"click",(e=>{(0,S.domClosestByTag)("a",e.target)&&this.layer.sendNavigationStatEvents("go_to_author")})),this.descEl=(0,S.geByClass1)("StoryInfo__subtitle",_),this.authorButtons=(0,S.geByClass1)("stories_author_buttons",_),this.storiesHeaderContent.appendChild(_),this.authorImg=_.querySelector(".stories_author_avatar"),this.storiesHeader}showFeatureTooltipIfNeed(e){window.cur.showStoriesFeatureTooltip&&!window.cur.storiesFeatureTooltip&&e&&(window.cur.storiesFeatureTooltipTimeoutId=setTimeout((()=>{const t=(0,S.se)(`\n        <div>\n          <div class="stories_feature_tt_close" onclick="window.cur.storiesFeatureTooltip.hide(); cancelEvent(event);"></div>\n          <div>${ae.getLang("intro_hint_title_stories_subscribe_hint_2")}</div>\n        </div>\n     `);(0,C.addEvent)(t,"click",(()=>{window.cur.storiesFeatureTooltip.hide()})),window.cur.storiesFeatureTooltip=new k.ElementTooltip(e,{appendToParent:!0,autoShow:!1,forceSide:"bottom",cls:"eltt_fancy stories_feature_tt",offset:[1,-2],content:t,align:"right",onHide:this.closeFeatureTooltip.bind(this)}),window.cur.storiesFeatureTooltip.show(),clearTimeout(window.cur.storiesFeatureTooltipTimeoutId)}),2e3),(0,oe.pushNavDestroy)((()=>{clearTimeout(window.cur.storiesFeatureTooltipTimeoutId)})))}getHeaderBottomHtml(){if(!this.data.author)return;const{href:e,also_subscribed:t}=this.data.author,s=this.getCurStoryData(),i=this.getCurrentNarrative();let o="",r="_self";this.layer.listName.includes("place")&&(r="_blank");let n="";const a="StoryInfoLink";if(s){if(o=s.date,s.maskOwnerDomain){const e=s.maskOwnerDomain,t=`<a href='/${e}' target='${r}' class="StoryInfo__maskLink ${a}">@${e}</a>`;n=`<span class="StoryInfo__maskInfo">${(0,T.langSex)(s.maskOwnerSex||Z.BaseSexEnumNames.UNKNOWN,ae.getLang("stories_mask_from","raw")).replace("{domain}",t)}</span><span class='dvd'></span>`}if(s.isPromo)o=s.promoCaption;else if(i)o=`<span class='dvd'></span><span>${o}</span>`,o=`${n}<a href='${e}' target='${r}' class='StoryInfo__narrativeOwnerName ${a}'>${i.ownerName}</a>${o}`;else if(s.isAds)o=ae.getLang("stories_is_ad");else if(t){(0,Y.createUserStackMaskIfNeeded)();let e="",s="",i="";t.owners.forEach((e=>{s+=`\n            <a href="${e.href}" class="StorySubscribedUsersStack__photo ${a}" title="${e.name}">\n              <img src="${e.photo_url}" class="StorySubscribedUsersStack__img" alt="">\n            </a>\n          `})),e=`<div class="StorySubscribedUsersStack__photos">${s}</div>`;const r=t.owners[0],n=`<a href="${r.href}" class="StorySubscribedUsersStack__link ${a}">${r.name}</a>`,l=t.total_count;i=1===l?(0,T.langStr)((0,T.langSex)(r.sex,ae.getLang("stories_also_subscribed_one_person","raw")),"name",n):(0,T.langStr)(ae.getLang("stories_also_subscribed_multiple_persons"),"name",n,"total_count",l-1),i=`<div class="StorySubscribedUsersStack__label">${i}</div>`,o=`<div class="StorySubscribedUsersStack">${e}${i}</div>`}else n&&(o=`${n}<span>${o}</span>`);if(s.is_authors_ads&&s.caption&&(o=`${o}<span class='dvd'></span><span>${s.caption}</span>`),(0,F.partConfigEnabled)("profile_questions_enabled")&&s.isProfileQuestion){const{icon:e}=(0,$.getIcon12Question)(),t=`<span class="StoryInfo__icon">${e}</span>${ae.getLang("stories_profile_question_label")}`;o=`${`<a href="/question?ref=story" class="StoryProfileQuestionLink ${a}" target="_blank">${t}</a>`}<span class='dvd'></span>${o}`}}return o}closeFeatureTooltip(e=!1){if(window.cur.storiesFeatureTooltip){if(window.cur.showStoriesFeatureTooltip=!1,window.cur.storiesFeatureTooltip.destroy(),window.cur.storiesFeatureTooltip=null,e&&this.playStory(),!window.cur.storiesFeatureTooltipKey)return;if((0,ce.isActsToApi2ForVKCOMViewerEnabled)())return void(0,a.ensureAccountHelpHintsService)().hideHelpHint({hintId:window.cur.storiesFeatureTooltipKey});window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:window.cur.storiesFeatureTooltipKey,hash:window.cur.storiesFeatureTooltipHash},{onDone:()=>{}})}}_renderFollowButton(){const e=this.data.author;if(!e)return;let t;return t=re.Ranges.isUserId(e.id)?(0,W.getIcon24UserAddOutline)():(0,z.getIcon24AddSquareOutline)(),this.followBtn=(0,S.ce)("div",{className:"StoryViewerHeaderButton"}),this.followBtn.innerHTML=t.icon,(0,C.addEvent)(this.followBtn,"click",this._onFollowBtnClick.bind(this)),(0,C.addEvent)(this.followBtn,"mouseover",(()=>{if(!e)return;this.closeFeatureTooltip();const t=e.can_follow?ae.getLang("stories_follow"):ae.getLang("stories_unfollow");(0,M.showTooltip)(this.followBtn,{black:1,center:1,forcetodown:!0,shift:[0,13,6],text:t,appendEl:this.contWrap})})),this.showFeatureTooltipIfNeed(this.followBtn),this.followBtn}renderActionButtons(){return this.actionButtons=document.createElement("div"),this.actionButtons.classList.add("StoryViewerHeaderButton"),this.actionButtons.setAttribute("data-testid","story_header_menu_button"),this._render((0,i.jsx)(Q.ActionsButton,{story:this}),this.actionButtons),this.actionButtons}updateActionButtons(){this.actionButtons&&this._render((0,i.jsx)(Q.ActionsButton,{story:this}),this.actionButtons)}destroyActionButton(){this.actionButtons&&(n.unmountComponentAtNode(this.actionButtons),delete this.actionButtons)}_renderTimeLine(){this.timeLineEl=(0,S.ce)("div",{className:"stories_time_line"+(this.data.items.length>50?" stories_time_line_many_items":"")}),this.timeLineEl.setAttribute("data-testid","story_time_line");const e=this.data?.author?.id,t=this.data.items[0]?.isOneTime,s=s=>{const i=(0,S.ce)("div",{className:"stories_time_line_item"});i.setAttribute("data-testid","story_time_line_item");(0,C.addEvent)(i,"click",(()=>{this.layer.sendNavigationStatEvents("go_to_story_click"),this.changeStory(s)}));const o=(0,S.ce)("div",{className:"stories_time_line_item_cont"});o.appendChild((0,S.ce)("div",{className:"stories_time_line_item_cont_active"})),i.appendChild(o),t&&window.vk.id!==e&&(i.appendChild((0,S.ce)("div",{className:"stories_time_line_item_wick"})),(0,S.addClass)(i,"stories_time_line_item_is_one_time")),this.timeLineEl.appendChild(i)};return this.data.items.forEach(((e,t)=>s(t))),this.hasMetaStory()&&s(this.data.items.length),this.timeLineEl}isPaused(){return!this.story||this.story.isPaused()}isLoaded(){return!this.story||this.story.isLoaded()}_onMouseDownHandle(e){this.pressedStory=e,this.isActive&&(this.isLocked()||((0,S.hasClass)(e,"stories_item_cont")||(0,S.hasClass)(e,"stories_item_back")||(0,S.hasClass)(e,"StoryStickers__disableArea")||e.closest(`.${ve.StickerTemplateSelectorStory}`)||(0,S.hasClass)(e,"StorySticker"))&&!this.downTs&&(this.downTs=(0,L.vkNow)(),this.longTapTimer=setTimeout(this.longTapHandle.bind(this),w.LONG_PRESS_DELAY_MS)))}_onMouseUpHandle(e,t=(()=>{})){clearTimeout(this.longTapTimer);const{downTs:s}=this;if(delete this.downTs,e!==this.pressedStory)return void(this.isPaused()&&this.layer.playStory());this.pressedStory=null;const i=(0,L.vkNow)()-s>=w.LONG_PRESS_DELAY_MS,o=i||this.isSendFormFocused||(0,S.hasClass)(this.wrapEl,"autoplay_failed");if(this.isActive&&((0,S.hasClass)(e,"stories_item_back")||(0,S.hasClass)(e,"StoryStickers__disableArea--left"))&&!o&&!this.isTooltipOpened())return this.prevStory();if(i||!(0,S.hasClass)(e,"StorySticker")&&!e.closest(`.${ve.StickerTemplateSelectorStory}`)){if((0,S.hasClass)(e,"stories_item_cont")||(0,S.hasClass)(e,"stories_item_back")||(0,S.hasClass)(e,"StoryStickers__disableArea")||(0,S.hasClass)(e,"StorySticker"))if(this.isFeedbackTooltipShow)this.hideFeedbackTooltip();else if((0,S.removeClass)(this.wrapEl,"paused"),this.isTooltipOpened())this.hideTooltip();else{if(!this.isActive){if(this.id>=this.layer.activeStory.id){let e=[];for(let t of this.layer.activeStory.data.items)e.push(t.raw_id),t.unread=!1;(0,pe.dispatchStoriesSeenEvent)([{blockId:this.layer.getBlockKey(this.layer.activeStory.data),storyRawIdSet:new Set(e)}]),this.layer.markStoriesSkipped(e)}const e=this.layer.renderedStoryBlockKeys;return e.indexOf(this.layer.getBlockKey(this.data))>e.indexOf(this.layer.blockKey)?this.layer.sendNavigationStatEvents("go_to_next_author"):this.layer.sendNavigationStatEvents("go_to_previous_author"),void this.opts.onSelect(this)}o?this.isPaused()&&this.playStory(!1,!!s):this._onPlayEnd()}}else t()}_markSeenIfNeeded(){this.isActiveStoryOneTime()&&this._markSeenCurrentStory()}_markSeenCurrentStory(){this.opts.onSeen(this.layer.activeStory)}isLocked(){return!!(this.getSendText()||!this.isActive||this.isSendFormFocused||this.isModalShown||this.isFeedbackTooltipShow||this.isFooterPanelsActive||document.hidden||this._isActionsShown()||(0,S.isVisible)(this.inlineLoader)||(0,S.hasClass)(this.wrapEl,"hiding_reply")||(0,I.curBox)()||this.isPausedByMetaScroll())}isSpaceLongTabAvailable(){return!this.isPaused()}isPausedByMetaScroll(){if(this.story instanceof V.MetaStory)return this.story.isPausedByMetaScroll}isPausedByFooterScroll(){if(this.story instanceof V.MetaStory)return this.story.isPausedByMetaScroll}autoResumeStory(e=!1){this.audioPlaying||this.isTooltipOpened()||this.playStory(!1,e)}changeStory(e){this.index===e||this.isSendFormFocused||(this._destroyStory(),this.index=e,this.hideTooltip(),this._setPreview(),this.playStory())}getWrap(){return this.wrapEl}stop(){this._destroyFeedBackTT(),this.isActive=!1,this._destroyStory(),this._stopLoader(),(0,S.val)((0,S.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),(0,S.removeClass)(this.wrapEl,"autoplay_failed")}getCurStoryData(){const e=this.data.items[this.index],t=this.isActiveMetaStory();return e||t||(0,R.logError)(new Error("getCurStoryData: data is undefined"),{environment:"stories"}),e}isActiveMetaStory(){return!!this.hasMetaStory()&&(!(!this.hasUnloadedMetaStory()||this.data.items.length)||this.data.grouped?.length&&this.getFullItemsLength()-1===this.index)}hasMetaStory(){return this.data.type===o.StoryBlockType.discover||this.data.type===o.StoryBlockType.appGroupedStories}hasUnloadedMetaStory(){return this.hasMetaStory()&&!this.data.grouped?.length}getCurrentNarrative(){return this.data.narrative}isActiveLive(){return"live"===this.getCurStoryData()?.type}isBestFriends(){return(0,F.partConfigEnabled)("stories_web_best_friends")&&this.getCurStoryData()?.is_best_friends_privacy}isLiveEnded(){return!!this.story&&(this.isActiveLive()&&this.story.liveEnded)}_initStory(){const e=this.getCurStoryData(),t=this.getCurrentNarrative(),s=this.isActiveMetaStory();if(!e&&!s)return void(0,R.logError)(new Error("Fail: _initStory"),{environment:"stories"});const r={onLoadingStart:this._onLoadingStart.bind(this),onLoadingEnd:this._onLoadingEnd.bind(this),onPlay:this._onPlay.bind(this),onPause:this._onPause.bind(this),onError:this._showError.bind(this),toggleMetaStoryTitle:this.toggleMetaStoryTitle,onLongLoading:this._showLoader.bind(this),onAutoPlayFail:this._onAutoPlayFail.bind(this),play:this.playStory,pause:this.pauseStory,playPrevStory:this.prevStory,playNextStory:this.nextStory,onLongTap:this.longTapHandle};if(e){const{type:s,noSound:o}=e;let n;if(this.story&&this._destroyStory(),(0,v.onPlayerChange)(this),Object.assign(e,{authorId:this.getOwnerId()}),"live"===s?n=new u.default(e,r,this.wrapEl):("video"===s?(n=new p.default(e,r,t),o&&this.opts.restoreAudioPlay(),(0,S.addClass)(this.wrapEl,"video")):(n=new m.default(e,r,t),this.opts.restoreAudioPlay(),(0,S.removeClass)(this.wrapEl,"video")),this.descEl&&(this.descEl.innerHTML=this.getHeaderBottomHtml()||"",this.initProfileQuestionTooltipIfNeeded()),this.fillTimeLine()),this.story=n,"live"===s||"video"===s){(0,Y.getVolume)()>0&&this.opts.onVideoPlay()}if((0,S.toggleClass)(this.wrapEl,"stories_can_comment",e.can_comment),this.data?.author?.can_follow&&!this.isActiveLive()){const e=this._renderFollowButton();e&&this.authorButtons?.appendChild(e)}const a=this.renderActionButtons();if(this.authorButtons?.appendChild(a),this._destroyFeedBackTT(),this.updateBottom(),e.clickable_stickers&&this.data.author){const t=e.clickable_stickers?.stickers||[],s=t.filter((e=>w.dynamicStickerIds.includes(e.type)))||[],o=t?.filter((e=>w.staticStickerIds.includes(e.type)))||[];(s.length||o.length)&&this._render((0,i.jsx)(h.StoryStickers,{ref:e=>{e&&(this.stickerLayers=e)},story:n,storyData:e,author:this.data.author,showMessage:this.showMessage.bind(this),playStory:this.playStory.bind(this),pauseStory:this.pauseStory.bind(this),hideFeedbackTooltip:this.hideFeedbackTooltip.bind(this),onModalShownChange:this._onModalsShownChange.bind(this),onMouseUpHandle:this._onMouseUpHandle.bind(this),onMouseDownHandle:this._onMouseDownHandle.bind(this),sendNavigationStatEvents:this.layer.sendNavigationStatEvents.bind(this.layer),markAppNotificationsSeen:this.markAppNotificationsSeen,list:this.layer.listName,layerEl:this.layer.layerEl,el:this.contWrap}),this.contStickers)}}else if(this.hasMetaStory()){this._destroyFeedBackTT();let e="";this.data.type===o.StoryBlockType.discover?(this.story=new q.DiscoverMetaStory(this.data,r),e=ae.getLang("stories_interesting_stories")):(this.story=new K.AppsMetaStory(this.data,r),(0,S.setStyle)((0,S.geByClass1)("stories_preview",this.contWrap),{backgroundImage:""})),e&&(this.metaStoryTitle=(0,S.ce)("div",{className:"MetaStoryTitle MetaStoryTitle--hide",innerHTML:e}),this.storiesHeaderContent.appendChild(this.metaStoryTitle)),(0,S.re)((0,S.geByClass1)("stories_photo",this.contWrap)),(0,S.re)((0,S.geByClass1)("stories_video",this.contWrap)),this.fillTimeLine()}this.opts.onStartStory(),this.contWrap.appendChild(this.story.render())}hasSticker(e){const t=this.getCurStoryData();if(!t||!t.clickable_stickers)return!1;const{stickers:s}=t.clickable_stickers;return!!Array.isArray(s)&&s.some((t=>t.type===e))}getSticker(e){const t=this.getCurStoryData();if(!t||!t.clickable_stickers)return;const{stickers:s}=t.clickable_stickers;return Array.isArray(s)?s.find((t=>t.type===e)):void 0}isTooltipOpened(){return this.stickerLayers&&this.stickerLayers.isShownTooltip()}hideTooltip(e=!1){this.isTooltipOpened()&&(this.stickerLayers&&this.stickerLayers.hideTooltip(),e||this.playStory())}getReplies(){if(this.story instanceof H.MediaStory)return this.story&&this.story.getReplies()}getViews(){if(this.story instanceof H.MediaStory)return this.story&&this.story.getViews()}setReplies(e){if(this.story instanceof H.MediaStory)return this.story&&this.story.setReplies(e)}setViews(e){if(this.story instanceof H.MediaStory)return this.story&&this.story.setViews(e)}indexToUnread(e=!1){const{items:t}=this.data;let s=null;for(let e in t)if(t[e].unread&&!this.layer._hasContext("all")){s=Number(e);break}if(null==s&&this.data.grouped?.some((e=>e.items.some((e=>e.unread))))&&(s=this.getFullItemsLength()-1),null==s&&(s=0),e)return s;this.index=s,this._setPreview()}indexToStoryById(e){const{items:t}=this.data;let s=-1;for(let i in t)if(t[i].raw_id===e){s=Number(i);break}this.layer._hasContext("all")&&(s=0),s>-1?(this.index=s,this._setPreview()):this.indexToUnread()}fillTimeLine(){const{timeLineEl:e}=this;if(e&&this.data.type!==o.StoryBlockType.discover)for(let t=0;t<e.children.length;t++){const s=(0,S.geByClass1)("stories_time_line_item_cont_active",e.children[t]);t===this.index&&(this._currentTimeLineEl=s,this._currentTimeLineAdditionalEl=(0,S.geByClass1)("stories_time_line_item_wick",e.children[t]));const i=t<this.index?100:0;(0,S.setStyle)(s,"transform",`translateX(${i}%)`)}}_destroyStory(){if(!this.story)return;const e=this.getCurStoryData();this.isFooterPanelsActive=!1,this.needHideSentReactions&&(this.needHideSentReactions=!1,e?.new_reactions&&delete e.new_reactions),this.updateBottom(!0),window.tooltips&&window.tooltips.hideAll(),this.hideTooltip(),this.destroyProfileQuestionTooltipIfNeeded(),this._resetErrors(),this._destroyFeedBackTT(),this.closeFeatureTooltip(!1),this.story.pause(),e&&e.clickable_stickers&&(n.unmountComponentAtNode(this.contStickers),this.stickerLayers=null),cancelAnimationFrame(this.timeLineAnim);try{this.story instanceof H.MediaStory&&this.contWrap.removeChild(this.story.getContainer()),this.story.destroy()}catch(e){(0,R.logError)(e)}this._replyHideEnd(),(0,C.removeEvent)(this.followBtn),this.authorButtons&&(this.authorButtons.innerHTML=""),this.metaStoryTitle?.remove(),(0,C.removeEvent)(this.answersEl),this.hideInlineLoader(),this.destroyActionButton(),delete this.story}_timeLineUpdate(){const{story:e}=this;if(!e||e.isPaused()||this.isActiveLive()||this.data.type===o.StoryBlockType.discover)return;const t=this.getStoryProgressPercent(),s=t/100;if((0,S.setStyle)(this._currentTimeLineEl,"transform",`translateX(${t}%) translateZ(0)`),this._currentTimeLineAdditionalEl&&this._currentTimeLineEl){const e=this._currentTimeLineEl.clientWidth*s;(0,S.setStyle)(this._currentTimeLineAdditionalEl,"transform",`translateX(${e}px) translateZ(0)`)}t<100?this.timeLineAnim=requestAnimationFrame(this._timeLineUpdate.bind(this)):this._onPlayEnd(!0)}getStoryProgressPercent(){if(!this.story)return 0;const e=this.story.getCurrentTime(),t=this.story.getDuration();return Math.max(0,Math.min(100,e/t*100))}_onLoadingStart(){this._loadingStartTime=+new Date}_onLoadingEnd(){const e=this.getRawId();e&&this._loadingStartTime&&(this.loadingTime=+Date.now()-this._loadingStartTime,this.layer.sendViewerStartTime(e,this.loadingTime),this._loadingStartTime=0)}_onPlay(){this._resetErrors(),this._stopLoader(),this._timeLineUpdate(),this.preloadNextStory(),this.opts.onPlayStory(),(0,S.removeClass)(this.wrapEl,"animate_story"),(0,S.removeClass)(this.wrapEl,"autoplay_failed");const e=this.data.items[this.getIndex()];e&&(e.unread=!1,(0,pe.dispatchStoriesSeenEvent)([{blockId:this.layer.getBlockKey(this.data),storyRawIdSet:new Set([e.raw_id])}])),this._updateFeedStoryPreview(),(0,v.onPlayerChange)(this)}_onPause(){cancelAnimationFrame(this.timeLineAnim),(0,v.onPlayerChange)(this)}_onPlayEnd(e=!1){this._markSeenIfNeeded(),this.nextStory(e)}getOffsetLeft(){return this.wrapEl.offsetLeft+this.wrapEl.offsetWidth/2}getWidth(){return this.wrapEl.offsetWidth}removeStoryBox(){const e=this.getCurStoryData();if(!e)return void(0,R.logError)(new Error("Fail: removeStoryBox"),{environment:"stories"});const t=e.isPartOfNarrative?ae.getLang("stories_remove_from_narrative_warning"):ae.getLang("stories_remove_warning");this.hideFeedbackTooltip(),this.pauseStory();const s=(0,x.showFastBox)({title:ae.getLang("global_warning")},t,ae.getLang("stories_remove_confirm"),this.removeStory.bind(this),ae.getLang("global_cancel"),(()=>{s.hide(),this.playStory()}))}removeStoryFromNarrative(){const e=this.getCurStoryData();if(!e)return void(0,R.logError)(new Error("Fail: removeStoryFromNarrative"),{environment:"stories"});const t=ae.getLang("stories_remove_only_from_narrative_warning");this.hideFeedbackTooltip(),this.pauseStory();const s=(0,x.showFastBox)({title:ae.getLang("global_warning")},t,ae.getLang("stories_remove_confirm"),(t=>{const s=this.getCurrentNarrative();if(!s)return;const i=this.getIndex();s.stories=s.stories.filter((t=>t.rawId!==e.raw_id)),(0,E.lockButton)(t),this.editNarrativeRequest(s).then((()=>{const t=(0,I.curBox)();t&&t.hide(),s.storiesCount=s.stories.length,this._popStoryAndClearList(i),this.updateNarrativeBlockIfNeeded(),this.layer.sendNavigationStatEvents("delete_from_narrative"),window?.StoriesManage?.removeRaw(e.raw_id)})).catch((()=>{const e=(0,I.curBox)();e&&e.hide(),(0,R.logError)(new Error("Fail: removeStoryFromNarrative"),{environment:"stories"})}))}),ae.getLang("global_cancel"),(()=>{s.hide(),this.playStory()}))}removeStory(e){this.pauseStory();const t=this.getIndex(),s=this.getRawId(),i=this.getItems()[t],o=e=>{this.layer.sendNavigationStatEvents("delete"),(0,I.curBox)()?.hide(),this._popStoryAndClearList(t),1!==this.layer.renderedStoryList.length||this.layer.renderedStoryList[0]||this.opts.removeCurrentList(),this.updateNarrativeBlockIfNeeded(),"profile"===window.cur.module&&window.Profile?.updateStories(),window?.removeStoryFromStoriesArchive?.(s),window?.StoriesManage?.removeRaw(s,e)},r=()=>((0,I.curBox)()?.hide(),(0,x.showFastBox)({title:ae.getLang("global_error"),onHide:()=>{this.playStory()}},ae.getLang("global_unknown_error")),!0);if((0,ce.isActsToApi2ForVKCOMViewerEnabled)())return(0,E.lockButton)(e),void de.storiesService.deleteFx({owner_id:this.getOwnerId(),story_id:this.getStoryId()}).then((()=>{const e=(0,Y.getGroupStoryManageRemoveData)(i);o(e)}),r).finally((()=>{(0,E.unlockButton)(e)}));const n={act:"remove_story",story_raw:s,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash};(0,A.isClaimContent)()&&(n.claim=window.nav.objLoc.claim),window.ajax.post("al_stories.php",n,{onDone:o,onFail:r,showProgress:()=>(0,E.lockButton)(e),hideProgress:()=>(0,E.unlockButton)(e)})}removeNarrativeBox(){this.hideFeedbackTooltip(),this.pauseStory();const e=(0,x.showFastBox)({title:ae.getLang("global_warning")},ae.getLang("stories_narrative_remove_warning"),ae.getLang("stories_remove_confirm"),this.removeNarrative.bind(this),ae.getLang("global_cancel"),(()=>{e.hide(),this.playStory()}))}removeNarrative(e){this.pauseStory();const t=this.getCurrentNarrative(),s=this.getItems()[this.getIndex()];if(!t)return void(0,R.logError)(new Error("Fail: removeNarrative"),{environment:"stories"});const{ownerId:i,id:o}=t,r=(0,l.joinRawId)({ownerId:i,itemId:o}),n=e=>{(0,I.curBox)()?.hide(),this.opts.removeCurrentList(),this.remove(),this.updateNarrativeBlockIfNeeded(),this.opts.afterNarrativeRemoved?.(),window?.StoriesManage?.removeRaw(r,e)},a=()=>((0,I.curBox)()?.hide(),(0,x.showFastBox)({title:ae.getLang("global_error"),onHide:()=>{this.playStory()}},ae.getLang("global_unknown_error")),!0);if((0,ce.isActsToApi2ForVKCOMViewerEnabled)())return(0,E.lockButton)(e),void de.narrativesService.deleteFx({owner_id:i,narrative_id:o}).then((()=>{const e=(0,Y.getGroupStoryManageRemoveData)(s);n(e)}),a).finally((()=>{(0,E.unlockButton)(e)}));window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:r,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash},{onDone:e=>{(0,I.curBox)()?.hide(),this.opts.removeCurrentList(),this.remove(),this.updateNarrativeBlockIfNeeded(),this.opts.afterNarrativeRemoved?.(),window?.StoriesManage?.removeRaw(r,e)},onFail:e=>((0,I.curBox)()?.hide(),(0,x.showFastBox)({title:ae.getLang("global_error"),onHide:()=>{this.playStory()}},e||ae.getLang("global_unknown_error")),!0),showProgress:()=>(0,E.lockButton)(e),hideProgress:()=>(0,E.unlockButton)(e)})}removeStoryWithReason(){const e=this.getIndex(),t=this.getRawId();this.layer.sendNavigationStatEvents("delete"),(0,I.curBox)()?.hide(),this._popStoryAndClearList(e),1!==this.layer.renderedStoryList.length||this.layer.renderedStoryList[0]||this.opts.removeCurrentList(),this.updateNarrativeBlockIfNeeded(),"profile"===window.cur.module&&window.Profile?.updateStories(),window?.removeStoryFromStoriesArchive?.(t),window?.StoriesManage?.removeRaw(t)}removeStoryWithReasonBox(){const e=this.getOwnerId(),t=this.getStoryId();e&&t&&(0,ge.showMessageBoxModal)((s=>(0,i.jsx)(me.StrikeForbidObjectForm,{...s,objectOwnerId:e,objectId:t,objectType:11,story:this})))}hideDiscover(){this.pauseStory(),(0,x.showFastBox)({title:ae.getLang("stories_discover_hiding_title"),onHide:()=>{this.playStory()}},ae.getLang("stories_discover_hiding_warning").replace("{link}",'<a href="/settings" target="_blank">').replace("{/link}","</a>"),ae.getLang("stories_add_blacklist_button"),(e=>{(0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?((0,E.lockButton)(e),de.storiesService.setDiscoverVisibleFx({is_discover_visible:0}).then((()=>{const e=(0,I.curBox)();e&&e.hide(),this.layer.sendNavigationStatEvents("hide_discover");const t=c.getPrevLayer();t?.activeStory?.data?.type===o.StoryBlockType.discover&&t?.activeStory?.remove(!0,(()=>{(0,I.showDoneBox)(ae.getLang("stories_discover_hidden_text"))})),c.hideAllLayers(!0)})).finally((()=>{(0,E.unlockButton)(e)}))):window.ajax.post("al_settings.php",{act:"toggle_story_discover_visible",hash:this.data.discover_hide_hash,enabled:0},{onDone:()=>{const e=(0,I.curBox)();e&&e.hide(),this.layer.sendNavigationStatEvents("hide_discover");const t=c.getPrevLayer();t?.activeStory?.data?.type===o.StoryBlockType.discover&&t?.activeStory?.remove(!0,(()=>{(0,I.showDoneBox)(ae.getLang("stories_discover_hidden_text"))})),c.hideAllLayers(!0)},showProgress:()=>(0,E.lockButton)(e),hideProgress:()=>(0,E.unlockButton)(e)})}),ae.getLang("global_cancel"))}sendNarrativeBookmarkButtonDidPress(){const e=this.getCurrentNarrative();if(e)if((0,ce.isActsToApiFirstForVKCOMViewerEnabled)()){(()=>e.isBookmarked?de.faveService.removeNarrativeFx({owner_id:e.ownerId,narrative_id:e.id}):de.faveService.addNarrativeFx({owner_id:e.ownerId,narrative_id:e.id}))().then((()=>{(0,I.showDoneBox)(e.isBookmarked?ae.getLang("stories_narrative_bookmark_deleted"):(0,ae.langTag)('<a href="/bookmarks">',"</a>",ae.getLang("stories_narrative_bookmark_added"),"link"),{className:"stories_done_msg"}),e.isBookmarked||(0,j.sendNarrativeAnalytic)(j.NarrativeAnalyticEventType.addToBookmarks,e,j.NarrativeAnalyticNavScreen.storyViewer),e.isBookmarked=!e.isBookmarked,this.updateBottom(),this.updateActionButtons()}))}else window.ajax.post("al_bookmarks.php",{act:"bookmark",owner_id:e.ownerId,object_id:e.id,type:"narrative",state:e.isBookmarked?1:0,hash:e.bookmarkHash,ref:window.cur.module},{onDone:()=>{(0,I.showDoneBox)(e.isBookmarked?ae.getLang("stories_narrative_bookmark_deleted"):(0,ae.langTag)('<a href="/bookmarks">',"</a>",ae.getLang("stories_narrative_bookmark_added"),"link"),{className:"stories_done_msg"}),e.isBookmarked||(0,j.sendNarrativeAnalytic)(j.NarrativeAnalyticEventType.addToBookmarks,e,j.NarrativeAnalyticNavScreen.storyViewer),e.isBookmarked=!e.isBookmarked,this.updateBottom()}});else(0,R.logError)(new Error("Fail: sendNarrativeBookmarkButtonDidPress"),{environment:"stories"})}sendNarrativeEditButtonDidPress(){const e=this.getCurrentNarrative();if(!this.data.author)return;const t=this.data.author.id,s=this.data.author.href;e?((0,j.sendNarrativeAnalytic)(j.NarrativeAnalyticEventType.clickToEditNarrative,e,j.NarrativeAnalyticNavScreen.storyViewer),re.Ranges.isUserId(t)?this.editCurrentNarrative():window.nav.go(`${s}?act=narrative_edit&nid=${e.id}`)):(0,R.logError)(new Error("Fail: sendNarrativeEditButtonDidPress"),{environment:"stories"})}editNarrativeRequest(e){const{id:t,ownerId:s,editHash:i,title:o,stories:r,coverStoryRawId:n}=e;let a;return n&&([,a]=n?.split("_")),new Promise(((e,n)=>{(0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?de.narrativesService.editFx({owner_id:s,narrative_id:t,title:o,story_ids:(0,O.prepareStoriesForPublishing)(r),cover_story_id:Number(a)}).then((()=>{e()})).catch((e=>{(0,I.curBox)()?.hide(),(0,x.showFastBox)({title:ae.getLang("global_error"),onHide:()=>{n(),this.playStory()}},e||ae.getLang("global_unknown_error"))})):window.ajax.post("al_stories.php",{act:"edit_narrative",owner_id:s,title:o,cover_story_id:a,hash:i,story_ids:(0,O.prepareStoriesForPublishing)(r),narrative_id:t},{onDone:()=>{e()},onFail:e=>((0,I.curBox)()?.hide(),(0,x.showFastBox)({title:ae.getLang("global_error"),onHide:()=>{n(),this.playStory()}},e||ae.getLang("global_unknown_error")),!0)})}))}_popStoryAndClearList(e){if(this._removeStoryFromMemoryByIndex(e),0===this.data.items.length){const e=this.getOwnerId();e&&c.onReplyDeleted(e)}}_removeStoryFromMemoryByIndex(e,t=!1){if(!this.data.items[e])return;this.data.items.splice(e,1);const s=this.getFullItemsLength();s?(this._initTimeLine(),s>e?this.isActive&&this.playStory(!0):this.isActive&&this.nextStory()):this.remove(t)}remove(e,t){this.opts.onStoryBlockRemoved?.(e,t)}shareBox(){if(!(this.story instanceof H.MediaStory))return;if(!this.getCurStoryData())return void(0,R.logError)(new Error("Fail: shareBox"),{environment:"stories"});const e=this.getCurrentNarrative();let t;t=e?`narrative${e.rawId}`:`story${this.story.getId()}`,this.pauseStory(),(0,x.showBox)("like.php",{act:"publish_box",object:t,from:"wkview"},{onDone:()=>{this.autoResumeStory()},params:{onHide:()=>{this.autoResumeStory()}}})}toggleLikeStory(){if(!(this.story instanceof H.MediaStory))return;const{data:e}=this.story,{isLiked:t,likeHash:s,owner_id:i}=e;if(e.isLiked=!t,this.updateBottom(),(0,ce.isActsToApiFirstForVKCOMViewerEnabled)()){const s={type:"story",owner_id:i,item_id:this.getStoryId()};(()=>t?(0,X.api)("likes.delete",s):(0,X.api)("likes.add",s))().then((()=>{this.layer.sendNavigationStatEvents(t?"click_to_unlike":"click_to_like")})).catch((()=>{e.isLiked=t,this.updateBottom()}))}else{const i=this.getRawId(),o={act:t?"delete_like":"like",hash:s,story_raw_id:i};window.ajax.post("al_stories.php",o,{onDone:()=>{this.layer.sendNavigationStatEvents(t?"click_to_unlike":"click_to_like")},onFail:()=>(e.isLiked=t,this.updateBottom(),!0)})}}onAnswerSend(e,t=[],s={},i={}){const o=this.getSendText();if(!(this.story instanceof H.MediaStory))return;if(!o&&!t.length||!this.story)return;if(this.isActiveLive())return void this.story.sendMessage(o,e);const r=this.getCurrentNarrative();if((0,ce.isActsToApi2ForVKCOMViewerEnabled)()){const n=s.sticker_referrer??void 0;let a=t.find((e=>"sticker"===e[0]))?.[1],l="";return l=r?`narrative${r.ownerId}_${r.id}`:`story${this.getRawId()}`,null!=a&&(a=Number(a)),this.sendFormButton&&(this.sendFormButton.innerHTML=this._getLoaderHtml(),this.sendFormButton.classList.add("sending")),void(0,he.apiMessagesSend)({entrypoint:"stories_comment",attachment:l,random_id:(0,_e.random)(),peer_id:this.getOwnerId(),message:o,sticker_id:a??void 0,sticker_referrer:n}).then((()=>{this.onAnswerSent(e,s,i)}),(()=>{this.showMessage(ae.getLang("global_unknown_error")).catch((e=>{(0,R.logError)(e)}))})).finally((()=>{this.sendFormButton&&(this.sendFormButton.innerHTML="",this.sendFormButton.classList.remove("sending"))}))}r?t.push(["narrative",`${r.ownerId}_${r.id}`]):t.push(["story",this.story.getId()]),window.ajax.post("al_im.php",Object.assign({act:"a_send",msg:o,hash:this.data.send_hash,media:(0,B.convertAttachesToPhpMedia)(t),entrypoint:"stories_comment",to:this.getOwnerId()},s),{onDone:()=>{this.onAnswerSent(e,s,i)},onFail:e=>(this.showMessage(e).catch((e=>{(0,R.logError)(e)})),!0),showProgress:()=>{(0,S.val)(this.sendFormButton,this._getLoaderHtml()),(0,S.addClass)(this.sendFormButton,"sending")},hideProgress:()=>{(0,S.val)(this.sendFormButton,""),(0,S.removeClass)(this.sendFormButton,"sending")}})}onAnswerSent(e=(()=>{}),t={},s={}){if(!this.isActiveLive()){this.showMessage(ae.getLang("stories_answer_sent")).then((()=>{this.playStory()})).catch((e=>{(0,R.logError)(e)}));const e=t.sticker_referrer||"",i={};let o="";"story_keyboard"===e?o="sticker_keyboard_send":e.startsWith("story_suggestion_")?o="sticker_suggestion_send":"story_reaction"===e?(o="sticker_reaction_send",i.reaction_name=s.reactionName):o="comment_send",this.layer.sendNavigationStatEvents(o,!0,i)}(0,S.val)((0,S.geByClass1)("stories_send_form_text",this.wrapEl),""),(0,b.cancelStackPop)(),this.pauseStory(),e&&e()}onSendFormFocus(){this.pauseStory(),this.isActiveLive()||this._toggleSendFormOverlay(!0),this.hideTooltip(!0),this.hideFeedbackTooltip(),(0,b.cancelStackPush)("stories_form_focus",(()=>{f.Emoji.shown||(this.resetSendForm(),this._blurSendForm())}))}_toggleSendFormOverlay(e=!1){this.isSendFormFocused=e}toggleFooterPanelsActive(e){this.isFooterPanelsActive=e,e&&this.toggleFeedbackTooltip(!1),e&&this.pauseStory(),e||this.playStory()}_blurSendForm(){const e=(0,S.geByClass1)("stories_send_form_text",this.wrapEl);e&&e.blur()}getSendText(){const e=f.Emoji.editableVal((0,S.geByClass1)("stories_send_form_text",this.wrapEl));return(0,L.trim)(e)}onSendFormBlur(){const e=this.getSendText();this.isActiveLive()||this._toggleSendFormOverlay(!1),e||this.resetSendForm()}_unlockSendForm(){this.isSendFormFocused&&(this.isSendFormFocused=!1)}resetSendForm(){(0,S.val)((0,S.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),this.playStory()}_getLoaderHtml(){return'<svg class="stories_view_loader_circular" viewBox="25 25 50 50">\n      <circle class="stories_view_loader_circular_path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>\n    </svg>'}preloadNextStory(e=this.index+1){if(this.preloadedStories[e])return;const t=this.data.items[e];if(!t)return;this.preloadedStories[e]=!0;const s="video"===t.type?t.video_url:t.photo_url;s&&("video"===t.type?(0,d.default)(s,t.type).catch((e=>(0,R.logError)(e))):(0,d.loadMedia)(s).catch((e=>(0,R.logError)(e))))}addToBlacklist(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory();const e=this.getOwnerId();e&&(0,x.showFastBox)({title:ae.getLang("stories_add_blacklist_title"),onHide:()=>{window.cur.storyLayer&&window.cur.storyLayer.playStory()}},re.Ranges.isGroupId(e)?ae.getLang("stories_add_blacklist_message_group"):ae.getLang("stories_add_blacklist_message"),ae.getLang("stories_add_blacklist_button"),this._doAddToBlacklist.bind(this),ae.getLang("global_cancel"))}_doAddToBlacklist(e){(0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?((0,E.lockButton)(e),de.storiesService.banOwnerFx({owners_ids:String(this.getOwnerId()),track_code:this.getTrackCode()}).then((()=>{this.data.can_blacklist=!1,this.layer.sendNavigationStatEvents("hide_from_stories"),(0,I.curBox)()?.hide(),this.opts.removeCurrentList(),this.remove()})).finally((()=>{(0,E.unlockButton)(e)}))):window.ajax.post("al_stories.php",{act:"blacklist_add",owner_id:this.getOwnerId(),hash:this.data.blacklist_hash,source_story:this.getRawId(),track_code:this.getTrackCode()},{onDone:()=>{this.data.can_blacklist=!1,this.layer.sendNavigationStatEvents("hide_from_stories"),(0,I.curBox)()?.hide(),this.opts.removeCurrentList(),this.remove()},showProgress:()=>(0,E.lockButton)(e),hideProgress:()=>(0,E.unlockButton)(e)})}markNotInterested(){const e=this.getCurStoryData();if(e)if(e.isAds){let t="";const s=e.track_code,i=(0,x.showBox)("reports.php",{act:"hide_ad_box",track_code:s,type:"story"},{onDone(){const e=(0,S.geByClass)("radiobtn","ad_hide");window.radioBtns.ad_hide={val:0,els:e};const s=(0,S.ge)("ad_csrf");t=s?s.value:t},params:{onClean:()=>{delete window.radioBtns.ad_hide,this.playStory()}},stat:["reports.css"]});i.removeButtons(),i.addButton(ae.getLang("box_send"),(o=>{(0,E.lockButton)(o),window.ajax.post("reports.php",{act:"hide_ad",track_code:s,reason_id:window.radioBtns.ad_hide.val,hash:t},{onDone:()=>{(0,E.unlockButton)(o),i.hide(),this._markNotInterested(e.track_code,e.canMarkNotInterestedHash)}})})),i.addButton(ae.getLang("global_cancel"),!1,"no")}else this._markNotInterested(e.track_code,e.canMarkNotInterestedHash);else(0,R.logError)(new Error("Fail: markNotInterested"),{environment:"stories"})}_markNotInterested(e,t){this.showMessage(ae.getLang("stories_thanks_feedback")).catch((e=>{(0,R.logError)(e)})),(0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?de.storiesService.markNotInterestedFx({owner_id:this.getOwnerId(),story_id:this.getStoryId(),track_code:e}).then((()=>{this.layer.sendNavigationStatEvents("mark_not_interested")})):window.ajax.post("al_stories.php",{act:"mark_not_interested",story_raw_id:this.getRawId(),track_code:e,hash:t},{onDone:()=>{this.layer.sendNavigationStatEvents("mark_not_interested")}})}_resetErrors(){const e=(0,S.geByClass1)("stories_error_wrap",this.contWrap);e&&((0,C.removeEvent)((0,S.geByClass1)("stories_error_button",e)),(0,S.re)(e)),(0,S.removeClass)(this.wrapEl,"failed"),(0,S.removeClass)(this.wrapEl,"fatal_error")}_showError(e){if(!this.contWrap)return;const t=e;let s,i;switch(e){case"load":s=ae.getLang("stories_error_cant_load"),i=(0,S.ce)("div",{className:"stories_error_button",innerHTML:ae.getLang("stories_try_again")}),(0,C.addEvent)(i,"click",(()=>{this._destroyStory(),this.playStory()}));break;case"expired":s=ae.getLang("stories_error_expired");break;case"deleted":s=ae.getLang("stories_error_deleted");break;case"private":s=ae.getLang("stories_error_private");break;case"deleted-narrative":s=ae.getLang("stories_error_deleted_narrative");break;case"private-narrative":s=ae.getLang("stories_error_private_narrative");break;case"isOneTimeSeen":s=ae.getLang("stories_error_one_time_seen");break;default:s=ae.getLang("global_unknown_error")}this._resetErrors(),this._stopLoader();const o=(0,S.ce)("div",{className:"stories_error_wrap"}),r=(0,S.ce)("div",{className:"stories_error"}),n=(0,S.ce)("div",{className:"stories_error_cont"});r.appendChild(n),n.appendChild((0,S.ce)("div",{className:"stories_error_icon "+t})),n.appendChild((0,S.ce)("div",{className:"stories_error_caption",innerHTML:s})),i&&n.appendChild(i),o.appendChild(r),this.contWrap.appendChild(o),(0,S.addClass)(this.wrapEl,"failed"),(0,L.inArray)(e,["expired","deleted","private","deleted-narrative","private-narrative"])&&(0,S.addClass)(this.wrapEl,"fatal_error")}_stopLoader(){setTimeout((()=>{(0,S.re)((0,S.geByClass1)("stories_loader",this.contWrap))}),0)}_showLoader(){if(this._stopLoader(),!this.isActive||this.isLoaded()&&!this.isPaused()||!this.contWrap)return;const e=(0,S.ce)("div",{className:"stories_loader",innerHTML:this._getLoaderHtml()});this.contWrap.appendChild(e)}_onFollowBtnClick(){if(this.pauseStory(),this.followBtnLock)return;if(this.followBtnLock=!0,!this.data.author)return;const e=this.data.author.id;if((0,ce.isActsToApiFirstForVKCOMViewerEnabled)()){this.showInlineLoader();(()=>re.Ranges.isUserIdTransitional(e)?this.data.author?.can_follow?de.storiesService.friendsAddFx({query:{user_id:e,source:"stories"}}):de.storiesService.friendsDeleteFx({query:{user_id:e}}):this.data.author?.can_follow?de.storiesService.groupsJoinFx({query:{group_id:-e,source:"stories"}}):de.storiesService.groupsLeaveFx({query:{group_id:-e}}))().then((()=>{if(this.data.author){if(this.data.author.can_follow=!this.data.author.can_follow,this.data.author.can_follow){const e=(0,W.getIcon24UserAddOutline)();this.followBtn.innerHTML=e.icon}else{const e=(0,G.getIcon24UserAddedOutline)();this.followBtn.innerHTML=e.icon,this.layer.listName===o.StoryListName.discover&&this.layer.sendNavigationStatEvents("add_to_friends")}this.showMessage(this.data.author.can_follow?ae.getLang("stories_unfollowed"):ae.getLang("stories_followed")).then((()=>this.playStory())).catch((e=>{(0,R.logError)(e)})),window.tooltips&&window.tooltips.destroy(this.followBtn),(0,C.triggerEvent)(this.followBtn,"mouseover")}})).finally((()=>{this.hideInlineLoader(),this.followBtnLock=!1}))}else{let t,s;const i=re.Ranges.isUserIdTransitional(e);i?(s="al_friends",t=this.data.author.can_follow?"add":"remove"):(s="al_groups",t=this.data.author.can_follow?"a_enter":"a_leave"),window.ajax.post(`${s}.php`,{act:t,mid:e,gid:-e,hash:this.data.author.hash,from:"stories"},{onDone:()=>{if(this.data.author){if(this.data.author.can_follow&&(this.sendStatEvent("follow"),i||(0,y.trackTmrGroupsJoin)()),this.data.author.can_follow=!this.data.author.can_follow,this.data.author.can_follow){const e=(0,W.getIcon24UserAddOutline)();this.followBtn.innerHTML=e.icon}else{const e=(0,G.getIcon24UserAddedOutline)();this.followBtn.innerHTML=e.icon,this.layer.listName===o.StoryListName.discover&&this.layer.sendNavigationStatEvents("add_to_friends")}this.showMessage(this.data.author.can_follow?ae.getLang("stories_unfollowed"):ae.getLang("stories_followed")).then((()=>this.playStory())).catch((e=>{(0,R.logError)(e)})),window.tooltips&&window.tooltips.destroy(this.followBtn),(0,C.triggerEvent)(this.followBtn,"mouseover")}},showProgress:()=>this.showInlineLoader(),hideProgress:()=>{this.hideInlineLoader(),this.followBtnLock=!1}})}}markAsActive(){this.isActive=!0,(0,S.addClass)(this.wrapEl,"animate_story")}_destroyFeedBackTT(){delete this.feedback,this.hideFeedbackTooltip()}hideFeedbackTooltip(e=!0){this.isFeedbackTooltipShow&&(this.isFeedbackTooltipShow=!1,this.autoResumeStory(),this.updateBottom(),e&&(0,b.cancelStackPop)())}showFeedbackTooltip(){const e=this.getCurStoryData();e?this.isFeedbackTooltipShow||(this.needHideSentReactions=Boolean(e.new_reactions),this.hideTooltip(),this.pauseStory(),this.isFeedbackTooltipShow=!0,this.updateBottom(),this.layer.sendNavigationStatEvents("open_replies_list"),(0,b.cancelStackPush)("stories_feedback_tt",(e=>{this.hideFeedbackTooltip(!1),e?.isCloseBtnClick&&(0,b.cancelStackPop)(e)}))):(0,R.logError)(new Error("Fail: showFeedbackTooltip"),{environment:"stories"})}initProfileQuestionTooltipIfNeeded(){if((0,F.partConfigEnabled)("profile_questions_enabled")&&this.descEl){const e=this.getCurStoryData();if(e?.isProfileQuestion){const e=this.descEl.querySelector(".StoryProfileQuestionLink"),t=e?.querySelector(".StoryInfo__icon");if(!e||!t)return;this.profileQuestionTooltipContent=(0,S.se)(`\n          <div class="StoryProfileQuestionTooltip__inner">\n            <div class="StoryProfileQuestionTooltip__title">${ae.getLang("global_ask_feature")}</div>\n            <div class="StoryProfileQuestionTooltip__text">${ae.getLang("stories_profile_question_tooltip_description")}</div>\n            <a href="/question?ref=story" class="StoryProfileQuestionTooltip__btn" target="_blank">${ae.getLang("stories_profile_question_tooltip_btn")}</a>\n          </div>\n        `);let s=!1;this.profileQuestionTooltip=new k.ElementTooltip(t,{appendTo:this.wrapEl,forceSide:"bottom",align:"left",centerShift:(0,S.getXY)(this.authorImg)[0]-(0,S.getXY)(t)[0],cls:"StoryProfileQuestionTooltip",noHideOnClick:!0,width:291,content:this.profileQuestionTooltipContent,onShow:()=>{this.isPaused()?s=!0:this.pauseStory()},onHide:()=>{s||this.playStory()}}),e?.addEventListener("mouseenter",this.showMyProfileQuestionsTooltip)}}}destroyProfileQuestionTooltipIfNeeded(){if(!this.profileQuestionTooltip)return;const e=this.descEl?.querySelector(".StoryProfileQuestionLink");e?.removeEventListener("mouseenter",this.showMyProfileQuestionsTooltip),this.profileQuestionTooltip.destroy()}_onModalsShownChange(e=!1){this.isModalShown=e}showInlineLoader(){(0,S.show)(this.inlineLoader)}hideInlineLoader(){(0,S.hide)(this.inlineLoader)}volumeUpdate(){const e=this.story;e&&e.volumeUpdate&&e.volumeUpdate()}_onAutoPlayFail(){(0,S.addClass)(this.wrapEl,"autoplay_failed")}hideReply(){(0,x.showFastBox)({title:ae.getLang("global_warning"),onHide:()=>{this.autoResumeStory()}},ae.getLang("stories_hide_reply_warning"),ae.getLang("global_continue"),this._doHideReply.bind(this),ae.getLang("global_cancel"))}_doHideReply(){if(!this.data.author)return;this.pauseStory(),(0,S.addClass)(this.wrapEl,"hiding_reply"),(0,I.curBox)()?.hide();const e=this.getIndex(),t=this.data.author.gender,s=(0,S.se)(`<div class="stories_hide_reply_wrap loading">\n  <div class="stories_inline_loader">${(0,N.getProgressHtml)()}</div>\n  <div class="stories_hide_reply_cont">\n    <div class="stories_hide_reply_icon"></div>\n    <div class="stories_hide_reply_info">${ae.getLang("stories_reply_hidden")}</div>\n    <div class="stories_hide_reply_continue_button _stories_reply_continue">${ae.getLang("stories_hide_reply_continue")}</div>\n  </div>\n  <div class="stories_hide_reply_other_actions">\n    <div class="stories_hide_reply_other_action _stories_hide_replies">${(0,T.langSex)(t,ae.getLang("stories_hide_all_replies"))}</div>\n    <div></div>\n    <div class="stories_hide_reply_other_action _stories_reply_ban">${ae.getLang("stories_reply_add_to_blacklist")}</div>\n  </div>\n</div>`);(0,C.addEvent)((0,S.geByClass1)("_stories_reply_continue",s),"click",(()=>this._replyHideEnd(e))),(0,C.addEvent)((0,S.geByClass1)("_stories_hide_replies",s),"click",this._hideAllReplies.bind(this)),(0,C.addEvent)((0,S.geByClass1)("_stories_reply_ban",s),"click",this._ban.bind(this)),this.contWrap.appendChild(s),(0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?de.storiesService.hideReplyFx({owner_id:Number(this.getOwnerId()),story_id:this.getStoryId()}).then((()=>{this.opts.removeCurrentList(),window.cur.needUpdateFeedStories=!0})).catch((()=>{this._resetReplyHide(),this.playStory()})).finally((()=>{(0,S.removeClass)(s,"loading")})):window.ajax.post("al_stories.php",{act:"hide_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:()=>{this.opts.removeCurrentList(),window.cur.needUpdateFeedStories=!0},onFail:()=>(this._resetReplyHide(),this.playStory(),!0),hideProgress:()=>(0,S.removeClass)(s,"loading")})}_resetReplyHide(){(0,S.re)((0,S.geByClass1)("stories_hide_reply_wrap",this.contWrap)),(0,S.removeClass)(this.wrapEl,"hiding_reply")}_hideAllReplies(){if(!this.data.author)return;const e=this.data.author.first_name_gen;(0,x.showFastBox)({title:ae.getLang("global_warning")},ae.getLang("stories_delete_all_replies_confirm").replace("{name}",e),ae.getLang("global_continue"),this._doHideAllReplies.bind(this),ae.getLang("global_cancel"))}_doHideAllReplies(e){(0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?((0,E.lockButton)(e),de.storiesService.hideAllRepliesFx({owner_id:Number(this.getOwnerId())}).then((()=>{(0,I.curBox)()?.hide(),this.opts.removeCurrentList(),this.data.items=[];const e=(0,S.geByClass1)("_stories_hide_replies",this.contWrap);(0,S.val)(e,ae.getLang("stories_all_replies_hidden")),(0,S.addClass)(e,"disabled")})).finally((()=>{(0,E.unlockButton)(e)}))):window.ajax.post("al_stories.php",{act:"hide_all_replies",owner_id:this.getOwnerId(),hash:this.data.reply_hide_hash},{onDone:()=>{(0,I.curBox)()?.hide(),this.opts.removeCurrentList(),this.data.items=[];const e=(0,S.geByClass1)("_stories_hide_replies",this.contWrap);(0,S.val)(e,ae.getLang("stories_all_replies_hidden")),(0,S.addClass)(e,"disabled")},showProgress:()=>(0,E.lockButton)(e),hideProgress:()=>(0,E.unlockButton)(e)})}_ban(){if(!this.data.author)return;const e=this.data.author.first_name_gen;(0,x.showFastBox)({title:ae.getLang("global_warning")},ae.getLang("stories_ban_confirm").replace("{name}",e),ae.getLang("global_continue"),this._doBan.bind(this),ae.getLang("global_cancel"))}_doBan(e){(0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?((0,E.lockButton)(e),de.userService.accountBanFx({params:{owner_id:Number(this.getOwnerId())}}).then((()=>{(0,I.curBox)()?.hide(),this.opts.removeCurrentList(),this.data.items=[];const e=(0,S.geByClass1)("_stories_reply_ban",this.contWrap);(0,S.val)(e,ae.getLang("stories_banned")),(0,S.addClass)(e,"disabled")})).finally((()=>{(0,E.unlockButton)(e)}))):window.ajax.post("al_stories.php",{act:"ban",owner_id:this.getOwnerId(),hash:this.data.stories_ban_hash},{onDone:()=>{(0,I.curBox)()?.hide(),this.opts.removeCurrentList(),this.data.items=[];const e=(0,S.geByClass1)("_stories_reply_ban",this.contWrap);(0,S.val)(e,ae.getLang("stories_banned")),(0,S.addClass)(e,"disabled")},showProgress:()=>(0,E.lockButton)(e),hideProgress:()=>(0,E.unlockButton)(e)})}_replyHideEnd(e){if((0,S.geByClass1)("stories_hide_reply_wrap",this.contWrap)){if(this.data.items.length<=1){const e=this.getOwnerId();e&&c.onReplyDeleted(e)}this._resetReplyHide(),this._removeStoryFromMemoryByIndex(e||this.getIndex(),!(0,L.isNumeric)(e))}}_feedbackRemoveReplyFromDom(e){const t=(0,S.geByClass1)("stories_feedback_content",this.wrapEl);if(!t)return;const s=t.querySelector(`#feed_story_${e}`);s&&(0,S.addClass)(s,"removed")}onReplyDeleted(e){this._feedbackRemoveReplyFromDom(e)}_updateFeedStoryPreview(){let e=(0,S.ge)(`feed_story_${this.layer.getBlockKey(this.data)}`);if(!e||e.classList.contains("stories_feed_reply_item")||!e.classList.contains("stories_feed_preview_item"))return;let t=this.indexToUnread(!0);if(t){let s=this.data.items[t];!s&&this.getFullItemsLength()-1===t&&this.data.grouped?.length&&this.data.grouped.some((e=>e.items.some((e=>{if(e.unread)return s=e,!0})))),s&&s.small_preview&&(0,S.setStyle)(e,"background-image",`url(${s.small_preview})`)}}sendStatEvent(e){const t=this.getCurStoryData();if(t)(0,ce.isActsToApi2ForVKCOMViewerEnabled)()?de.statsService.trackEventsFx({events:JSON.stringify([{e:ue.STATS_EVENT_TYPE_STORY_LINK_VIEW,owner_id:this.getOwnerId(),story_id:this.getStoryId(),track_code:this.getTrackCode()}])}).catch((e=>{console.error("story view link click stat has failed",e)})):window.ajax.post("al_stories.php",(0,L.extend)({act:"stat",source_story:this.getRawId(),track_code:this.getTrackCode()},t.stats[e]));else{this.isActiveMetaStory()||(0,R.logError)(new Error("Fail: sendStatEvent"),{environment:"stories"})}}report(){const e=this.getCurStoryData(),t=this.getCurrentNarrative();if(e)if(e.isAds){const s=e.track_code;let i="";const o=(0,x.showBox)("/reports.php",{act:"report_ad_box",track_code:s,type:"story"},{onDone(){const e=(0,S.geByClass)("radiobtn","ad_report");window.radioBtns.ad_report={val:0,els:e};const t=(0,S.ge)("ad_csrf");i=t?t.value:i},params:{onClean:()=>{delete window.radioBtns.ad_report,this.playStory()}},stat:["reports.css"]});o.removeButtons(),o.addButton(ae.getLang("box_send"),(e=>{window.ajax.post("reports.php",{act:"report_ad_common",track_code:s,reason:window.radioBtns.ad_report.val,hash:i},{onDone:()=>{const e=this.index;o.hide(),this.layer.sendNavigationStatEvents("claim"),t||this._popStoryAndClearList(e),(0,I.showDoneBox)(ae.getLang("stories_report_sent"),{className:"stories_done_msg"}),this.updateNarrativeBlockIfNeeded()},showProgress:()=>(0,E.lockButton)(e),hideProgress:()=>(0,E.unlockButton)(e)})})),o.addButton(ae.getLang("global_cancel"),!1,"no")}else{if(this.isActiveLive()&&!(0,ce.isActsToApiFirstForVKCOMViewerEnabled)())return void this.showReportLiveBox();const e=()=>this.playStory();if(t)(0,U.showReportForm)("narrative",t.ownerId,t.id,void 0,e);else{const[t,s]=this.getRawId().split("_"),i=parseInt(t),o=parseInt(s);(0,U.showReportForm)("story",i,o,void 0,e)}}else(0,R.logError)(new Error("Fail: report"),{environment:"stories"})}showReportLiveBox(){const e=(0,x.showBox)("al_stories.php",{act:"report_box"},{onDone:()=>{const e=(0,S.geByClass)("radiobtn","stories_report");window.radioBtns.stories_report={val:0,els:e}},params:{onClean:()=>{delete window.radioBtns.stories_report,this.playStory()}}});e.removeButtons(),e.addButton(ae.getLang("box_send"),this._sendReportButtonDidPress.bind(this)),e.addButton(ae.getLang("global_cancel"),!1,"no")}_sendReportButtonDidPress(e){const t=this.getCurStoryData();if(!t)return void(0,R.logError)(new Error("Fail: _sendReportButtonDidPress"),{environment:"stories"});const s=this.index,{report_hash:i}=t,o=this.getCurrentNarrative();let r,n;o?(r=`${o.rawId}`,n=o.reportHash):(r=this.getRawId(),n=i),window.ajax.post("al_stories.php",{act:"report",type:o?"narrative":"story",item_raw:r,reason:window.radioBtns.stories_report.val,hash:n},{onDone:()=>{(0,I.curBox)()?.hide(),this.layer.sendNavigationStatEvents("claim"),o||this._popStoryAndClearList(s),(0,I.showDoneBox)(ae.getLang("stories_report_sent"),{className:"stories_done_msg"})},showProgress:()=>(0,E.lockButton)(e),hideProgress:()=>(0,E.unlockButton)(e)})}onLiveEnded(e=!1){this.isActiveLive()&&(this.data.items[this.index]&&(this.data.items[this.index].can_share=!e),this.story&&this.story.onLiveEnded(),this.updateBottom())}updateLiveViewersCount(e){this.descEl&&(this.descEl.innerHTML=e)}isActiveStoryOneTime(){return this.story instanceof H.MediaStory&&(this.story&&this.story.isOneTime())}buildStoryArchiveByActive(){const e=this.getRawId(),t=this.getCurStoryData();if(!e||!t)return;const[,s]=e.split("_");return{id:Number(s),rawId:e,listId:this.layer.listName,preview:t.small_preview,originalPreviewUrl:t.small_preview,time:t.time}}editCurrentNarrative(){const e=this.getCurStoryData(),t=this.getCurrentNarrative(),s=this.getOwnerId();if(!e||!s)return;if(this.pauseStory(),this.isModalShown=!0,!t)return;let i=[];t?.stories.length&&(i=[...t.stories]);const o={selectedStories:i,narrative:t,onSave:()=>{this.opts.afterNarrativeEdited?.()},onClose:e=>{this.isModalShown=!1,this.updateBottom(),e&&(this.updateNarrativeBlockIfNeeded(),this.opts.removeCurrentList(),this.remove(!1))},navScreen:j.NarrativeAnalyticNavScreen.storyViewer};(0,D.showNarrativeEditorBox)(s,o)}updateNarrativeBlockIfNeeded(){(0,O.updateNarrativeBlock)()}renderAvatar(){this.avatarWrap&&this.avatarPhoto&&this.data.author&&n.render((0,i.jsx)(J.AppRootProvider,{children:this.isBestFriends()?(0,i.jsx)(ee.TextTooltip,{maxWidth:360,placement:"bottom-start",text:(0,i.jsx)(te.LangTag,{className:(0,se.getColorClass)("color_text_positive"),tag:"tag",enableInnerHTML:!0,children:(0,ae.langReplace)(ae.getLang("stories_tooltip_best_friends_web"),{name:(0,le.clean)(this.data.author.name_get)})}),onShownChange:e=>{e?(this.pauseStory(),this.layer.sendNavigationStatEvents("click_on_badge")):this.playStory()},children:(0,i.jsx)(ie.RichAvatar,{src:this.avatarPhoto,nft:Boolean(this.data.author.nft),size:36,children:(0,i.jsx)(ie.RichAvatar.Badge,{children:(0,i.jsx)(ne.Icon20FavoriteCircleFillGreen,{})})})}):(0,i.jsx)(ie.RichAvatar,{src:this.avatarPhoto,nft:Boolean(this.data.author.nft),size:36,children:this.isActiveLive()&&(0,i.jsx)(ie.RichAvatar.BadgeWithPreset,{preset:"live"})})}),this.avatarWrap)}_render(e,t){n.render((0,i.jsx)(J.AppRootProvider,{children:e}),t)}constructor(e,t){this.storyBottomRef=(0,r.createRef)(),this.updateBottom=e=>{const t=(0,S.geByClass1)("stories_bottom_wrap",this.wrapEl);this.isActive&&!e&&this.story&&!this.isActiveMetaStory()?(this.resetNewRepliesCounterIfNeeded(),this._render((0,i.jsx)(_.StoryBottom,{story:this,markAppNotificationsSeen:this.markAppNotificationsSeen,ref:this.storyBottomRef}),t)):(n.unmountComponentAtNode(t),(0,S.val)(t,""))},this.longTapHandle=()=>{this.isActiveStoryOneTime()||(this.story&&this.story.pause(),(0,S.addClass)(this.wrapEl,"paused"),this.isTooltipOpened()||this.layer.sendNavigationStatEvents("pause_long_tap"))},this.playStory=(e=!1,t=!1)=>{this.isLocked()||((0,S.removeClass)(this.wrapEl,"paused"),this.story&&!e||this._initStory(),this.story&&this.story.play(),t&&this.layer.sendNavigationStatEvents("resume_release"),delete this.downTs)},this.pauseStory=e=>{this.story&&(this.isPaused()||(e&&(0,S.addClass)(this.wrapEl,"paused"),this.story.pause()))},this.toggleMetaStoryTitle=e=>{this.metaStoryTitle&&this.metaStoryTitle.classList.toggle("MetaStoryTitle--hide",!e)},this.nextStory=(e=!1)=>{if(this.isLocked())return;e||this.layer.sendNavigationStatEvents("go_to_next_story_tap");let t=this.index+1;t<this.getFullItemsLength()?(e&&this.layer.sendNavigationStatEvents("go_to_next_story_auto_by_time"),this.changeStory(t)):(this.opts.onStoriesEnd(e),this._destroyStory())},this.prevStory=()=>{if(this.isFeedbackTooltipShow&&this.hideFeedbackTooltip(),this.isLocked())return;this.layer.sendNavigationStatEvents("go_to_previous_story");let e=this.index-1;e>=0?this.changeStory(e):(this.opts.playPrevOwner(),this._destroyStory())},this.showMyProfileQuestionsTooltip=()=>{this.profileQuestionTooltip?.show()},this.markAppNotificationsSeen=e=>{const t=this.getCurStoryData();if(!t)return void(0,R.logError)(new Error("Fail: markAppNotificationsSeen"),{environment:"stories"});const{raw_id:s=""}=t;if(!e.appId||!e.appRef)return;const[i,r]=s.split("_");e.hasNewInteractions&&((0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?de.storiesService.markAppNotificationsSeenFx({owner_id:Number(i),story_id:Number(r),sticker_id:e.id}).then((()=>{t.clickable_stickers&&t.clickable_stickers.stickers&&t.clickable_stickers.stickers.forEach((t=>{t.id===e.id&&t.type===o.StickerTypes.app&&(t.hasNewInteractions=!1)})),this.updateBottom();const s=document.querySelector(`#feed_story_${i} .stories_feed_preview_app`);s&&s.classList.contains("has_new")&&s.classList.remove("has_new")})):window.ajax.post("al_stories.php",{act:"mark_app_notifications_seen",owner_id:i,story_id:r,sticker_id:e.id,hash:e.hash},{onDone:()=>{t.clickable_stickers&&t.clickable_stickers.stickers&&t.clickable_stickers.stickers.forEach((t=>{t.id===e.id&&t.type===o.StickerTypes.app&&(t.hasNewInteractions=!1)})),this.updateBottom();const s=document.querySelector(`#feed_story_${i} .stories_feed_preview_app`);s&&s.classList.contains("has_new")&&s.classList.remove("has_new")}})),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),this.pauseStory(),(0,P.showWiki)({w:`app${e.appId}`,app_ref:e.appRef,app_hash:e.appHash}),this.layer.sendNavigationStatEvents("click_to_app",!0,{clickable_sticker:{id:e.id,type:"app"}})},this.toggleFeedbackTooltip=(e=!this.isFeedbackTooltipShow)=>{e?this.showFeedbackTooltip():this.hideFeedbackTooltip()},this.onFetchFeedbackData=e=>{this.feedback=e;const t=e?.replies?.repliesTotalCountText,s=e?.viewers?.viewsTotalCountText,i=e?.replies,o=i?.listName,r=i?.list;t&&this.setReplies(t),s&&this.setViews(s),i&&r&&(window.cur=(0,L.extend)(window.cur,{[`stories_list_${o}`]:r}),i.list=r.length>w.INIT_MAX_FEEDBACK_STORIES_COUNT?r.slice(0,w.INIT_MAX_FEEDBACK_STORIES_COUNT):r,i.moreRepliesCount=r.length-i.list.length),this.updateBottom()},this.showMoreReplies=()=>{const e=this.feedback?.replies,t=e?.listName,s=e?.list;if(t&&e&&s){const s=(0,ye.getStoryList)(t);if(!s)return;e.list=s.slice(0,e.list.length+w.MAX_FEEDBACK_STORIES_SLICE_COUNT),e.moreRepliesCount=s.length-e.list.length,this.updateBottom()}},this.onFetchViewers=e=>{this.feedback?.viewers?.items&&(this.feedback.viewers.items=this.feedback.viewers.items.concat(e.viewers),this.feedback.viewers.nextFrom=e.nextFrom,this.updateBottom())},this.onQuestionRemove=e=>{this.feedback?.questions?.items&&(this.feedback.questions.items=this.feedback.questions.items.filter((t=>t.id!==e)),this.feedback.questions.items.length||delete this.feedback.questions,this.updateBottom())},this.onPrivacyHintHide=()=>{this.feedback?.stats?.showPrivacyHint&&((0,ce.isActsToApiFirstForVKCOMViewerEnabled)()?de.storiesService.hidePrivacyBlockFx({}):window.ajax.post("al_stories.php",{act:"hide_privacy_hint",privacy_hint_hash:this.feedback.stats.privacyHintHash}),this.feedback.stats.extendedStats?this.feedback.stats.showPrivacyHint=!1:delete this.feedback.stats,this.updateBottom())},this.onAddToNarrativeBtnClick=()=>{const e=this.getCurStoryData();if(!e)return;this.pauseStory(),this.isModalShown=!0;const t=this.getOwnerId(),s=this.buildStoryArchiveByActive();if(!s||!t)return;const i={ownerId:t,story:s,onClose:e=>{this.isModalShown=!1,this.updateBottom(),this.playStory(),e&&this.updateNarrativeBlockIfNeeded()},onSave:t=>{e.isPartOfNarrative=t},navScreen:j.NarrativeAnalyticNavScreen.storyViewer};(0,D.showNarrativeChooseBox)(i),(0,j.sendNarrativeAnalytic)(j.NarrativeAnalyticEventType.clickToAddToNarrative,{ownerId:t},j.NarrativeAnalyticNavScreen.storyViewer)},this.data=e,this.opts=t,this.id=t.id,this.isActive=!1,this.isSendFormFocused=!1,this.isModalShown=!1,this.isFeedbackTooltipShow=!1,this.pressedStory=null,this.index=0,this._currentTimeLineAdditionalEl=null,this._currentTimeLineEl=null,this.preloadedStories={},this.layer=t.layer}}},722180:(e,t,s)=>{s.d(t,{showStoryBlackList:()=>r});var i=s(159663),o=s(190328);function r(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory(),(0,i.showBox)("al_stories.php",{act:"black_list"},{onDone(){window.cur.storiesBlackListScroll=new o.UiScroll("stories_black_list_result")},params:{onHide:()=>{window.cur.storyLayer&&window.cur.storyLayer.playStory()}}})}},598015:(e,t,s)=>{s.d(t,{onPlayerChange:()=>l});var i=s(541762),o=s(802130),r=s(659397),n=s(65718);let a;function l(e){if(!i.HAS_MEDIA_SESSION)return;a=e;const t=a.getCurStoryData(),s=a.isActiveMetaStory();if(!t)return void(s||(0,n.logError)(new Error("Fail story media session"),{environment:"stories"}));if(!["video"].includes(t.type)||t.noSound)return void(0,i.clear)();const o=a.data.author?(0,r.decodeHTMLEntities)(a.data.author.name):"",l=(0,r.decodeHTMLEntities)(t.date),u=t.small_preview||t.photo_url||t.first_frame||t.preview_url,p=u?[{sizes:"800x1497",src:u}]:[];!function(){if(!i.HAS_MEDIA_SESSION)return;navigator.mediaSession.setActionHandler("play",d),navigator.mediaSession.setActionHandler("pause",c),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",h),navigator.mediaSession.setActionHandler("nexttrack",_)}(),(0,i.updateMediaSessionMetadata)({title:o,artist:l,album:"",artwork:p})}function d(){a.playStory(),(0,o.statlogsValueEvent)("global_media_controls","story_player","play")}function c(){a.pauseStory(),(0,o.statlogsValueEvent)("global_media_controls","story_player","pause")}function h(){a.prevStory(),(0,o.statlogsValueEvent)("global_media_controls","story_player","previous_track")}function _(){a.nextStory(),(0,o.statlogsValueEvent)("global_media_controls","story_player","next_track")}},879692:(e,t,s)=>{s.d(t,{isActsToApi2ForVKCOMViewerEnabled:()=>a,isActsToApiFirstForVKCOMViewerEnabled:()=>n,isApiForVKCOMViewerEnabled:()=>o,isMinimizedStoryFeedBlockEnabled:()=>r,isStickerTemplateEnabled:()=>l});var i=s(977053);function o(){return Boolean((0,i.partConfigEnabled)("stories_web_api"))}function r(){return Boolean((0,i.partConfigEnabled)("stories_minimized_feed_block"))}function n(){return(0,i.partConfigEnabled)("stories_web_acts_to_api_1")}function a(){return(0,i.partConfigEnabled)("stories_web_acts_to_api_2")}function l(){return(0,i.partConfigEnabled)("stories_sticker_template")}},152259:(e,t,s)=>{s.d(t,{STORY_DURATION:()=>i});const i=5e3},578526:(e,t,s)=>{s.d(t,{default:()=>l});var i=s(961462),o=s(959302),r=s(70689),n=s(30655),a=s(93367);class l extends i.MediaStory{render(){if(this.onStartLoading(),this.video)return this.video;const{video_url:e}=this.data;return this.video=document.createElement("video"),this.video.setAttribute("class","stories_video"),this.video.setAttribute("autoplay","false"),this.video.setAttribute("volume",(0,n.getAudioPlayer)().getVolume()),this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),(0,a.addEvent)(this.video,"error",(()=>{this._loadingError()})),this._isFailed()||(this.loaded&&(this.video.currentTime=0),(0,a.addEvent)(this.video,"canplay",this.canPlay.bind(this)),this.video.src=e,this.volumeUpdate()),this.video}getContainer(){return this.video||this.render()}getImage(){const e=(0,r.getSize)(this.video),t=document.createElement("canvas");t.setAttribute("width",e[0].toString()),t.setAttribute("height",e[1].toString());const s=t.getContext("2d");return s&&s.drawImage(this.video,0,0,e[0],e[1]),t.toDataURL()}destroy(){super.destroy(),(0,a.removeEvent)(this.video),delete this.video}play(){if(super.play(),this.loaded&&this.video){const e=this.video.play();void 0!==e&&e.catch((()=>{this.options.onAutoPlayFail?.()}))}}pause(){super.pause(),this.video&&this.video.pause()}setCurrentTime(e=0){e=+(e/1e3).toFixed(1),this.loaded&&this.video.currentTime<e&&(this.video.currentTime=e)}getCurrentTime(){return 1e3*this.video.currentTime}getDuration(){return 1e3*this.video.duration}volumeUpdate(){this.video.volume=o.getVolume()}canPlay(){super.canPlay(),!this.isFirstChunkLoaded&&window.cur.storyLayer&&(this.isFirstChunkLoaded=!0,window.cur.storyLayer.sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0})),(0,r.setStyle)(this.video,"opacity",1),(0,a.removeEvent)(this.video,"canplay")}constructor(e,t,s){super(e,t,s),this.isFirstChunkLoaded=!1}}},487462:(e,t,s)=>{function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},i.apply(this,arguments)}s.d(t,{default:()=>i})},894578:(e,t,s)=>{s.d(t,{default:()=>o});var i=s(589611);function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,i.default)(e,t)}},263366:(e,t,s)=>{function i(e,t){if(null==e)return{};var s,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)s=r[i],t.indexOf(s)>=0||(o[s]=e[s]);return o}s.d(t,{default:()=>i})},589611:(e,t,s)=>{function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}s.d(t,{default:()=>i})}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,loadStylesheet,installedCssChunks;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(s.exports,s,s.exports,__webpack_require__),s.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,s,i)=>{if(!t){var o=1/0;for(l=0;l<deferred.length;l++){for(var[t,s,i]=deferred[l],r=!0,n=0;n<t.length;n++)(!1&i||o>=i)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[n])))?t.splice(n--,1):(r=!1,i<o&&(o=i));if(r){deferred.splice(l--,1);var a=s();void 0!==a&&(e=a)}}return e}i=i||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>i;l--)deferred[l]=deferred[l-1];deferred[l]=[t,s,i]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var s=Object.create(null);__webpack_require__.r(s);var i={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var o=2&t&&e;"object"==typeof o&&!~leafPrototypes.indexOf(o);o=getProto(o))Object.getOwnPropertyNames(o).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,__webpack_require__.d(s,i),s},__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,s)=>(__webpack_require__.f[s](e,t),t)),[])),__webpack_require__.u=e=>24817===e?"web/chunks/hls.b496ce21.js":77794===e?"web/chunks/7bdfc282.async.758ca0aa.js":95040===e?"web/chunks/cf5562e5.async.b4aed2d1.js":40530===e?"web/chunks/5ef6139d.async.f064c195.js":69488===e?"web/chunks/a7aba191.async.c36a6a36.js":67498===e?"web/chunks/19b9f4a7.async.9c26c7dc.js":24328===e?"web/chunks/c4004e28.async.ea2a65ee.js":27370===e?"web/chunks/2c9432b5.async.5b90c7cd.js":5157===e?"web/chunks/unauth_action_box.111478de.js":25394===e?"web/chunks/AudioLongtapModal.ab967a4b.js":75980===e?"web/chunks/menu_settings.7bdcde07.js":89334===e?"web/chunks/a228276f.async.a4e26c75.js":40928===e?"web/chunks/fcbd3ef2.async.877aa898.js":9914===e?"web/chunks/52fa6987.async.94be31b8.js":59727===e?"web/chunks/VideoUpload.d33511cc.js":9375===e?"web/chunks/voice_message_player.faac3006.js":28762===e?"web/chunks/speech.3083d7af.js":57468===e?"web/chunks/SilentModeForms.d5a6e099.js":28872===e?"web/chunks/feed-client-nav-skeleton.73bce91a.js":35953===e?"web/chunks/feed-client-nav-async-right-block.f4069a0d.js":29019===e?"web/chunks/ReportForm.fa1fcb63.js":73084===e?"web/chunks/96539bf4.async.9654cd5b.js":78192===e?"web/chunks/701b8118.async.fb5545b5.js":39386===e?"web/chunks/2d7de133.async.66d8dc10.js":4545===e?"web/chunks/4d4eaf41.async.eb9c7fc3.js":68346===e?"web/chunks/NewStickerPicker.115df0af.js":97066===e?"web/chunks/rlottie.212c27d9.js":58086===e?"web/chunks/06f378a9.async.96f62021.js":7103===e?"web/chunks/stickers-layer-view.1c2806e7.js":37211===e?"web/chunks/stickers-layer-purchase-details-view.2a588baa.js":39457===e?"web/chunks/stickers-random-selector-view.3b16ec21.js":78177===e?"web/chunks/stickers-random-selector-packs-view.5df4de88.js":34757===e?"web/chunks/stickers-random-selector-result-view.eb42f591.js":378===e?"web/chunks/79f739a7.async.6dfc0f2b.js":72491===e?"web/chunks/story_blocks.dfab0b41.js":85059===e?"web/chunks/059ba3af.async.1897b369.js":67724===e?"web/chunks/VideoEditorModal.eb979233.js":22854===e?"web/chunks/PublishClipToVideoModal.dae3ac0f.js":30271===e?"web/chunks/VideoUploadModal.b8d73da8.js":31286===e?"web/chunks/VideoExternalUploadModal.2c5830cb.js":969===e?"web/chunks/0dc980e6.async.f010f601.js":92846===e?"web/chunks/ClipUploadModal.8eff9d1c.js":59240===e?"web/chunks/performance-stats.b497cf49.js":13503===e?"web/chunks/StickersKit-AgeRestrictionModal.dbdc1610.js":7308===e?"web/chunks/7308.e4292e75.js":34808===e?"chunks/"+e+".c8e9c7bc.js":53297===e?"chunks/"+e+".a3bee52c.js":71475===e?"chunks/"+e+".db838172.js":1854===e?"chunks/1854.9b4b0c68.js":18254===e?"chunks/"+e+".0ac520ae.js":92398===e?"chunks/"+e+".18cb85f5.js":"web/chunks/videoplayer-interactive.c61a72cb.js",__webpack_require__.miniCssF=e=>({5157:1,59727:1}[e]?"web/chunks/b1037836.css":25394===e?"web/chunks/6a66a172.css":75980===e?"web/chunks/5bbee2c9.css":57468===e?"web/chunks/122e7a6e.css":29019===e?"web/chunks/fb872de1.css":68346===e?"web/chunks/5e4183b8.css":97066===e?"web/chunks/68f9f3a8.css":7103===e?"web/chunks/3bdfe57e.css":37211===e?"web/chunks/3318c635.css":39457===e?"web/chunks/d9a18422.css":78177===e?"web/chunks/205d0569.css":34757===e?"web/chunks/f10155d6.css":72491===e?"web/chunks/6b53e0ac.css":67724===e?"web/chunks/3c048aa6.css":22854===e?"web/chunks/70c35bc4.css":{30271:1,31286:1}[e]?"web/chunks/f89919fd.css":92846===e?"web/chunks/83ceb5be.css":13503===e?"web/chunks/572d6e8a.css":void 0),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,s,i)=>{if(inProgress[e])inProgress[e].push(t);else{var o,r;if(void 0!==s)for(var n=document.getElementsByTagName("script"),a=0;a<n.length;a++){var l=n[a];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")=="vk:"+s){o=l;break}}o||(r=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.setAttribute("data-webpack","vk:"+s),o.src=e),inProgress[e]=[t];var d=(t,s)=>{o.onerror=o.onload=null,clearTimeout(c);var i=inProgress[e];if(delete inProgress[e],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((e=>e(s))),t)return t(s)},c=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),r&&document.head.appendChild(o)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",loadStylesheet=e=>new Promise(((t,s)=>{var i=__webpack_require__.miniCssF(e),o=__webpack_require__.p+i;if(((e,t)=>{for(var s=document.getElementsByTagName("link"),i=0;i<s.length;i++){var o=(n=s[i]).getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(o===e||o===t))return n}var r=document.getElementsByTagName("style");for(i=0;i<r.length;i++){var n;if((o=(n=r[i]).getAttribute("data-href"))===e||o===t)return n}})(i,o))return t();((e,t,s,i)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.onerror=o.onload=r=>{if(o.onerror=o.onload=null,"load"===r.type)s();else{var n=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=n,l.request=a,o.parentNode.removeChild(o),i(l)}},o.href=t,document.head.appendChild(o)})(e,o,t,s)})),installedCssChunks={75583:0},__webpack_require__.f.miniCss=(e,t)=>{installedCssChunks[e]?t.push(installedCssChunks[e]):0!==installedCssChunks[e]&&{5157:1,7103:1,13503:1,22854:1,25394:1,29019:1,30271:1,31286:1,34757:1,37211:1,39457:1,57468:1,59727:1,67724:1,68346:1,72491:1,75980:1,78177:1,92846:1,97066:1}[e]&&t.push(installedCssChunks[e]=loadStylesheet(e).then((()=>{installedCssChunks[e]=0}),(t=>{throw delete installedCssChunks[e],t})))},(()=>{__webpack_require__.b=document.baseURI||self.location.href;var e={75583:0};__webpack_require__.f.j=(t,s)=>{var i=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var o=new Promise(((s,o)=>i=e[t]=[s,o]));s.push(i[2]=o);var r=__webpack_require__.p+__webpack_require__.u(t),n=new Error;__webpack_require__.l(r,(s=>{if(__webpack_require__.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;n.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",n.name="ChunkLoadError",n.type=o,n.request=r,i[1](n)}}),"chunk-"+t,t)}},__webpack_require__.O.j=t=>0===e[t];var t=(t,s)=>{var i,o,[r,n,a]=s,l=0;if(r.some((t=>0!==e[t]))){for(i in n)__webpack_require__.o(n,i)&&(__webpack_require__.m[i]=n[i]);if(a)var d=a(__webpack_require__)}for(t&&t(s);l<r.length;l++)o=r[l],__webpack_require__.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return __webpack_require__.O(d)},s=self.webpackChunkvkweb=self.webpackChunkvkweb||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var __webpack_exports__=__webpack_require__.O(void 0,[213,83737,2067,20795,57451,5038,71610,36834,95167,39056,74623,75934,28056,63580,38234,250,95245,57491,67654,51587],(()=>__webpack_require__(685424)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();